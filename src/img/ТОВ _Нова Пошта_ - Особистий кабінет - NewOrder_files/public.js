function dump(e){var t="";if(e&&"object"==typeof e)for(var a in e)t+=a+": "+e[a]+"\n";else t=e;console.log(t)}$config_$additionalServices={};var $additionalServices={_processedCounterpartyType:"",_processSelectCounterpartyText:"",init:function(){var e=$("body");$("input.beginDateTime, input.endDateTime").on("change",function(e){$additionalServices.filterAjax(),e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()}),$(".filterSubmit").on("click",function(e){$additionalServices.filterAjax(),e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()}),e.on("keypress keyup",".allowed-char",function(e){var t,a=e.which,i=String.fromCharCode(a),r=[0,8,9,13,16,17,36,37,38,39,40,46],n=[22,86,118];switch($(this).data("allowed-type")){case"cyrillic":t=/[а-я\s\-ёєії\d]/i}var d=-1!=$.inArray(a,n)&&e.ctrlKey;return!(-1==$.inArray(a,r)&&!i.match(t)&&!d)}),e.on("change",".allowed-char",function(){switch($(this).data("allowed-type")){case"cyrillic":$(this).val($(this).val().replace(/[^а-я\s\-ёєії\d]+/i,""))}}),$("#addresses_ul, #payer_ul, #payment_form_ul, #reasons_ul, #subreasons_ul").on("click","li",function(){if(!$(this).hasClass("disabled")){var e=$(this),t=e.parent();e.siblings().removeClass("active"),e.addClass("active");var a=t.data("inputId"),i=e.data("city"),r=e.data("counterparty"),n=e.data("contactperson"),d=e.data("noncash"),o=e.data("noncashonly");if($("#city_text_ul li a").text(i),$("#counterparties_ul li a").text(r),$("#contacts_ul li a").text(n),0==d&&($("#payment_form_ul li:nth-child(1)").addClass("disabled"),$("#payment_form_ul li:nth-child(2)").click()),1==o&&($("#payment_form_ul li:nth-child(1)").click(),$("#payment_form_ul li:nth-child(2)").addClass("disabled")),a){var s=$("#"+a);s.val(e.data("ref")).trigger("change")}}}),$("#addresses_ul").on("click","li",function(){$("#address_ul a").text($(this).text())}),$("#selectAddress").click(function(){$("#RecipientAddress").val()&&$(this).closest(".row-fluid").hide().next(".row-fluid").show()}),$("#reasons_ul li").on("click",function(){var e=$(this),t=e.data("ref");$additionalServices.subreasons_filter(t)}),$("#subreasons_ul li").hide(),$("#addresses_block").hide();var t=!1;$("#formSaveOrder").ajaxForm({initFields:function(){$additionalServices.initFields($("#formSaveOrder").find("button"))},beforeSubmit:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],t||(t=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide())},success:function(e){$(".control-group").removeClass("error"),null!=e&&void 0!=e.success?(e.success===!0&&$("#documentCreatedModal").find("div.modal-body").html("<p> <b>"+e.data[0].MessageText+"</b> </p>").end().modal(),e.errors.length&&$.each(e.errors,function(e,t){$noty.push(noty(Yii.t("additionalServices/js",t),3e3))}),e.warnings.length&&$.each(e.warnings,function(e,t){$noty.push(noty(Yii.t("additionalServices/js",t),3e3,"warning"))})):$noty.push(noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")))},complete:function(){t=!1,$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),$noty.push(noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))),t=!1}}),$("#formRedirecting").ajaxForm({beforeSubmit:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],t||(t=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide())},success:function(e){if($(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0){var t="",a="";e.errors.length&&(t+="<ul>",$.each(e.errors,function(e,a){t+="<li>"+Yii.t("additionalServices/js",a)+" </li>"}),t+="</ul>"),e.warnings.length&&(a+="<ul>",$.each(e.warnings,function(e,t){a+="<li>"+Yii.t("additionalServices/js",t)+" </li>"}),a+="</ul>"),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Номер документа:")+" <b>"+e.data[0].Number+"</b> </p>"+a).end().modal()}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("additionalServices/js",t)))}):noty(Yii.t("additionalServices/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){t=!1,$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),t=!1}}),$("#formReturn").ajaxForm({beforeSubmit:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],t||(t=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide())},success:function(e){if($(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0){var t="",a="";e.errors.length&&(t+="<ul>",$.each(e.errors,function(e,a){t+="<li>"+Yii.t("additionalServices/js",a)+" </li>"}),t+="</ul>"),e.warnings.length&&(a+="<ul>",$.each(e.warnings,function(e,t){a+="<li>"+Yii.t("additionalServices/js",t)+" </li>"}),a+="</ul>"),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Номер документа:")+" <b>"+e.data[0].Number+"</b> </p>"+a).end().modal()}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("additionalServices/js",t)))}):noty(Yii.t("additionalServices/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){t=!1,$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),t=!1}}),$("#formTermExtension").ajaxForm({beforeSubmit:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],t||(t=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide())},success:function(e){if(null!=e&&void 0!=e.success&&e.success===!0){var t="",a="";e.errors.length&&(t+="<ul>",$.each(e.errors,function(e,a){t+="<li>"+Yii.t("additionalServices/js",a)+" </li>"}),t+="</ul>"),e.warnings.length&&(a+="<ul>",$.each(e.warnings,function(e,t){a+="<li>"+Yii.t("additionalServices/js",t)+" </li>"}),a+="</ul>"),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Номер документа:")+" <b>"+e.data[0].Number+"</b> </p>"+a).end().modal()}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("additionalServices/js",t)))}):noty(Yii.t("additionalServices/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){t=!1,$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(e){console.log(e),$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),t=!1}}),$("#submitRedirectingButton").on("click",function(){$additionalServices.fillSelectedCounterparty()}),$(".button-clear").click(function(){var e=$(this).siblings("input");e.val("").trigger("keydown").trigger("change").focus()}),$(".removeOrder").off().on("click",function(e){e.preventDefault(),e.stopPropagation(),$additionalServices.orderRef=$(this).closest("tr").attr("id"),$("#removeOrderModal").modal("show")}),$("#removeOrderModalForm").ajaxForm({initFields:function(){$("input#removeOrderRef").val($additionalServices.orderRef)},beforeSubmit:function(){if($.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],!t){t=!0;var e=$additionalServices.showProgressRow($additionalServices.orderRef);$("#"+$additionalServices.orderRef).hide().after(e)}},success:function(e){if(e.success){noty(Yii.t("additionalServices/js","Заявка удалена"),3e3,"success");var t=$(".ordersList:visible").length;t||$("#emptyResult").show(),$("#orderCount").text(t)}else $("#"+$additionalServices.orderRef).show(),$(e.errors).each(function(e,t){noty(Yii.t("additionalServices/js",t),3e3,"error")})},complete:function(){$("#removeOrderModal").modal("hide"),$additionalServices.hideProgressRow($additionalServices.orderRef),t=!1},error:function(){$("#"+$additionalServices.orderRef).show(),noty(Yii.t("additionalServices/js","Возникла ошибка"),3e3,"error")}}),$(".phoneFlags").intlTelInput({onlyCountries:window.codeTelephoneCountries}),$additionalServices.activeLegendFoldedUnfolded(),$additionalServices.editable(e),$additionalServices.dblclickable(e),"undefined"!=typeof appParameters.warnings&&$.each(appParameters.warnings,function(e,t){noty(Yii.t("additionalServices/js",t),null,"warning","center")})},activeLegendFoldedUnfolded:function(){$LegendFoldedUnfolded=$("legend.folded, legend.unfolded"),$LegendFoldedUnfolded.unbind("click"),$LegendFoldedUnfolded.click(function(){var e=$(this),t=$("#"+e.data("children"));t.slideToggle("fast",function(){e.toggleClass("folded unfolded")})})},showProgressRow:function(e){var t=$("tr:first > th").length;return $("<tr>").attr("id",e+"_progress").append($("<td>").attr("colspan",t).append($("<div>").addClass("progress").addClass("progress-striped").addClass("active").css("margin","5px 0").append($("<div>").addClass("bar").addClass("bar-danger").css("width","100%"))))},hideProgressRow:function(e){$("#"+e+"_progress").hide()},fillSelectedCounterparty:function(){if($counterparties.check_fields_filled()){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),a=$counterparties.get_filled_element("address_ul"),i=$counterparties.get_filled_element("contacts_ul"),r=$counterparties.get_filled_element("payer_ul"),n=$counterparties.get_filled_element("payment_form_ul");$("#"+$additionalServices._processedCounterpartyType+"RecipientAreaRef").val(e.area),$("#"+$additionalServices._processedCounterpartyType+"RecipientCityRef").val(e.ref),$("#"+$additionalServices._processedCounterpartyType+"RecipientConglomeratesRef").val(e.conglomerates),$("#"+$additionalServices._processedCounterpartyType+"RecipientCounterpartyRef").val(t.ref),$("#"+$additionalServices._processedCounterpartyType+"RecipientAddressRef").val(a.ref),$("#"+$additionalServices._processedCounterpartyType+"RecipientContactRef").val(i.ref),$("#"+$additionalServices._processedCounterpartyType+"PayerType").val(r.ref),$("#"+$additionalServices._processedCounterpartyType+"PaymentMethod").val(n.type),$("#"+$additionalServices._processedCounterpartyType+"InfoTable").removeClass("hidden"),$("#"+$additionalServices._processedCounterpartyType+"CounterpartyText").html(t.description),$("#"+$additionalServices._processedCounterpartyType+"CounterpartyRef").val(t.ref),$("#"+$additionalServices._processedCounterpartyType+"ContactText").html(i.description),$("#"+$additionalServices._processedCounterpartyType+"ContactRef").val(i.ref),$("#"+$additionalServices._processedCounterpartyType+"PhoneText").html(i.phone),$("#"+$additionalServices._processedCounterpartyType+"Phone").val(i.phone),$("#"+$additionalServices._processedCounterpartyType+"EDRPOU").val(t.edrpou),$("#"+$additionalServices._processedCounterpartyType+"OwnershipForm").val(t.ownershipform),$("#"+$additionalServices._processedCounterpartyType+"CounterpartyType").val(t.counterpartytype);var d=$("#"+$additionalServices._processedCounterpartyType+"IsWarehouse");d.val(a.warehouse),$("#"+$additionalServices._processedCounterpartyType+"SelectButton").text($additionalServices._processSelectCounterpartyText),$("#selectCounterpartyModal").modal("hide")}},subreasons_filter:function(e){e=e||"",$("#subreasons_ul li").each(function(){$(this).data("reason")==e?$(this).show():$(this).hide()})},filterAjax:function(){var e=$("body").find("thead").find("input"),t=[];$(e).each(function(){this.name.length>0&&(t[this.name]=$(this).val())});var a=$(".templatesList");$("#progressLoadingForm").show(),$.ajax({url:"/"+window.CurrentController+"/"+window.CurrentAction,dataType:"html",type:"POST",data:{partial:!0,Number:t.Number,OwnerDocumentNumber:$("#OwnerDocumentNumber").val(),DateTime:t.DateTime,BeginDateTime:t.BeginDateTime,EndDateTime:t.EndDateTime,DeliveryDateTime:t.DeliveryDateTime,FilterRecipientText:t.FilterRecipientText},success:function(e){a.children("tbody").remove();var t=document.createElement("tbody");t.innerHTML="<tbody>"+e+"</tbody>",a.append(t),$additionalServices.init()},complete:function(){$("#progressLoadingForm").hide()},error:function(){$("#progressLoadingForm").hide()}})},editable:function(e){e.on("click","[data-editable]",function(){var e=$(this).data("editable");$additionalServices.getValue(e)}),e.on("keypress",".editable input",function(e){return 13==e.keyCode?($(this).closest(".editable").find(".icon-ok").trigger("click"),!1):void 0}),e.on("click",".editable .icon-ok",function(){var e=$(this).closest(".editable"),t="#"+e.data("edit"),a=$(t),i=e.find("input"),r=i.val(),n=a.data("template");if(n)var d=n.replace("#value#",r);else var d=r;e.toggleClass("hide"),a.data("value",r).text(d).toggleClass("hide"),i.trigger("change",{fromEditable:1})})},dblclickable:function(e){e.on("dblclick",".dblclickable",function(){var e=$(this).attr("id");$additionalServices.getValue(e)})},getValue:function(e){var t="#"+e;$el=$(t);var a=$el.data("value");$el.toggleClass("hide");var i=$(t+"Input").toggleClass("hide").data("edit",e);i.find("input").val(a)},initFieldsTimeout:function(e){setTimeout(function(){$additionalServices.initFields(e)},10)},initFields:function(e){e.each(function(e,t){if($button=$(t),"select"==$button.data("type")){if(!$button.hasClass("active"))return;var a=$button.data("input")}else var a=$button.attr("id");var i=$button.data("value")?$button.data("value"):$button.text();$("[name="+a+"]").val(i).trigger("change")})},fillInputValues4JqueryHTML:function(e){e.find("input, select, textarea").each(function(){var e=$(this);e.is("[type='radio']")||e.is("[type='checkbox']")?e.prop("checked")?e.attr("checked","checked"):e.removeAttr("checked"):e.is("select")?e.find(":selected").attr("selected","selected"):e.attr("value",e.val())})}},$additionalServices_EditEW={counterpartyProperty:"Sender",counterpartyRef:"",counterpartyDescription:"",contactName:"",phone:"",init:function(){var e=$("body");$additionalServices_EditEW.searchCounterparty(e),$additionalServices_EditEW.createCounterparty(e),$additionalServices_EditEW.editContactPerson(e),$additionalServices_EditEW.paymentValidation(e),$additionalServices_EditEW.handleServices(e)},searchCounterparty:function(e){e.on("click",".editCounterparty",function(){$additionalServices_EditEW.counterpartyProperty!=$(this).data("type")&&($("#counterpartyASModal :input").val(""),$additionalServices_EditEW.counterpartyProperty=$(this).data("type"))});var t,a=1e3;e.on("keyup",".js-counterpartyPhone",function(){var e=$(this).closest(".tab-pane"),t=e.find(".js-counterpartyPhone").val();13==t.length&&("PrivatePersonSearch"===e.attr("id")?e.find(".js-counterpartyLastName").focus():e.find(".js-counterpartyDescription").focus())}),e.on("keyup",".js-counterpartyDescription, .js-counterpartyLastName, .js-EDRPOU",function(){var e=$(this).closest(".tab-pane"),i=e.find(".js-counterpartyDescription").val(),r=e.find(".js-counterpartyPhone").val(),n=e.find(".js-counterpartyLastName").val(),d=e.find(".js-EDRPOU").val(),o="PrivatePersonSearch"===e.attr("id"),s="OrganizationSearch"===e.attr("id"),c="";if(o){if(n.length<3||r.length<13)return;c=n}else if(s){if(n.length<3&&i.length<3&&d.length<8)return;""!==n&&(c=n),""!==i&&(c=i)}clearTimeout(t);var l=e.find(".cellCounterparties");if(""==c&&""!=d)var u={modelName:"Counterparty",calledMethod:"getCounterpartyByEDRPOU",methodProperties:{EDRPOU:d}};else var u={modelName:"Counterparty",calledMethod:"getCatalogCounterparty",methodProperties:{CounterpartyType:$("#tabsCounterpartyTypeSearch.nav-tabs li.active").data("counterpartytype"),LastName:c,Phone:r.trim()}};t=setTimeout(function(){$.ajax({dataType:"json",type:"POST",data:JSON.stringify(u),beforeSend:function(){$("#progressSearch").show()},success:function(e){if(e.data.length){var t='<ul class="nav nav-list bs-docs-sidenav journal_block" id="counterpaties_ul">';$.each(e.data,function(e,a){t+=""==c&&""!=d?'<li class="browser_element_main" data-counterparty-ref="'+a.Ref+'" data-counterparty="'+a.Description+'" data-description="'+a.FullName+'" data-phone="'+r+'"><a>'+a.Description+" - "+a.FullName+"</a></li>":'<li class="browser_element_main" data-counterparty-ref="'+a.RefCounterparty+'" data-counterparty="'+a.Description+'" data-description="'+a.LastName+" "+a.FirstName+'" data-phone="'+r+'"><a>'+a.Description+" - "+a.LastName+" "+a.FirstName+"</a></li>"}),t+="</ul>",$("#counterpartyCheckButton").show(),$("#counterpartyCreateButton").hide()}else{var t=Yii.t("counterparties/js","Counterparty not found");$("#counterpartyCheckButton").hide(),$("#counterpartyCreateButton").show()}l.html(t)},complete:function(){$("#progressSearch").hide()},error:function(){$("#progressSearch").hide()}})},a)}),e.on("click","#counterpaties_ul li.browser_element_main",function(){var e=$(this);e.hasClass("active")||(e.parent().find("li.active").removeClass("active"),e.addClass("active"),$additionalServices_EditEW.counterpartyRef=e.data("counterparty-ref"),$additionalServices_EditEW.counterpartyDescription=e.data("counterparty"),$additionalServices_EditEW.contactName=e.data("description"),$additionalServices_EditEW.phone=e.data("phone"))}),e.on("click","#counterpartyCheckButton",function(){$("#"+$additionalServices_EditEW.counterpartyProperty+"CounterpartyRef").val($additionalServices_EditEW.counterpartyRef),$("#"+$additionalServices_EditEW.counterpartyProperty+"CounterpartyText").text($additionalServices_EditEW.counterpartyDescription),$("#"+$additionalServices_EditEW.counterpartyProperty+"ContactName").text($additionalServices_EditEW.contactName),$("#"+$additionalServices_EditEW.counterpartyProperty+"Phone").text($additionalServices_EditEW.phone)})},createCounterparty:function(){$("#counterpartyCreateButton").click(function(){if($("#counterpartyModal :input").val(""),$('#tabsCounterpartyTypeSearch [data-counterpartytype="PrivatePerson"].active').length){var e=$("#PrivatePersonSearch");$("#counterpartyPhone").val(e.find(".js-counterpartyPhone").val());var t=e.find(".js-counterpartyLastName").val().trim();t=t.replace(/[\s]+/g," "),arFio[0]&&$("#counterpartyLastName").val(arFio[0]),arFio[1]&&$("#counterpartyFirstName").val(arFio[1]),arFio[2]&&$("#counterpartyMiddleName").val(arFio[2])}else{var e=$("#OrganizationSearch");$("#counterpartyOrganizationName").val(e.find(".js-counterpartyDescription").val()),$('#tabsCounterpartyType [data-counterpartytype="Organization"] a').trigger("click")}}),$("#counterpartyEditEWSaveButton").click(function(){var e=$("body"),t=$("#counterpartyModal"),a="8d5a980d-391c-11dd-90d9-001a92567626",i=t.find("#tabsCounterpartyType").find("li.active").data("counterpartytype");switch(i){case"PrivatePerson":var r=t.find("#counterpartyFirstName"),n=t.find("#counterpartyMiddleName"),d=t.find("#counterpartyLastName"),o=t.find("#counterpartyPhone"),s=t.find("#counterpartyEmail"),c={CityRef:a,FirstName:r.val(),MiddleName:n.val(),LastName:d.val(),Phone:o.val(),Email:s.val(),CounterpartyType:"PrivatePerson",CounterpartyProperty:$additionalServices_EditEW.counterpartyProperty};break;case"Organization":default:var l=t.find("#counterpartyOrganizationName"),u=t.find("#ownershipFormsList"),v=t.find("#counterpartyEDRPOU"),c={CityRef:a,FirstName:l.val(),OwnershipForm:u.val(),EDRPOU:v.val(),CounterpartyType:"Organization",CounterpartyProperty:$additionalServices_EditEW.counterpartyProperty}}var p={modelName:"Counterparty",calledMethod:"save",modelProperties:c},m=!1;$.ajax({data:JSON.stringify(p),beforeSend:function(){m||(m=!0,e.modalmanager("loading"))},success:function(t){if(void 0!=t.data[0]&&"undefined"!=typeof t.data[0].ContactPerson&&void 0!=t.data[0].ContactPerson.data[0]&&($counterparties.contactRefToSelect=t.data[0].ContactPerson.data[0].Ref),t.success===!0){if(void 0==t.warnings.DuplicateValidate||void 0!=t.warnings.DuplicateValidate&&"Counterparty is not unique"!=t.warnings.DuplicateValidate){var a=t.data[0].CounterpartyType,i=t.data[0].Ref,r=t.data[0].Description,n=(t.data[0].OwnershipForm,t.data[0].OwnershipFormDescription);if("PrivatePerson"==a){var d=[];t.data[0].LastName&&d.push(t.data[0].LastName),t.data[0].FirstName&&d.push(t.data[0].FirstName),t.data[0].MiddleName&&d.push(t.data[0].MiddleName);var o=d.join(" "),s=t.data[0].Phone}else var o="",s="";$("#"+$additionalServices_EditEW.counterpartyProperty+"CounterpartyRef").val(i),$("#"+$additionalServices_EditEW.counterpartyProperty+"CounterpartyText").text(n+" "+r),$("#"+$additionalServices_EditEW.counterpartyProperty+"ContactName").text(o),$("#"+$additionalServices_EditEW.counterpartyProperty+"Phone").text(s)}}else t.success===!1?$.each(t.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."));void 0!=t.warnings&&$.each(t.warnings,function(e,t){$noty.push(noty(Yii.t("counterparties/js",t),5e3,"warning"))}),e.modalmanager("removeLoading")},complete:function(){m=!1}})})},editContactPerson:function(e){$(".editContact").unbind("click").click(function(){$additionalServices_EditEW.counterpartyProperty=$(this).data("type");var e=$("#"+$additionalServices_EditEW.counterpartyProperty+"ContactName").text().split(" ");$("#contactLastName").val(e[0]),$("#contactFirstName").val(e[1]),$("#contactMiddleName").val(e[2])}),e.on("click","#counterpartyContactCheckButton",function(){var e=[$("#contactLastName").val(),$("#contactFirstName").val(),$("#contactMiddleName").val()].join(" ");$("#"+$additionalServices_EditEW.counterpartyProperty+"ContactName").text(e)})},paymentValidation:function(){$("[data-input=PayerType], [data-input=PaymentMethod]").click(function(){$additionalServices.initFieldsTimeout($(this))}),$("[name=PayerType]").change(function(){if(2!=$("[data-input=PaymentMethod][disabled]").length){$("[data-input=PaymentMethod]").attr("disabled",!1);var e="Sender"==$(this).val();e&&$("[data-input=PaymentMethod][data-value=Cash]").attr("disabled","disabled")}}),$("[name=PaymentMethod]").change(function(){if(2!=$("[data-input=PayerType][disabled]").length){$("[data-input=PayerType]").attr("disabled",!1);var e="Cash"==$(this).val();e&&$("[data-input=PayerType][data-value=Sender]").attr("disabled","disabled")}}),$("[data-input=PayerType].active, [data-input=PaymentMethod].active").trigger("click")},services:{AfterpaymentOnGoodsCost:{id:"AfterpaymentOnGoodsCost",title:Yii.t("additionalServices/js","Контроль оплаты"),textTemplate:"#value# "+Yii.t("additionalServices/js","грн"),valueField:"#AfterpaymentOnGoodsCost",doubleClick:!0,edit:!1,modal:"#editEWAfterpayment",handleDeletion:function(){$("#AfterpaymentOnGoodsCost").val(0)}},NumberOfFloorsLifting:{id:"NumberOfFloorsLifting",title:Yii.t("additionalServices/js","Подъем на этаж"),textTemplate:"#value# "+Yii.t("additionalServices/js","этаж"),valueField:"#NumberOfFloorsLifting",doubleClick:!0,edit:!1,modal:"#editEWLifting",handleDeletion:function(){$("#NumberOfFloorsLifting").val(0),$("#ElevatorCheckBox").prop("checked",!1).trigger("change")}},FillingWarranty:{handleDeletion:function(){$("#FillingWarranty").val(0)}},BackwardDeliveryDataMoney:{id:"BackwardDeliveryDataMoney",title:Yii.t("additionalServices/js","Денежный перевод"),textTemplate:"#value# "+Yii.t("additionalServices/js","грн"),valueField:"#backwardDeliveryMoneyDescription",doubleClick:!0,modal:"#editEWBackwardDeliveryMoney",handleDeletion:function(){$("#backwardDeliveryMoneyDescription").val("")}},BackwardDeliveryDataDocuments:{id:"BackwardDeliveryDataDocuments",title:Yii.t("additionalServices/js","Обратная доставка (документы)"),textTemplate:!1,valueField:"#backwardDeliveryDocumentsDescription",doubleClick:!0,edit:!1,modal:"#editEWBackwardDeliveryDocuments",handleDeletion:function(){$("#backwardDeliveryDocumentsDescription").val("")}},BackwardDeliveryDataDocumentsServices:{id:"BackwardDeliveryDataDocumentsServices",title:Yii.t("additionalServices/js","Обратная доставка (подтипы документов)"),textTemplate:!1,valueField:!1,doubleClick:!1,edit:!1,modal:"#editEWBackwardDeliveryDocumentsServices",handleDeletion:function(){$("#backwardDeliveryDocumentsServicesDescription").val(""),$("#editEWBackwardDeliveryDocumentsServices").find("input:checkbox").prop("checked",!1)}},BackwardDeliveryDataOther:{id:"BackwardDeliveryDataOther",title:Yii.t("additionalServices/js","Обратная доставка (другое)"),textTemplate:!1,valueField:"#backwardDeliveryOtherDescription",doubleClick:!0,edit:!1,modal:"#editEWBackwardDeliveryOther",handleDeletion:function(){$("#backwardDeliveryOtherDescription").val("")}}},servicesAvailable:{},handleServices:function(e){$additionalServices_EditEW.handleServicesInputs(e),$additionalServices_EditEW.handleServicesButtons(e),e.on("click",".icon-remove",function(){if(confirm(Yii.t("additionalServices/js","Предупреждение удаления услуги"))){var e=$(this).closest("tr").find(".tdServices").data("id");$additionalServices_EditEW.services[e].handleDeletion(),$additionalServices_EditEW.servicesAvailable[e]=!0,$additionalServices_EditEW.updateAvailableServices(),$(this).closest("tr").remove()}}),e.on("change","#ElevatorCheckBox",function(){$("#Elevator").val($(this).is(":checked")?1:0)}),$("button.redeliveryPayerType").click(function(){var e=$(this);e.closest("fieldset").find("input").val(e.data("type"))}),$("#buttonsBackwardDeliveryMoneyType").on("click",'button:not([class~="disabled"])',function(){return"ToPaymentCard"==$(this).data("type")?($("#blockBackwardDeliveryMoneyType").show(),$("#blockBackwardDeliveryMoneyInformer").show(),$("#PaymentCard")[0].selectedIndex=1):($("#hideDataCard").click(),$("#blockBackwardDeliveryMoneyType").hide(),$("#blockBackwardDeliveryMoneyInformer").hide(),$("#PaymentCard")[0].selectedIndex=0),!0}),e.on("click",'.cellAdditionalServicesAvailable a[data-toggle="modal"], .cellAdditionalServices a[data-toggle="modal"]',function(){var e=$(this).data("id"),t=$('.modal[data-id="'+e+'"]');$additionalServices.fillInputValues4JqueryHTML(t);var a=t.html();$additionalServices_EditEW.services[e].back=a}),e.on("click",'.editewmodal [data-toggle="modal"]',function(){}),e.on("click",'.editewmodal [data-dismiss="modal"]',function(){var e=$(this).closest(".editewmodal").data("id"),t=$additionalServices_EditEW.services[e].back;$('.modal[data-id="'+e+'"]').html(t),$main.activeMask()})},handleServicesInputs:function(e){e.on("change","#NumberOfFloorsLiftingTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#NumberOfFloorsLifting").val($(this).val())}),e.on("change","#AfterpaymentOnGoodsCostTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#AfterpaymentOnGoodsCost").val($(this).val())}),e.on("change","#BackwardDeliveryDataMoneyTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#backwardDeliveryMoneyDescription").val($(this).val())}),e.on("change","#BackwardDeliveryDataDocumentsTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#backwardDeliveryDocumentsDescription").val($(this).val())}),e.on("change","#BackwardDeliveryDataSignedDocumentsTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#backwardDeliverySignedDocumentsDescription").val($(this).val())}),e.on("change","#BackwardDeliveryDataCreditDocumentsTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#backwardDeliveryCreditDocumentsDescription").val($(this).val())}),e.on("change","#BackwardDeliveryDataOtherTextInput input",function(e,t){"undefined"!=typeof t&&"undefined"!=typeof t.fromEditable&&$("#backwardDeliveryOtherDescription").val($(this).val())})},handleServicesButtons:function(e){e.on("click","#afterpaymentOKButton",function(){var e="AfterpaymentOnGoodsCost",t=$additionalServices_EditEW.services[e],a=$(t.valueField),i=parseInt(a.val());if(i>9999999||0>i){var r=a.closest(".editewmodal").find("div.error");return a.addClass("error"),r.removeClass("hide"),r.text(Yii.t("additionalServices/js","Значение послеоплаты")),!1}$additionalServices_EditEW.handleAdd(e,this)}),e.on("click","#liftingOKButton",function(){var e="NumberOfFloorsLifting",t=$additionalServices_EditEW.services[e],a=$(t.valueField),i=parseInt(a.val());if(i>99||-9>i){var r=a.closest(".editewmodal").find("div.error");return a.addClass("error"),r.removeClass("hide"),r.text(Yii.t("additionalServices/js","Значение этажа")),!1}a.val(i),$additionalServices_EditEW.handleAdd(e,this)}),e.on("click","#backwardDeliveryMoneyOKButton",function(){$additionalServices_EditEW.handleAdd("BackwardDeliveryDataMoney",this)}),e.on("click","#backwardDeliveryDocumentsOKButton",function(){$additionalServices_EditEW.handleAdd("BackwardDeliveryDataDocuments",this)}),e.on("click","#backwardDeliveryDocumentsServicesOKButton",function(){$additionalServices_EditEW.handleAdd("BackwardDeliveryDataDocumentsServices",this)}),e.on("click","#backwardDeliveryOtherOKButton",function(){$additionalServices_EditEW.handleAdd("BackwardDeliveryDataOther",this)})},handleAdd:function(e,t){var a=$additionalServices_EditEW.services[e];if(a.valueField){var i=$(a.valueField),r=i.val(),n=i.closest(".editewmodal").find("div.error");if(!r)return i.addClass("error"),n.removeClass("hide"),n.text(Yii.t("additionalServices/js","Для заказа услуги заполните поле")),!1;i.removeClass("error"),n.addClass("hide")}$additionalServices_EditEW.addService(a),$(t).closest(".modal").modal("hide")},updateAvailableServices:function(){$.each($additionalServices_EditEW.servicesAvailable,function(e,t){if(t){var a=$additionalServices_EditEW.services[e],i='<div class="text-append responsive"><span class="one-button"><button type="button" class="btn">'+a.title+'</button></span>                <a class="btn btn-np active btn-first"                title="'+Yii.t("additionalServices/js","Заказать")+" "+a.title+'"';a.modal&&(i+=' data-toggle="modal" href="'+a.modal+'"',i+=' data-id="'+a.id+'"'),i+='><i class="icon-plus icon-white"></i></a>                    </div>';var r=$("#_"+e+"Add");r.length?r.html(i).show():(i='<dd id="_'+e+'Add">'+i+"</dd>",$("#additionalServicesAvailableTable").append(i))}})},addService:function(e){if($additionalServices_EditEW.servicesAvailable[e.id]=!1,$additionalServices_EditEW.updateAvailableServices(),e.valueField){var t=$(e.valueField).val();if(e.textTemplate)var a=e.textTemplate.replace("#value#",t);else var a=t}var i='<td class="tdServices" data-id="'+e.id+'">            <div class="btn btn_s active">'+e.title+'</div>        </td>        <td class="tdValue">';e.valueField&&(i+='<div class="responsive">                    <div class="one-button">                        <div class="btn btn_s active',e.doubleClick&&(i+=" dblclickable"),i+='" id="'+e.id+'Text"                    data-value="'+t+'"',e.textTemplate&&(i+='data-template="'+e.textTemplate+'"'),i+=">"+a+'</div>                    <div id="'+e.id+'TextInput" class="hide editable">                            <input class="buttoned" maxlength="18" value="">                            <i class="icon-ok" title="OK"></i>                        </div>                    </div>                </div>'),i+='</td>        <td class="tdAction">            <div style=" margin: 0 5px">                <a class="btn btn-np active btn-first"            title="'+Yii.t("additionalServices/js","Редактировать")+" "+e.title+'"',e.edit&&(i+=' data-editable="'+e.id+'"'),e.modal&&(i+=' data-toggle="modal" href="'+e.modal+'"',i+=' data-id="'+e.id+'"'),i+='><i class="icon-pencil icon-white"></i></a>                <a class="btn btn-np active btn-first"                    title="'+Yii.t("additionalServices/js","Удалить")+" "+e.title+'"                    ><i class="icon-remove icon-white"></i></a>            </div>        </td>';var r=$(".tdServices[data-id="+e.id+"]");r.length?r.closest("tr").html(i):(i="<tr>"+i+"</tr>",$("#additionalServicesTable table").append(i),$("#_"+e.id+"Add").hide())}},$additionalServices_Redirecting={init:function(){var e=$("body");
"Recipient"==$("#CustomerValue").val()&&($("#contactPersonBlock").parent().css({position:"relative"}),$("#contactPersonBlock").css({right:15,position:"absolute"}),$("#counterpartyBlock").parent().css({position:"relative"}),$("#counterpartyBlock").css("cssText","right: 15px !important;")),$("#formRedirecting").on("click","#editAddressRedirection",function(){if(""===$("#FNews_settlementDescription").val())return $noty.push(noty(Yii.t("newOrder/js","Необходимо выбрать город"))),!1;if($("#WarehousePayer").hasClass("active")){$("#doors").css("display","none"),$("#warehouse").css("display","block"),document.getElementById("AddressType").value="WarehouseWarehouse";var e={SettlementRef:$("#RecipientCityRef").val(),WarehouseFor:"Sender"},t={modelName:"Address",calledMethod:"getWarehouses",methodProperties:e};$.ajax({async:!1,data:JSON.stringify(t),success:function(e){var t,a="";if(e.success===!0){for(a+='<option value ="">'+Yii.t("additionalServices/js","Укажите отделение")+"</option>",t=0;t<e.data.length;t++)a+='<option value ="'+e.data[t].Ref+'">'+e.data[t].Description+"</option>";$("#FNews_warehouseRef").html(a)}}})}else $("#doors").css("display","block"),$("#warehouse").css("display","none"),document.getElementById("AddressType").value="WarehouseDoors"}),$("#formRedirecting").on("click","#WarehousePayer",function(){$("#WarehousePayer").addClass("active"),$("#DoorsPayer").removeClass("active")}),$("#formRedirecting").on("click","#DoorsPayer",function(){$("#DoorsPayer").addClass("active"),$("#WarehousePayer").removeClass("active")}),$additionalServices_Redirecting.paymentValidation(e)},paymentValidation:function(){$("#PayerType").change(function(){$("[data-input-id=PaymentMethod] li").removeClass("disabled");var e="Sender"==$(this).val();e&&($("#Cash").addClass("disabled"),"Cash"==$("#PaymentMethod").val()&&$("#NonCash").trigger("click"))}),$("#PaymentMethod").change(function(){if("Recipient"!=$("#CustomerValue").val()){$("[data-input-id=PayerType] li").removeClass("disabled");var e="Cash"==$(this).val();e&&($("#Sender").addClass("disabled"),"Sender"==$("#PayerType").val()&&$("#Recipient").trigger("click"))}}),$("#PayerType, #PaymentMethod").trigger("change"),"Recipient"==$("#CustomerValue").val()&&$("[data-input-id=PayerType] li").addClass("disabled")}},$additionalServices_Return={init:function(){$("#addresses_ul > li:first-child").trigger("click");var e=$("#addresses_ul > li").size();1==e&&$("#selectAddress").trigger("click")}},$additionalServices_MassiveReturn={init:function(e){function t(e){var i={Number:e},r={modelName:"AdditionalService",calledMethod:"CheckPossibilityCreateReturn",methodProperties:i};$.ajax({data:JSON.stringify(r),success:function(t){t.data.length||(t.data[0]={}),t.data[0].IntDocNumber=e,$orders.addServices._DocumentsReturn.push(t)},complete:function(){$orders.addServices._checkedCount++,$("#massiveReturnValidationChecked").text($orders.addServices._checkedCount),$("#massiveReturnValidationModal .bar").css("width",Math.round($orders.addServices._checkedCount/$orders.addServices._checkCount*100)+"%"),$orders.addServices._validationCancelled||($orders.addServices._Documents.length?t($orders.addServices._Documents.pop()):($("#massiveReturnValidationModal").modal("hide"),a()))}})}function a(){$.each($orders.addServices._DocumentsReturn,function(e,t){var a='<table style="width: 100%; vertical-align: middle;"><tr>';if(a+='<td class="number">'+t.data[0].IntDocNumber+"</td>",t.success){var i='<td><div class="btn-group btn-group-vertical return-address js-return-address" data-toggle="buttons-radio">',r='<td class="return-paymenttype js-return-paymenttype">';$.each(t.data,function(t,a){var n=0==t?" active":"",d=0==t?"":" disabled",o=0==t?"":" disabled ",s=e+"-"+t,c=a.Address+" - "+a.Counterparty+", "+a.ContactPerson+", "+a.Phone;i+='<button type="button" data-ref="'+a.Ref+'" data-id="'+s+'" class="btn btn_s '+n+'" title="'+c+'">'+c+"</button>",r+=a.NonCash?'<div class="btn-group btn-group-horizontal js-return-payment-type-block" data-toggle="buttons-radio" data-id="'+s+'"><button type="button" data-paymenttype="Cash" class="btn btn_s'+n+d+'"'+o+'">'+Yii.t("orders/js","Готівка")+'</button><button type="button" data-paymenttype="NonCash" class="btn btn_s'+d+'"'+o+'">'+Yii.t("orders/js","Безготівка")+"</button></div>":'<div class="btn-group btn-group-horizontal js-return-payment-type-block" data-toggle="buttons-radio" data-id="'+s+'"><button type="button" data-paymenttype="Cash" class="btn btn_s'+n+d+'"'+o+'">'+Yii.t("orders/js","Готівка")+"</button></div><br>"}),i+="</div></td>",r+="</td>",a+=i+r}else a+='<td><div class="journal_block"><ul class="nav nav-list bs-docs-sidenav">',$.each(t.errors,function(e,t){a+="<li><a>"+t+"</a></li>"}),a+="</ul></div></td>";a+="</tr></table>",a+="<hr>",$("#massiveReturnList").append(a)}),$(".js-return-address button").length&&$("#massiveReturnButtonCreate").attr("disabled",!1),$("#massiveReturnValidationModal").hide(),$("#massiveReturnListModal").show()}function i(e){var t=$.extend($orders.addServices._returnRequest,e);$.ajax({url:"/additionalServices/return",data:t,success:function(t){t.success?($orders.addServices._createdCountSuccess++,$(".massiveReturnCreatedSuccess").text($orders.addServices._createdCountSuccess)):($orders.addServices._createdCountFailed++,$(".massiveReturnCreatedFailed").text($orders.addServices._createdCountFailed)),t.data.length||(t.data[0]={}),t.data[0].IntDocNumber=e.IntDocNumber,$orders.addServices._DocumentsCreated.push(t)},error:function(){$orders.addServices._createdCountFailed++,$(".massiveReturnCreatedFailed").text($orders.addServices._createdCountFailed)},complete:function(){return $orders.addServices._creatingCancelled?($("#massiveReturnDeleteCount").text(parseInt($("#massiveReturnDeleteCount").text())+1),void 0):($orders.addServices._createdCount++,$("#massiveReturnCreated").text($orders.addServices._createdCount),$("#massiveReturnCreatingModal .bar").css("width",Math.round($orders.addServices._createdCount/$orders.addServices._createCount*100)+"%"),$orders.addServices._DocumentsRequest.length?i($orders.addServices._DocumentsRequest.pop()):($("#massiveReturnCreatingModal").modal("hide"),r()),void 0)}})}function r(){var e='<table class="massiveReturnResult">';e+="<tr><th>"+Yii.t("orders/js","Номер документа")+"</th><th>"+Yii.t("orders/js","Номер заявки")+"</th></tr>",$.each($orders.addServices._DocumentsCreated,function(t,a){e+="<tr><td>"+a.data[0].IntDocNumber+"</td>",e+=a.success?"<td>"+a.data[0].Number+"</td>":"<td>"+a.errors.join("<br>")+"</td>",e+="</tr>"}),e+="</table>",$("#massiveReturnSuccess").text($orders.addServices._createdCountSuccess),$("#massiveReturnFailed").text($orders.addServices._createdCountFailed),$("#massiveReturnCreatedList").append(e),$("#massiveReturnCreatedListModal").modal()}function n(e){if(!e||!e.success)return $orders.addServices._DocumentsCreated.length?(n($orders.addServices._DocumentsCreated.pop()),void 0):($("#massiveReturnDeletingModal").modal("hide"),d(),void 0);var t={Ref:e.data[0].Ref};$.ajax({url:"/additionalServices/delete",data:t,success:function(t){if(t&&!t.success){$orders.addServices._deletedCountSuccess++,$(".massiveReturnDeletedSuccess").text($orders.addServices._deletedCountSuccess);var a={Number:e.data[0].Number,Errors:t.errors};$orders.addServices._DocumentsDeletedFailed.push(a)}else $orders.addServices._deletedCountFailed++,$(".massiveReturnDeletedFailed").text($orders.addServices._deletedCountFailed)},error:function(){$orders.addServices._deletedCountFailed++,$(".massiveReturnCreatedFailed").text($orders.addServices._deletedCountFailed)},complete:function(){$orders.addServices._deletedCount++,$("#massiveReturnDeleted").text($orders.addServices._deletedCount),$("#massiveReturnDeletingModal .bar").css("width",Math.round($orders.addServices._deletedCount/$orders.addServices._DocumentsCreated.length*100)+"%"),$orders.addServices._DocumentsCreated.length?n($orders.addServices._DocumentsCreated.pop()):($("#massiveReturnDeletingModal").modal("hide"),d())}})}function d(){$.each($orders.addServices._DocumentsDeletedFailed,function(e,t){var a='<table style="width: 100%; vertical-align: middle;"><tr>';a+='<td style="width: 10%;" class="number">'+t.IntDocNumber+"</td>",a+='<td style="width: 10%;" class="number">'+t.Number+"</td>",a+="<td>"+t.Errors.join("<br>")+"</td>",a+="</tr></table>",a+="<hr>",$("#massiveReturnDeletingFailedList").append(a)}),0==$orders.addServices._DocumentsDeletedFailed.length?($("#massiveReturnDeletingFailedModal").addClass("narrow"),$("#massiveReturnDeletingFailedList").text(Yii.t("orders/js","Заявки удалены"))):$("#massiveReturnDeletingFailedModal").removeClass("narrow"),$("#massiveReturnDeletingFailedModal").modal()}"undefined"==typeof massiveReturnDocuments&&(location.href="/orders");var e=$("body");$orders.addServices._returnRequest={OrderType:"orderCargoReturn",Reason:massiveReturnReason,SubReason:massiveReturnSubtypeReason,Note:massiveReturnNote},$orders.addServices._checkedCount=0,$orders.addServices._createdCount=0,$orders.addServices._createdCountSuccess=0,$orders.addServices._createdCountFailed=0,$orders.addServices._deletedCount=0,$orders.addServices._Documents=[],$orders.addServices._DocumentsReturn=[],$orders.addServices._DocumentsRequest=[],$orders.addServices._DocumentsCreated=[],$orders.addServices._DocumentsDeletedFailed=[],$orders.addServices._validationCancelled=!1,$orders.addServices._creatingCancelled=!1,$("#massiveReturnButtonCreate").attr("disabled","disabled"),$("#massiveReturnCreated, .massiveReturnCreatedSuccess, .massiveReturnCreatedFailed").text(0),$("#massiveReturnValidationModal .bar, #massiveReturnCreatingModal .bar, #massiveReturnDeletingModal .bar").css("width",0),$orders.addServices._Documents=massiveReturnDocuments,$("#massiveReturnValidationChecked").text(0),$("#massiveReturnValidationCount").text(massiveReturnDocuments.length),$orders.addServices._checkCount=$orders.addServices._Documents.length,t($orders.addServices._Documents.pop()),e.on("click","#massiveReturnValidationButtonCancel",function(){$orders.addServices._validationCancelled=!0,location.href="/orders"}),e.on("click","#massiveReturnButtonCancel",function(){location.href="/orders"}),e.on("click",".js-return-address button",function(){var e=$(this);if(!e.hasClass("active")){var t=e.data("id"),a=$(".js-return-payment-type-block[data-id="+t+"]");a.closest(".js-return-paymenttype").find("button").removeClass("active").addClass("disabled").attr("disabled","disabled"),a.find("button").removeClass("disabled").attr("disabled",!1),a.find("[data-paymenttype=Cash]").addClass("active")}}),e.on("click","#massiveReturnButtonCash",function(){$(".js-return-paymenttype button").not("[data-paymenttype=Cash]").removeClass("active"),$(".js-return-paymenttype button[data-paymenttype=Cash]").not(".disabled").addClass("active")}),e.on("click","#massiveReturnButtonNonCash",function(){$(".js-return-address .active").each(function(){var e=$(this).data("id"),t=$(".js-return-payment-type-block[data-id="+e+"] button");2==t.length&&(t.not("[data-paymenttype=NonCash]").removeClass("active"),t.not(".active").not("[data-paymenttype=Cash]").addClass("active"))})}),e.on("click","#massiveReturnButtonCreate",function(){$("#massiveReturnList table").each(function(){var e=$(this),t=e.find(".js-return-address .active").data("ref");t&&$orders.addServices._DocumentsRequest.push({IntDocNumber:e.find(".number").text().trim(),RecipientAddress:t,PaymentMethod:e.find(".js-return-paymenttype .active").data("paymenttype")})}),$("#massiveReturnChecked").text(0),$("#massiveReturnCount").text($orders.addServices._DocumentsRequest.length),$("#massiveReturnListModal").hide(),$("#massiveReturnCreatingModal").modal(),$orders.addServices._createCount=$orders.addServices._DocumentsRequest.length,$orders.addServices._DocumentsRequest.reverse(),i($orders.addServices._DocumentsRequest.pop())}),e.on("click","#massiveReturnButtonCancelCreate",function(){$orders.addServices._creatingCancelled=!0,$orders.addServices._DocumentsRequest=[],$("#massiveReturnDeleteCount").text($orders.addServices._DocumentsCreated.length),$("#massiveReturnCreatingModal").modal("hide"),$("#massiveReturnDeletingModal").modal(),n($orders.addServices._DocumentsCreated.pop()),$(this).closest(".modal").find(".close").trigger("click")}),e.on("click","#massiveReturnDeletingFailedModal .close",function(){location.href="/orders"}),e.on("click","#massiveReturnButtonOkDeleted",function(){$(this).closest(".modal").find(".close").trigger("click")}),e.on("click","#massiveReturnCreatedListModal .close",function(){location.href="/orders"}),e.on("click","#massiveReturnButtonOkCreated",function(){$(this).closest(".modal").find(".close").trigger("click")})}},$additionalServices_TermExtension={init:function(){$("body");"undefined"!=typeof dateTermExtension&&$("#NewServiceDate").datetimepicker({autoclose:!0,format:"dd.mm.yyyy",startDate:new Date,datesEnabled:dateTermExtension,minView:2,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1}),$("#NewServiceDate").change(function(){""==$(this).val()?$("#termExtensionDays").val(""):$("#termExtensionDays").val(dateDiffTermExtension[$(this).val()])})}};
$apiKeys={_ApiKeysRef:"",init:function(){var e=$("div.tab-pane.active");$("a.btn").tooltip(),e.on("click",".removeApiKey",function(a){var t=$(this);$apiKeys._ApiKeysRef=t.data("ref"),$("#remove"+e.find("input#tabname").val()+"Modal").modal("show"),a.preventDefault(),a.stopPropagation()}),$("body").on("click","#removeApiKeyButton",function(){$(this);$apiKeys.removeApiKey(e)}),e.on("click","#generateAPIKey",function(){var e=$("html");$.ajax({url:Yii.app.createUrl("settings/apikeys"),type:"post",data:{todo:"create"},dataType:"JSON",beforeSend:function(){e.modalmanager("loading")},success:function(a){if("false"!=a){var t=$("#tableApiKeys"),i=t.find(".apiKeyRow").first().clone();i.find(".apiKey").html(a.key),i.find(".expireDate").html(a.expireDate),i.find(".removeApiKey").attr("data-ref",a.key),i.attr("id","apiKeyRow_"+a.key),i.show(),$(".apiKeyRowEmpty").hide(),t.find("tbody").append(i),$("a.btn").tooltip(),e.modalmanager("removeLoading")}}})}),e.on("click","#sendApiQuery",function(){var e=$("html"),a=$("#apiQuery");$dataType="XML"==$("#formatAPI").val()?"XML":"JSON",$.ajax({url:Yii.app.createUrl("settings/apikeys"),type:"post",data:{todo:"testQuery",query:a.val(),formatAPI:$("#formatAPI").val()},dataType:$dataType,beforeSend:function(){"XML"==$("#formatAPI").val()?e.modalmanager("loading"):(a.val(JSON.stringify($.parseJSON(a.val()),null,4)),e.modalmanager("loading"))},success:function(e){null!=e?"XML"==$("#formatAPI").val()?$("#apiResponse").text((new XMLSerializer).serializeToString(e)):$("#apiResponse").text(JSON.stringify(e,null,4)):$("#apiResponse").text("request timed out")},complete:function(){e.modalmanager("removeLoading")}})})},removeApiKey:function(e){{var a=$("#remove"+e.find("input#tabname").val()+"Modal"),t=$apiKeys._ApiKeysRef;$(this)}$.ajax({url:Yii.app.createUrl("settings/apikeys"),type:"post",data:{todo:"delete",apiKey:t},dataType:"JSON",beforeSend:function(){a.modalmanager("loading")},success:function(e){"false"!=e&&($("#apiKeyRow_"+$apiKeys._ApiKeysRef).remove(),1==$(".apiKeyRow").length&&($(".apiKeyRowEmpty").show(),console.log(e),console.log($apiKeys._ApiKeysRef)),a.modalmanager("removeLoading"))},complete:function(){a.modal("hide")}})}};
var $archiverequest={init:function(){$("input.addTTN").on("click",function(){var e=$("div.TTN:first").clone();e.children("input").val("").removeAttr("required"),e.appendTo("div.TTNs"),e.children("input").focus()}),$("div.TTNs").on("keyup","input.mask-integer_14",function(){$(this).mask("99999999999999")});var e=$("html");$("#archiveRequestFormSubmit").click(function(){$("#archiveRequestForm").submit()}),$("#archiveRequestForm").ajaxForm({dataType:"json",beforeSubmit:function(){e.modalmanager("loading"),$(".btn").prop("disabled",!0),$.each($noty,function(e,i){$(i.$note).hide()}),$(".alert").hide(),$noty=[]},success:function(e){e.success===!0?($.each(e.messages,function(e,i){$("#ArchiveRequestResultId").html(i),$("#archiveRequestComplete").show(),$(".alert-error").hide(),$("#archiveRequestForm").hide()}),$("#archiveRequestForm").hide()):e.success===!1?$.each(e.errors,function(e,i){$("#ArchiveRequestForm_"+e).addClass("error"),$noty.push(noty(Yii.t("archiveRequest/js",i)))}):noty(Yii.t("archiveRequest/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),$(".btn").prop("disabled",!1)},complete:function(){$(".btn").prop("disabled",!1),e.modalmanager("removeLoading")},error:function(){noty(Yii.t("archiveRequest/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),$(".btn").prop("disabled",!1)}}),$("#ArchiveRequestForm_phone").intlTelInput({onlyCountries:window.codeTelephoneCountries}).change(),$("#ArchiveRequestForm_typeOfPartner").change(function(){$blockOrganization=$("#blockOrganization"),$ArchiveRequestForm_typeOfPartner=$("#ArchiveRequestForm_typeOfPartner"),"Organization"==$ArchiveRequestForm_typeOfPartner.val()?$blockOrganization.show():($blockOrganization.hide(),$("#ArchiveRequestForm_companyName").val(""))}),$(".TTNs").on("keypress","input",function(e){var i=e.keyCode?e.keyCode:e.which;return"13"==i?($("input.addTTN").click(),!1):void 0})}};
var $auth={init:function(){$("html");$("#oAuthRegister").click(function(){var t=$(this).attr("href");return opener?opener.open(t):self.open(t),!1}),$(".tabs-registration .button-tab").click(function(){var t=$(this).data("type");$("#LoginForm_type").val()!=t&&($("#LoginForm_type").val(t),$(".js-registration").toggleClass("hide","business"==t),$("#auth_text_person").toggleClass("hide"),$("#auth_text_business").toggleClass("hide"),$(".button-tab.selected").removeClass("selected"),$(this).addClass("selected"))})},step2:function(){$("#forgotPasswordPhone").intlTelInput({onlyCountries:["ua"]})}};
var $barcodePrint={init:function(){window.print()}};
var $cCard={init:function(){var e=$("body");$("input.mask-username").mask("X",{translation:{X:{pattern:/[абвгґдеєжзиіїйклмнопрстуфхцчшщьюя\'\`\’\-\s\"]/i,recursive:!0}}}),$("input.mask-phone_12").mask("380999999999",{translation:{3:{pattern:/[380]/},7:{pattern:/[\d]/}}}),e.on("click","#clearFilter",function(e){var r=$(".cCardsForm").find("input");$.each(r,function(e,r){$(r).val("")}),$cCard.filterSubmit(),e.stopPropagation(),e.preventDefault()}),e.on("change","select#DeletionMark, select#RequestType",function(e){$cCard.filterSubmit(),e.stopPropagation(),e.preventDefault()}),e.on("click",".filterSubmit",function(e){$cCard.filterSubmit(),e.stopPropagation(),e.preventDefault()}),e.on("click",".removeCCardRequest",function(e){var r=$(this).data("ref");$cCard.removeCCardRequest(r),e.stopPropagation(),e.preventDefault()}),e.on("click",".recoveryCCardRequest",function(e){var r=$(this).data("ref");$cCard.recoveryCCardRequest(r),e.stopPropagation(),e.preventDefault()}),$(".view").click(function(e){e.currentTarget.href=e.currentTarget.href+"/dateToInput/"+$("#dateToInput")[0].value+"/dateFromInput/"+$("#dateFromInput")[0].value}),$("#DateTime").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1})},filterSubmit:function(){var e=$("tbody"),r=$(".cCardsForm").serialize();$("#progressLoadingForm").show(),$.ajax({url:Yii.app.createUrl("site/cCard",{render:"partial"}),dataType:"html",type:"POST",data:{filer:r},success:function(r){e.empty(),e.append(r)},complete:function(){$("#progressLoadingForm").hide()},error:function(){$("#progressLoadingForm").hide()}})},removeCCardRequest:function(e){$("#progressLoadingForm").show(),$.ajax({url:Yii.app.createUrl("site/removeCCard"),dataType:"html",type:"POST",data:{Ref:e,partial:!0},success:function(){$cCard.filterSubmit()},complete:function(){$("#progressLoadingForm").hide()},error:function(){$("#progressLoadingForm").hide()}})},recoveryCCardRequest:function(e){$("#progressLoadingForm").show(),$.ajax({url:Yii.app.createUrl("site/recoveryCCard"),dataType:"html",type:"POST",data:{Ref:e,partial:!0},success:function(){$cCard.filterSubmit()},complete:function(){$("#progressLoadingForm").hide()},error:function(){$("#progressLoadingForm").hide()}})}};
var $cCardManagement={_warehouseChecked:!1,_cityChanged:!1,init:function(){var e=$("body");$cCardManagement.selectCounterparty(),$("#WCCardRequests_WarehouseRef").is("input")&&0!==$("#WCCardRequests_WarehouseRef").val().length&&$("#warehouse").prop("checked",!0),null!==jQuery.parseJSON(modelErrors)&&$cCardManagement.displayErrors(jQuery.parseJSON(modelErrors)),e.on("click",".counterpartyList li",function(){$("#counterpartyList").find(".active").removeClass("active"),$(this).addClass("active"),$("#WCCardRequests_InternetCounterpartyDescription").val($(this).data("description")),$("#WCCardRequests_InternetCounterpartyRef").val($(this).data("ref"))}),e.on("change",".counterparty_select",function(){$("#WCCardRequests_InternetCounterpartyDescription").val($("option:selected",this).text()),$(".counterpartyDescription").show()}),e.on("click","#WCCardRequests_SettlementCityName",function(){$("#cities").dialog("open"),$("#cities_ul").show()}),e.on("click","#cities_ul li",function(){var e=$(this);$("#WCCardRequests_Address").val(""),$("#WCCardRequests_WarehouseRef").val(""),$cCardManagement.citySelect(e)}),e.on("click","#warehouses_ul li",function(){var e=$(this);$cCardManagement.warehouseSelect(e)}),e.on("click",".warehouse-address, #WCCardRequests_Address",function(e){var a=$("#WCCardRequests_SettlementCityName").val(),t=$(this),r=$("#WCCardRequests_Address");"warehouse-address"===e.target.name&&($cCardManagement._warehouseChecked===!0&&(r.val(""),r.data("")),$cCardManagement._warehouseChecked="warehouse"===t.val()),0===a.length?($("#cities").dialog("open"),$("#cities_ul").show()):$cCardManagement._warehouseChecked===!0&&($("#warehouses_modal").dialog("open"),$("#warehouses_modal").parent().find("a.ui-dialog-titlebar-close").hide(),$cCardManagement._cityChanged=!0,$cCardManagement.getWarehouses(a))})},selectCounterparty:function(){var e=$("#counterpartyList").find(".browser_element_main"),a=$("#WCCardRequests_InternetCounterpartyDescription"),t=$("#WCCardRequests_InternetCounterpartyRef");a.val(""),t.val(""),1===e.length&&(e.addClass("active"),a.val(e.data("description")),t.val(e.data("ref")))},warehouseSelect:function(e){var a=e.find("a").text(),t=$("#WCCardRequests_Address"),r=e.data();t.val(a),$("#WCCardRequests_WarehouseRef").val(r.ref),$("#warehouses_modal").dialog("close"),$("#warehouse").prop("checked",!0)},citySelect:function(e){var a=e.find("a").text(),t=$("#WCCardRequests_SettlementCityName"),r=e.data();t.val(a),$("#WCCardRequests_SettlementRef").val(r.ref),$cCardManagement._cityChanged=!0,$("#cities").dialog("close"),$cCardManagement._warehouseChecked===!0?($("#warehouses_modal").dialog("open"),$("#warehouses_modal").parent().find("a.ui-dialog-titlebar-close").hide(),$cCardManagement.getWarehouses(a)):$("#address").prop("checked",!0)},getWarehouses:function(e){if($cCardManagement._cityChanged!==!1){var a=$("#warehouses_modal"),t=$("#progressLoadingForm");a.empty(),a.append(t),t.show(),$.ajax({url:Yii.app.createUrl("site/GetWarehouses"),dataType:"html",type:"POST",data:{cityName:e},success:function(e){a.append(e),0==$(e).find("li").length&&$("#warehouses_modal").parent().find("a.ui-dialog-titlebar-close").show(),$cCardManagement._cityChanged=!1},complete:function(){$("#progressLoadingForm").hide()},error:function(){$("#progressLoadingForm").hide(),$("#warehouses_modal").parent().find("a.ui-dialog-titlebar-close").show()}})}},displayErrors:function(e){$("input").removeClass("error"),$.each(e,function(e){$noty.push(noty(Yii.t("loyalty/index",$("label[for='WCCardRequests_"+e+"']").text()+" введено не коректно")))})}};
var $cCardRequests={init:function(){$scope=$("body"),$(".view").click(function(t){t.currentTarget.href=t.currentTarget.href+"/dateToInput/"+$("#dateToInput")[0].value+"/dateFromInput/"+$("#dateFromInput")[0].value}),$("#dateFrom").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1}),$("#dateTo").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1}),$scope.on("change","#dateFromInput, #dateToInput",function(){var t=$("#dateFilter").serialize();$cCardRequests.ajaxUpdate(t)})},ajaxUpdate:function(t){$.ajax({url:Yii.app.createUrl("admin/CCardRequests"),dataType:"html",type:"POST",data:{filter:t},success:function(t){$("#cCardList").empty(),$("#cCardList").append($(t).find("#cCardList"))},complete:function(){},error:function(){}})}};
var $counterparties={counterpartyRefToSelect:"",addressRefToSelect:"",contactRefToSelect:"",cityRefToSelect:"",counterpartyProperty:"Recipient",counterPartyRefresh:!1,init:function(){$('input[type="text"], input[type="tel"]').keypress(function(){$(this).closest(".error").removeClass("error")}),$("#filter_journal_cities").fastLiveFilter("#cities_ul",{type:"cities"}),$("input.mask-char_filter").mask("L"),$("input.mask-char_uk_s").mask("L"),$("input.mask-organization").mask("O"),$("input.mask-integer").mask("#"),$("input.mask-email").mask("E",{translation:{E:{pattern:/[a-zA-Z0-9\_\-\.\%\+\@]/,recursive:!0}}}),$("input.mask-phone").mask("0999999999",{translation:{0:{pattern:/[0]/},9:{pattern:/[\d]/}}}),$(".selectboxit-list").length||$("select.custom-select").selectBoxIt({autoWidth:!1,hideCurrent:!0,showEffect:"slideDown",showEffectSpeed:200,hideEffect:"slideUp",hideEffectSpeed:200,copyClasses:"container"}),$("div.button-input.clear").click(function(){var e=$(this).siblings("input");e.val("").trigger("keydown").focus(),e.trigger("keyup")});var e=$("#tabsCounterpartyType");e.find("a:first").click(),e.find('a[class~="disabled"]').attr("data-toggle",""),e.on("click",'a[class~="disabled"]',function(e){return e.preventDefault(),e.stopPropagation(),!1});var t,a,r=0;$("#cities_ul").on("click","li.browser_element_main",function(){var e=$(this);if(!e.hasClass("active")){clearTimeout(t);var n=e.attr("data-ref"),i=$("#filter_journal_counterparties");if(e.parent().find("li.active").removeClass("active"),e.addClass("active"),$("#address_ul").html(""),$("#contacts_ul").html(""),i.val(""),$counterparties.counterPartyRefresh){var o={CityRef:n,CounterpartyProperty:$counterparties.counterpartyProperty,RefreshCache:!0};$counterparties.counterPartyRefresh=!1}else var o={CityRef:n,CounterpartyProperty:$counterparties.counterpartyProperty};t=setTimeout(function(){a=$counterparties.load_list_rendered("getCounterparties",o,"counterparties_ul","filter_journal_counterparties",a,$counterparties.counterpartyRefToSelect),$counterparties.counterpartyRefToSelect="",i.fastLiveFilter("#counterparties_ul")},r)}}),$("#counterparties_ul").on("click","#refreshCounterparty",function(){$counterparties.counterPartyRefresh=!0,$("#cities_ul li.active").removeClass("active").click()});var n,i,o;$("#counterparties_ul").on("click","li.browser_element_main",function(e,t){var a="undefined"!=typeof t&&"undefined"!=typeof t.bNoCheckActive&&t.bNoCheckActive;if(!$(e.target).hasClass("element_check")){var s=$(this);if(!s.hasClass("active")||a){clearTimeout(n);var d=s.attr("data-ref"),c=$("#cities_ul").find("li.active"),l=c.data("ref");s.parent().find("li.active").removeClass("active"),s.addClass("active"),$("#address_ul").html(""),$("#contacts_ul").html(""),$("#filter_journal_address").val(""),$("#filter_journal_contacts").val(""),n=setTimeout(function(){var e={CityRef:l,Counterparty:d,WarehouseFor:$configBox.appParameters._WarehouseFor};$counterparties.load_list_rendered("getAddresses",e,"address_ul","filter_journal_address",i,$counterparties.addressRefToSelect),$counterparties.addressRefToSelect="";var t={Counterparty:d};$counterparties.load_list_rendered("getCounterpartyContactPersons",t,"contacts_ul","filter_journal_contacts",o,$counterparties.contactRefToSelect),$counterparties.contactRefToSelect=""},r)}}}),$("#address_ul").on("click","li.browser_element_main",function(){var e=$(this);if(!e.hasClass("active")){{e.attr("data-ref")}e.parent().find("li.active").removeClass("active"),e.addClass("active")}$counterparties.check_address_filled()}),$("#contacts_ul").on("click","li.browser_element_main",function(){var e=$(this);if(!e.hasClass("active")){{e.attr("data-ref")}e.parent().find("li.active").removeClass("active"),e.addClass("active")}$counterparties.check_contact_filled()}),$("#filter_journal_contacts").bind({keypress:function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&$(".createContact").trigger("click"),clearTimeout(n);var a=$(this).val();n=setTimeout(function(){var e={Counterparty:$("#counterparties_ul .active").attr("data-ref"),FindByString:a};$counterparties.load_list_rendered("getCounterpartyContactPersons",e,"contacts_ul","filter_journal_contacts",o,$counterparties.contactRefToSelect)},r),$counterparties.contactRefToSelect=""},keyup:function(){$(this).trigger("keypress")}}),$("#counterpartyContactSaveButton").click(function(){$counterparties.createCounterpartyContactSaveButton()}),$("#counterpartyContactPhoneSaveButton").click(function(){$counterparties.createcounterpartyContactPhoneSaveButton()}),$("#counterpartyContactDeleteButton").click(function(){$counterparties.deleteCounterpartyContactSaveButton()}),$("#filter_journal_cities").bind({keyup:function(){$(this).trigger("keypress"),clearTimeout(n);var e=$(this).val();n=setTimeout(function(){var t={FindByString:e};$counterparties.load_list_rendered("getCities",t,"cities_ul","filter_journal_cities",o,$counterparties.cityRefToSelect)},1e3),$counterparties.cityRefToSelect=""}}),$("#filter_journal_counterparties").bind({keypress:function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&$(".createCounterparty").trigger("click")},keyup:function(){$(this).trigger("keypress"),clearTimeout(n);var e=$(this).val(),t=$("#cities_ul li.browser_element_main.active").attr("data-ref");n=setTimeout(function(){var a={CityRef:t,CounterpartyProperty:$counterparties.counterpartyProperty,String:e};$counterparties.load_list_rendered("getCounterparties",a,"counterparties_ul","filter_journal_counterparties",o,$counterparties.counterpartyRefToSelect)},1e3),$counterparties.counterpartyRefToSelect=""}}),$("#counterpartySaveButton").click(function(){$counterparties.createCounterpartySaveButton()}),$("#counterpartySenderSaveButton").click(function(){$counterparties.createCounterpartySenderButton()}),$("#counterpartyDeleteButton").click(function(){$counterparties.deleteCounterpartySaveButton()});var s=$("#ownershipFormsList"),d=$("#counterpartyEDRPOU");s.change(function(){"d558bfcc-7456-11df-ad52-000c29118aa7"==s.val()?d.val("").attr("maxlength","10"):d.val("").attr("maxlength","8")}),$("#filter_journal_address").bind({keypress:function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&$(".createAddress").trigger("click")},keyup:function(){$(this).trigger("keypress"),clearTimeout(n);var e=$(this).val(),t=$("#counterparties_ul").find("li.active").attr("data-ref"),a=$("#cities_ul").find("li.active").data("ref");n=setTimeout(function(){var r={CityRef:a,Counterparty:t,WarehouseFor:$configBox.appParameters._WarehouseFor,FindByString:e};$counterparties.load_list_rendered("getAddresses",r,"address_ul","filter_journal_address",i,$counterparties.addressRefToSelect)},1e3),$counterparties.addressRefToSelect=""}}),$("#counterpartyAddressSaveButton").click(function(){$counterparties.createCounterpartyAddressSaveButton()}),$("#counterpartyAddressDeleteButton").click(function(){$counterparties.deleteCounterpartyAddressSaveButton()});var c=$("div.journal_list, div.journal_list_small");if($("body").on("click","input.element_check",function(){var e=$(this),t=e.closest("ul");$counterparties.checkSelectedItems(t)}),$("a.btn-delete").click(function(){var e=$(this),t=e.closest("div.top-divider").find("ul"),a=e.attr("data-type");$counterparties.deleteSelectedItems(t,a)}),c.on("click",".nav-list > li > p.unDelete > a",function(e){$counterparties.undelete(this),e.preventDefault()}),$("#counterpartyPhone, .counterpartyPhone").intlTelInput({onlyCountries:window.codeTelephoneCountries}),$(".phoneFlags").intlTelInput({onlyCountries:window.codeTelephoneCountries}),500=="#counterparties_ul .browser_element_main".length){var l=[],u=0,p=null;$(document).on("keypress","#filter_journal_counterparties",function(){if($(this).val().length<3)return p&&$("#counterparties_ul").html(p),void 0;var e=$("body");clearTimeout(u);var t=this;u=setTimeout(function(){var a=$("#cities_ul .active").data("ref")+$(t).val();return"undefined"!=typeof l[a]?($("#counterparties_ul").html(l[a]),void 0):(l[a]=!0,$.ajax({url:"/counterparties/getCounterparties/String/"+$(t).val()+"/CounterpartyProperty/Recipient",dataType:"text",beforeSend:function(){e.modalmanager("loading")}}).success(function(t){p||(p=$("#counterparties_ul").html()),$("#counterparties_ul").html(t),$("#counterparties_ul .browser_element_main").trigger("click"),l[a]=t,e.modalmanager("removeLoading")}).error(function(){noty(Yii.t("js","Возникла ошибка. Попробуйте позже"))}),void 0)},1e3)})}},createCounterpartyAddressButton:function(){var e=$("#addressModal"),t=e.find("#streetName"),a=e.find("#buildingName"),r=e.find("#commentName"),n=e.find("#addressRef");$("#streetName").typeahead({minLength:2,source:function(e,t){$addresses.streetFind(e,t)},matcher:function(e){return-1!=e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $addresses.streetSelect(e)}}).on("blur",function(){void 0==$addresses.mapStreets[$(this).val()]&&($(this).val(""),$addresses.selectedStreet="")}),$("#buildingName").typeahead({source:function(e,t){$addresses.buildingFind(e,t)},matcher:function(e){return 0==e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $addresses.buildingSelect(e)}}).on("blur",function(){$addresses.selectedBuilding=void 0==$addresses.mapBuildings[$(this).val()]?"":$addresses.mapBuildings[$(this).val()].Ref}),a.val("").addClass("disabled").prop("readonly",!0),t.val(""),r.val(""),n.val(""),$("#counterpartyAddressDeleteButton").hide(),$("#blockAddressText").hide(),$("#counterpartyAddressSaveButton").text(Yii.t("counterparties/js","Добавить"))},editCounterpartyAddressButton:function(){{var e=$("#addressModal"),t=e.find("#streetName"),a=e.find("#buildingName"),r=e.find("#flatName"),n=e.find("#commentName"),i=e.find("#addressRef"),o=$("#address_ul").find("li.active"),s=o.attr("data-ref");$("#cities_ul").find("li.active").data("ref")}$("#streetName").typeahead({minLength:2,source:function(e,t){$addresses.streetFind(e,t)},matcher:function(e){return-1!=e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $addresses.streetSelect(e)}}).on("blur",function(){void 0==$addresses.mapStreets[$(this).val()]&&($(this).val(""),$addresses.selectedStreet="")}),$("#buildingName").typeahead({source:function(e,t){$addresses.buildingFind(e,t)},matcher:function(e){return 0==e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $addresses.buildingSelect(e)}}).on("blur",function(){$addresses.selectedBuilding=void 0==$addresses.mapBuildings[$(this).val()]?"":$addresses.mapBuildings[$(this).val()].Ref}),a.val("").addClass("disabled").prop("readonly",!0),t.val(""),a.val("").addClass("disabled").prop("readonly",!0),n.val(""),r.val(""),i.val(s),$("#blockAddressText").show(),$("#addressText").text(o.attr("data-description")),$("#counterpartyAddressDeleteButton").show(),$("#counterpartyAddressSaveButton").text(Yii.t("counterparties/js","Изменить"))},createCounterpartyAddressSaveButton:function(){var e=$("body"),t=$("#addressModal"),a=t.find("#addressRef"),r=t.find("#buildingName"),n=t.find("#flatName"),i=t.find("#commentName"),o=$("#address_ul"),s=$("#counterparties_ul"),d=s.find("li.active").data("ref"),c=$("#cities_ul").find("li.active").data("ref");if(""==$addresses.selectedBuilding&&""!=$addresses.selectedStreet&&""!=r.val()){var l={StreetRef:$addresses.selectedStreet,BuildingNumber:r.val()},u={modelName:"Address",calledMethod:"createBuilding",methodProperties:l};$.ajax({async:!1,data:JSON.stringify(u),beforeSend:function(){e.modalmanager("loading")},success:function(t){t.success===!0?$addresses.selectedBuilding=t.data[0].Ref:t.success===!1?$.each(t.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","top-right")}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),e.modalmanager("removeLoading")}})}if(""==a.val())var l={CounterpartyRef:d,AddressCityRef:c,StreetRef:$addresses.selectedStreet,BuildingRef:$addresses.selectedBuilding,Flat:n.val(),Note:i.val()},u={modelName:"Address",calledMethod:"save",modelProperties:l};else if(""!=a.val())var l={Ref:a.val(),CounterpartyRef:d,StreetRef:$addresses.selectedStreet,BuildingRef:$addresses.selectedBuilding,Flat:n.val(),Note:i.val()},u={modelName:"Address",calledMethod:"update",modelProperties:l};$.ajax({data:JSON.stringify(u),beforeSend:function(){e.modalmanager("loading")},success:function(r){if(r.success===!0){""!=a.val()&&o.find("#"+a.val()).remove();var n=r.data[0].Ref,i=r.data[0].Description,s=$("<li>").attr("id",n).attr("data-ref",n).attr("data-description",i).attr("data-warehouse","false").addClass("browser_element_main").append($("<a>").append($("<label>").addClass("element_check").append($("<input>").attr("type","checkbox").attr("data-ref",n).addClass("element_check"))).append(i));o.find("li.listDelimiter:first").length?o.find("p.empty_list_address").remove().end().find("li.listDelimiter:first").after(s):o.find("p.empty_list").remove().end().append(s),o.find("li#"+n).trigger("click"),t.modal("hide")}else r.success===!1?$.each(r.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."));$counterparties.check_fields_filled(),e.modalmanager("removeLoading")}})},deleteCounterpartyAddressSaveButton:function(){var e=$("#addressModal"),t=e.find("#addressRef"),a=$("#address_ul");if(""!=t.val()){var r={Ref:t.val()};$counterparties.deleteSingleItem("Address",r,t.val(),a,e)}},createCounterpartyContactButton:function(){$("#cities_ul").find("li.active").data("ref");1==$("#address_ul .browser_element_main.active").data("customaddress")?($(".cellFirstName").hide(),$(".cellMiddleName").hide(),$(".cellLastName").hide(),$(".cellFio").show()):($(".cellFirstName").show(),$(".cellMiddleName").show(),$(".cellLastName").show(),$(".cellFio").hide());{var e=$("#filter_journal_contacts"),t=$("#contactModal"),a=t.find("#contactFirstName"),r=t.find("#contactMiddleName"),n=t.find("#contactLastName");t.find("#contactFioString")}a.val(e.val()),r.val(e.val()),n.val(e.val()),t.find("#contactRef").val(""),t.find("#contactPhone").val(""),t.find("#contactEmail").val(""),$("#counterpartyContactDeleteButton").hide(),$("#counterpartyContactSaveButton").text(Yii.t("counterparties/js","Создать"))},createCounterpartyContactPhoneButton:function(){var e=($("#filter_journal_contacts"),$("#contactPhoneModal"));e.find("#contactRef").val(""),e.find("#contactPhone").val(""),e.find("#contactEmail").val(""),$("#counterpartyContactDeleteButton").hide(),$("#counterpartyContactSaveButton").text(Yii.t("counterparties/js","Создать"))},editCounterpartyContactButton:function(){var e=$("#contactModal"),t=e.find("#contactFirstName"),a=e.find("#contactMiddleName"),r=e.find("#contactLastName"),n=e.find("#contactPhone"),i=e.find("#contactEmail"),o=e.find("#contactRef"),s=$("#contacts_ul").find("li.active"),d=s.attr("data-firstname"),c=s.attr("data-middlename"),l=s.attr("data-lastname"),u=s.attr("data-phone"),p=s.attr("data-email"),f=s.attr("data-ref");t.val(d),a.val(c),r.val(l),n.val(u).change(),i.val(p),o.val(f),e.find('input[type="text"], input[type="tel"]').closest(".error").removeClass("error"),$("#counterpartyContactDeleteButton").show(),$("#counterpartyContactSaveButton").text(Yii.t("counterparties/js","Изменить"))},editCounterpartyContactPhoneButton:function(){var e=$("#contactPhoneModal"),t=e.find("#contactPhone"),a=e.find("#contactEmail"),r=e.find("#contactRef"),n=$("#contacts_ul").find("li.active"),i=n.attr("data-phone"),o=n.attr("data-email"),s=n.attr("data-ref");t.val(i),a.val(o),r.val(s),e.find('input[type="text"], input[type="tel"]').closest(".error").removeClass("error"),$("#counterpartyContactDeleteButton").show(),$("#counterpartyContactSaveButton").text(Yii.t("counterparties/js","Изменить"))},createCounterpartyContactSaveButton:function(){var e=$("body"),t=$("#contactModal"),a=t.find("#contactFirstName"),r=t.find("#contactMiddleName"),n=t.find("#contactLastName"),i=t.find("#contactPhone"),o=t.find("#contactEmail"),s=t.find("#contactRef"),d=$("#contacts_ul"),c=$("#counterparties_ul"),l=c.find("li.active").data("ref");if(""==s.val())var u={CounterpartyRef:l,FirstName:a.val(),MiddleName:r.val(),LastName:n.val(),Phone:i.val(),Email:o.val()},p={modelName:"ContactPerson",calledMethod:"save",modelProperties:u};else if(""!=s.val())var u={Ref:s.val(),CounterpartyRef:l,FirstName:a.val(),MiddleName:r.val(),LastName:n.val(),Phone:i.val(),Email:o.val()},p={modelName:"ContactPerson",calledMethod:"update",modelProperties:u};$.ajax({data:JSON.stringify(p),beforeSend:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],e.modalmanager("loading")},success:function(a){if(a.success===!0){""!=s.val()&&d.find("#"+s.val()).remove();var r=a.data[0].Ref,n=a.data[0].Description,i=a.data[0].LastName,o=a.data[0].FirstName,c=a.data[0].MiddleName,l=new RegExp("^\\+*(.*)$","ig"),u=a.data[0].Phones.replace(l,"$1"),p=a.data[0].Email,f=$("<li>").attr("id",r).attr("data-ref",r).attr("data-description",n).attr("data-firstname",o).attr("data-middlename",c).attr("data-lastname",i).attr("data-phone",u).attr("data-email",p).addClass("browser_element_main").append($("<a>").append($("<label>").addClass("element_check").append($("<input>").attr("type","checkbox").attr("data-ref",r).addClass("element_check"))).append(n+", "+Yii.t("counterparties/js","тел")+". "+u));$("#contacts_ul").find("p.empty_list:first").hide(),d.prepend(f),d.find("#"+r).trigger("click"),t.modal("hide")}else a.success===!1?$.each(a.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."));$counterparties.check_fields_filled(),e.modalmanager("removeLoading")}})},createcounterpartyContactPhoneSaveButton:function(){var e=$("body"),t=$("#contactPhoneModal"),a=t.find("#contactPhone"),r=t.find("#contactEmail"),n=t.find("#contactRef"),i=$("#contacts_ul"),o=$("#counterparties_ul"),s=o.find("li.active").data("ref");if(""==n.val())var d={CounterpartyRef:s,Phone:a.val(),Email:r.val()},c={modelName:"ContactPerson",calledMethod:"save",modelProperties:d};else if(""!=n.val())var d={Ref:n.val(),CounterpartyRef:s,Phone:a.val(),Email:r.val()},c={modelName:"ContactPerson",calledMethod:"update",modelProperties:d};$.ajax({data:JSON.stringify(c),beforeSend:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],e.modalmanager("loading")},success:function(a){if(a.success===!0){""!=n.val()&&i.find("#"+n.val()).remove();var r=a.data[0].Ref,o=a.data[0].Description,s=a.data[0].LastName,d=a.data[0].FirstName,c=a.data[0].MiddleName,l=a.data[0].Phones,u=new RegExp("^\\+*38(.*)$","ig"),l=a.data[0].Phones.replace(u,"$1"),p=a.data[0].Email,f=$("<li>").attr("id",r).attr("data-ref",r).attr("data-description",o).attr("data-firstname",d).attr("data-middlename",c).attr("data-lastname",s).attr("data-phone",l).attr("data-email",p).addClass("browser_element_main").append($("<a>").append($("<label>").addClass("element_check").append($("<input>").attr("type","checkbox").attr("data-ref",r).addClass("element_check"))).append(o+", "+Yii.t("counterparties/js","тел")+". "+l));$("#contacts_ul").find("p.empty_list:first").hide(),i.prepend(f),i.find("#"+r).trigger("click"),t.modal("hide")}else a.success===!1?$.each(a.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."));$counterparties.check_fields_filled(),e.modalmanager("removeLoading")}})},deleteCounterpartyContactSaveButton:function(){var e=$("#contactModal"),t=e.find("#contactRef"),a=$("#contacts_ul");if(""!=t.val()){var r={Ref:t.val()};$counterparties.deleteSingleItem("ContactPerson",r,t.val(),a,e)}},createCounterpartyButton:function(){var e=$("#filter_journal_counterparties"),t=$("#counterpartyModal"),a=t.find("#counterpartyFirstName"),r=t.find("#counterpartyMiddleName"),n=t.find("#counterpartyLastName"),i=t.find("#counterpartyPhone"),o=t.find("#counterpartyEmail"),s=t.find("#ownershipFormsList"),d=t.find("#counterpartyOrganizationName"),c=t.find("#counterpartyEDRPOU"),l=t.find("#counterpartyRef");a.val(e.val()),d.val(e.val()),r.val(""),n.val(""),i.val(""),o.val(""),s.selectBoxIt({aggressiveChange:!0}),c.val(""),l.val("");var u=$("#tabsCounterpartyType");u.find("li > a").removeClass("disabled"),$("#counterpartyDeleteButton").hide(),$("#counterpartySaveButton").text(Yii.t("counterparties/js","Создать"))},editCounterpartyButton:function(){var e=$("#counterpartyModal"),t=e.find("#counterpartyFirstName"),a=e.find("#counterpartyMiddleName"),r=e.find("#counterpartyLastName"),n=e.find("#counterpartyPhone"),i=e.find("#counterpartyEmail"),o=e.find("#ownershipFormsList"),s=e.find("#counterpartyOrganizationName"),d=e.find("#counterpartyEDRPOU"),c=e.find("#counterpartyRef"),l=$("#counterparties_ul").find("li.active"),u=$("#contacts_ul").find("li.active"),p=l.attr("data-firstname"),f=l.attr("data-edrpou"),m=l.attr("data-ownershipform"),v=l.attr("data-counterpartytype"),y=l.attr("data-ref"),h=$("#tabsCounterpartyType");if(h.find("li > a").addClass("disabled"),"PrivatePerson"==v){h.find('a[href="#PrivatePerson"]').removeClass("disabled").tab("show");var g=l.attr("data-middlename"),C=l.attr("data-lastname"),_=u.attr("data-phone"),b=u.attr("data-email");t.val(p),a.val(g),r.val(C),n.val(_).change(),i.val(b)}else"Organization"==v&&(h.find('a[href="#Organization"]').removeClass("disabled").tab("show"),o.val(m).change(),s.val(p),d.val(f));c.val(y),e.find('input[type="text"], input[type="tel"]').closest(".error").removeClass("error"),$("#counterpartyDeleteButton").show(),$("#counterpartySaveButton").text(Yii.t("counterparties/js","Изменить"))},createCounterpartySaveButton:function(){var e=$("body"),t=$("#counterpartyModal"),a=t.find("#counterpartyRef"),r=$("#counterparties_ul"),n=$("#cities_ul"),i=n.find("li.active").data("ref"),o=t.find("#tabsCounterpartyType").find("li.active").data("counterpartytype");switch(o){case"PrivatePerson":var s=t.find("#counterpartyFirstName"),d=t.find("#counterpartyMiddleName"),c=t.find("#counterpartyLastName"),l=t.find("#counterpartyPhone"),u=t.find("#counterpartyEmail");if(""==a.val())var p={CityRef:i,FirstName:s.val(),MiddleName:d.val(),LastName:c.val(),Phone:l.val(),Email:u.val(),CounterpartyType:"PrivatePerson",CounterpartyProperty:$counterparties.counterpartyProperty},f={modelName:"Counterparty",calledMethod:"save",modelProperties:p};else if(""!=a.val())var p={Ref:a.val(),CityRef:i,FirstName:s.val(),MiddleName:d.val(),LastName:c.val(),Phone:l.val(),Email:u.val(),CounterpartyType:"PrivatePerson",CounterpartyProperty:$counterparties.counterpartyProperty},f={modelName:"Counterparty",calledMethod:"update",modelProperties:p};break;case"Organization":default:var m=t.find("#counterpartyOrganizationName"),v=m.val(),y=t.find("#ownershipFormsList"),h=y.val(),g=t.find("#counterpartyEDRPOU");if(("undefined"==typeof g.val()||""===g.val())&&(g=t.find("#counterpartyOrganizationEdrpou"),""!==g.val()&&(v="",h="")),""==a.val())var p={CityRef:i,FirstName:v,OwnershipForm:h,EDRPOU:g.val(),CounterpartyType:"Organization",CounterpartyProperty:$counterparties.counterpartyProperty},f={modelName:"Counterparty",calledMethod:"save",modelProperties:p};else if(""!=a.val())var p={Ref:a.val(),CityRef:i,FirstName:v,OwnershipForm:h,EDRPOU:g.val(),CounterpartyType:"Organization",CounterpartyProperty:$counterparties.counterpartyProperty},f={modelName:"Counterparty",calledMethod:"update",modelProperties:p}}var C=!1;$.ajax({data:JSON.stringify(f),beforeSend:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],C||(C=!0,$(".control-group").removeClass("error"),e.modalmanager("loading"))},success:function(n){if(void 0!=n.data[0]&&"undefined"!=typeof n.data[0].ContactPerson&&void 0!=n.data[0].ContactPerson.data[0]&&($counterparties.contactRefToSelect=n.data[0].ContactPerson.data[0].Ref),n.success===!0){if(void 0==n.warnings.DuplicateValidate||void 0!=n.warnings.DuplicateValidate&&"Counterparty is not unique"!=n.warnings.DuplicateValidate){""!=a.val()&&r.find("#"+a.val()).remove();var i=n.data[0].Ref,s=n.data[0].Description,d=n.data[0].FirstName,c=n.data[0].MiddleName,l=n.data[0].LastName,u=n.data[0].Counterparty,p=n.data[0].OwnershipForm,f=n.data[0].OwnershipFormDescription,m=n.data[0].EDRPOU,v=n.data[0].CounterpartyType,y=$("<li>").attr("id",i).attr("data-ref",i).attr("data-description",s).attr("data-firstname",d).attr("data-middlename",c).attr("data-lastname",l).attr("data-counterparty",u).attr("data-ownershipform",p).attr("data-edrpou",m).attr("data-counterpartytype",v).addClass("browser_element_main").append($("<a>").append($("<label>").addClass("element_check").append($("<input>").attr("type","checkbox").attr("data-ref",i).addClass("element_check"))).append($("<i>").addClass("icon-chevron-right")).append(f+" "+s));"PrivatePerson"==o||"Organization"==o&&($("#counterparties_ul").find(".listDelimiter.Organization").next("p.empty_list_address:first, p.empty_list:first").hide(),r.find(".listDelimiter.Organization").after(y)),r.find("#"+i).trigger("click",{bNoCheckActive:!0}),t.modal("hide"),"undefined"!=typeof g&&"undefined"!=typeof g.val()&&""!==g.val()&&g.val("")}}else n.success===!1?$.each(n.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."));void 0!=n.warnings&&$.each(n.warnings,function(e,t){$noty.push(noty(Yii.t("counterparties/js",t),5e3,"warning"))}),e.modalmanager("removeLoading")},complete:function(){C=!1}})},createCounterpartySenderButton:function(){var e=$("body"),t=$("#counterpartySenderModal"),a=$("#cities_ul"),r=!1,n={CityRef:a.find("li.active").data("ref")},i={modelName:"Counterparty",calledMethod:"cloneLoyaltyCounterpartySender",methodProperties:n};$.ajax({data:JSON.stringify(i),beforeSend:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],r||(r=!0,$(".control-group").removeClass("error"),e.modalmanager("loading"))},success:function(r){r.success===!0?(a.find("li.active").addClass("activeTemp"),a.find("li.active").removeClass("active"),a.find("li.activeTemp").trigger("click"),a.find("li.activeTemp").removeClass("activeTemp"),t.modal("hide")):r.success===!1?$.each(r.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),e.modalmanager("removeLoading")},error:function(){noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e.modalmanager("removeLoading")}})},deleteCounterpartySaveButton:function(){var e=$("#counterpartyModal"),t=e.find("#counterpartyRef"),a=$("#counterparties_ul");if(""!=t.val()){var r={Ref:t.val()};$counterparties.deleteSingleItem("Counterparty",r,t.val(),a,e)}},showUndeleteButton:function(e,t,a){e.after($("<li>").append($("<p>").hide().append($("<a>").text(Yii.t("counterparties/js","Отменить удаление")).attr("href","#").attr("data-ref",t).attr("data-type",a)).addClass("unDelete").show()))},undelete:function(e){var t=$("body"),a=$(e),r=a.data("ref"),n=a.data("type"),i=a.closest("ul"),o={Ref:r},s={modelName:n,calledMethod:"cancelDeletion",modelProperties:o};$.ajax({data:JSON.stringify(s),beforeSend:function(){t.modalmanager("loading")},success:function(e){e.success===!0?(a.closest("li").hide(),$("#"+r).removeClass("removed").show(),$counterparties.checkSelectedItems(i)):$.each(e.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","top-right")}),t.modalmanager("removeLoading")}})},deleteSingleItem:function(e,t,a,r,n){var i,o=$("body"),s={modelName:e,calledMethod:"delete",modelProperties:t};$.ajax({data:JSON.stringify(s),beforeSend:function(){o.modalmanager("loading")},success:function(t){t.success===!0?(i=r.find("li#"+a),i.addClass("removed").hide(),$counterparties.showUndeleteButton(i,a,e),r.find("li.browser_element_main:visible:first").trigger("click"),n.modal("hide")):$.each(t.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")})},complete:function(){o.modalmanager("removeLoading")}})},deleteSelectedItems:function(e,t){var a=$("body"),r=$(e).find('input[type="checkbox"]:checked:visible').closest("li"),n=[];if($.each(r,function(e,t){n.push($(t).attr("data-ref"))}),n.length>0){var i={DocumentRefs:n},o={modelName:t,calledMethod:"deletePack",modelProperties:i};$.ajax({data:JSON.stringify(o),beforeSend:function(){a.modalmanager("loading")},success:function(a){a.success===!0?($(a.data).size()>0&&$.each(a.data,function(a,r){var n;$.each(r,function(){n=r.Ref});var i=$("#"+n);i.addClass("removed").hide(),i.hasClass("active")&&e.find("li.browser_element_main:visible:first").trigger("click"),$counterparties.showUndeleteButton(i,n,t),$counterparties.checkSelectedItems(e)}),$(a.warnings).size()>0&&$.each(a.warnings,function(e,t){noty(Yii.t("orders/js",t),3e3,"error","center")}),$counterparties.check_fields_filled()):a.success===!1&&$.each(a.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")})},complete:function(){a.modalmanager("removeLoading")}})}else noty(Yii.t("orders/js","Сначала отметьте документы для удаления"),3e3,"warning","center");$counterparties.checkSelectedItems(e)},checkSelectedItems:function(e){var t=e.closest("div.top-divider").find("a.btn-third"),a=$(e).find('input[type="checkbox"]:visible:checked');a.length>0&&("Sender"!=$counterparties.counterpartyProperty||"deleteCounterparty"!=t.attr("id"))||"Sender"==$counterparties.counterpartyProperty&&"deleteContact"==t.attr("id")?t.removeClass("hidden").closest("div").find("span").removeClass("two-buttons").addClass("three-buttons"):t.addClass("hidden").closest("div").find("span").removeClass("three-buttons").addClass("two-buttons"),$counterparties.check_fields_filled()},load_list_rendered:function(e,t,a,r,n,i){i=i||0;var o=$("#"+a);return null!=n&&n.abort(),n=$.ajax({url:Yii.app.createUrl("counterparties/"+e,t),type:"get",dataType:"html",ifModified:!0,beforeSend:function(){o.html("").css("opacity",0),$("#"+a).parent().addClass("loading"),$counterparties.check_fields_filled()},success:function(e){o.html(e),$counterparties.select_element(a,i),$counterparties.check_fields_filled()},error:function(e){"abort"!=e.statusText&&noty(Yii.t("counterparties/js","Возникла ошибка"))},complete:function(){$("#"+a).parent().removeClass("loading"),o.css("opacity",1)}})},check_fields_filled:function(){var e=$("#cities_ul").find("li.active"),t=$("#counterparties_ul").find("li.active"),a=$("#address_ul").find("li.active"),r=$("#contacts_ul").find("li.active");return $counterparties.check_city_filled(),$counterparties.check_counterparty_filled(),$counterparties.check_address_filled(),$counterparties.check_contact_filled(),"true"==$("#counterparties_ul").attr("data-readonly")&&$counterparties.set_edite_permission(),e.length>0&&t.length>0&&a.length>0&&r.length>0?($("#selectCounterpartyButton").removeClass("disabled"),!0):($("#selectCounterpartyButton").addClass("disabled"),!1)},set_edite_permission:function(){$(".createCounterparty").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),$("#editCounterparty").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),$(".createAddress").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),$("#editAddress").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),$(".createContact").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),$("#editContact").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click")},check_city_filled:function(){var e=$("#cities_ul").find("li.active"),t=$(".createCounterparty");return t.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),e.length>0?("Sender"!=$counterparties.counterpartyProperty?t.removeClass("disabled").attr("data-toggle","modal").attr("href","#counterpartyModal").click(function(){$counterparties.createCounterpartyButton()
}):0==$("#counterparties_ul li, #counterparties_ul span").hasClass("browser_element_main")&&1==window.IsLoyalty&&t.removeClass("disabled").attr("data-toggle","modal").attr("href","#counterpartySenderModal"),!0):!1},check_counterparty_filled:function(){var e=$("#counterparties_ul").find("li.active"),t=$("#contacts_ul").find("li.active"),a=$(".createAddress"),r=$(".createContact"),n=$("#editCounterparty");if(e.length>0){"Sender"!=$counterparties.counterpartyProperty&&(t.length>0||"Organization"==e.attr("data-counterpartytype")?n.removeClass("disabled").attr("data-toggle","modal").attr("href","#counterpartyModal").click(function(){$counterparties.editCounterpartyButton()}):n.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click")),a.removeClass("disabled").removeClass("disabled").attr("data-toggle","modal").attr("href","#addressModal").click(function(){$counterparties.createCounterpartyAddressButton()});var i=window.IsLoyalty&&"Sender"==$counterparties.counterpartyProperty;if(i)r.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click");else{{$("#cities_ul").find("li.active").data("ref")}r.removeClass("disabled").attr("data-toggle","modal").attr("href","#contactModal").click(function(){$counterparties.createCounterpartyContactButton()})}return!0}return n.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),a.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),r.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),$("#address_ul").html(""),$("#contacts_ul").html(""),!1},check_address_filled:function(){var e=$("#address_ul").find("li.active");return e.length>0&&!e.data("warehouse")?($("#editAddress").removeClass("disabled").attr("data-toggle","modal").attr("href","#addressModal").click(function(){$counterparties.editCounterpartyAddressButton()}),!0):($("#editAddress").addClass("disabled").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),!1)},check_contact_filled:function(){var e=$("#counterparties_ul").find("li.active"),t=$("#contacts_ul").find("li.active"),a=window.IsLoyalty&&"Sender"==$counterparties.counterpartyProperty,r=window.IsLoyalty&&"Sender"==$counterparties.counterpartyProperty;if(0==t.length&&""!=$("#contacts_ul").html()&&"PrivatePerson"==e.attr("data-counterpartytype")&&"Recipient"!==$counterparties.counterpartyProperty)$(".createContact").removeClass("disabled").attr("data-toggle","modal").attr("href","#contactPhoneModal").click(function(){$counterparties.createCounterpartyContactPhoneButton()});else if(a)$(".createContact").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click");else{{$("#cities_ul").find("li.active").data("ref")}$(".createContact").removeClass("disabled").attr("data-toggle","modal").attr("href","#contactModal").click(function(){$counterparties.createCounterpartyContactButton()})}if(r&&$("#contacts_ul .element_check").hide(),t.length>0){var n=window.IsLoyalty&&"Sender"==$counterparties.counterpartyProperty;return n||$("#editContact").removeClass("disabled").attr("data-toggle","modal").attr("href","#contactModal").click(function(){$counterparties.editCounterpartyContactButton()}),!0}return $("#editContact").addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),!1},select_element:function(e,t){t=t||0;var a,r=$("#"+e);if(""==t||0==t)a=r.find("li.browser_element_main").first();else if(liSelectElement='li.browser_element_main[data-ref="'+t+'"]',a=r.find(liSelectElement),"contacts_ul"==e){r.find(liSelectElement).hide();var n=$("#counterparties_ul").find("li.active").data("ref"),i={Counterparty:n,ContactRef:t};n&&$.ajax({url:Yii.app.createUrl("counterparties/getCounterpartyContactPersons",i),type:"get",dataType:"html",ifModified:!0,success:function(e){$("#contacts_ul li").removeClass("active"),$(e).prependTo(r),$("#selectCounterpartyButton").removeClass("disabled")}})}a.trigger("click")},get_filled_element:function(e,t){if(t)var a=$("#"+e+"> li").filter('[data-ref="'+t+'"]');else var a=$("#"+e).find("li.active");return a.data()},clear_lists:function(e,t,a,r){$counterparties.counterpartyRefToSelect=e,$counterparties.addressRefToSelect=t,$counterparties.contactRefToSelect=a;var n=$("#cities_block"),i=$("#counterparties_ul"),o=$("#address_ul"),s=$("#contacts_ul"),d=$("input.filter_input");s.html(""),o.html(""),i.html(""),d.val(""),n.find("li").removeClass("active"),$("#filter_journal_cities").val(r).trigger("keydown"),$counterparties.check_fields_filled()}},$addresses={buildingsData:[],mapStreets:{},mapBuildings:{},finishedStreets:!0,timeoutStreets:0,selectedStreet:"",selectedBuilding:"",streetFind:function(e,t){var a=$("body");clearTimeout($addresses.timeoutStreets),$addresses.timeoutStreets=setTimeout(function(){if($addresses.finishedStreets){$addresses.finishedStreets=!1;var r=$("#cities_ul").find("li.active").data("ref"),n={FindByString:e,Page:1,CityRef:r},i={modelName:"Address",calledMethod:"getStreet",methodProperties:n};$.ajax({data:JSON.stringify(i),beforeSend:function(){a.modalmanager("loading")},success:function(e){if(1==e.success){var r=[];$.each(e.data,function(e,t){$addresses.mapStreets[t.Description+" "+t.StreetsType]=t,r.push(t.Description+" "+t.StreetsType)}),t(r)}else $.each(e.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")});$addresses.finishedStreets=!0,a.modalmanager("removeLoading")},error:function(){a.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка улиц"))}})}},500)},streetSelect:function(e){var t=$("body"),a={StreetRef:$addresses.mapStreets[e].Ref},r={modelName:"Address",calledMethod:"getBuildings",methodProperties:a};return $.ajax({data:JSON.stringify(r),beforeSend:function(){t.modalmanager("loading")},success:function(e){1==e.success?($addresses.buildingsData=e.data,$("#buildingName").val("").removeClass("disabled").prop("readonly",!1),$("#flatName").val("").removeClass("disabled").prop("readonly",!1)):$.each(e.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")}),t.modalmanager("removeLoading")},error:function(){t.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка строений"))}}),$addresses.selectedStreet=$addresses.mapStreets[e].Ref,e},buildingFind:function(e,t){var a=[];$.each($addresses.buildingsData,function(e,t){$addresses.mapBuildings[t.Description]=t,a.push(t.Description)}),t(a)},buildingSelect:function(e){return $addresses.selectedBuilding=$addresses.mapBuildings[e].Ref,e}};
var $counterpartiesOnly={counterpartyProperty:"Recipient",counterpartyRefToSelect:"",counterpartyFilterEnabled:!1,init:function(){$('input[type="text"], input[type="tel"]').keypress(function(){$(this).closest(".error").removeClass("error")});var t,e=200;$(document).on("click","#cities_ul_counterparty > li.browser_element_main",function(){var r=$(this);if(!r.hasClass("active")){clearTimeout(t);var a=(r.attr("data-ref"),$("#filter_journal_counterparties_counterparty"));if(r.parent().find("li").removeClass("active"),r.addClass("active"),a.val(""),""!=$orders._filterCounterpartyId&&void 0!=$orders._filterCounterpartyId.data("type")&&"redirecting"==$orders._filterCounterpartyId.data("type"))var n={CounterpartyProperty:$counterpartiesOnly.counterpartyProperty,ServiceDataType:"redirecting"};else var n={CounterpartyProperty:$counterpartiesOnly.counterpartyProperty};t=setTimeout(function(){$counterpartiesOnly.load_list_rendered("getCounterparties",n,"counterparties_ul_counterparty","filter_journal_counterparties_counterparty",$counterpartiesOnly.counterpartyRefToSelect),a.fastLiveFilter("#counterparties_ul_counterparty")},e)}}),$("#counterpartyThirdPersonSaveButton").click(function(){$counterpartiesOnly.createCounterpartyThirdPersonSaveButton()}),$("#counterpartyThirdPersonDeleteButton").click(function(){$counterpartiesOnly.deleteCounterpartyThirdPersonSaveButton()});var r;$(document).on("click","#counterparties_ul_counterparty > li.browser_element_main",function(){var t=$(this);t.hasClass("active")||(clearTimeout(r),t.parent().find("li").removeClass("active"),t.addClass("active")),$counterpartiesOnly.check_fields_filled()})},initFilter:function(){$counterpartiesOnly.counterpartyFilterEnabled||($("#filter_journal_cities_counterparty").fastLiveFilter("#cities_ul_counterparty"),$counterpartiesOnly.counterpartyFilterEnabled=!0)},load_list_rendered:function(t,e,r,a,n){n=n||0;var i,o=$("#"+r),l=3001;$.ajax({url:Yii.app.createUrl("counterpartiesOnly/"+t,e),dataType:"html",type:"get",ifModified:!0,beforeSend:function(){o.html(""),$("#"+r).parent().addClass("loading")},success:function(c){o.html(c);var u=o.find(".browser_element_main").length;l>u?($counterpartiesOnly.select_element(r,n),$("#"+a).fastLiveFilter("#"+r)):($("#"+a).off(),$("#"+a).on("keyup",function(){clearTimeout(i);var o=$(this).val();i=setTimeout(function(){e.FindByString=o,$counterpartiesOnly.load_list_rendered(t,e,r,a,n)},1e3)}))},error:function(){},complete:function(){$counterpartiesOnly.check_fields_filled(),$("#"+r).parent().removeClass("loading")}})},createCounterpartyThirdPersonButton:function(){var t=($("#filter_journal_counterparties_counterparty"),$("#counterpartyThirdPersonModal")),e=t.find("#counterpartyEDRPOU"),r=t.find("#counterpartyRef");e.val(""),r.val(""),$("#counterpartyThirdPersonDeleteButton").hide(),$("#counterpartyThirdPersonSaveButton").text(Yii.t("counterparties/js","Создать"))},editCounterpartyThirdPersonButton:function(){var t=$("#counterpartyThirdPersonModal"),e=t.find("#counterpartyEDRPOU"),r=t.find("#counterpartyRef"),a=$("#counterparties_ul_counterparty").find("li.active"),n=a.attr("data-edrpou"),i=a.attr("data-ref");e.val(n),r.val(i),t.find('input[type="text"], input[type="tel"]').closest(".error").removeClass("error"),$("#counterpartyThirdPersonDeleteButton").show(),$("#counterpartySaveButton").text(Yii.t("counterparties/js","Изменить"))},createCounterpartyThirdPersonSaveButton:function(){var t=$("html"),e=$("#counterpartyThirdPersonModal"),r=e.find("#counterpartyRef"),a=$("#counterparties_ul_counterparty"),n=$("#cities_ul_counterparty"),i=n.find("li.active").data("ref"),o=e.find("#counterpartyEDRPOU");if(!new RegExp("^([\\d]{8}|[\\d]{10})$").test(o.val()))return $("#counterpartyThirdPersonModal").find(".cellEDRPOU").addClass("error"),noty(Yii.t("counterparties/js","не корректный ОКПО")),void 0;if("undefined"!=typeof appParameters.edrpouBlockThirdPersonPayers){var l=$.inArray(o.val(),appParameters.edrpouBlockThirdPersonPayers);if(-1!==l)return noty(Yii.t("counterparties/js","создание данного третьего лица запрещено")),void 0}if(""==r.val())var c={CityRef:i,EDRPOU:o.val(),CounterpartyType:"Organization",CounterpartyProperty:$counterpartiesOnly.counterpartyProperty},u={modelName:"Counterparty",calledMethod:"saveThirdPerson",modelProperties:c};else if(""!=r.val())var c={Ref:r.val(),CityRef:i,EDRPOU:o.val(),CounterpartyType:"Organization",CounterpartyProperty:$counterpartiesOnly.counterpartyProperty},u={modelName:"Counterparty",calledMethod:"updateThirdPerson",modelProperties:c};var s=!1;$.ajax({data:JSON.stringify(u),beforeSend:function(){$.each($noty,function(t,e){$(e.$note).hide()}),$noty=[],s||(s=!0,$(".control-group").removeClass("error"),t.modalmanager("loading"))},success:function(n){if(n.success===!0){""!=r.val()&&a.find("#"+r.val()).remove();var i=n.data[0].Ref,o=n.data[0].Description,l=n.data[0].FirstName,c=n.data[0].MiddleName,u=n.data[0].LastName,s=n.data[0].Counterparty,d=n.data[0].OwnershipForm,p=n.data[0].OwnershipFormDescription,y=n.data[0].EDRPOU,f=n.data[0].CounterpartyType,_=$("<li>").attr("id",i).attr("data-ref",i).attr("data-description",o).attr("data-firstname",l).attr("data-middlename",c).attr("data-lastname",u).attr("data-counterparty",s).attr("data-ownershipform",d).attr("data-edrpou",y).attr("data-counterpartytype",f).attr("data-ownershipformdescription",p).addClass("browser_element_main").append($("<a>").append($("<label>").addClass("element_check").append($("<input>").attr("type","checkbox").attr("data-ref",i).addClass("element_check"))).append(p+" "+o));$("#counterparties_ul_counterparty").find(".listDelimiter.Organization").next("p.empty_list_address:first, p.empty_list:first").hide(),a.find(".listDelimiter.Organization").after(_),a.find("#"+i).trigger("click"),e.modal("hide")}else n.success===!1?$.each(n.errors,function(t,e){$(".cell"+t).addClass("error"),$noty.push(noty(Yii.t("counterparties/js",e)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."));t.modalmanager("removeLoading")},complete:function(){s=!1,$counterpartiesOnly.check_fields_filled()}})},deleteCounterpartyThirdPersonSaveButton:function(){var t=$("#counterpartyThirdPersonModal"),e=t.find("#counterpartyRef"),r=$("#counterparties_ul_counterparty");if(""!=e.val()){var a={Ref:e.val()};$counterparties.deleteSingleItem("Counterparty",a,e.val(),r,t)}},check_fields_filled:function(){var t=$("#cities_ul_counterparty").find("li.active"),e=$("#counterparties_ul_counterparty").find("li.active");return $counterpartiesOnly.check_city_filled(),t.length>0&&e.length>0?($("#selectCounterpartyOnlyButton").removeClass("disabled"),!0):($("#selectCounterpartyOnlyButton").addClass("disabled"),!1)},check_city_filled:function(){var t=$("#cities_ul_counterparty").find("li.active"),e=$("#counterparties_ul_counterparty").find("li.active"),r=$("#createCounterpartyThirdPerson"),a=$("#editCounterpartyThirdPerson");return r.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),a.addClass("disabled").removeAttr("data-toggle").removeAttr("href").unbind("click"),t.length>0&&"Sender"!=$counterpartiesOnly.counterpartyProperty&&r.removeClass("disabled").attr("data-toggle","modal").attr("href","#counterpartyThirdPersonModal").click(function(){$counterpartiesOnly.createCounterpartyThirdPersonButton()}),e.length>0?(a.removeClass("disabled").attr("data-toggle","modal").attr("href","#counterpartyThirdPersonModal").click(function(){$counterpartiesOnly.editCounterpartyThirdPersonButton()}),!0):!1},select_element:function(t,e){e=e||0;var r,a=$("#"+t);r=""==e||0==e?a.find("li.browser_element_main").first():a.find('li.browser_element_main[data-ref="'+e+'"]'),r.trigger("click")},clear_lists:function(t,e){var r=$("#cities_block_counterparty"),a=$("#counterparties_ul_counterparty"),n=$("input.filter_input");a.html(""),n.val(""),r.find("li").removeClass("active"),$counterpartiesOnly.counterpartyRefToSelect=e,$("#filter_journal_cities_counterparty").val(t).trigger("keydown"),$counterpartiesOnly.check_fields_filled()}};
var $forgotPasswor={init:function(){$(".restoreType").on("click",function(){"email"==$(this).attr("id")?($("#restoreType").val("email"),$("#restoreFieldValue").val($(this).val())):($("#restoreType").val("phone"),$("#restoreFieldValue").val("")),$(".check").hide().children("input").removeAttr("name"),$("#check_"+$(this).attr("id")+"_"+$(this).val()).show().find("input").attr("name","restoreFieldValueCheck")}),$("#SelectPasswordResetType").on("submit",function(){return $.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],0==$(".restoreType:checked").length?($noty.push(noty(Yii.t("auth/js","Не выбран способ востановления пароля"))),!1):""==$("#check_"+$(".restoreType:checked").attr("id")+"_"+$(".restoreType:checked").val()).find("input").val()?("email"==$(".restoreType:checked").attr("id")?$noty.push(noty(Yii.t("auth/js","Не введен E-mail для проверки"))):$noty.push(noty(Yii.t("auth/js","Не введен номер Телефона для проверки"))),!1):!0}),$("#ForgotCardForm_Phone").intlTelInput({onlyCountries:["ua"]}).change()}};
$freight={_counterpartyCustomerOptions:"",_processedObjectType:"",_processedObjectTypeRaw:"",_processedWindowSelector:"",_modalWindowButtons:"#selectCustomer,#selectSender,#selectRecipient,#selectSenderCity,#selectRecipientCity,#selectPointOneCity,#selectPointTwoCity,#selectPointThreeCity",init:function(){scope=$("body"),objCounterpartySelectTimeout=1e3,objSettlementSelectTimeout=1e3,this.handleOpenWindowClick(),this.handleClearSearchButtonClick(),this.handleClearCityButtonClick(),this.handleApproveButtonClick(),this.handleListElementClick(),this.handleCounterpartySearchFieldInput(),this.handleSettlementSearchFieldInput(),this.initDateTimePickers(),this.handleFillFromCustomerClick(),this.initTelInputFields(),this.applyFieldMasks(),this.fillCalculatedVolume(),this.handleSubmitForm()},handleOpenWindowClick:function(){scope.on("click",$freight._modalWindowButtons,function(){$freight._processedObjectTypeRaw=$(this).context.id.replace("select",""),$freight._processedObjectType=$freight._processedObjectTypeRaw,"Customer"===$freight._processedObjectTypeRaw&&($freight._processedObjectType="Sender"),-1===$freight._processedObjectTypeRaw.search("City")?($freight._processedWindowSelector="#counterparties_ul",$("#filter_journal_counterparties").val(""),$("#selectCounterpartyModal").modal("show"),$freight.loadCounterparties()):($freight._processedWindowSelector="#cities_ul",$("#filter_journal_cities").val(""),$freight.loadSettlements(),$("#selectCityModal").modal("show")),$freight.applyFieldMasks()})},loadCounterparties:function(){$freight.loadListRendered("getCounterparties","","counterparties_ul","filter_journal_counterparties","","")},loadSettlements:function(){$freight.loadListRendered("getSettlements","","cities_ul","filter_journal_cities","","")},handleClearSearchButtonClick:function(){scope.on("click",".modal-body div.button-input.clear",function(){var e=$(this).siblings("input");e.val("").trigger("keydown").focus()})},handleClearCityButtonClick:function(){scope.on("click",".additionalPointsBlock div.button-input.clear",function(){var e=$(this).siblings("input");$.each(e,function(e,t){$(t).val("")})})},handleApproveButtonClick:function(){scope.on("click",".selectApproveButton",function(){$freight.fillSelectedElement()})},fillSelectedElement:function(){if($freight.checkFieldsFilled()){var e=$($freight._processedWindowSelector).find("li.active"),t=$freight._processedObjectTypeRaw+"Description",i=$freight._processedObjectTypeRaw,n=$("#"+i),o=n.val();n.val(e.data("id")),$("#"+t).val(e.data("description")),"#cities_ul"===$freight._processedWindowSelector?($("#selectCityModal").modal("hide"),$("#filter_journal_cities").val("")):($("#selectCounterpartyModal").modal("hide"),$("#filter_journal_counterparties").val(""),$freight.getCounterpartyOptions(e.data("id"),o))}},checkFieldsFilled:function(){var e=$($freight._processedWindowSelector).find("li.active");return e.length>0?($(".selectApproveButton").removeClass("disabled"),!0):($(".selectApproveButton").addClass("disabled"),!1)},handleListElementClick:function(){scope.on("click","li.browser_element_main",function(){var e=$(this);e.hasClass("active")||(clearTimeout(objCounterpartySelectTimeout),e.parent().find("li").removeClass("active"),e.addClass("active")),$freight.checkFieldsFilled()})},handleCounterpartySearchFieldInput:function(){$("#filter_journal_counterparties").bind({keyup:function(){clearTimeout(objCounterpartySelectTimeout);var e,t=$(this).val();objCounterpartySelectTimeout=setTimeout(function(){var i={String:t};$freight.loadListRendered("getCounterparties",i,"counterparties_ul","filter_journal_counterparties",e,$freight.counterpartyRefToSelect)},1e3),$freight.counterpartyRefToSelect=""}})},handleSettlementSearchFieldInput:function(){$("#filter_journal_cities").bind({keyup:function(){clearTimeout(objSettlementSelectTimeout);var e=$(this).val();objSettlementSelectTimeout=setTimeout(function(){var t={FindByString:e};$freight.loadListRendered("getSettlements",t,"cities_ul","filter_journal_cities","","")},1e3)}})},loadListRendered:function(e,t,i,n,o){o=o||0;var r=$("#"+i);$.ajax({url:Yii.app.createUrl("freight/"+e,t),dataType:"html",type:"get",ifModified:!0,beforeSend:function(){r.html(""),$("#"+i).parent().addClass("loading")},success:function(e){r.html(e),$freight.selectElement(i,o),$("#"+n).fastLiveFilter("#"+i)},error:function(){noty(Yii.t("freight/js","Возникла ошибка"))},complete:function(){$("#"+i).parent().removeClass("loading")}})},selectElement:function(e,t){t=t||0;var i,n=$("#"+e);i=""==t||0==t?n.find("li.browser_element_main").first():n.find('li.browser_element_main[data-ref="'+t+'"]'),i.trigger("click")},initDateTimePickers:function(){$("#dateToLoad, #dateAfterLoad, #dateArrival, #dateUnLoad,#dateArrivalPointOne, #dateArrivalPointTwo, #dateArrivalPointThree,#dateUnLoadPointOne, #dateUnLoadPointTwo, #dateUnLoadPointThree").datetimepicker({startDate:new Date,format:"dd.mm.yyyy hh:ii",autoclose:!0,minView:0,maxView:3,todayBtn:!0,todayHighlight:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1}).on("show",function(){$freight.dateTimePickerLogic()})},handleFillFromCustomerClick:function(){scope.on("click","#FillFromCustomer",function(){$("input[name=Sender]").val($("#CustomerDescription").val()),$("input[name=SenderContactPerson]").val($("input[name=CustomerContactPerson]").val()),$("input[name=SenderPhone]").val($("input[name=CustomerPhone]").val()),$("input[name=SenderEmail]").val($("input[name=CustomerEmail]").val())})},initTelInputFields:function(){$(".phoneField").intlTelInput({onlyCountries:["ua"]})},applyFieldMasks:function(){$("input.mask-integer").mask("#"),$("input.mask-char_filter").mask("L")},fillCalculatedVolume:function(){scope.on("keyup","#Length, #Width, #Height",function(){var e=$("#Volume");if(""!==e.val())return!1;var t=$("#Length").val(),i=$("#Width").val(),n=$("#Height").val();if(""===t||""===i||""===n)return!1;var o=Math.round(t*i*n*10)/10;e.val(o)})},handleSubmitForm:function(){var e=!1;$("#formSaveFreight").ajaxForm({beforeSubmit:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],e||(e=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide())},success:function(e){if($(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0){var t="";e.warnings.length&&(t+="<ul>",$.each(e.warnings,function(e,i){t+="<li>"+Yii.t("freight/js",i)+" </li>"}),t+="</ul>"),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("freight/js","Номер документа:")+" <b>"+e.data[0].Number+"</b> </p>"+t).end().modal()}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("freight/js",t)))}):noty(Yii.t("freight/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1,$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),e=!1}})},dateTimePickerLogic:function(){function e(e){var t=new Date;return t.setDate(e.substring(0,2)),t.setMonth(e.substring(3,5)),t.setYear(e.substring(6,10)),t.setHours(e.substring(11,13)),t.setMinutes(e.substring(14,16)),t.setMinutes(t.getMinutes()+5),("0"+t.getDate()).slice(-2)+"."+("0"+t.getMonth()).slice(-2)+"."+t.getFullYear()+" "+("0"+t.getHours()).slice(-2)+"."+("0"+t.getMinutes()).slice(-2)}var t=$("#DateToLoad").val(),i=$("#DateAfterLoad").val(),n=$("#DateArrival").val(),o=($("#DateUnLoad").val(),$("#DateArrivalPointOne").val()),r=$("#DateUnLoadPointOne").val(),a=$("#DateArrivalPointTwo").val(),l=$("#DateUnLoadPointTwo").val(),s=$("#DateArrivalPointThree").val(),c=$("#DateUnLoadPointThree").val();$("#dateAfterLoad").datetimepicker("setStartDate",e(t)),i>c?$("#dateArrival").datetimepicker("setStartDate",e(i)):$("#dateArrival").datetimepicker("setStartDate",e(c)),$("#dateUnLoad").datetimepicker("setStartDate",e(n)),$("#dateArrivalPointOne").datetimepicker("setStartDate",i),$("#dateUnLoadPointOne").datetimepicker("setStartDate",o),$("#dateArrivalPointTwo").datetimepicker("setStartDate",r),$("#dateUnLoadPointTwo").datetimepicker("setStartDate",a),$("#dateArrivalPointThree").datetimepicker("setStartDate",l),$("#dateUnLoadPointThree").datetimepicker("setStartDate",s)},getCounterpartyOptions:function(e,t){if(e!==t){if(""===e||void 0==e||"00000000-0000-0000-0000-000000000000"===e)return!1;var i={Ref:e},n={modelName:"Counterparty",calledMethod:"getCounterpartyOptions",methodProperties:i};$.ajax({data:JSON.stringify(n),success:function(e){null!=e&&void 0!=e.success&&e.success===!0?($freight._counterpartyCustomerOptions=e.data[0],$freight.blockDebtorCustomer()):null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$noty.push(noty(Yii.t("freight/js",t)))}):noty(Yii.t("freight/js","Ошибка при получении свойств контрагента"))}})}},blockDebtorCustomer:function(){"Customer"===$freight._processedObjectTypeRaw&&$freight._counterpartyCustomerOptions.Debtor&&noty(Yii.t("freight/js","Обраному контрагенту заборонено створювати заявку на фрахт"))}},$freightIndex={init:function(){scopeBody=$("body"),this.handleDenyOpenWindowClick(),this.handleSubmitForm(),this.handleDenyWindowCancelClick(),$freightIndex.filters.init()},handleDenyOpenWindowClick:function(){scopeBody.on("click",".buttonDenyFreight",function(){var e=$(this).closest(".freightListItem").attr("id");$("#FreightDenyId").val(e),$("#documentDenyModal").modal("show"),$freightIndex.applyFieldMasks()})},applyFieldMasks:function(){$("input.mask-char_filter").mask("L")},handleSubmitForm:function(){var e=!1;scopeBody.on("click","#DenyReasonSaveButton",function(){return $freightIndex.checkFieldsFilled()?($.ajax({type:"POST",url:"/freight/deny",data:{DenyReason:$("#DenyReason").val(),Ref:$("#FreightDenyId").val()},beforeSend:function(){$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],e||(e=!0,$("#progressLoadingForm").show(),$("#declineControlButtons").hide())},success:function(e){if($(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0){var t="";e.warnings.length&&(t+="<ul>",$.each(e.warnings,function(e,i){t+="<li>"+Yii.t("freight/js",i)+" </li>"}),t+="</ul>"),noty(Yii.t("freight/js","Фрахт успешно отменен"),3e3,"success"),$("#documentDenyModal").modal("hide"),setTimeout(3e3),location.reload(!0)}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("freight/js",t)))}):noty(Yii.t("freight/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1,$("#progressLoadingForm").hide(),$("#declineControlButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#declineControlButtons").show(),e=!1}}),void 0):(noty(Yii.t("freight/js","Причина не указана")),!1)})},handleDenyWindowCancelClick:function(){$("#documentDenyModal").on("click",".reset",function(){$("#documentDenyModal").modal("hide")})},checkFieldsFilled:function(){var e=$("#DenyReason").val();return e.length>0},filters:{init:function(){$("#filterNumber, #filterDeclaredCost, #filterCustomerContactName, #filterCustomerPhone, #filterWeight, #filterVolume, #filterStatus").change(function(){var e=$(this).closest("form");$freightIndex.filters.formSubmit(e)}),$("#filterDateTime, #filterDateTimeVehicleFiling").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:4,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1}).change(function(e){var t=$(e.currentTarget).closest("form");$freightIndex.filters.formSubmit(t)})},formSubmit:function(e){e=e||$("form.ordersForm").has("table.freightList"),e.submit()}}};
var $helper={init:function(){},ajaxHtml:function(e){return e="object"==typeof e?e:{},_currentAjax=$.ajax({url:e.url,type:"get",dataType:"html",ifModified:!0,beforeSend:function(){e.beforeSend&&e.beforeSend()},success:function(n){e.inBlock&&e.inBlock.html(n),e.success&&e.success(n)},error:function(n){e.error&&e.error(n)},complete:function(){e.complete&&e.complete()}})}};
$iewOrder={objCounterpartySelectTimeout:1e3,processedModal:"",mapCities:[],selectedCity:"",selectedCityAvailability:!0,mapStreets:[],mapCountries:[],mapWarehouses:[],selectedStreet:"",selectedCountry:"",selectedWarehouse:"",finishedCities:!0,finishedStreets:!0,finishedCountries:!0,finishedWarehouses:!0,timeoutCities:0,timeoutStreets:0,timeoutCountries:0,timeoutWarehouses:0,stepSender:"StepSender",stepRecipient:"StepRecipient",stepCargoInfo:"StepCargoInfo",stepInvoice:"StepInvoice",stepCheckOrder:"StepCheckOrder",endStep:"EndStep",privatePerson:"PrivatePerson",organization:"Organization",langEn:"en",langUa:"ua",selectors:{ids:{counterpartySender:"#selectCounterpartySender",counterpartySenderWarehouseCity:"#selectCounterpartySenderWarehouseCity",counterpartiesUL:"#counterparties_ul",addressUL:"#address_ul",counterpartySenderFromWarehouse:"#CounterpartySenderFromWarehouse",selectCounterpartyModal:"#selectCounterpartyModal",selectAddressModal:"#selectAddressModal",selectDpdWarehouse:"#selectDpdWarehouse",cargoInfoTypeOfShipment:'[name="TypeOfShipment"]',exportReason:"#ExportReason",formSaveStepCargoInfo:"#formSaveStepCargoInfo",clientInvoice:"#ClientInvoice",invoiceCurrency:"#InvoiceCurrency",noDeliveryTypesAvailableModal:"#noDeliveryTypesAvailableModal"},classes:{selectApproveButton:".selectApproveButton",warehouseRecipient:".selectWarehouseRecipient",placeRow:".iewOrderPlaceRow",cargoInfoPlaceNumber:".iewOrderCargoInfoPlaceNumber",copyPlace:".copyPlace",addPlace:".addPlace",deletePlace:".deletePlace",placeLength:".PlaceLength",placeHeight:".PlaceHeight",placeWidth:".PlaceWidth",placeVolumetricWeight:".PlaceVolumetricWeight",placeActualWeight:".PlaceActualWeight",documentPriceResult:".documentPriceResult",deliveryTypesListInfoRow:".infoRow",countrySelector:".countrySelector",countrySelectorRef:".countrySelectorRef",viewImage:".viewImage",inputContainer:".input-container",placeCost:".placeCost",placeAmount:".placeAmount",placeMeasurementsUnit:".placeMeasurementsUnit"},complex:{modalClearButton:".modal-body div.button-input.clear",modalListElement:"li.browser_element_main",modalCounterpartiesListElement:"#counterparties_ul li.browser_element_main",modalContactsListElement:"#contacts_ul li.browser_element_main",modalCitiesListElement:"#cities_ul li.browser_element_main",modalAddressListElement:"#address_ul li.browser_element_main",initCargoInfoPlaceActualWeight:'[name="Place[0][ActualWeight]"]',initCargoInfoPlaceVolumetricWeight:'[name="Place[0][VolumetricWeight]"]',initCargoInfoPlaceLength:'[name="Place[0][Length]"]',initCargoInfoPlaceHeight:'[name="Place[0][Height]"]',initCargoInfoPlaceWidth:'[name="Place[0][Width]"]',counterpartyRecipientType:'[name="CounterpartyRecipientType"]',deliveryType:'[name="DeliveryType"]',payerType:'[name="PayerType"]',placeRowInitNoDot:"iewOrderPlaceRowInit",placeRowInput:".iewOrderPlaceRow input",cargoInfoTypeOfShipmentChecked:'[name="TypeOfShipment"]:checked',cargoInfoDeliveryTypeChecked:'[name="DeliveryType"]:checked',forms:"#formSaveStepSender, #formSaveStepRecipient, #formSaveStepCargoInfo, #formSaveStepInvoice, #formSaveStepCheckOrder",createdModalBody:$("#iewOrderCreatedModal .modal-body"),maskDouble_9_1:"mask-double_9_1",maskInteger_9:"mask-integer_9"},objects:{scope:$("body"),selectApproveButton:$(".selectApproveButton"),filterJournalCounterparties:$("#filter_journal_counterparties"),filterJournalContacts:$("#filter_journal_contacts"),filterJournalCities:$("#filter_journal_cities"),filterJournalAddress:$("#filter_journal_address"),selectCounterpartyModal:$("#selectCounterpartyModal"),selectAddressModal:$("#selectAddressModal"),contactsUL:$("#contacts_ul"),counterpartiesUL:$("#counterparties_ul"),citiesUL:$("#cities_ul"),addressUL:$("#address_ul"),counterpartySenderDescription:$("#CounterpartySenderDescription"),counterpartySenderLastName:$("#CounterpartySenderLastName"),counterpartySenderMiddleName:$("#CounterpartySenderMiddleName"),counterpartySenderFirstName:$("#CounterpartySenderFirstName"),counterpartySenderRef:$("#CounterpartySenderRef"),counterpartyContactPersonRef:$("#CounterpartyContactPersonRef"),counterpartySenderPhone:$("#CounterpartySenderPhone"),counterpartySenderEmail:$("#CounterpartySenderEmail"),counterpartySenderFromWarehouse:$("#CounterpartySenderFromWarehouse"),warehouseAddressCheckbox:$(".warehouseAddressCheckbox"),counterpartySenderCityDescription:$("#CounterpartySenderWarehouseCity"),counterpartySenderWarehouseCityRef:$("#CounterpartySenderWarehouseCityRef"),counterpartySenderWarehouseDescription:$("#CounterpartySenderWarehouse"),counterpartySenderWarehouseRef:$("#CounterpartySenderWarehouseRef"),counterpartySenderCity:$("#CounterpartySenderCity"),counterpartySenderStreet:$("#CounterpartySenderStreet"),counterpartySenderCityRef:$("#CounterpartySenderCityRef"),counterpartySenderStreetRef:$("#CounterpartySenderStreetRef"),counterpartyRecipientPhone:$("#CounterpartyRecipientPhone"),counterpartyRecipientEmail:$("#CounterpartyRecipientEmail"),counterpartyRecipientType:$('[name="CounterpartyRecipientType"]'),counterpartyRecipientDescription:$("#CounterpartyRecipientDescription"),counterpartyRecipientLastName:$("#CounterpartyRecipientLastName"),counterpartyRecipientFirstName:$("#CounterpartyRecipientFirstName"),counterpartyRecipientIndex:$("#CounterpartyRecipientIndex"),counterpartyRecipientCountryRef:$("#CounterpartyRecipientCountryRef"),counterpartyRecipientCountry:$("#CounterpartyRecipientCountry"),counterpartyRecipientCity:$("#CounterpartyRecipientCity"),counterpartyRecipientStreet:$("#CounterpartyRecipientStreet"),counterpartyRecipientHouse:$("#CounterpartyRecipientHouse"),counterpartyRecipientAdditionalInfo:$("#CounterpartyRecipientAdditionalInfo"),counterpartyRecipientTypePrivatePerson:$("#CounterpartyRecipientTypePrivatePerson"),counterpartyRecipientTypeOrganization:$("#CounterpartyRecipientTypeOrganization"),counterpartyRecipientRef:$("#CounterpartyRecipientRef"),copyPlace:$(".copyPlace"),addPlace:$(".addPlace"),places:$(".iewOrderPlaces"),placeRowInit:$(".iewOrderPlaceRowInit"),cargoInfoTypeOfShipment:$('[name="TypeOfShipment"]'),recipientType:$("#RecipientType"),senderType:$("#SenderType"),paymentMethodCashBlock:$("#PaymentMethodCashBlock"),paymentMethodNonCashBlock:$("#PaymentMethodNonCashBlock"),paymentMethodCash:$("#PaymentMethodCash"),paymentMethodNonCash:$("#PaymentMethodNonCash"),exportReason:$("#ExportReason"),deliveryTypesListInfoRow:$(".infoRow"),showToShopWarehouse:$(".showToShopWarehouse"),additionalInformationExportReasonToggler:$(".AdditionalInformationExportReasonToggler"),additionalInformationExportReason:$("#AdditionalInformationExportReason"),warehouseRecipient:$(".WarehouseRecipient"),selectDpdWarehouse:$("#selectDpdWarehouse"),recipientCountryRef:$("#RecipientCountryRef"),warehouseRecipientRef:$("#WarehouseRecipientRef"),isTypeDocumentsNav:$(".isTypeDocumentsNav"),isNotTypeDocumentsNav:$(".isNotTypeDocumentsNav"),deliveryTypesList:$(".deliveryTypesList tr.infoRow"),countrySenderRef:$("#CountrySenderRef"),documentCost:$("#DocumentCost"),menPopover:$(".menPopover"),warehouseSenderRef:$("#WarehouseSenderRef"),clientInvoice:$("#ClientInvoice"),recipientDescriptionRow:$(".counterpartyRecipientDescriptionRow"),invoicePlacesInfo:$(".invoicePlacesInfo"),cargoDescription:$("#CargoDescription"),invoiceCost:$("#Cost"),invoiceCurrency:$("#InvoiceCurrency"),textTotalCost:$(".textTotalCost"),textInputTotalCost:$(".textInputTotalCost"),step:$("#Step"),nextStepUrl:$("#NextStepUrl"),nextStepUrlDocuments:$("#NextStepUrlDocuments"),progressLoadingForm:$("#progressLoadingForm"),blockFooterButtons:$("#blockFooterButtons"),controlGroup:$(".control-group"),createdModal:$("#iewOrderCreatedModal"),createdDocumentNumber:$(".createdDocumentNumber"),createdDocumentCost:$(".createdDocumentCost")}},init:function(){var e=this.selectors.objects.step.val();e===this.stepSender&&this.functions.initStepSenderHandlers(),e===this.stepRecipient&&this.functions.initStepRecipientHandlers(),e===this.stepCargoInfo&&this.functions.initStepCargoInfoHandlers(),e===this.stepInvoice&&this.functions.initStepInvoiceHandlers(),e===this.stepCheckOrder&&this.functions.initStepCheckOrderHandlers()},handlers:{openCounterpartySender:function(){$iewOrder.functions.onClick($iewOrder.selectors.ids.counterpartySender,function(){$iewOrder.processedModal=$iewOrder.selectors.ids.selectCounterpartyModal,$iewOrder.functions.clearValue($iewOrder.selectors.objects.filterJournalCounterparties),$iewOrder.functions.modalShow($iewOrder.selectors.objects.selectCounterpartyModal),$iewOrder.functions.loadCounterparties(),$iewOrder.functions.applyFieldMasks()})},clearSearchButton:function(){$iewOrder.functions.onClick($iewOrder.selectors.complex.modalClearButton,function(){var e=$(this).siblings("input");e.val("").trigger("keydown").focus()})},selectCounterparty:function(){$iewOrder.functions.onClick($iewOrder.selectors.complex.modalCounterpartiesListElement,function(){var e=$(this);$iewOrder.functions.changeActiveListElement(e),$iewOrder.functions.clearHtml($iewOrder.selectors.objects.contactsUL),$iewOrder.functions.clearValue($iewOrder.selectors.objects.filterJournalContacts),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var r={Counterparty:e.attr("data-id")};$iewOrder.functions.loadContacts(r)},0)})},selectContact:function(){$iewOrder.functions.onClick($iewOrder.selectors.complex.modalContactsListElement,function(){$iewOrder.functions.changeActiveListElement($(this)),$iewOrder.functions.checkFieldsFilled()})},approveButton:function(){$iewOrder.functions.onClick($iewOrder.selectors.classes.selectApproveButton,function(){$iewOrder.functions.fillSelectedElement()})},inputCounterpartySearchField:function(){$iewOrder.selectors.objects.filterJournalCounterparties.bind({keyup:function(){var e=$(this).val();0!==e.length&&(clearTimeout($iewOrder.objCounterpartySelectTimeout),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var r={String:e};$iewOrder.functions.loadCounterparties(r)},1e3))}})},inputContactSearchField:function(){$iewOrder.selectors.objects.filterJournalContacts.bind({keyup:function(){var e=$(this).val();if(0!==e.length){var r=$iewOrder.selectors.objects.counterpartiesUL.find("li.active");clearTimeout($iewOrder.objCounterpartySelectTimeout),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var t={Counterparty:r.attr("data-id"),FindByString:e};$iewOrder.functions.loadContacts(t)},1e3)}}})},clickSendFromWarehouse:function(){$iewOrder.functions.onClick($iewOrder.selectors.ids.counterpartySenderFromWarehouse,function(){$iewOrder.selectors.objects.counterpartySenderFromWarehouse.is(":checked")?$iewOrder.selectors.objects.warehouseAddressCheckbox.show():$iewOrder.selectors.objects.warehouseAddressCheckbox.hide()})},openAddress:function(){$iewOrder.functions.onClick($iewOrder.selectors.ids.counterpartySenderWarehouseCity,function(){$iewOrder.processedModal=$iewOrder.selectors.ids.selectAddressModal,$iewOrder.functions.clearValue($iewOrder.selectors.objects.filterJournalCities),$iewOrder.functions.modalShow($iewOrder.selectors.objects.selectAddressModal),$iewOrder.functions.loadCities(),$iewOrder.functions.applyFieldMasks()})},selectCity:function(){$iewOrder.functions.onClick($iewOrder.selectors.complex.modalCitiesListElement,function(){var e=$(this);$iewOrder.functions.changeActiveListElement(e),$iewOrder.functions.clearHtml($iewOrder.selectors.objects.addressUL),$iewOrder.functions.clearValue($iewOrder.selectors.objects.filterJournalAddress),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var r={City:e.attr("data-ref")};$iewOrder.functions.loadAddress(r)},0)})},selectAddress:function(){$iewOrder.functions.onClick($iewOrder.selectors.complex.modalAddressListElement,function(){$iewOrder.functions.changeActiveListElement($(this)),$iewOrder.functions.checkFieldsFilled()})},inputCitySearchField:function(){$iewOrder.selectors.objects.filterJournalCities.bind({keyup:function(){var e=$(this).val();0!==e.length&&(clearTimeout($iewOrder.objCounterpartySelectTimeout),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var r={FindByString:e};$iewOrder.functions.loadCities(r)},1e3))}})},inputAddressSearchField:function(){$iewOrder.selectors.objects.filterJournalAddress.bind({keyup:function(){var e=$(this).val();if(0!==e.length){var r=$iewOrder.selectors.objects.citiesUL.find("li.active");clearTimeout($iewOrder.objCounterpartySelectTimeout),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var t={City:r.attr("data-ref"),FindByString:e};$iewOrder.functions.loadAddress(t)},1e3)}}})},searchCity:function(){$iewOrder.selectors.objects.counterpartySenderCity.typeahead({minLength:2,source:function(e,r){$iewOrder.functions.cityFind(e,r)},matcher:function(e){return-1!=e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $iewOrder.functions.citySelect(e)}}).on("blur",function(){void 0==$iewOrder.mapCities[$(this).val()]&&($(this).val(""),$iewOrder.selectedCity="")})},searchStreet:function(){$iewOrder.selectors.objects.counterpartySenderStreet.typeahead({minLength:2,source:function(e,r){$iewOrder.functions.streetFind(e,r)},matcher:function(e){return-1!=e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $iewOrder.functions.streetSelect(e)}}).on("blur",function(){void 0==$iewOrder.mapStreets[$(this).val()]&&($(this).val(""),$iewOrder.selectedStreet="")})},inputRecipientPhone:function(){$iewOrder.selectors.objects.counterpartyRecipientPhone.bind({keyup:function(){var e=$(this).val();e.length<=3||(clearTimeout($iewOrder.objCounterpartySelectTimeout),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){$iewOrder.functions.loadRecipient(e)},1e3))}})},changeRecipientType:function(){$iewOrder.functions.onChange($iewOrder.selectors.complex.counterpartyRecipientType,function(e){e.target.value===$iewOrder.privatePerson?$iewOrder.selectors.objects.recipientDescriptionRow.hide():$iewOrder.selectors.objects.recipientDescriptionRow.show()})},searchCountry:function(e){$($iewOrder.selectors.classes.countrySelector).typeahead({minLength:2,source:function(r,t){$iewOrder.functions.countryFind(r,t,e)},matcher:function(){return!0},updater:function(r){return $iewOrder.functions.countrySelect(r,this.$element.context,e)}}).on("blur",function(){"undefined"==typeof $iewOrder.mapCountries[$(this).val()]&&$iewOrder.mapCountries.length>0&&($(this).val(""),$iewOrder.selectedCountry="")})},copyPlace:function(e,r){$iewOrder.functions.onClick($iewOrder.selectors.classes.copyPlace,function(){$iewOrder.functions.clonePlace($($iewOrder.selectors.classes.placeRow).last(),!1,e,r)})},addPlace:function(e,r){$iewOrder.functions.onClick($iewOrder.selectors.classes.addPlace,function(){$iewOrder.functions.clonePlace($iewOrder.selectors.objects.placeRowInit,!0,e,r)})},deletePlace:function(){$iewOrder.functions.onClick($iewOrder.selectors.classes.deletePlace,function(){var e=$($iewOrder.selectors.classes.placeRow).last();e.hasClass($iewOrder.selectors.complex.placeRowInitNoDot)||(e.remove(),$($iewOrder.selectors.complex.placeRowInput).trigger("change"))})},changeExportReason:function(){$iewOrder.functions.onChange($iewOrder.selectors.ids.exportReason,function(e){$iewOrder.functions.clearValue($iewOrder.selectors.objects.additionalInformationExportReason),e.target.value===appParameters.exportReasonContract||e.target.value===appParameters.exportReasonOther?$iewOrder.selectors.objects.additionalInformationExportReasonToggler.show():$iewOrder.selectors.objects.additionalInformationExportReasonToggler.hide()})},changeShipmentType:function(){$iewOrder.functions.onChange($iewOrder.selectors.ids.cargoInfoTypeOfShipment,function(){$iewOrder.functions.showHideDeliveryTypes(),$iewOrder.functions.changeFormFields();var e=$iewOrder.selectors.objects;$($iewOrder.selectors.complex.cargoInfoTypeOfShipmentChecked).val()===appParameters.documentsRef?(e.cargoDescription.val("Documents").prop("disabled",!0),e.cargoDescription.parents($iewOrder.selectors.classes.inputContainer).addClass("no-bgcolor"),e.isNotTypeDocumentsNav.hide(),e.isTypeDocumentsNav.show()):(e.cargoDescription.val("").prop("disabled",!1),e.cargoDescription.parents($iewOrder.selectors.classes.inputContainer).removeClass("no-bgcolor"),e.isTypeDocumentsNav.hide(),e.isNotTypeDocumentsNav.show())})},changeDeliveryType:function(){$iewOrder.functions.onChange($iewOrder.selectors.complex.deliveryType,function(){var e=$($iewOrder.selectors.complex.cargoInfoDeliveryTypeChecked).parents($iewOrder.selectors.classes.deliveryTypesListInfoRow);$iewOrder.selectors.objects.documentCost.val(e.find($iewOrder.selectors.classes.documentPriceResult).text().trim()),""!==e.data("shoptoshop")?e.next($iewOrder.selectors.objects.showToShopWarehouse.selector).show():($iewOrder.selectors.objects.showToShopWarehouse.hide(),$iewOrder.functions.clearValue($iewOrder.selectors.objects.warehouseRecipientRef))})},changePayerType:function(){$iewOrder.functions.onChange($iewOrder.selectors.complex.payerType,function(){var e=appParameters.isAllowedCountry&&$(this).val()===appParameters.payerRecipientRef,r=appParameters.isAllowedCountry&&!appParameters.isPrivatePerson&&$(this).val()===appParameters.payerSenderRef,t=appParameters.isAllowedCountry&&appParameters.isPrivatePerson&&$(this).val()===appParameters.payerSenderRef,i=t||!appParameters.isAllowedCountry&&appParameters.isPrivatePerson||e,o=r||!appParameters.isAllowedCountry&&!appParameters.isPrivatePerson||e,n=$iewOrder.selectors.objects;i?n.paymentMethodCashBlock.css("display","inline-block"):(n.paymentMethodCashBlock.hide(),n.paymentMethodNonCash.trigger("click")),o?n.paymentMethodNonCashBlock.css("display","inline-block"):(n.paymentMethodNonCashBlock.hide(),n.paymentMethodCash.trigger("click"))})},changeCargoInfoPlaceRowInput:function(){$iewOrder.functions.onChange($iewOrder.selectors.complex.placeRowInput,function(){var e=$(this).parents($iewOrder.selectors.classes.placeRow),r=e.find($iewOrder.selectors.classes.placeActualWeight),t=e.find($iewOrder.selectors.classes.placeLength),i=e.find($iewOrder.selectors.classes.placeHeight),o=e.find($iewOrder.selectors.classes.placeWidth),n=e.find($iewOrder.selectors.classes.placeVolumetricWeight);if(""===t.val()||""===i.val()||""===o.val()||""===r.val())return n.val(""),void 0;var s=parseFloat(r.val()),a=parseFloat(t.val()),c=parseFloat(i.val()),l=parseFloat(o.val()),d=a+2*c+2*l,u=a*c*l/5e3;n.val(Math.ceil(100*u)/100);var p=appParameters.countrySettings,f=[],h=!1,w=!1,m=!1,y=!1;$.each(p,function(e,r){var t=!1,i=!1,o=!1,n=!1,u=!1,p=!1;if(r.CounterpartyType===$iewOrder.selectors.objects.senderType.val()&&"Export"===r.Direction&&r.ShipmentType===$($iewOrder.selectors.complex.cargoInfoTypeOfShipmentChecked).val()){var O=parseFloat(r.MinWeight),v=parseFloat(r.MaxWeight),C=parseFloat(r.MinLengthCm),g=parseFloat(r.MaxLengthCm),S=parseFloat(r.MinHeightCm),R=parseFloat(r.MaxHeightCm),b=parseFloat(r.MinWidthCm),T=parseFloat(r.MaxWidthCm),P=parseInt(r.PlacesAmount),j=parseFloat(r.MaxGirthCm);if(s>=O&&v>=s&&(h=!0,t=!0),a>=C&&g>=a&&(w=!0,i=!0),c>=S&&R>=c&&(m=!0,o=!0),l>=b&&T>=l&&(y=!0,n=!0),(0===P||$iewOrder.functions.getCurrentPlaceNumber()<=P)&&(u=!0),(0===j||j>=d)&&(p=!0),t&&i&&o&&n&&u&&p)if(r.DeliveryType===appParameters.deliveryTypeExpress){var I=0;$.each($($iewOrder.selectors.classes.placeVolumetricWeight),function(e,r){""!==$(r).val()&&(I+=parseFloat($(r).val()))}),v>=I&&f.push(r.DeliveryType)}else f.push(r.DeliveryType)}}),$iewOrder.functions.showHideDeliveryTypes(f),h||r.val(""),w||t.val(""),m||i.val(""),y||o.val(""),h&&w&&m&&y||n.val(""),h&&w&&m&&y&&$iewOrder.functions.changeFormFields()})},openShopToShopWarehouse:function(){$iewOrder.functions.onClick($iewOrder.selectors.classes.warehouseRecipient,function(){$iewOrder.processedModal=$iewOrder.selectors.ids.selectDpdWarehouse,$iewOrder.functions.modalShow($iewOrder.selectors.objects.selectDpdWarehouse);var e={Country:$iewOrder.selectors.objects.recipientCountryRef.val()};$iewOrder.functions.loadDpdWarehouses(e),$iewOrder.functions.applyFieldMasks()})},inputShopToShopWarehouseSearchField:function(){$iewOrder.selectors.objects.filterJournalAddress.bind({keyup:function(){var e=$(this).val();0!==e.length&&(clearTimeout($iewOrder.objCounterpartySelectTimeout),$iewOrder.objCounterpartySelectTimeout=setTimeout(function(){var r={Country:$iewOrder.selectors.objects.recipientCountryRef.val(),FindByString:e};$iewOrder.functions.loadDpdWarehouses(r)},1e3))}})},selectShopToShopWarehouse:function(){$iewOrder.functions.onClick($iewOrder.selectors.complex.modalAddressListElement,function(){$iewOrder.functions.changeActiveListElement($(this)),$iewOrder.functions.checkFieldsFilled()})},clickClientInvoice:function(){$iewOrder.functions.onClick($iewOrder.selectors.ids.clientInvoice,function(){var e=$iewOrder.selectors.objects;e.clientInvoice.is(":checked")?(e.invoicePlacesInfo.hide(),e.invoiceCost.prop("disabled",!1),e.invoiceCost.parents($iewOrder.selectors.classes.inputContainer).removeClass("no-bgcolor"),e.textTotalCost.hide(),e.textInputTotalCost.show()):(e.invoiceCost.val("").prop("disabled",!0),e.invoiceCost.parents($iewOrder.selectors.classes.inputContainer).addClass("no-bgcolor"),e.invoicePlacesInfo.show(),e.textInputTotalCost.hide(),e.textTotalCost.show())})},changePlaceCost:function(){$iewOrder.functions.onChange($iewOrder.selectors.classes.placeCost,function(){$iewOrder.functions.calculateInvoiceTotalCost()})},changePlaceAmount:function(){$iewOrder.functions.onChange($iewOrder.selectors.classes.placeAmount,function(){$iewOrder.functions.calculateInvoiceTotalCost()})},changePlaceMeasurementUnits:function(){$iewOrder.functions.onChange($iewOrder.selectors.classes.placeMeasurementsUnit,function(){var e=$(this).parents($iewOrder.selectors.classes.placeRow).find($iewOrder.selectors.classes.placeAmount);$iewOrder.functions.clearValue(e),e.removeClass($iewOrder.selectors.complex.maskDouble_9_1),e.removeClass($iewOrder.selectors.complex.maskInteger_9),$(this).val()===appParameters.measurementsUnitsPieces||$(this).val()===appParameters.measurementsUnitsPackage?e.addClass($iewOrder.selectors.complex.maskInteger_9):e.addClass($iewOrder.selectors.complex.maskDouble_9_1),$main.activeMask()})},changeInvoiceCurrency:function(){$iewOrder.functions.onChange($iewOrder.selectors.ids.invoiceCurrency,function(){$iewOrder.functions.calculateInvoiceTotalCost()})},togglePopover:function(){$($iewOrder.selectors.objects.menPopover.selector).popover({trigger:"focus",animation:!1,delay:{show:100,hide:100}})},togglePopoverLong:function(){$iewOrder.selectors.objects.menPopover.popover({trigger:"hover",animation:!1,delay:{show:100,hide:600}})},viewImage:function(){$iewOrder.functions.onClick($iewOrder.selectors.classes.viewImage,function(){var e=$(this).data("src"),r=window.open();r.document.body.innerHTML='<img src="'+e+'">'})},submitForm:function(){var e=!1,r=$iewOrder.selectors.objects;$($iewOrder.selectors.complex.forms).ajaxForm({beforeSubmit:function(){$.each($noty,function(e,r){$(r.$note).hide()}),$noty=[],e||(e=!0,r.progressLoadingForm.show(),r.blockFooterButtons.hide())},success:function(e){if(r.controlGroup.removeClass("error"),null!=e&&"undefined"!=typeof e.success&&e.success===!0){var t="";if(e.warnings.length&&(t+="<ul>",$.each(e.warnings,function(e,r){t+="<li>"+Yii.t("iewOrder/js",r)+" </li>"}),t+="</ul>"),$iewOrder.endStep===r.nextStepUrl.val())return r.createdDocumentNumber.text(e.data[0].Number),r.createdDocumentCost.text(e.data[0].Cost),$iewOrder.functions.modalShow(r.createdModal),void 0;if($iewOrder.stepSender===r.step.val())return window.location=Yii.app.createUrl(r.nextStepUrl.val(),{Ref:e.data[0].Ref}),void 0;if($iewOrder.stepCargoInfo===r.step.val()){var i=$($iewOrder.selectors.complex.cargoInfoTypeOfShipmentChecked).val()===appParameters.documentsRef;if(i)return window.location=r.nextStepUrlDocuments.val(),void 0}window.location=r.nextStepUrl.val()}else null!=e&&"undefined"!=typeof e.success&&e.success===!1?$.each(e.errors,function(e,r){$(".cell"+e).addClass("error"),""!=r&&$noty.push(noty(Yii.t("iewOrder/js",r)))}):noty(Yii.t("freight/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1,r.progressLoadingForm.hide(),r.blockFooterButtons.show()},error:function(){r.progressLoadingForm.hide(),r.blockFooterButtons.show(),e=!1}})}},functions:{initStepSenderHandlers:function(){$iewOrder.handlers.openCounterpartySender(),$iewOrder.handlers.clearSearchButton(),$iewOrder.handlers.selectCounterparty(),$iewOrder.handlers.selectContact(),$iewOrder.handlers.approveButton(),$iewOrder.handlers.inputCounterpartySearchField(),$iewOrder.handlers.inputContactSearchField(),$iewOrder.handlers.clickSendFromWarehouse(),$iewOrder.handlers.openAddress(),$iewOrder.handlers.selectCity(),$iewOrder.handlers.selectAddress(),$iewOrder.handlers.inputCitySearchField(),$iewOrder.handlers.inputAddressSearchField(),$iewOrder.handlers.searchCity(),$iewOrder.handlers.searchStreet(),$iewOrder.handlers.submitForm()},initStepRecipientHandlers:function(){$iewOrder.handlers.inputRecipientPhone(),$iewOrder.handlers.changeRecipientType(),$iewOrder.handlers.searchCountry($iewOrder.langEn),$iewOrder.handlers.submitForm()},initStepCargoInfoHandlers:function(){$iewOrder.handlers.copyPlace(!0),$iewOrder.handlers.addPlace(!0),$iewOrder.handlers.deletePlace(),$iewOrder.handlers.changeExportReason(),$iewOrder.handlers.openShopToShopWarehouse(),$iewOrder.handlers.inputShopToShopWarehouseSearchField(),$iewOrder.handlers.selectShopToShopWarehouse(),$iewOrder.handlers.approveButton(),$iewOrder.handlers.clearSearchButton(),$iewOrder.handlers.changeShipmentType(),$iewOrder.handlers.changeDeliveryType(),$iewOrder.handlers.changePayerType(),$iewOrder.handlers.changeCargoInfoPlaceRowInput(),$iewOrder.handlers.togglePopoverLong(),$iewOrder.handlers.submitForm()},initStepInvoiceHandlers:function(){$iewOrder.handlers.copyPlace(!1,!0),$iewOrder.handlers.addPlace(!1,!0),$iewOrder.handlers.deletePlace(),$iewOrder.handlers.clickClientInvoice(),$iewOrder.handlers.searchCountry($iewOrder.langUa),$iewOrder.handlers.changePlaceCost(),$iewOrder.handlers.changePlaceAmount(),$iewOrder.handlers.changePlaceMeasurementUnits(),$iewOrder.handlers.changeInvoiceCurrency(),$iewOrder.handlers.togglePopover(),$iewOrder.handlers.submitForm()},initStepCheckOrderHandlers:function(){$iewOrder.handlers.viewImage(),$iewOrder.handlers.submitForm()},loadCounterparties:function(e){$iewOrder.functions.loadListRendered("getCounterparties",e,"counterparties_ul","filter_journal_counterparties","")},loadContacts:function(e){$iewOrder.functions.loadListRendered("getCounterpartyContactPersons",e,"contacts_ul","filter_journal_contacts","")},loadCities:function(e){$iewOrder.functions.loadListRendered("getCitiesWithWarehouse",e,"cities_ul","filter_journal_citiess","")},loadAddress:function(e){$iewOrder.functions.loadListRendered("getWarehouses",e,"address_ul","filter_journal_address","")},loadDpdWarehouses:function(e){$iewOrder.functions.loadListRendered("getDpdWarehouses",e,"address_ul","filter_journal_address","")},loadListRendered:function(e,r,t,i,o){o=o||0;var n=$("#"+t);$.ajax({url:Yii.app.createUrl("iewOrder/"+e,r),dataType:"html",type:"get",ifModified:!0,beforeSend:function(){n.html(""),$("#"+t).parent().addClass("loading"),$iewOrder.functions.checkFieldsFilled()},success:function(e){n.html(e),$iewOrder.functions.selectElement(t,o),$iewOrder.processedModal!==$iewOrder.selectors.ids.selectDpdWarehouse&&$("#"+i).fastLiveFilter("#"+t),$iewOrder.functions.checkFieldsFilled()},error:function(){noty(Yii.t("iewOrder/js","Возникла ошибка"))},complete:function(){$("#"+t).parent().removeClass("loading")}})},selectElement:function(e,r){r=r||0;var t,i=$("#"+e);t=""==r||0==r?i.find("li.browser_element_main").first():i.find('li.browser_element_main[data-ref="'+r+'"]'),t.trigger("click")},applyFieldMasks:function(){$("input.mask-integer").mask("#"),$("input.mask-char_filter").mask("L")},fillSelectedElement:function(){if($iewOrder.functions.checkFieldsFilled()){var e=$iewOrder.selectors.objects,r=e.counterpartiesUL.find("li.active"),t=e.contactsUL.find("li.active"),i=e.citiesUL.find("li.active"),o=e.addressUL.find("li.active");if($iewOrder.processedModal===$iewOrder.selectors.ids.selectDpdWarehouse&&o.length>0)return e.warehouseRecipientRef.val(o.data("ref")),e.warehouseRecipient.val(o.data("description")),$iewOrder.functions.modalHide($($iewOrder.processedModal)),!0;if($iewOrder.processedModal===$iewOrder.selectors.ids.selectAddressModal&&i.length>0&&o.length>0)return e.counterpartySenderCityDescription.val(i.text()),e.counterpartySenderWarehouseCityRef.val(i.data("ref")),e.counterpartySenderWarehouseDescription.val(o.data("description")),e.counterpartySenderWarehouseRef.val(o.data("ref")),$iewOrder.functions.modalHide($($iewOrder.processedModal)),!0;e.counterpartySenderDescription.val(r.data("description")),e.counterpartySenderLastName.val(t.data("lastname")),e.counterpartySenderMiddleName.val(t.data("middlename")),e.counterpartySenderFirstName.val(t.data("firstname")),e.counterpartySenderPhone.val(t.data("phone")),""===e.counterpartySenderEmail.val()&&e.counterpartySenderEmail.val(t.data("email")),e.counterpartySenderRef.val(r.data("id")),e.counterpartyContactPersonRef.val(t.data("ref")),$iewOrder.functions.modalHide($($iewOrder.processedModal)),$iewOrder.functions.clearValue(e.filterJournalCounterparties),$iewOrder.functions.clearValue(e.filterJournalCities)}},checkFieldsFilled:function(){var e=$iewOrder.selectors.objects,r=e.contactsUL.find("li.active"),t=e.contactsUL.find("li.active"),i=e.citiesUL.find("li.active"),o=e.addressUL.find("li.active");return $iewOrder.processedModal===$iewOrder.selectors.ids.selectCounterpartyModal&&r.length>0&&t.length>0?(e.selectApproveButton.removeClass("disabled"),!0):$iewOrder.processedModal===$iewOrder.selectors.ids.selectAddressModal&&i.length>0&&o.length>0?(e.selectApproveButton.removeClass("disabled"),!0):$iewOrder.processedModal===$iewOrder.selectors.ids.selectDpdWarehouse&&o.length>0?(e.selectApproveButton.removeClass("disabled"),!0):(e.selectApproveButton.addClass("disabled"),!1)},cityFind:function(e,r){var t=$iewOrder.selectors.objects.scope;clearTimeout($iewOrder.timeoutCities),$iewOrder.timeoutCities=setTimeout(function(){if($iewOrder.finishedCities){$iewOrder.finishedCities=!1;var i={FindByString:e,GetStreetsAvailability:!0},o={modelName:"Address",calledMethod:"getSettlements",methodProperties:i};$.ajax({data:JSON.stringify(o),beforeSend:function(){t.modalmanager("loading")},success:function(e){if(1==e.success){var i=[];$.each(e.data,function(e,r){$iewOrder.mapCities[r.Description+" ("+r.RegionsDescription+", "+r.AreaDescription+" обл.)"]=r,i.push(r.Description+" ("+r.RegionsDescription+", "+r.AreaDescription+" обл.)")}),r(i)}else $.each(e.errors,function(e,r){noty(Yii.t("iewOrder/js",r),3e3,"error","center")});$iewOrder.finishedCities=!0,t.modalmanager("removeLoading")},error:function(){t.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка"))}})}},500)},citySelect:function(e){return $iewOrder.selectedCity=$iewOrder.mapCities[e].Ref,$iewOrder.selectors.objects.counterpartySenderCityRef.val($iewOrder.selectedCity),$iewOrder.selectedCityAvailability=$iewOrder.mapCities[e].StreetsAvailability,e},streetFind:function(e,r){if(0==$iewOrder.selectedCityAvailability){$iewOrder.mapStreets[e]=e;var t=[];return t.push(e),r(t),void 0}var i=$iewOrder.selectors.objects.scope;clearTimeout($iewOrder.timeoutStreets),$iewOrder.timeoutStreets=setTimeout(function(){if($iewOrder.finishedStreets){$addresses.finishedStreets=!1;var t=$iewOrder.selectedCity;""===t&&(t=$iewOrder.selectors.objects.counterpartySenderCityRef.val());var o={FindByString:e,Page:1,SettlementRef:t},n={modelName:"Address",calledMethod:"getSettlementStreets",methodProperties:o};$.ajax({data:JSON.stringify(n),beforeSend:function(){i.modalmanager("loading")},success:function(e){if(1==e.success){var t=[];$.each(e.data,function(e,r){$iewOrder.mapStreets[r.Description+" "+r.StreetsType]=r,t.push(r.Description+" "+r.StreetsType)
}),r(t)}else $.each(e.errors,function(e,r){noty(Yii.t("iewOrder/js",r),3e3,"error","center")});$iewOrder.finishedStreets=!0,i.modalmanager("removeLoading")},error:function(){i.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка улиц"))}})}},500)},streetSelect:function(e){return 0==$iewOrder.selectedCityAvailability?e:($iewOrder.selectedStreet=$iewOrder.mapStreets[e].Ref,$iewOrder.selectors.objects.counterpartySenderStreetRef.val($iewOrder.selectedStreet),e)},countryFind:function(e,r,t){var i=$iewOrder.selectors.objects.scope;clearTimeout($iewOrder.timeoutCountries),$iewOrder.timeoutCountries=setTimeout(function(){if($iewOrder.finishedCountries){$iewOrder.finishedCountries=!1;var o={FindByString:e},n={modelName:"International",calledMethod:"getCountries",methodProperties:o};$.ajax({data:JSON.stringify(n),beforeSend:function(){i.modalmanager("loading")},success:function(e){if(1==e.success){if(0===e.data.length)return i.modalmanager("removeLoading"),noty(Yii.t("iewOrder/js","Не знайдено жодної країни по запиту")),$iewOrder.finishedCountries=!0,$($iewOrder.selectors.classes.countrySelector).val(""),void 0;var o=[];$.each(e.data,function(e,r){var i=r.Description;t===$iewOrder.langEn&&(i=r.DescriptionEn),$iewOrder.mapCountries[i+"("+r.Code+")"]=r,o.push(i+"("+r.Code+")")}),r(o)}else $.each(e.errors,function(e,r){noty(Yii.t("iewOrder/js",r),3e3,"error","center")});$iewOrder.finishedCountries=!0,i.modalmanager("removeLoading")},error:function(){i.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка"))}})}},500)},countrySelect:function(e,r){if($iewOrder.selectedCountry=$iewOrder.mapCountries[e].Ref,$(r).siblings($iewOrder.selectors.classes.countrySelectorRef).val($iewOrder.selectedCountry),$iewOrder.selectors.objects.step.val()===$iewOrder.stepInvoice)return e;if($iewOrder.selectors.objects.counterpartyRecipientType.is(":checked")===!1)return noty(Yii.t("iewOrder/js","Спочатку оберіть тип контагента")),void 0;var t=!1;if("undefined"!=typeof $iewOrder.mapCountries[e].Settings){var i=$($iewOrder.selectors.objects.counterpartyRecipientType.selector+":checked");$.each($iewOrder.mapCountries[e].Settings,function(e,r){r.CounterpartyType===i.val()&&"Export"===r.Direction&&(t=!0)})}return t?e:(noty(Yii.t("iewOrder/js","В обрану країну доставка не здійснюється")),void 0)},onClick:function(e,r){return"string"!=typeof e?(console.error("OnClick handler must be string"),void 0):($iewOrder.selectors.objects.scope.on("click",e,r),void 0)},onChange:function(e,r){return"string"!=typeof e?(console.error("OnClick handler must be string"),void 0):($iewOrder.selectors.objects.scope.on("change",e,r),void 0)},clearValue:function(e){return"object"!=typeof e?(console.error("clearValue selector must be object"),void 0):(e.val(""),void 0)},clearHtml:function(e){e.html("")},modalShow:function(e){e.modal("show")},modalHide:function(e){e.modal("hide")},changeActiveListElement:function(e){e.hasClass("active")||(clearTimeout($iewOrder.objCounterpartySelectTimeout),e.parent().find("li.active").removeClass("active"),e.addClass("active"))},loadRecipient:function(e){var r=$iewOrder.selectors.objects.scope,t={Phone:e,getExtendedInfo:!0},i={modelName:"International",calledMethod:"getRecipients",methodProperties:t};$.ajax({data:JSON.stringify(i),beforeSend:function(){r.modalmanager("loading")},success:function(e){if(1==e.success){var r=$iewOrder.selectors.objects;r.counterpartyRecipientRef.val(e.data[0].Ref),r.counterpartyRecipientDescription.val(e.data[0].Description),e.data[0].Type===$iewOrder.privatePerson?r.counterpartyRecipientTypePrivatePerson.trigger("click"):r.counterpartyRecipientTypeOrganization.trigger("click"),r.counterpartyRecipientPhone.val(e.data[0].Phone),r.counterpartyRecipientEmail.val(e.data[0].Email);var t=e.data[0].ContactPerson.split(" ");r.counterpartyRecipientLastName.val(t[0]),r.counterpartyRecipientFirstName.val(t[1]),r.counterpartyRecipientIndex.val(e.data[0].ZipCode),r.counterpartyRecipientCountryRef.val(e.data[0].CountryRef),r.counterpartyRecipientCountry.val(e.data[0].CountryDescriptionEn),r.counterpartyRecipientCity.val(e.data[0].CityDescription);var i=e.data[0].AddressDescription.split(";");r.counterpartyRecipientStreet.val(i[0].trim()),r.counterpartyRecipientHouse.val(i[1].trim()),r.counterpartyRecipientAdditionalInfo.val(i[2].trim())}},complete:function(){r.modalmanager("removeLoading")}})},clonePlace:function(e,r,t,i){if(t===!0){var o=appParameters.countrySettings,n=!1;if($.each(o,function(e,r){r.CounterpartyType===$iewOrder.selectors.objects.recipientType.val()&&"Export"===r.Direction&&r.ShipmentType===$iewOrder.selectors.objects.cargoInfoTypeOfShipment.val()&&(0==r.PlacesAmount||r.PlacesAmount>$iewOrder.functions.getCurrentPlaceNumber())&&(n=!0)}),!n)return}$iewOrder.selectors.objects.menPopover.popover("hide");var s=e.clone();s.removeClass($iewOrder.selectors.complex.placeRowInitNoDot);var a=$iewOrder.functions.getCurrentPlaceNumber()+1,c=s.find("input, select, textarea");s.find(".selectboxit-container").remove(),c.each(function(e,t){var i="Place["+a+"]["+$(t).data("fieldname")+"]";if($(t).attr("name",i),$(t).hasClass("custom-select"))var o=$(t).selectBoxIt({autoWidth:!1,hideCurrent:!0,showEffect:"slideDown",showEffectSpeed:200,hideEffect:"slideUp",hideEffectSpeed:100}).data("selectBox-selectBoxIt");r===!0&&($(t).hasClass("custom-select")?o.selectOption(0):$(t).hasClass("dontCleanOnCopy")||$iewOrder.functions.clearValue($(t)))});var l=s.find($iewOrder.selectors.classes.cargoInfoPlaceNumber);l.length&&l.text(a),$iewOrder.selectors.objects.places.append(s),$($iewOrder.selectors.complex.placeRowInput).trigger("change"),i===!0&&$iewOrder.handlers.searchCountry($iewOrder.langUa),$iewOrder.stepInvoice===$iewOrder.selectors.objects.step.val()&&($iewOrder.functions.calculateInvoiceTotalCost(),$iewOrder.handlers.togglePopover()),$main.activeMask()},showHideDeliveryTypes:function(e){$.each($iewOrder.selectors.objects.deliveryTypesList,function(r,t){var i=!1,o=!0;$($iewOrder.selectors.complex.cargoInfoTypeOfShipmentChecked).val()===$(t).data("shipmenttype")&&(i=!0),"undefined"==typeof e||$.inArray($(t).data("deliverytyperef"),e)>=0||(o=!1),i&&o?$(t).show():($(t).hide(),$(t).find($iewOrder.selectors.complex.deliveryType).prop("checked",!1),""!==$(t).data("shoptoshop")&&($(t).next($iewOrder.selectors.objects.showToShopWarehouse.selector).hide(),$iewOrder.functions.clearValue($iewOrder.selectors.objects.warehouseRecipientRef)))}),1===$iewOrder.selectors.objects.deliveryTypesList.filter(":visible").length&&$iewOrder.selectors.objects.deliveryTypesList.filter(":visible").find($iewOrder.selectors.complex.deliveryType).trigger("click"),0===$iewOrder.selectors.objects.deliveryTypesList.filter(":visible").length&&$iewOrder.functions.modalShow($($iewOrder.selectors.ids.noDeliveryTypesAvailableModal))},changeFormFields:function(){var e=[];$($iewOrder.selectors.classes.placeRow).each(function(r,t){var i=$(t),o=i.find($iewOrder.selectors.classes.placeActualWeight),n=i.find($iewOrder.selectors.classes.placeLength),s=i.find($iewOrder.selectors.classes.placeHeight),a=i.find($iewOrder.selectors.classes.placeWidth);e.push({Length:n.val(),Height:s.val(),Width:a.val(),ActualWeight:o.val()})});var r="Warehouse";""===$iewOrder.selectors.objects.warehouseSenderRef.val()&&(r="Doors");var t={CounterpartySender:$iewOrder.selectors.objects.counterpartySenderRef.val(),DeliveryType:$($iewOrder.selectors.complex.cargoInfoDeliveryTypeChecked).val(),ShipmentType:$($iewOrder.selectors.complex.cargoInfoTypeOfShipmentChecked).val(),PickupCountryRef:$iewOrder.selectors.objects.countrySenderRef.val(),DeliveryCountryRef:$iewOrder.selectors.objects.recipientCountryRef.val(),Parcels:e},i=$($iewOrder.selectors.complex.cargoInfoDeliveryTypeChecked).parents($iewOrder.selectors.classes.deliveryTypesListInfoRow).data("deliverytyperef");$($iewOrder.selectors.classes.deliveryTypesListInfoRow).each(function(e,o){var n=$(o);if(!n.is(":visible"))return!0;var s="Doors";""!==n.data("shoptoshop")&&(s="Warehouse"),t.ServiceType=r+s,t.DeliveryType=n.data("deliverytyperef");var a={modelName:"International",calledMethod:"getDocumentPrice",methodProperties:t};$.ajax({data:JSON.stringify(a),success:function(e){1==e.success&&"undefined"!=typeof e.data[0].Cost&&(n.find($iewOrder.selectors.classes.documentPriceResult).text(e.data[0].Cost),n.data("deliverytyperef")===i&&$iewOrder.selectors.objects.documentCost.val(e.data[0].Cost))}})})},getCurrentPlaceNumber:function(){return $($iewOrder.selectors.classes.placeRow).length},calculateInvoiceTotalCost:function(){var e=appParameters.currencyRateList,r=0;if($.each($($iewOrder.selectors.classes.placeCost),function(e,t){var i=$(t).parents($iewOrder.selectors.classes.placeRow).find($iewOrder.selectors.classes.placeAmount).val(),o=$(t).val();""!==i&&""!==o&&(r+=parseInt(i)*parseFloat(o))}),0===r)return $iewOrder.functions.clearValue($iewOrder.selectors.objects.invoiceCost),void 0;var t=r/parseFloat(e[$iewOrder.selectors.objects.invoiceCurrency.val()]);$iewOrder.selectors.objects.invoiceCost.val(Math.ceil(100*t)/100)}}};
$internationalOrders={selectors:{ids:{},classes:{orderCheckbox:".orderCheckbox",documentListItem:".documentListItem",mySmall:".my_small",orderCheckAll:".orderCheckAll",removeMenPack:".removeMenPack",editMen:".editMen",paginatorBlock:".paginatorBlock",paginatorPrev:".paginatorPrev",paginatorNext:".paginatorNext",paginator:".paginator",paginatorCurrentPageInfo:".paginatorCurrentPageInfo"},complex:{listItems:".internationalList a.btn, .internationalList input.orderCheckbox",orderCheckboxVisible:".orderCheckbox:visible",orderCheckboxChecked:".orderCheckbox:checked",documentListItemVisible:".documentListItem:visible",inputCheckbox:"input:checkbox",allowDenyDeleteDocument:".denyDeleteDocument, .allowDeleteDocument",denyDeleteDocument:"denyDeleteDocument"},objects:{scope:$("body"),submitDeleteModal:$("#submitDeleteModal")}},init:function(){$internationalOrders.handlers.clickListElement(),$internationalOrders.handlers.selectRowWithCheckBox(),$internationalOrders.handlers.selectRowByList(),$internationalOrders.handlers.selectRowByButton(),$internationalOrders.handlers.selectAllRows(),$internationalOrders.handlers.deleteMultipleMen(),$internationalOrders.handlers.submitDeleteMen(),$internationalOrders.handlers.editMen(),$internationalOrders.handlers.paginator(),$internationalOrders.functions.checkPagination()},handlers:{clickListElement:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.complex.listItems,function(e){e.stopPropagation()})},selectRowWithCheckBox:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.orderCheckbox,function(){$internationalOrders.functions.selectRow($(this).closest($internationalOrders.selectors.classes.documentListItem),!0)})},selectRowByList:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.documentListItem,function(){$internationalOrders.functions.selectRow($(this))})},selectRowByButton:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.mySmall,function(){$internationalOrders.functions.selectRow($(this).closest($internationalOrders.selectors.classes.documentListItem))})},selectAllRows:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.orderCheckAll,function(){var e=$(this),n=e.closest("table");n.find($internationalOrders.selectors.complex.orderCheckboxVisible).prop("checked",e.prop("checked")),n.find($internationalOrders.selectors.complex.documentListItemVisible).toggleClass("active",e.prop("checked")),n.find($internationalOrders.selectors.classes.orderCheckAll).prop("checked",e.prop("checked"))})},deleteMultipleMen:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.removeMenPack,function(){var e=$($internationalOrders.selectors.complex.orderCheckboxChecked);return 0===e.length?(noty(Yii.t("iewOrder/js","Не обрано жодного документу"),3e3,"warning","center"),void 0):($internationalOrders.selectors.objects.submitDeleteModal.modal("show"),void 0)})},submitDeleteMen:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.complex.allowDenyDeleteDocument,function(){var e=$(this);if($internationalOrders.selectors.objects.submitDeleteModal.modal("hide"),e.hasClass($internationalOrders.selectors.complex.denyDeleteDocument))return!1;var n=$($internationalOrders.selectors.complex.orderCheckboxChecked),t=[];$.each(n,function(e,n){t.push($(n).closest("tr").attr("id"))}),$internationalOrders.functions.removeMultipleMen(t)})},editMen:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.editMen,function(){var e=$($internationalOrders.selectors.complex.orderCheckboxChecked);return"undefined"==typeof e.val()?(noty(Yii.t("iewOrder/js","Спочатку оберіть документ"),3e3,"warning","center"),!1):e.length>1?(noty(Yii.t("iewOrder/js","Для редагування оберіть один документ"),3e3,"warning","center"),!1):(window.location=Yii.app.createUrl("iewOrder/stepCheckOrder",{Ref:e.val()}),void 0)})},paginator:function(){$internationalOrders.functions.onClick($internationalOrders.selectors.classes.paginator,function(){var e=$(this);if(e.hasClass("disabled"))return!1;var n,t=e.closest($internationalOrders.selectors.classes.paginatorBlock),r=parseInt(t.data("current-page")),s=e.data("next-page");"-"===s?n=r-1:"+"===s&&(n=r+1),t.data("current-page",n).find($internationalOrders.selectors.classes.paginatorCurrentPageInfo).text(n);var o=Yii.app.createUrl("international/index",{page:n});return e.closest("form").attr("action",o).submit(),history.pushState("","",Yii.app.createUrl("international/index",{page:n})),$internationalOrders.functions.checkPagination(),!1})}},functions:{onClick:function(e,n){return"string"!=typeof e?(console.error("OnClick handler must be string"),void 0):($internationalOrders.selectors.objects.scope.on("click",e,n),void 0)},onChange:function(e,n){return"string"!=typeof e?(console.error("OnClick handler must be string"),void 0):($internationalOrders.selectors.objects.scope.on("change",e,n),void 0)},selectRow:function(e,n){var t=e.find($internationalOrders.selectors.classes.orderCheckbox),r=n?!t.prop("checked"):t.prop("checked");e.toggleClass("active",!r),t.prop("checked",!r);var s=e.closest("table"),o=s.find($internationalOrders.selectors.complex.orderCheckboxChecked),i=s.find($internationalOrders.selectors.classes.orderCheckbox);o.length==i.length?s.find($internationalOrders.selectors.classes.orderCheckAll).prop("checked",!0):s.find($internationalOrders.selectors.classes.orderCheckAll).prop("checked",!1)},removeMultipleMen:function(e){if(e.length>0){var n={DocumentRefs:e},t={modelName:"International",calledMethod:"deleteMultiple",modelProperties:n};$.ajax({data:JSON.stringify(t),beforeSend:function(){$.each(e,function(e,n){var t=$("#"+n),r=$internationalOrders.functions.showProgressRow(n);t.hide().after(r),t.find($internationalOrders.selectors.complex.inputCheckbox).attr("checked",!1)})},success:function(n){return 1==n.success&&$.each(e,function(e,n){var t=$("#"+n);$internationalOrders.functions.hideProgressRow(n),t.remove()}),null!=n.warnings&&$.each(n.warnings,function(e,n){noty(Yii.t("orders/js",n),3e3,"error","center");var t=$("#"+e);t.find($internationalOrders.selectors.complex.inputCheckbox).attr("checked",!0)}),null!=n.errors&&$.each(n.errors,function(e,n){noty(Yii.t("orders/js",n),3e3,"error","center"),$internationalOrders.functions.hideProgressRow(e);var t=$("#"+e);t.show(),t.find($internationalOrders.selectors.complex.inputCheckbox).attr("checked",!0)}),!0}})}else noty(Yii.t("iewOrder/js","Не обрано жодного документу"),3e3,"warning","center")},showProgressRow:function(e,n){if(void 0!=n)var t=$(n).find("#"+e+" td").length;else var t=$("#"+e+" td").length;return $("<tr>").attr("id",e+"_progress").append($("<td>").attr("colspan",t).append($("<div>").addClass("progress").addClass("progress-striped").addClass("active").css("margin","5px 0").append($("<div>").addClass("bar").addClass("bar-danger").css("width","100%"))))},hideProgressRow:function(e){$("#"+e+"_progress").remove()},checkPagination:function(){var e=$internationalOrders.selectors.objects.scope.find($internationalOrders.selectors.classes.paginatorBlock);if(e.length){var n=parseInt(e.data("current-page"));1>=n?e.find($internationalOrders.selectors.classes.paginatorPrev).addClass("disabled"):e.find($internationalOrders.selectors.classes.paginatorPrev).removeClass("disabled"),appParameters.documentDefaultListLimit!=appParameters.documentCount?e.find($internationalOrders.selectors.classes.paginatorNext).addClass("disabled"):e.find($internationalOrders.selectors.classes.paginatorNext).removeClass("disabled")}}}};
!function(t){"function"==typeof define&&define.amd?define(["jquery"],function(i){t(i,window,document)}):t(jQuery,window,document)}(function(t,i,a,e){"use strict";function n(i,a){this.element=i,this.options=t.extend({},r,a),this._defaults=r,this.ns="."+s+o++,this.isGoodBrowser=Boolean(i.setSelectionRange),this._name=s,this.init()}var s="intlTelInput",o=1,r={autoFormat:!0,autoHideDialCode:!0,defaultCountry:"ua",nationalMode:!1,onlyCountries:[],preferredCountries:[],responsiveDropdown:!1,validationScript:""},l={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90,ZERO:48,NINE:57,SPACE:32,BSPACE:8,DEL:46,CTRL:17,CMD1:91,CMD2:224},u=!1;t(i).load(function(){u=!0}),n.prototype={init:function(){this.options.nationalMode&&(this.options.autoFormat=this.options.autoHideDialCode=!1),navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Chrome/i)&&(this.options.autoFormat=!1),this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners()},_processCountryData:function(){this._setInstanceCountryData(),this._setPreferredCountries()},_setInstanceCountryData:function(){var i=this;if(this.options.onlyCountries.length){var a,e,n=[],s={};for(e=0;e<this.options.onlyCountries.length;e++){var o=this.options.onlyCountries[e],r=i._getCountryData(o,!0,!0);r&&(n.push(r),a=r.dialCode,s[a]?s[a].push(o):s[a]=[o])}for(a in s)if(s[a].length>1){var l=[];for(e=0;e<d[a].length;e++){var u=d[a][e];t.inArray(s[a],u)&&l.push(u)}s[a]=l}this.countries=n,this.countryCodes=s}else this.countries=h,this.countryCodes=d},_setPreferredCountries:function(){var t=this;this.preferredCountries=[];for(var i=0;i<this.options.preferredCountries.length;i++){var a=this.options.preferredCountries[i],e=t._getCountryData(a,!1,!0);e&&t.preferredCountries.push(e)}},_generateMarkup:function(){this.telInput=t(this.element),this.telInput.wrap(t("<div>",{"class":"intl-tel-input"}));var i=t("<div>",{"class":"flag-dropdown"}).insertAfter(this.telInput),a=t("<div>",{"class":"selected-flag"}).appendTo(i);this.selectedFlagInner=t("<div>",{"class":"flag"}).appendTo(a),t("<div>",{"class":"arrow"}).appendTo(this.selectedFlagInner),this.countryList=t("<ul>",{"class":"country-list v-hide"}).appendTo(i),this.preferredCountries.length&&(this._appendListItems(this.preferredCountries,"preferred"),t("<li>",{"class":"divider"}).appendTo(this.countryList)),this._appendListItems(this.countries,""),this.dropdownHeight=this.countryList.outerHeight(),this.countryList.removeClass("v-hide").addClass("hide"),this.options.responsiveDropdown&&this.countryList.outerWidth(this.telInput.outerWidth()),this.countryListItems=this.countryList.children(".country")},_appendListItems:function(t,i){for(var a="",e=0;e<t.length;e++){var n=t[e];a+="<li class='country "+i+"' data-dial-code='"+n.dialCode+"' data-country-code='"+n.iso2+"'>",a+="<div class='flag "+n.iso2+"'></div>",a+="<span class='country-name'>"+n.name+"</span>",a+="<span class='dial-code'>+"+n.dialCode+"</span>",a+="</li>"}this.countryList.append(a)},_setInitialState:function(){var t=this.telInput.val();if(!t||!this.setNumber(t)){var i;i=this.options.defaultCountry?this._getCountryData(this.options.defaultCountry,!1,!1):this.preferredCountries.length?this.preferredCountries[0]:this.countries[0],this._selectFlag(i.iso2),this.options.autoHideDialCode||this._resetToDialCode(i.dialCode)}},_initListeners:function(){var e=this;this.telInput.on("change"+this.ns,function(){e._updateFlag()}),this.telInput.on("paste keyup change"+this.ns,function(){e._handleInputKey(null,!0)}),this.options.autoHideDialCode&&this._initAutoHideDialCode();var n=this.telInput.closest("label");n.length&&n.on("click"+this.ns,function(){e.countryList.hasClass("hide")&&e.telInput.focus()}),this.options.autoFormat;var s=this.selectedFlagInner.parent();if(s.on("click"+this.ns,function(){e.countryList.hasClass("hide")&&!e.telInput.prop("disabled")&&e._showDropdown()}),this.options.validationScript){var o=function(){var t=a.createElement("script");t.type="text/javascript",t.src=e.options.validationScript,a.body.appendChild(t)};u?o():t(i).load(o)}},_handleInputKey:function(t,i){var a=this.telInput.val(),e=null,n=!1,s=this.telInput[0];if(this.isGoodBrowser){var o=s.selectionEnd,r=a.length;n=o==r,t?(a=a.substring(0,s.selectionStart)+t+a.substring(o,r),n||(e=o+(a.length-r))):e=s.selectionStart}else t&&(a+=t);this.setNumber(a,i),this.isGoodBrowser&&(n&&(e=this.telInput.val().length),s.setSelectionRange(e,e))},_initAutoHideDialCode:function(){var i=this;this.telInput.on("mousedown"+this.ns,function(t){i.telInput.is(":focus")||i.telInput.val()||(t.preventDefault(),i._focus())}),this.telInput.on("focus"+this.ns,function(){t.trim(i.telInput.val())||(i._updateVal("+"+i.selectedCountryData.dialCode,!0),i.telInput.one("keypress.plus"+i.ns,function(t){t.which==l.PLUS&&i.telInput.val("+")}))}),this.telInput.on("blur"+this.ns,function(){var t=i.telInput.val(),a="+"==t.substring(0,1);if(a){var e=t.replace(/\D/g,"");e&&i._getDialCode().replace(/\D/g,"")!=e||i.telInput.val("")}i.telInput.off("keypress.plus"+i.ns)})},_focus:function(){this.telInput.focus();var t=this.telInput[0];if(this.isGoodBrowser){var i=this.telInput.val().length;t.setSelectionRange(i,i)}},_showDropdown:function(){this._setDropdownPosition();var t=this.countryList.children(".active");this._highlightListItem(t),this.countryList.removeClass("hide"),this._scrollTo(t),this._bindDropdownListeners(),this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var a=this.telInput.offset().top,e=t(i).scrollTop(),n=a+this.telInput.outerHeight()+this.dropdownHeight<e+t(i).height(),s=a-this.dropdownHeight>e,o=!n&&s?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",o)},_bindDropdownListeners:function(){var i=this;this.countryList.on("mouseover"+this.ns,".country",function(){i._highlightListItem(t(this))}),this.countryList.on("click"+this.ns,".country",function(){i._selectListItem(t(this))});var e=!0;t("html").on("click"+this.ns,function(){e||i._closeDropdown(),e=!1});var n="",s=null;t(a).on("keydown"+this.ns,function(t){t.preventDefault(),t.which==l.UP||t.which==l.DOWN?i._handleUpDownKey(t.which):t.which==l.ENTER?i._handleEnterKey():t.which==l.ESC?i._closeDropdown():(t.which>=l.A&&t.which<=l.Z||t.which==l.SPACE)&&(s&&clearTimeout(s),n+=String.fromCharCode(t.which),i._searchForCountry(n),s=setTimeout(function(){n=""},1e3))})},_handleUpDownKey:function(t){var i=this.countryList.children(".highlight").first(),a=t==l.UP?i.prev():i.next();a.length&&(a.hasClass("divider")&&(a=t==l.UP?a.prev():a.next()),this._highlightListItem(a),this._scrollTo(a))},_handleEnterKey:function(){var t=this.countryList.children(".highlight").first();t.length&&this._selectListItem(t)},_searchForCountry:function(t){for(var i=0;i<this.countries.length;i++)if(this._startsWith(this.countries[i].name,t)){var a=this.countryList.children("[data-country-code="+this.countries[i].iso2+"]").not(".preferred");this._highlightListItem(a),this._scrollTo(a,!0);break}},_startsWith:function(t,i){return t.substr(0,i.length).toUpperCase()==i},_updateVal:function(t,i,a){var e,n="";if(this.options.autoFormat){if(e=t.replace(/\D/g,""),i){var s=this.selectedCountryData.format;if(s)for(var o=0;o<s.length;o++)if("."==s[o]){if(!e)break;if(n+=e.substring(0,1),e=e.substring(1),!e&&a)break}else n+=s[o]}n||"+"!=t.substring(0,1)||(n="+")}else e=t;this.telInput.val(n+e)},_updateFlag:function(t){"0"==this.telInput.val().charAt(0)?this.telInput.val("+38"+this.telInput.val()):""!=this.telInput.val().charAt(0)&&"+"!=this.telInput.val().charAt(0)&&this.telInput.val("+"+this.telInput.val());var i=this._getDialCode(t);if(i){for(var a=this.countryCodes[i.replace(/\D/g,"")],e=!1,n=0;n<a.length;n++)this.selectedFlagInner.hasClass(a[n])&&(e=!0);e||this._selectFlag(a[0])}return i},_resetToDialCode:function(t){var i=this.options.nationalMode?"":"+"+t;this.telInput.val(i)},_highlightListItem:function(t){this.countryListItems.removeClass("highlight"),t.addClass("highlight")},_getCountryData:function(t,i,a){for(var e=i?h:this.countries,n=0;n<e.length;n++)if(e[n].iso2==t)return e[n];if(a)return null;throw new Error("No country data for '"+t+"'")},_selectFlag:function(t){this.selectedFlagInner.attr("class","flag "+t),this.selectedCountryData=this._getCountryData(t,!1,!1);var i=this.selectedCountryData.name+": +"+this.selectedCountryData.dialCode;this.selectedFlagInner.parent().attr("title",i);var a=this.countryListItems.children(".flag."+t).first().parent();this.countryListItems.removeClass("active"),a.addClass("active")},_selectListItem:function(t){var i=t.attr("data-country-code");this._selectFlag(i),this._closeDropdown(),this.options.nationalMode||(this._updateDialCode("+"+t.attr("data-dial-code")),this.telInput.trigger("change")),this._focus()},_closeDropdown:function(){this.countryList.addClass("hide"),this.selectedFlagInner.children(".arrow").removeClass("up"),t(a).off(this.ns),t("html").off(this.ns),this.countryList.off(this.ns)},_scrollTo:function(t,i){var a=this.countryList,e=a.height(),n=a.offset().top,s=n+e,o=t.outerHeight(),r=t.offset().top,l=r+o,u=r-n+a.scrollTop(),h=e/2-o/2;if(n>r)i&&(u-=h),a.scrollTop(u);else if(l>s){i&&(u+=h);var d=e-o;a.scrollTop(u-d)}},_updateDialCode:function(i){var a,e=this.telInput.val(),n=this._getDialCode();if(n.length>1)a=e.replace(n,i);else{var s=e&&"+"!=e.substr(0,1)?t.trim(e):"";a=i+s}this._updateVal(a,!0)},_getDialCode:function(i){var a="",e=i||this.telInput.val();if("+"==e.charAt(0))for(var n="",s=0;s<e.length;s++){var o=e.charAt(s);if(t.isNumeric(o)&&(n+=o,this.countryCodes[n]&&(a=e.substring(0,s+1)),4==n.length))break}return a},destroy:function(){this._closeDropdown(),this.telInput.off(this.ns),this.selectedFlagInner.parent().off(this.ns),this.telInput.closest("label").off(this.ns);var t=this.telInput.parent();t.before(this.telInput).remove()},getSelectedCountryData:function(){return this.selectedCountryData},isValidNumber:function(a){var e=t.trim(this.telInput.val()),n=a?this.selectedCountryData.iso2:"",s=/[a-zA-Z]/.test(e);return!s&&i.isValidNumber(e,n)},selectCountry:function(t){this.selectedFlagInner.hasClass(t)||(this._selectFlag(t),this.telInput.val()||this.options.autoHideDialCode||this._resetToDialCode(this.selectedCountryData.dialCode))},setNumber:function(t,i){var a=this._updateFlag(t);return this._updateVal(t,a,i),a}},t.fn[s]=function(i){var a=arguments;if(i===e||"object"==typeof i)return this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new n(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var o;return this.each(function(){var e=t.data(this,"plugin_"+s);e instanceof n&&"function"==typeof e[i]&&(o=e[i].apply(e,Array.prototype.slice.call(a,1))),"destroy"===i&&t.data(this,"plugin_"+s,null)}),o!==e?o:this}},t.fn[s].getCountryData=function(){return h},t.fn[s].setCountryData=function(t){h=t};for(var h=[["Afghanistan (‫افغانستان‬‎)","af","93"],["Aland Islands (‫Åland Islands‬‎)","ax","358"],["Albania (Shqipëri)","al","355"],["Algeria (‫الجزائر‬‎)","dz","213"],["American Samoa","as","1684"],["Andorra","ad","376"],["Angola","ao","244"],["Anguilla","ai","1264"],["Antigua and Barbuda","ag","1268"],["Argentina","ar","54"],["Armenia (Հայաստան)","am","374"],["Aruba","aw","297"],["Australia","au","61"],["Austria (Österreich)","at","43"],["Azerbaijan (Azərbaycan)","az","994"],["Bahamas","bs","1242"],["Bahrain (‫البحرين‬‎)","bh","973"],["Bangladesh (বাংলাদেশ)","bd","880"],["Barbados","bb","1246"],["Belarus (Беларусь)","by","375"],["Belgium (België)","be","32"],["Belize","bz","501"],["Benin (Bénin)","bj","229"],["Bermuda","bm","1441"],["Bhutan (འབྲུག)","bt","975"],["Bolivia","bo","591"],["Bosnia and Herzegovina (Босна и Херцеговина)","ba","387"],["Botswana","bw","267"],["Brazil (Brasil)","br","55"],["British Indian Ocean Territory","io","246"],["British Virgin Islands","vg","1284"],["Brunei","bn","673"],["Bulgaria (България)","bg","359"],["Burkina Faso","bf","226"],["Burundi (Uburundi)","bi","257"],["Cambodia (កម្ពុជា)","kh","855"],["Cameroon (Cameroun)","cm","237"],["Canada","ca","1"],["Cape Verde (Kabu Verdi)","cv","238"],["Caribbean Netherlands","bq","599","",1],["Cayman Islands","ky","1345"],["Central African Republic (République centrafricaine)","cf","236"],["Chad (Tchad)","td","235"],["Chile","cl","56"],["China (中国)","cn","86"],["Colombia","co","57"],["Comoros (‫جزر القمر‬‎)","km","269"],["Congo (DRC) (Jamhuri ya Kidemokrasia ya Kongo)","cd","243"],["Congo (Republic) (Congo-Brazzaville)","cg","242"],["Cook Islands","ck","682"],["Costa Rica","cr","506"],["Côte d’Ivoire","ci","225"],["Croatia (Hrvatska)","hr","385"],["Cuba","cu","53"],["Curaçao","cw","599","",0],["Cyprus (Κύπρος)","cy","357"],["Czech Republic (Česká republika)","cz","420"],["Denmark (Danmark)","dk","45"],["Djibouti","dj","253"],["Dominica","dm","1767"],["Dominican Republic (República Dominicana)","do","1809"],["Ecuador","ec","593"],["Egypt (‫مصر‬‎)","eg","20"],["El Salvador","sv","503"],["Equatorial Guinea (Guinea Ecuatorial)","gq","240"],["Eritrea","er","291"],["Estonia (Eesti)","ee","372"],["Ethiopia","et","251"],["Falkland Islands (Islas Malvinas)","fk","500"],["Faroe Islands (Føroyar)","fo","298"],["Fiji","fj","679"],["Finland (Suomi)","fi","358"],["France","fr","33","+.. . .. .. .. .."],["French Guiana (Guyane française)","gf","594"],["French Polynesia (Polynésie française)","pf","689"],["Gabon","ga","241"],["Gambia","gm","220"],["Georgia (საქართველო)","ge","995"],["Germany (Deutschland)","de","49"],["Ghana (Gaana)","gh","233"],["Gibraltar","gi","350"],["Greece (Ελλάδα)","gr","30"],["Greenland (Kalaallit Nunaat)","gl","299"],["Grenada","gd","1473"],["Guadeloupe","gp","590","",0],["Guam","gu","1671"],["Guatemala","gt","502"],["Guernsey","gg","44"],["Guinea (Guinée)","gn","224"],["Guinea-Bissau (Guiné Bissau)","gw","245"],["Guyana","gy","592"],["Haiti","ht","509"],["Honduras","hn","504"],["Hong Kong (香港)","hk","852"],["Hungary (Magyarország)","hu","36"],["Iceland (Ísland)","is","354"],["India (भारत)","in","91"],["Indonesia","id","62"],["Iran (‫ایران‬‎)","ir","98"],["Iraq (‫العراق‬‎)","iq","964"],["Ireland","ie","353"],["Isle of Man","im","44"],["Israel (‫ישראל‬‎)","il","972"],["Italy (Italia)","it","39"],["Jamaica","jm","1876"],["Japan (日本)","jp","81"],["Jersey","je","44"],["Jordan (‫الأردن‬‎)","jo","962"],["Kazakhstan (Казахстан)","kz","7"],["Kenya","ke","254"],["Kiribati","ki","686"],["Kuwait (‫الكويت‬‎)","kw","965"],["Kyrgyzstan (Кыргызстан)","kg","996"],["Laos (ລາວ)","la","856"],["Latvia (Latvija)","lv","371"],["Lebanon (‫لبنان‬‎)","lb","961"],["Lesotho","ls","266"],["Liberia","lr","231"],["Libya (‫ليبيا‬‎)","ly","218"],["Liechtenstein","li","423"],["Lithuania (Lietuva)","lt","370"],["Luxembourg","lu","352"],["Macau (澳門)","mo","853"],["Macedonia (FYROM) (Македонија)","mk","389"],["Madagascar (Madagasikara)","mg","261"],["Malawi","mw","265"],["Malaysia","my","60"],["Maldives","mv","960"],["Mali","ml","223"],["Malta","mt","356"],["Marshall Islands","mh","692"],["Martinique","mq","596"],["Mauritania (‫موريتانيا‬‎)","mr","222"],["Mauritius (Moris)","mu","230"],["Mexico (México)","mx","52"],["Mayotte","yt","262"],["Micronesia","fm","691"],["Moldova (Republica Moldova)","md","373"],["Monaco","mc","377"],["Mongolia (Монгол)","mn","976"],["Montenegro (Crna Gora)","me","382"],["Montserrat","ms","1664"],["Morocco (‫المغرب‬‎)","ma","212"],["Mozambique (Moçambique)","mz","258"],["Myanmar (Burma) (မြန်မာ)","mm","95"],["Namibia (Namibië)","na","264"],["Nauru","nr","674"],["Nepal (नेपाल)","np","977"],["Netherlands (Nederland)","nl","31"],["New Caledonia (Nouvelle-Calédonie)","nc","687"],["New Zealand","nz","64"],["Nicaragua","ni","505"],["Niger (Nijar)","ne","227"],["Nigeria","ng","234"],["Niue","nu","683"],["Norfolk Island","nf","672"],["North Korea (조선 민주주의 인민 공화국)","kp","850"],["Northern Mariana Islands","mp","1670"],["Norway (Norge)","no","47"],["Oman (‫عُمان‬‎)","om","968"],["Pakistan (‫پاکستان‬‎)","pk","92"],["Palau","pw","680"],["Palestine (‫فلسطين‬‎)","ps","970"],["Panama (Panamá)","pa","507"],["Papua New Guinea","pg","675"],["Paraguay","py","595"],["Peru (Perú)","pe","51"],["Philippines","ph","63"],["Poland (Polska)","pl","48"],["Portugal","pt","351"],["Puerto Rico","pr","1787"],["Qatar (‫قطر‬‎)","qa","974"],["Réunion (La Réunion)","re","262"],["Romania (România)","ro","40"],["Russia (Россия)","ru","7"],["Rwanda","rw","250"],["Saint Barthélemy (Saint-Barthélemy)","bl","590"],["Saint Helena","sh","290"],["Saint Kitts and Nevis","kn","1869"],["Saint Lucia","lc","1758"],["Saint Martin (Saint-Martin (partie française))","mf","590"],["Saint Pierre and Miquelon (Saint-Pierre-et-Miquelon)","pm","508"],["Saint Vincent and the Grenadines","vc","1784"],["Samoa","ws","685"],["San Marino","sm","378"],["São Tomé and Príncipe (São Tomé e Príncipe)","st","239"],["Saudi Arabia (‫المملكة العربية السعودية‬‎)","sa","966"],["Senegal (Sénégal)","sn","221"],["Serbia (Србија)","rs","381"],["Seychelles","sc","248"],["Sierra Leone","sl","232"],["Singapore","sg","65"],["Sint Maarten","sx","1721"],["Slovakia (Slovensko)","sk","421"],["Slovenia (Slovenija)","si","386"],["Solomon Islands","sb","677"],["Somalia (Soomaaliya)","so","252"],["South Africa","za","27"],["South Korea (대한민국)","kr","82"],["South Sudan (‫جنوب السودان‬‎)","ss","211"],["Spain (España)","es","34"],["Sri Lanka (ශ්‍රී ලංකාව)","lk","94"],["Sudan (‫السودان‬‎)","sd","249"],["Suriname","sr","597"],["Svalbard and Jan Mayen","sj","47"],["Swaziland","sz","268"],["Sweden (Sverige)","se","46"],["Switzerland (Schweiz)","ch","41"],["Syria (‫سوريا‬‎)","sy","963"],["Taiwan (台灣)","tw","886"],["Tajikistan","tj","992"],["Tanzania","tz","255"],["Thailand (ไทย)","th","66"],["Timor-Leste","tl","670"],["Togo","tg","228"],["Tokelau","tk","690"],["Tonga","to","676"],["Trinidad and Tobago","tt","1868"],["Tunisia (‫تونس‬‎)","tn","216"],["Turkey (Türkiye)","tr","90"],["Turkmenistan","tm","993"],["Turks and Caicos Islands","tc","1649"],["Tuvalu","tv","688"],["U.S. Virgin Islands","vi","1340"],["Uganda","ug","256"],["Ukraine (Україна)","ua","38"],["United Arab Emirates (‫الإمارات العربية المتحدة‬‎)","ae","971"],["United Kingdom","gb","44"],["United States","us","1"],["Uruguay","uy","598"],["Uzbekistan (Oʻzbekiston)","uz","998"],["Vanuatu","vu","678"],["Vatican City (Città del Vaticano)","va","39"],["Venezuela","ve","58"],["Vietnam (Việt Nam)","vn","84"],["Wallis and Futuna","wf","681"],["Yemen (‫اليمن‬‎)","ye","967"],["Zambia","zm","260"],["Zimbabwe","zw","263"]],d={},c=0;c<h.length;c++){var p=h[c];h[c]={name:p[0],iso2:p[1],dialCode:p[2]},p[3]&&(h[c].format=p[3]),p[2]in d||(d[p[2]]=[]);var g=p[4]||0;d[p[2]][g]=p[1]}});
var $loyalty={_loadTurnoverContentInProcess:!1,init:function(){function t(){""!=$("#editLoyaltyCardForm #loyaltyLastName").val()&&""!=$("#editLoyaltyCardForm #loyaltyFirstName").val()&&""!=$("#editLoyaltyCardForm #loyaltyMiddleName").val()&&""!=$("#editLoyaltyCardForm #loyaltyPhoneNumber").val()?$("#loyaltyPersonEditSaveButton").prop("disabled",!1):$("#loyaltyPersonEditSaveButton").prop("disabled","disabled")}var e=$("#turnoverMonth"),a=$("#turnoverDay"),o=$("#addCardMonth"),n=$("body"),r=new Date,i=r.getFullYear()-10,s=r.getFullYear(),l=r.getMonth()+1;e.datetimepicker({autoclose:!0,startDate:l+"."+i,endDate:l+"."+s,startView:"year",minView:3,maxView:3,language:"uk",weekStart:1}),o.datetimepicker({autoclose:!0,startDate:l+"."+s,startView:"year",minView:3,maxView:3,language:"uk",weekStart:1}),a.datetimepicker({autoclose:!0,startDate:new Date(s,l-1,1),endDate:new Date(s,l,0),startView:"month",minView:2,maxView:2,todayHighlight:!0,language:"uk",weekStart:1,clearBtn:!0}),e.on("changeDate",function(t){var e=new Date(t.date.getFullYear(),t.date.getMonth(),new Date(t.date.getFullYear(),t.date.getMonth()+1,0).getDate());a.datetimepicker("setStartDate",t.date),a.datetimepicker("setEndDate",e),$("#turnoverDay").find("input").val(""),a.datetimepicker("update"),$loyalty.loadTurnoverContent(t.date,!0)}),a.on("changeDate",function(t){if(void 0!=t.date){var e=new Date(t.date.getFullYear(),t.date.getMonth(),new Date(t.date.getFullYear(),t.date.getMonth()+1,0).getDate());a.datetimepicker("setStartDate",new Date(t.date.getFullYear(),t.date.getMonth(),1)),a.datetimepicker("setEndDate",e)}$loyalty.loadTurnoverContent(t.date)}),a.on("show",function(t){c(t.date.getDate()),$(".datetimepicker-days").find(".day").not(".disabled").each(function(){$(this).html()==t.date.getDate()?$(this).addClass("active"):$(this).removeClass("active")})}),$(".generateReportXLS").add(".generateReportCSV").on("click",function(t){var e=$("#loyaltyUserForm"),a=e.attr("action"),o=$("#turnoverMonth");if(""==$("#turnoverDay_field").val())var n=0;else var n=$("#turnoverDay").data("datetimepicker").date.getDate();var r=o.data("datetimepicker").date.getMonth(),i=o.data("datetimepicker").date.getFullYear();""!==r&&""!=i?e.attr("target","_blank").attr("action",Yii.app.createUrl("loyaltyUser/generateReport",{Type:$(this).data("type"),Year:i,Month:r+1,Day:n})).submit().attr("target","").attr("action",a):noty(Yii.t("orders/js","Сначала выберите период за который формировать отчёт"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),n.on("click",".columnSettings",function(){$("#columnSettingsModal").modal("show")}),n.on("click","#columnViewSave",function(){$("#columnSettingsModal").modal("hide"),$("html").modalmanager("loading"),$("#columnSettingsForm").submit()}),$(".filter_journal_statuses_content").find(".element_check").change(function(t){t.stopPropagation(),$(this).prop("checked")?$(this).closest(".browser_element_main").addClass("active"):$(this).closest(".browser_element_main").removeClass("active")}),n.on("click",".loyaltyCardEdit",function(){$("#loyaltyPersonEdit").modal("show"),$("#loyaltyPhoneNumber").intlTelInput({onlyCountries:["ua"]}),$("#editLoyaltyCardRef").val($(this).data("ref"))}),$("#loyaltyPersonEdit").on("keyup",function(){t()}),$("#loyaltyPersonEdit").on("change",function(){t()}),n.on("click","#loyaltyPersonEditSaveButton",function(){$("#loyaltyPersonEdit").modal("hide");var t=!1;$("#editLoyaltyCardForm").ajaxForm({initFields:function(){},beforeSubmit:function(e){$.each($noty,function(t,e){$(e.$note).hide()}),$noty=[],t||(t=!0,e.push({name:"DateTimeFrom",value:$("#DateTimeFrom").val()}),e.push({name:"DateTimeTo",value:$("#DateTimeTo").val()}))},success:function(){},complete:function(e){if(t=!1,null!=e){try{var a=JSON.parse(e.responseText);return noty(Yii.t("loyalty/js",a.error)),void 0}catch(o){}$(".standardCardsContainer").html(e.responseText),noty(Yii.t("loyalty/js","Данные карты успешно обновлены."),5e3,"success")}else noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},error:function(){t=!1}})}),n.on("click",".loyaltyCardBlock, .loyaltyCardUnBlock",function(){var t=$("body");$.ajax({url:$(this).data("url"),beforeSend:function(){t.modalmanager("loading")},complete:function(e){if(null!=e){try{var a=JSON.parse(e.responseText);return noty(Yii.t("loyalty/js",a.error)),void 0}catch(o){}$(".standardCardsContainer").html(e.responseText),noty(Yii.t("loyalty/js","Данные карты успешно обновлены."),5e3,"success")}else noty(Yii.t("counterparties/js","Произошла неизвестная ошибка. Попробуйте снова позже."));t.modalmanager("removeLoading")},error:function(){}})});var d=new Date("2017-09-13");$("#DateTimeFrom").datetimepicker({startDate:d,autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1}).change(function(t){$(t.currentTarget).closest("form").submit()}),$("#DateTimeTo").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1}).change(function(t){$(t.currentTarget).closest("form").submit()}),$("#loyaltyFirstName").typeahead({minLength:3,source:function(t,e){var a=$("body"),o=0,n=!0;clearTimeout(o),o=setTimeout(function(){if(n){n=!1;var o={FindByStringFromStart:t,Limit:10},r={modelName:"Common",calledMethod:"getCatalogFirstNames",methodProperties:o};$.ajax({data:JSON.stringify(r),beforeSend:function(){a.modalmanager("loading")},success:function(t){if(1==t.success){var o=[];$.each(t.data,function(t,e){o.push(e.Description)}),e(o)}else $.each(t.errors,function(t,e){noty(Yii.t("counterparties/js",e),3e3,"error","center")});n=!0,a.modalmanager("removeLoading")},error:function(){a.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Не найдено совпадений"))}})}},500)},matcher:function(t){return-1!=t.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(t){return $("#loyaltyFirstNameChosen").val("1"),t}}).on("change",function(){""==$("#loyaltyFirstNameChosen").val()&&$("#loyaltyFirstName").val(""),$("#loyaltyFirstNameChosen").val("")}),$("#loyaltyMiddleName").typeahead({minLength:3,source:function(t,e){var a=$("body"),o=0,n=!0;clearTimeout(o),o=setTimeout(function(){if(n){n=!1;var o={FindByStringFromStart:t,Limit:10},r={modelName:"Common",calledMethod:"getCatalogMiddleNames",methodProperties:o};$.ajax({data:JSON.stringify(r),beforeSend:function(){a.modalmanager("loading")},success:function(t){if(1==t.success){var o=[];$.each(t.data,function(t,e){o.push(e.Description)}),e(o)}else $.each(t.errors,function(t,e){noty(Yii.t("counterparties/js",e),3e3,"error","center")});n=!0,a.modalmanager("removeLoading")},error:function(){a.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Не найдено совпадений"))}})}},500)},matcher:function(t){return-1!=t.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(t){return $("#loyaltyMiddleNameChosen").val("1"),t}}).on("change",function(){""==$("#loyaltyMiddleNameChosen").val()&&$("#loyaltyMiddleName").val(""),$("#loyaltyMiddleNameChosen").val("")}),n.on("click",".loyaltyCardReport",function(t){var e=$(this),a=e.closest("tr.standardCardsContainerRow"),o=e.closest("tr.standardCardsContainerRow").next(".standardCardsContainerRowContent"),n=e.children(".icon-sort-down");if(n.toggle(),!a.hasClass("loaded")){var r=[];r.push({name:"DateTimeFrom",value:$("#DateTimeFrom").val()}),r.push({name:"DateTimeTo",value:$("#DateTimeTo").val()}),$.ajax({url:$(this).data("url"),data:r,dataType:"html",success:function(t){a.addClass("loaded"),a.after(t),u(),y()}})}n.is(":visible")?o.hide():o.show(),t.preventDefault(),t.stopPropagation()}),n.on("click",".paginatorBlock a",function(){var t=$(this);if(t.hasClass("disabled"))return!1;var e=parseInt(t.closest(".paginatorBlock").attr("data-current-page")),a=0,o=t.attr("data-next-page");"-"==o&&0!=e?a=e-1:"+"==o&&(a=e+1);var n=t.closest(".standardCardsContainerRowContent"),r=t.closest("form");r.children(".pageCurrent").val(a),$.ajax({url:r.attr("action"),type:"post",data:r.serialize(),dataType:"html",beforeSend:function(){$.each($noty,function(t,e){$(e.$note).hide()}),$noty=[]},success:function(t){n.after(t),n.remove(),u(),y()},complete:function(){}})});var u=function(){$(".standardCardsContainerRowContentForm .DateTimeFrom").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1})},y=function(){$(".standardCardsContainerRowContentForm .DateTimeTo").datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy",minView:2,maxView:2,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1})};n.on("change",".standardCardsContainerRowContentForm .DateTimeFrom, .standardCardsContainerRowContentForm .DateTimeTo",function(){var t=$(this),e=t.closest(".standardCardsContainerRowContent"),a=t.closest("form");$.ajax({url:a.attr("action"),type:"post",data:a.serialize(),dataType:"html",beforeSend:function(){$.each($noty,function(t,e){$(e.$note).hide()}),$noty=[]},success:function(t){e.after(t),e.remove(),u(),y()},complete:function(){}})}),n.on("click",".block-attorney",function(){var t=$("body"),e=!1;$.ajax({url:$(this).data("url"),beforeSend:function(){e||(e=!0,t.modalmanager("loading"))},success:function(e){e.success===!0?($noty.push(noty(Yii.t("loyaltyUser/js","Данные успешно изменены"),5e3,"success")),setTimeout(function(){location.href=location.href},1e3)):e.success===!1?$.each(e.errors,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),void 0!=e.warnings&&$.each(e.warnings,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e),5e3,"warning"))}),t.modalmanager("removeLoading")},complete:function(){e=!1},error:function(){}})}),$loyalty.editContactPerson(n)},loadTurnoverContent:function(t,e){var a=void 0!=t?void 0!=e?0:t.getDate():0;t=t||new Date;var o=$("#turnoverData"),n={Year:t.getFullYear(),Month:t.getMonth()+1,Day:a};0==$loyalty._loadTurnoverContentInProcess&&($loyalty._loadTurnoverContentInProcess=!0,$.ajax({url:Yii.app.createUrl("loyaltyUser/turnoverContent"),type:"post",data:n,dataType:"html",beforeSend:function(){o.find("tbody").html(""),$.each($noty,function(t,e){$(e.$note).hide()}),$noty=[];var t=$main.showProgressRow("","#turnoverData");o.find("tbody").html(t)},success:function(t){o.find("tbody").html(t)},complete:function(){$loyalty._loadTurnoverContentInProcess=!1}}))},editContactPerson:function(t){var e=$("body");$(".phoneFlags").intlTelInput({onlyCountries:window.codeTelephoneCountries}),t.on("click","#counterpartyContactCheckButton",function(){var t=!1,a={LastName:$("#contactModal #loyaltyLastName").val(),FirstName:$("#contactModal #loyaltyFirstName").val(),MiddleName:$("#contactModal #loyaltyMiddleName").val()},o={modelName:"LoyaltyUser",calledMethod:"updateLoyaltyUser",methodProperties:a},t=!1;$.ajax({data:JSON.stringify(o),beforeSend:function(){t||(t=!0,e.modalmanager("loading"))},success:function(t){t.success===!0?($noty.push(noty(Yii.t("loyaltyUser/js","Данные успешно изменены"),5e3,"success")),setTimeout(function(){location.href=location.href},1e3)):t.success===!1?$.each(t.errors,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),void 0!=t.warnings&&$.each(t.warnings,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e),5e3,"warning"))}),e.modalmanager("removeLoading")},complete:function(){t=!1}})}),t.on("click","#counterpartyPhoneCheckButton",function(){var t=!1,a={Phone:$("#phoneModal #contactPhone").val()},o={modelName:"LoyaltyUser",calledMethod:"updateLoyaltyUser",methodProperties:a},t=!1;$.ajax({data:JSON.stringify(o),beforeSend:function(){t||(t=!0,e.modalmanager("loading"))},success:function(t){t.success===!0?($noty.push(noty(Yii.t("loyaltyUser/js","Отправлено смс для подтверждения изменений"),5e3,"success")),$("#smsModal").modal()):t.success===!1?$.each(t.errors,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),void 0!=t.warnings&&$.each(t.warnings,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e),5e3,"warning"))}),e.modalmanager("removeLoading")},complete:function(){t=!1}})}),t.on("click","#counterpartySmsCheckButton",function(){var t=!1,a={VerificationCode:$("#VerificationCode").val()},o={modelName:"LoyaltyUser",calledMethod:"checkVerificationCodeForUpdateLoyaltyUser",methodProperties:a},t=!1;$.ajax({data:JSON.stringify(o),beforeSend:function(){t||(t=!0,e.modalmanager("loading"))},success:function(t){t.success===!0?($noty.push(noty(Yii.t("loyaltyUser/js","Телефон успешно изменен"),5e3,"success")),$("#smsModal").modal("hide"),setTimeout(function(){location.href=location.href},1e3)):t.success===!1?$.each(t.errors,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже.")),void 0!=t.warnings&&$.each(t.warnings,function(t,e){$noty.push(noty(Yii.t("loyaltyUser/js",e),5e3,"warning"))}),e.modalmanager("removeLoading")},complete:function(){t=!1}})})}};
var $massiveUpload_integros={_processedCounterpartyType:"",_processSelectCounterpartyText:"",_counterpartyOptions:{},_selectedCounterpartiesCount:0,init:function(){$("#selectCounterpartyButton").on("click",function(){$massiveUpload_integros.fillSelectedCounterparty()}),$(".addSenderCounterparty").on("click",function(){$massiveUpload_integros.senderSelectButton()}),$(".addRecipientCounterparty").on("click",function(){$massiveUpload_integros.recipientSelectButton()}),$(".counterpartyDataContainer .counterpartyDelete").live("click",function(e){$(e.target).closest(".counterpartyNode").remove()}),$("input.mask-integer_12").mask("099999999999"),$("input.mask-integer_4").mask("0999"),$("input.mask-float_7_2").mask("0999999C09"),$massiveUpload_integros.initAjaxForm(),$massiveUpload_integros.initTimePickers(),$massiveUpload_integros.initDeleteButtons(),$massiveUpload_integros.initFormSubmitButton()},initTimePickers:function(){$(".initDT").datetimepicker({autoclose:!0,minView:3,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1,format:"dd.mm.yyyy"});var e=["dateCreated","dateSended","dateDelivered","dateReceipt"];$.each(e,function(e,t){$("#"+t+"From").datetimepicker().on("changeDate",function(){var e=$("#"+t+"From"),r=e.val().split(/\./),a=new Date(r[2],r[1]-1,r[0]),i=$("#"+t+"To");if(a instanceof Date&&!isNaN(a.getTime())){if(""!=i.val()){var s=i.val().split(/\./),o=new Date(s[2],s[1]-1,s[0]);parseInt(o.getTime())-parseInt(a.getTime())<0&&i.datetimepicker("setDate",a)}i.datetimepicker("setStartDate",a),i.datetimepicker("update")}})});var e=["Weight","Cost","SeatsAmount","CostOnSite"];$.each(e,function(e,t){$("#"+t+"From").on("blur",function(){var e=$("#"+t+"From"),r=$("#"+t+"To");""==r.val()||isNaN(r.val())||parseInt(r.val())-parseInt(e.val())<0&&r.val(e.val())})})},initFormSubmitButton:function(){var e=!1,t=!1;$("#formSubmit").on("click",function(r){console.log("formSubmit clicked"),console.log(e),console.log(t),console.log($massiveUpload_integros._selectedCounterpartiesCount),r.preventDefault(),e===!0&&t===!0&&$massiveUpload_integros._selectedCounterpartiesCount>0?$("#IntegrosForm").submit():noty("Некоторые поля остались не заполненными. Должны быть указаны оба файла и выбран контрагент-отправитель.")}),$("#file1").on("change",function(){e=!0}),$("#file2").on("change",function(){t=!0})},initDeleteButtons:function(){$(".removeReport").on("click",function(){if(confirm(Yii.t("reports","Вы подтверждаете удаление?"))){var e=$(this).data("ref");return window.location.pathname=Yii.app.createUrl("reports/removeReport",{Ref:e}),!0}return!1})},senderSelectButton:function(){if("Sender"!=$massiveUpload_integros._processedCounterpartyType){$massiveUpload_integros._processedCounterpartyType="Sender",$counterparties.counterpartyProperty="Sender";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),a=$("#SenderContactRef").val();$counterparties.clear_lists(t,r,a,e)}},recipientSelectButton:function(){if("Recipient"!=$massiveUpload_integros._processedCounterpartyType){$massiveUpload_integros._processedCounterpartyType="Recipient",$counterparties.counterpartyProperty="Recipient";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),a=$("#SenderContactRef").val();$counterparties.clear_lists(t,r,a,e)}},addCounterparty:function(e,t,r,a){var i="",s=document.createElement("div");if(void 0!==e){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_integros._processedCounterpartyType+"Counterparties[CityRef]",o.value=e.ref,s.appendChild(o),i+=e.description}if(void 0!==t){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_integros._processedCounterpartyType+"Counterparties[CounterpartyRef]",o.value=t.ref,s.appendChild(o),i+=", "+t.description}if(void 0!==r){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_integros._processedCounterpartyType+"Counterparties[AddressRef]",o.value=r.ref,s.appendChild(o);var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_integros._processedCounterpartyType+"Counterparties[IsWarehouse]",o.value="true"==r.warehouse?1:0,s.appendChild(o),i+=", "+r.description}if(void 0!==a){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_integros._processedCounterpartyType+"Counterparties[ContactRef]",o.value=a.ref,s.appendChild(o),i+=", "+a.description}if(""!==i){var n=document.createElement("div");n.className="counterpartyTitle",n.innerHTML=i,s.appendChild(n)}""!==i&&(document.getElementById($massiveUpload_integros._processedCounterpartyType+"CounterpartiesData").appendChild(s),$massiveUpload_integros._selectedCounterpartiesCount++),$(".addSenderCounterparty").hide()},fillSelectedCounterparty:function(){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),r=$counterparties.get_filled_element("address_ul"),a=$counterparties.get_filled_element("contacts_ul");$massiveUpload_integros.addCounterparty(e,t,r,a),$("#selectCounterpartyModal").modal("hide")},initAjaxForm:function(){var e=!1;$("#CreateNewReport").ajaxForm({beforeSubmit:function(){e||(e=!0)},success:function(e){$(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0?$("#documentCreatedReport").modal().show():null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){""!=t&&noty(Yii.t("reports/js",t))}):noty(Yii.t("reports/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1},error:function(){e=!1}})}},$massiveUpload_privatbank={_formBranchesAddresses:$("#formBranchesAddresses"),init:function(){$massiveUpload_privatbank._formBranchesAddresses.hide(),$("#filter_journal_cities").fastLiveFilter("#cities_ul",{type:"cities"}),$("#selectedCityRef").val(""),$("#selectedBranchAddressRef").val(""),$("#branchAddressTitle").html(""),$("#addressNote").html(""),$massiveUpload_privatbank.unsetAddressData("Building"),$massiveUpload_privatbank.unsetAddressData("Street"),$(".selectAddress").on("click",function(){$("#selectedBranchAddressRef").val($(this).attr("data-ref")),$("#branchAddressTitle").html($(this).attr("data-original-title")),$("#addressNote").html($(this).attr("data-original-note")),$massiveUpload_privatbank._formBranchesAddresses.modal("show")}),$("#icon-remove-building").on("click",function(){$massiveUpload_privatbank.unsetAddressData("Building")}),$("#icon-remove-street").on("click",function(){$massiveUpload_privatbank.unsetAddressData("Building"),$massiveUpload_privatbank.unsetAddressData("Street")}),$("div.button-input.clear").click(function(){var e=$(this).siblings("input");e.val("").trigger("keydown").focus()});var e;$("#cities_ul").on("click","li.browser_element_main",function(){var t=$(this);if(!t.hasClass("active")){$massiveUpload_privatbank.unsetAddressData("Building"),$massiveUpload_privatbank.unsetAddressData("Street"),clearTimeout(e);var r=t.attr("data-ref");$("#selectedCityRef").val(r),t.parent().find("li.active").removeClass("active"),t.addClass("active")}}),$("#filter_journal_Street").typeahead({minLength:2,source:function(e,t){$addressesPB.streetFind(e,t)},matcher:function(e){return-1!=e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $addressesPB.streetSelect(e)}}).on("blur",function(){void 0==$addressesPB.mapStreets[$(this).val()]&&($(this).val(""),$massiveUpload_privatbank.unsetAddressData("Street"))}),$("#filter_journal_Building").typeahead({source:function(e,t){$addressesPB.buildingFind(e,t)},matcher:function(e){return 0==e.toLowerCase().indexOf(this.query.trim().toLowerCase())},updater:function(e){return $addressesPB.buildingSelect(e)}}).on("blur",function(){void 0==$addressesPB.mapBuildings[$(this).val()]||$massiveUpload_privatbank.setAddressData("Building",$addressesPB.mapBuildings[$(this).val()].Ref,$addressesPB.mapBuildings[$(this).val()].Description)}).on("keypress",function(){$.trim(""!=$("#filter_journal_Building").val())?$("#selectBranchAddressSubmit").removeClass("disabled").prop("readonly",!1):$("#selectBranchAddressSubmit").addClass("disabled").prop("readonly",!0)})},setAddressData:function(e,t,r){$("#selected"+e+"Ref").val(t),$("#selected"+e).show(),$("#selected"+e+" a").html(r),"Building"==e?$("#selectBranchAddressSubmit").removeClass("disabled").prop("readonly",!1):($("#filter_journal_Building").val("").removeClass("disabled").prop("readonly",!1),$("#icon-remove-building").show())},unsetAddressData:function(e){$("#selected"+e+"Ref").val(""),$("#selected"+e).hide(),$("#selected"+e+" a").html(""),$("#selectBranchAddressSubmit").addClass("disabled").prop("readonly",!0),"Building"==e?($("#filter_journal_Building").val("").removeClass("disabled").prop("readonly",!1),$("#icon-remove-building").show()):($("#filter_journal_Building").val("").addClass("disabled").prop("readonly",!0),$("#filter_journal_Street").val(""),$("#icon-remove-building").hide())}},$addressesPB={buildingsData:[],mapStreets:{},mapBuildings:{},finishedStreets:!0,timeoutStreets:0,streetFind:function(e,t){var r=$("body");clearTimeout($addressesPB.timeoutStreets),$addressesPB.timeoutStreets=setTimeout(function(){if($addressesPB.finishedStreets){$addressesPB.finishedStreets=!1;var a=$("#cities_ul").find("li.active").data("ref"),i={FindByString:e,Page:1,CityRef:a},s={modelName:"Address",calledMethod:"getStreet",methodProperties:i};$.ajax({data:JSON.stringify(s),beforeSend:function(){r.modalmanager("loading")},success:function(e){if(1==e.success){var a=[];$.each(e.data,function(e,t){$addressesPB.mapStreets[t.Description+" "+t.StreetsType]=t,a.push(t.Description+" "+t.StreetsType)}),t(a)}else $.each(e.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")});$addressesPB.finishedStreets=!0,r.modalmanager("removeLoading")},error:function(){r.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка улиц"))}})}},500)},streetSelect:function(e){var t=$("body"),r={StreetRef:$addressesPB.mapStreets[e].Ref},a={modelName:"Address",calledMethod:"getBuildings",methodProperties:r};return $.ajax({data:JSON.stringify(a),beforeSend:function(){t.modalmanager("loading")},success:function(e){1==e.success?$addressesPB.buildingsData=e.data:$.each(e.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")}),t.modalmanager("removeLoading")},error:function(){t.modalmanager("removeLoading"),noty(Yii.t("counterparties/js","Ошибка при получении списка строений"))}}),description=$addressesPB.mapStreets[e].Description+" "+$addressesPB.mapStreets[e].StreetsType,$massiveUpload_privatbank.setAddressData("Street",$addressesPB.mapStreets[e].Ref,description),e},buildingFind:function(e,t){var r=[];$.each($addressesPB.buildingsData,function(e,t){$addressesPB.mapBuildings[t.Description]=t,r.push(t.Description)}),t(r)},buildingSelect:function(e){return $massiveUpload_privatbank.setAddressData("Building",$addressesPB.mapBuildings[e].Ref,$addressesPB.mapBuildings[e].Description),e}},$massiveUpload_stat={init:function(){$("input.mask-Postcode").mask("99999"),$(".GetTaskXLSFile").on("click",function(){var e={type:"xls",taskId:$(this).attr("data-ref"),action:"generateMassiveReport"},t=Yii.app.createUrl("massiveUpload/stat"),r=document.createElement("form");r.setAttribute("method","post"),r.setAttribute("action",t),r._submit_function_=r.submit;for(var a in e){var i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",a),i.setAttribute("value",e[a]),r.appendChild(i)}document.body.appendChild(r),r._submit_function_()}),$(".openEditorOrder").on("click",function(){var e=$(this);e.find("i").toggleClass("icon-edit").toggleClass("icon-pencil").end().closest("tr").next("tr").toggle().end()}),$(".refreshOrder").on("click",function(){var e={action:"getOrderInfo",orderID:$(this).attr("data-ref")},t=Yii.app.createUrl("massiveUpload/stat");t?$.ajax({type:"POST",url:t,data:e,async:!1,success:function(e){""==e.error?($("#row_"+e.OrderId+" .tdClientBarcode").html(e.ClientBarcode),$("#row_"+e.OrderId+" .tdBarcode").html(e.Barcode),$("#row_"+e.OrderId+" .tdError").html(e.Error),$("#row_"+e.OrderId+" .tdErrorText").html(e.ErrorText),$("#row_"+e.OrderId+" .tdStatus").html(e.Status),$("#row_"+e.OrderId+" .tdRetryCount").html(e.RetryCount),$("#row_"+e.OrderId+" .tdLastModificationDate").html(e.LastModificationDate),"InProgress"!=e.Status?($("#row_"+e.OrderId+" .openEditorOrder").hide(),$("#row_"+e.OrderId+" .tr-class-1").find("i").toggleClass("icon-edit").toggleClass("icon-pencil").end().closest("tr").next("tr").toggle().end()):$("#row_"+e.OrderId+" .openEditorOrder").show(),void 0!==e.Recipient&&($("#doc_"+e.OrderId+" .Recipient").val(e.Recipient),$("#doc_"+e.OrderId+" .cellRecipient").show()),void 0!==e.PostCode&&void 0===e.ToWarehouse&&($("#doc_"+e.OrderId+" .PostCode").val(e.PostCode),$("#doc_"+e.OrderId+" .cellPostCode").show()),void 0!==e.PhoneNumber&&($("#doc_"+e.OrderId+" .PhoneNumber").val(e.PhoneNumber),$("#doc_"+e.OrderId+" .cellPhoneNumber").show()),void 0!==e.Address&&($("#doc_"+e.OrderId+" .Address").val(e.Address),$("#doc_"+e.OrderId+" .cellAddress").show()),void 0!==e.RecipientAddressName&&($("#doc_"+e.OrderId+" .RecipientAddressName").val(e.RecipientAddressName),$("#doc_"+e.OrderId+" .cellRecipientAddressName").show()),void 0!==e.House&&($("#doc_"+e.OrderId+" .House").val(e.House),$("#doc_"+e.OrderId+" .cellHouse").show()),void 0!==e.Description&&($("#doc_"+e.OrderId+" .Description").val(e.Description),$("#doc_"+e.OrderId+" .cellDescription").show()),void 0!==e.Warehouse&&($("#doc_"+e.OrderId+" .Warehouse").val(e.Warehouse),$("#doc_"+e.OrderId+" .cellWarehouse").show()),void 0!==e.TotalWeight&&($("#doc_"+e.OrderId+" .TotalWeight").val(e.TotalWeight),$("#doc_"+e.OrderId+" .cellTotalWeight").show()),void 0!==e.TotalVolume&&($("#doc_"+e.OrderId+" .TotalVolume").val(e.TotalVolume),$("#doc_"+e.OrderId+" .cellTotalVolume").show()),void 0!==e.ReadOnlyInfo&&($("#doc_"+e.OrderId+" .ReadOnlyInfo").html(e.ReadOnlyInfo),$("#doc_"+e.OrderId+" .cellReadOnlyInfo").show())):noty(Yii.t("massiveUpload/stat",e.error),3e3,"error")},dataType:"json"}):noty(Yii.t("massiveUpload/stat","Виникла помилка. Спробуйте пізніше."),3e3,"error")}),$(".editOrder").on("click",function(){var e={action:"editOrder",orderID:$(this).attr("data-ref")};$("#doc_"+$(this).attr("data-ref")+" .cellPostCode").is(":visible")&&(e.postcode=$("#doc_"+$(this).attr("data-ref")+" .PostCode").val()),$("#doc_"+$(this).attr("data-ref")+" .cellRecipient").is(":visible")&&(e.Recipient=$("#doc_"+$(this).attr("data-ref")+" .Recipient").val()),$("#doc_"+$(this).attr("data-ref")+" .cellPhoneNumber").is(":visible")&&(e.PhoneNumber=$("#doc_"+$(this).attr("data-ref")+" .PhoneNumber").val()),$("#doc_"+$(this).attr("data-ref")+" .cellAddress").is(":visible")&&(e.Address=$("#doc_"+$(this).attr("data-ref")+" .Address").val()),$("#doc_"+$(this).attr("data-ref")+" .cellRecipientAddressName").is(":visible")&&(e.RecipientAddressName=$("#doc_"+$(this).attr("data-ref")+" .RecipientAddressName").val()),$("#doc_"+$(this).attr("data-ref")+" .cellHouse").is(":visible")&&(e.House=$("#doc_"+$(this).attr("data-ref")+" .House").val()),$("#doc_"+$(this).attr("data-ref")+" .cellDescription").is(":visible")&&(e.Description=$("#doc_"+$(this).attr("data-ref")+" .Description").val()),$("#doc_"+$(this).attr("data-ref")+" .cellWarehouse").is(":visible")&&(e.Warehouse=$("#doc_"+$(this).attr("data-ref")+" .Warehouse").val()),$("#doc_"+$(this).attr("data-ref")+" .cellTotalWeight").is(":visible")&&(e.TotalWeight=$("#doc_"+$(this).attr("data-ref")+" .TotalWeight").val()),$("#doc_"+$(this).attr("data-ref")+" .cellTotalVolume").is(":visible")&&(e.TotalVolume=$("#doc_"+$(this).attr("data-ref")+" .TotalVolume").val()),$("#doc_"+$(this).attr("data-ref")+" .cellReadOnlyInfo").is(":visible")&&(e.ReadOnlyInfo=$("#doc_"+$(this).attr("data-ref")+" .ReadOnlyInfo").val());var t=Yii.app.createUrl("massiveUpload/stat");t?$.ajax({type:"POST",url:t,data:e,async:!1,success:function(t){"true"==t.success?(noty(Yii.t("massiveUpload/stat","Изменения внесены"),3e3,"success","center"),$("#"+e.orderID+" .refreshOrder").click()):noty(Yii.t("massiveUpload/stat",t.error),3e3,"error")},dataType:"json"}):noty(Yii.t("massiveUpload/stat","Виникла помилка. Спробуйте пізніше."),3e3,"error")})}},$massiveUpload_amway={_processedCounterpartyType:"",_processSelectCounterpartyText:"",_counterpartyOptions:{},_selectedCounterpartiesCount:0,init:function(){$("#selectCounterpartyButton").on("click",function(){$massiveUpload_amway.fillSelectedCounterparty()}),$(".addSenderCounterparty").on("click",function(){$massiveUpload_amway.senderSelectButton()}),$(".addRecipientCounterparty").on("click",function(){$massiveUpload_amway.recipientSelectButton()}),$(".counterpartyDataContainer .counterpartyDelete").live("click",function(e){$(e.target).closest(".counterpartyNode").remove()}),$("input.mask-integer_12").mask("099999999999"),$("input.mask-integer_4").mask("0999"),$("input.mask-float_7_2").mask("0999999C09"),$massiveUpload_amway.initAjaxForm(),$massiveUpload_amway.initTimePickers(),$massiveUpload_amway.initDeleteButtons(),$massiveUpload_amway.initFormSubmitButton()},initTimePickers:function(){$(".initDT").datetimepicker({autoclose:!0,minView:3,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1,format:"dd.mm.yyyy"});var e=["dateCreated","dateSended","dateDelivered","dateReceipt"];$.each(e,function(e,t){$("#"+t+"From").datetimepicker().on("changeDate",function(){var e=$("#"+t+"From"),r=e.val().split(/\./),a=new Date(r[2],r[1]-1,r[0]),i=$("#"+t+"To");if(a instanceof Date&&!isNaN(a.getTime())){if(""!=i.val()){var s=i.val().split(/\./),o=new Date(s[2],s[1]-1,s[0]);parseInt(o.getTime())-parseInt(a.getTime())<0&&i.datetimepicker("setDate",a)}i.datetimepicker("setStartDate",a),i.datetimepicker("update")}})});var e=["Weight","Cost","SeatsAmount","CostOnSite"];$.each(e,function(e,t){$("#"+t+"From").on("blur",function(){var e=$("#"+t+"From"),r=$("#"+t+"To");""==r.val()||isNaN(r.val())||parseInt(r.val())-parseInt(e.val())<0&&r.val(e.val())})})},initFormSubmitButton:function(){var e=!1;$("#formSubmit").on("click",function(t){console.log("formSubmit clicked"),console.log(e),console.log($massiveUpload_amway._selectedCounterpartiesCount),t.preventDefault(),e===!0&&$massiveUpload_amway._selectedCounterpartiesCount>0?$("#amwayForm").submit():noty("Некоторые поля остались не заполненными. Должны быть указаны оба файла и выбран контрагент-отправитель.")}),$("#file").on("change",function(){e=!0})},initDeleteButtons:function(){$(".removeReport").on("click",function(){if(confirm(Yii.t("reports","Вы подтверждаете удаление?"))){var e=$(this).data("ref");return window.location.pathname=Yii.app.createUrl("reports/removeReport",{Ref:e}),!0}return!1})},senderSelectButton:function(){if("Sender"!=$massiveUpload_amway._processedCounterpartyType){$massiveUpload_amway._processedCounterpartyType="Sender",$counterparties.counterpartyProperty="Sender";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),a=$("#SenderContactRef").val();$counterparties.clear_lists(t,r,a,e)}},recipientSelectButton:function(){if("Recipient"!=$massiveUpload_amway._processedCounterpartyType){$massiveUpload_amway._processedCounterpartyType="Recipient",$counterparties.counterpartyProperty="Recipient";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),a=$("#SenderContactRef").val();$counterparties.clear_lists(t,r,a,e)}},addCounterparty:function(e,t,r,a){var i="",s=document.createElement("div");if(void 0!==e){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_amway._processedCounterpartyType+"Counterparties[CityRef]",o.value=e.ref,s.appendChild(o),i+=e.description}if(void 0!==t){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_amway._processedCounterpartyType+"Counterparties[CounterpartyRef]",o.value=t.ref,s.appendChild(o),i+=", "+t.description}if(void 0!==r){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_amway._processedCounterpartyType+"Counterparties[AddressRef]",o.value=r.ref,s.appendChild(o);var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_amway._processedCounterpartyType+"Counterparties[IsWarehouse]",o.value=1==r.warehouse?1:0,s.appendChild(o),i+=", "+r.description}if(void 0!==a){var o=document.createElement("input");o.type="hidden",o.name=""+$massiveUpload_amway._processedCounterpartyType+"Counterparties[ContactRef]",o.value=a.ref,s.appendChild(o),i+=", "+a.description}if(""!==i){var n=document.createElement("div");n.className="counterpartyTitle",n.innerHTML=i,s.appendChild(n)}""!==i&&(document.getElementById($massiveUpload_amway._processedCounterpartyType+"CounterpartiesData").appendChild(s),$massiveUpload_amway._selectedCounterpartiesCount++),$(".addSenderCounterparty").hide()},fillSelectedCounterparty:function(){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),r=$counterparties.get_filled_element("address_ul"),a=$counterparties.get_filled_element("contacts_ul");$massiveUpload_amway.addCounterparty(e,t,r,a),$("#selectCounterpartyModal").modal("hide")},initAjaxForm:function(){var e=!1;$("#CreateNewReport").ajaxForm({beforeSubmit:function(){e||(e=!0)},success:function(e){$(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0?$("#documentCreatedReport").modal().show():null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){""!=t&&noty(Yii.t("reports/js",t))}):noty(Yii.t("reports/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1},error:function(){e=!1}})}};
function dump(e){var t="";if(e&&"object"==typeof e)for(var r in e)t+=r+": "+e[r]+"\n";else t=e;console.log(e)}$config_$neworder={pageForPay:"?r=loyaltyUser/paydocuments",weightIsCargoTypeDocument:window.appParameters.weightIsCargoTypeDocument};var $neworder={_recipientIsLatin:!1,_redeliveryTypes:"",_redeliveryTypesMore:"",_processedCounterpartyType:"",_processSelectCounterpartyText:"",_counterpartyOptions:{},_counterpartyTimeIntervals:{},_lookingForCargotypes:0,_aletrnativeRecipient:{},_PickUpServiceBrand:{},_canPayTheThirdPersonStatus:"",init:function(){function e(e){e.prop("checked")?$("#NumberOfFloorsLifting").prop("readonly",!0).attr("tabindex","-1"):$("#NumberOfFloorsLifting").prop("readonly",!1).removeAttr("tabindex")}tasLink="https://np.taslink.com.ua";var t=$("body");cargoTypeIsCargoOrParcel=!1,$("#blockWeightType").on("click",'button:not([class~="disabled"])',function(){var e=$(this);$(".blockWeightType").find("input").val("").end().hide(),$("#blockWeightType"+e.data("type")).show()}).on("click",'button[class~="disabled"]',function(){return!1}),$("#cost").on("change",function(){var e=$(this),t="";if("Money"==$("#redeliveryTypes").val()&&(t=$("#moneyTable").find("input.backwardDeliveryMoney").val()),"Money"==$("#redeliveryTypesMore").val()&&(t=$("#moneyMoreTable").find("input.backwardDeliveryMoney").val()),e.val()&&e.val(parseFloat(e.val().replace(",","."))),""!=t){var r=e.val();parseFloat(t.replace(",","."))>parseFloat(r.replace(",","."))&&e.val(t)}}),$("#PreferredDeliveryDate").on("change",function(){{var e=($(this),$("#TimeIntervalSelected")),t=$("#TimeInterval");$("#TimeIntervalSelectBoxItContainer")}if(e.val(t.val()),$("#dateTo").datetimepicker("getUTCDate")>new Date&&$("#SameDayDelivery").prop("checked")){noty(Yii.t("orders/js",'Послуга "Локал Ексрпес" вимкнена'),3e3,"warning","center"),$("#SameDayDelivery").prop("checked",!1);var r=new Date;r.setDate(r.getDate()+1),$("#dateTo").datetimepicker("setStartDate",r)}$neworder.getTimeIntervals($("#RecipientCityRef").val(),"")}),$("#TimeInterval").on("change",function(){$("#TimeIntervalSelected").val($(this).val())}),$("#TimeInterval").on("click",function(){$("#TimeIntervalSelected").val($(this).val())}),$("#DateTime").on("change",function(){$neworder.getCounterpartyOptions($("#RecipientCounterpartyRef").val(),"","Recipient"),$neworder.fillSelectedCounterparty(),$neworder.getCounterpartyOptions($("#SenderCounterpartyRef").val(),"","Sender"),$neworder.fillSelectedCounterparty(),$neworder.getCounterpartyOptions($("#ThirdPersonCounterpartyRef").val(),"","ThirdPerson"),$neworder.fillSelectedThirdPerson()});var r=$("#Elevator");r.on("click",function(){e($(this))}),r.prop("checked")&&$("#NumberOfFloorsLifting").prop("readonly",!0).attr("tabindex","-1"),$("#PickupService").on("change",function(){$neworder.PickUpServiceLogic($(this))}),$("#PickUpServiceBrand").on("change",function(){$neworder.SetThirdPersonPayerType()}),$("input.backwardDeliveryMoney").on("change",function(){var e="";"Money"==$("#redeliveryTypes").val()?e=$("#moneyTable").find("input.backwardDeliveryMoney").val():"Money"==$("#redeliveryTypesMore").val()&&(e=$("#moneyMoreTable").find("input.backwardDeliveryMoney").val());var t=$("#cost").val();(""==t||parseFloat(e.replace(",","."))>parseFloat(t.replace(",",".")))&&$("#cost").val(e),""==e||0==e?($(".showCardsRedelivery").css("color","#ccc"),$(".showCardsRedelivery").on("click",function(){return!1})):($(".showCardsRedelivery").css("color","#08c"),$(".showCardsRedelivery").on("click",function(){oneClick.init($paycard.getSid()),$("#accessPayCardModal #linkToCard").hide(),$("#payCardModalRedelivery").modal("show")}))}),$("#numRedelivery").on("click",function(){$("#payCardModalRedelivery").modal("hide")}),$("#dataCardRedelivery").on("click","#hideDataCard",function(){$(".showCardsRedelivery").removeClass("hide"),$("#dataCardRedelivery").html("")}),$neworder.dateFromAndTo.init(),$neworder.getPredefinedValues();var a=$("#dateFrom"),o=$("#dateTo");o.on("click",function(){$neworder.checkSundayDelivery()}),$(".cellVolumeWeight ").on("change",function(){$neworder.checkSundayDelivery()}),a.find("input").change(function(){$("#infoblockDateFrom").text($(this).val()),$neworder.checkSundayDelivery()}),$("#infoblockDateFrom").text(a.find("input").val()),o.find("input").change(function(){$("#infoblockDateTo").text($(this).val())}),$("#infoblockDateTo").text(o.find("input").val()),$("#SenderSelectButton").unbind("click").click(function(){$neworder.senderSelectButton()}),$("#RecipientSelectButton").unbind("click").click(function(){$neworder.recipientSelectButton()}),$("#SetMoneyTransferAddress").click(function(){$neworder.MoneyTransfer.editMoneyTransferButton(),$warehouses.init()}),$("#selectWarehousModalButton").on("click",function(){var e=$warehouses.get_filled_element("warehous_ul");$("#MoneyTransferAddressText").html(e.description),$("#MoneyTransferAddress").val(e.ref),$("#selectWarehousModal").modal("hide")});var n=$("#RecipientCityRef").val();if(""!=n){var i=$counterparties.get_filled_element("cities_ul",n),s=$("#cities_ul").find("li.active").data("delivery");if(null!=s){var d={delivery1:s[0],delivery2:s[1],delivery3:s[2],delivery4:s[3],delivery5:s[4],delivery6:s[5],delivery7:s[6]};$neworder.dateDelivery(d)}$neworder.getCounterpartyOptions($("#RecipientCounterpartyRef").val(),"","Recipient"),$neworder.getTimeIntervals(i,"")}var l=$counterparties.get_filled_element("address_ul");null!=l&&($neworder.postomat.isPostomatInPost(l.typeofwarehouse)||$neworder.postomat.isPostomatNP(l.typeofwarehouse))&&$("#RecipientPayer").removeClass("active").prop("disabled",!0).addClass("disabled");var c=$("#SenderCounterpartyRef").val();""!=c&&$neworder.getCounterpartyOptions(c,"","Sender"),$("#ThirdPersonSelectButton").unbind("click").click(function(){$neworder.thirdPersonSelectButton()}),$("#counterparties_ul_counterparty").bind("DOMSubtreeModified",function(){"undefined"!=typeof appParameters.edrpouBlockThirdPersonPayers&&$.each(appParameters.edrpouBlockThirdPersonPayers,function(e,t){$("li[data-edrpou = '"+t+"']").addClass("disabled").prop("readonly",!0).prop("disabled",!0)})}),"undefined"!=typeof appParameters.edrpouBlockThirdPersonPayers&&$.each(appParameters.edrpouBlockThirdPersonPayers,function(e,t){$("#ThirdPersonCounterpartyEDRPO").val()==t&&($neworder.UnSetThirdPersonPayerType(),$("#PayerType").val("Sender"),$('button.paymentsForms[data-type="NonCash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$('button.paymentsForms[data-type="Cash"]').removeClass("disabled").prop("disabled",!1).addClass("active"))}),$("#selectCounterpartyButton").on("click",function(){$neworder.fillSelectedCounterparty(),$("#infoblockTypesOfPayers").text($('button.payerType[class*="active"]').text()),$neworder.checkSundayDelivery();var e=$counterparties.get_filled_element("address_ul");if("Recipient"==$neworder._processedCounterpartyType){if(($neworder.postomat.isPostomatInPost(e.typeofwarehouse)||$neworder.postomat.isPostomatNP(e.typeofwarehouse))&&($("#PostomatInfoModal").modal("show"),$(".postomatMaxWeight").html(predefinedValues.InternetDocumentPostomatSeatMaxWeight),$neworder.postomat.isPostomatNP(e.typeofwarehouse))){var t=predefinedValues.InternetDocumentPostomatNPSeatMaxHeight+"x"+predefinedValues.InternetDocumentPostomatNPSeatMaxWidth+"x"+predefinedValues.InternetDocumentPostomatNPSeatMaxLength;$(".postomatParameters").html(t),$(".postomatName").html("«Нова пошта»")}1==predefinedValues.DisableBackwardDeliveryForPostomatPrivatBank&&($neworder.postomat.isPostomatPB(e.typeofwarehouse)?$("#fieldsetBlockBackwardDelivery").hide():$("#fieldsetBlockBackwardDelivery").show());{$("#SenderAddressRef")}$neworder.postomat.isSomePostomat(e.typeofwarehouse)&&$neworder.getWarehouseParams(e.ref)}else{$("#RecipientAddressRef")}}),$("#selectCounterpartyOnlyButton").on("click",function(){$neworder.fillSelectedThirdPerson(),$("#infoblockTypesOfPayers").text($('button.payerType[class*="active"]').text())}),"ThirdPerson"==$("#PayerType").val()&&($('button.paymentsForms[data-type="NonCash"]').removeClass("disabled").prop("disabled",!1).addClass("active"),$('button.paymentsForms[data-type="Cash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$("#infoblockTypesOfPayers").text($('button.payerType[class*="active"]').text()));var p=-1,u=-1;$("#redeliveryTypes").change(function(){if($("#SenderCounterpartyRef").val()){var e=$(this),t=e.find("option:selected"),r=$("#redeliveryTypesMoreFiledset"),a=$("#redeliveryPayerFieldset"),o=$("#redeliveryTypesMore"),n=o.data("selectBox-selectBoxIt"),i=$(this).val(),s=$("#moneyTable"),d=$("#moneyTableRub"),l=$("#otherTable"),c=$("#documentsTable");if(n.enableOption(p),p=t.index(),0!=p?n.disableOption(p):n.selectOption(0),i?(r.slideDown("fast"),a.slideDown("fast")):(r.slideUp("fast"),a.slideUp("fast")),s.hide(),d.hide(),l.hide(),c.hide(),c.find("input").prop("readonly",!1),$neworder.MoneyTransfer.hideMoneyTransfer(),p>0){switch(i){case"Money":s.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||s.find(":input").val("").prop("readonly",!1),$("#RecipientAreaRef").val()==crimeaArea?(d.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||d.find(":input").val("")):d.find(":input").val(""),"false"==$("#SenderIsWarehouse").val()&&"true"==$("#RecipientIsWarehouse").val()&&$neworder.MoneyTransfer.showMoneyTransfer(),$("#moneyTable").find(".BackwardDeliveryMoneyType.active").click();break;case"SignedDocuments":l.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||l.find(":input").val(Yii.t("newOrder/js","Подписанные документы")).prop("readonly",!0);break;case"EWTransporter":l.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||l.find(":input").val(Yii.t("newOrder/js","ТТН перевозчика")).prop("readonly",!0);break;case"CreditDocuments":$neworder._counterpartyOptions.Sender.CanCreditDocuments&&$neworder.OnlineCredit._lastCounterparty&&$neworder.Redelivery.getFinancialInstitution($("#SenderCounterpartyRef").val()),l.find(":input").val(t.text()).prop("readonly",!0);break;default:"Documents"==i&&$neworder.Redelivery.checkRestriction(),l.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||l.find(":input").val("").prop("readonly",!1),void 0==$neworder._counterpartyOptions.Sender||$neworder._counterpartyOptions.Sender.ShowDeliveryByHand||($(".cellDeliveryByHand").hide(),$("#DeliveryByHand").prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1"))}$("#CustomBackwardDeliveryAddressRef option").length>1&&"CreditDocuments"!=i&&$("#CustomBackwardDeliveryAddressRef").closest("fieldset").show()}else $("#CustomBackwardDeliveryAddressRef").closest("fieldset").hide();$neworder._redeliveryTypes=e.val(),$neworder.checkRedeliveryPayerType(),$neworder.getCustomBackwardDeliveryAddresses($("#SenderCounterpartyRef").val(),"Redelivery","#CustomBackwardDeliveryAddressRef, #AdditionalCustomBackwardDeliveryAddressRef",$("#redeliveryTypes").val())}}),$("#redeliveryTypesMore").change(function(){var e=$(this),t=$("#redeliveryTypes"),r=t.data("selectBox-selectBoxIt"),a=$(this).val(),o=$("#moneyMoreTable"),n=$("#moneyMoreTableRub"),i=$("#otherMoreTable"),s=$("#documentsMoreTable");if(r.enableOption(u),u=e.find("option:selected").index(),0!=u&&r.disableOption(u),o.hide(),n.hide(),i.hide(),s.hide(),s.find("input").prop("readonly",!1),u>0){switch(a){case"Money":o.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||o.find(":input").val("").prop("readonly",!1),$("#RecipientAreaRef").val()==crimeaArea?(n.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||n.find(":input").val("")):n.find(":input").val("");break;case"SignedDocuments":i.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||i.find(":input").val(Yii.t("newOrder/js","Подписанные документы")).prop("readonly",!0);break;case"EWTransporter":i.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||i.find(":input").val(Yii.t("newOrder/js","ТТН перевозчика")).prop("readonly",!0);break;default:"Documents"==a&&$neworder.Redelivery.checkRestriction(),i.slideDown("fast").find(":input"),$neworder._lookingForCargotypes||(i.find(":input").val("").prop("readonly",!1),s.find("input:checkbox").removeAttr("checked")),$neworder.DeliveryByHand.needToShowDeliveryByHand()||$neworder.DeliveryByHand.hideDeliveryByHand()}$("#AdditionalCustomBackwardDeliveryAddressRef option").length>1&&$("#AdditionalCustomBackwardDeliveryAddressRef").closest("fieldset").show()}else $("#AdditionalCustomBackwardDeliveryAddressRef").closest("fieldset").hide();$neworder._redeliveryTypesMore=e.val(),$neworder.checkRedeliveryPayerType(),e.siblings().find("input:visible").first().focus()}),$("#CustomBackwardDeliveryAddressRef, #AdditionalCustomBackwardDeliveryAddressRef, #CustomReturnAddressRef ").on("change",function(){$("#"+$(this).attr("id")+"Selected").val($(this).val())}),"Pallet"==$("#cargoTypes").val()&&$("#ExpressPallet").removeAttr("disabled").removeAttr("title"),$("#cargoTypes").change(function(){{var e=$(this),t=e.val(),r=$("#palletsListTable"),a=$("#tiresWheelsListTable"),o=$("#cargoMoneyTable"),n=$("#blockWeightType"),i=n.find('button[data-type="Normal"]'),s=n.find('button[data-type="Volumetric"]'),d=$("#weight"),l=$("#seatsAmount"),c=$("#ExpressPallet"),p=$("#cost");$("#cargoMoney")}switch(r.hide(),a.hide(),o.hide(),d.addClass("disabled").prop("readonly",!0).attr("tabindex","-1").val(""),p.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),c.attr("disabled","disabled").prop("checked",!1).removeAttr("checked").attr("title",Yii.t("newOrder/index","Услуга доступна только для типа Паллеты")),t){case"TiresWheels":a.show(),i.trigger("click"),s.addClass("disabled");break;case"Pallet":d.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),l.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),c.removeAttr("disabled").removeAttr("title"),void 0!=predefinedValues.MetroSetExpressPallet&&$("#ExpressPallet").prop("checked","checked").val("1").attr("onclick","return false;");break;case"Documents":d.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),l.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex");break;default:d.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),l.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex")}e.siblings().find("input:visible").first().focus()}),$("#cargoMoney").keyup(function(){var e=$("#cost"),t=$("#Description");e.val($(this).val()),t.val(Yii.t("newOrder/js","Документы Ц1П")+" ("+$(this).val()+")")}),$("#SameDayDelivery").prop("checked")&&($("#dateTo").val(""),o.find("input").val(a.find("input").val()),o.find("input").prop("readonly",!0)),$("#SameDayDelivery").on("click",function(){if($("#SameDayDelivery").prop("checked"))$("#dateTo").val(""),o.find("input").val(a.find("input").val()),o.find("input").prop("readonly",!0),$("#infoblockDateTo").text(o.find("input").val()),$("#dateTo").datetimepicker("setStartDate",$("#dateFrom").datetimepicker("getDate")),$("#dateTo").datetimepicker("setDate",$("#dateFrom").datetimepicker("getDate"));else{var e=new Date;e.setDate(e.getDate()+1);var t=$("#dateTo");t.datetimepicker({startDate:e,autoclose:!0,minView:2,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1}),o.find("input").val(""),o.find("input").prop("readonly",!1),t.datetimepicker("setStartDate",e),$("#infoblockDateTo").text("")}$neworder.getTimeIntervals($("#RecipientCityRef").val(),"")}),$("input.cargoTypeWheelsCount").on("change keyup",function(){var e=$("#weight"),t=$("#seatsAmount"),r=0,a=0;$.each($("input.cargoTypeWheelsCount"),function(){var e=$(this),t=parseFloat(e.data("weight")),o=isNaN(parseInt(e.val()))?0:parseInt(e.val());r+=t*o,a+=o}),e.val(r.toFixed(2)),t.val(a)}),$("input.cargoTypePalletsCount").on("change keyup",function(){var e=$("#seatsAmount"),t=$("#weight"),r=0,a=0;$.each($("input.cargoTypePalletsCount"),function(){var e=$(this),t=parseFloat(e.data("weight")),o=isNaN(parseInt(e.val()))?0:parseInt(e.val());r+=t*o,a+=o}),t.val(r.toFixed(2)),e.val(a)}),$("#infoblockTypesOfPayers").text($('button.payerType[class*="active"]').text()),$("button.payerType").click(function(){var e=$(this),t=$("#selectThirdPersonBlock");$("#PayerType").val(e.data("type")),$("#infoblockTypesOfPayers").text(e.text()),"ThirdPerson"==e.data("type")?(t.slideDown("fast"),$('button.paymentsForms[data-type="NonCash"]').removeClass("disabled").prop("disabled",!1).addClass("active"),$('button.paymentsForms[data-type="Cash"]').removeClass("active").prop("disabled",!0).addClass("disabled")):"Sender"==e.data("type")&&predefinedValues.CheckPaymentForDebtor?$neworder.checkPaymentTypeForSender():(void 0!=$neworder._counterpartyOptions[e.data("type")]&&0==$neworder._counterpartyOptions[e.data("type")].CanNonCashPayment&&$('button.paymentsForms[data-type="NonCash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$('button.paymentsForms[data-type="Cash"]').removeClass("disabled").prop("disabled",!1),t.slideUp("fast")),$("#infoblockPaymentsForms").text($('button.paymentsForms[class*="active"]').text()),$neworder.checkCounterpartyEDRPOU()}),$("button.redeliveryPayerType").click(function(){var e=$(this);$("#redeliveryPayerType").val(e.data("type"))}),$("#infoblockPaymentsForms").text($('button.paymentsForms[class*="active"]').text()),$("#blockPaymentsForms").on("click",'button:not([class~="disabled"])',function(){var e=$(this);return $("#PaymentMethod").val(e.data("type")),$("#infoblockPaymentsForms").text(e.text()),$neworder.checkCounterpartyEDRPOU()}).on("click",'button[class~="disabled"]',function(){return!1}),$("#blockInternationalDeliveryTypeForm").on("click",'button:not([class~="disabled"])',function(){var e=$(this);return $("#InternationalDeliveryType").val(e.data("type")),!0}),$("#buttonsBackwardDeliveryMoneyType").on("click",'button:not([class~="disabled"])',function(){return"ToPaymentCard"==$(this).data("type")?($("#blockBackwardDeliveryMoneyType").show(),$("#blockBackwardDeliveryMoneyInformer").show(),$("#RecipientRedeliveryPayer").trigger("click"),$("#SenderRedeliveryPayer").addClass("disabled"),$("#SenderRedeliveryPayer").prop("disabled","disabled")):($("#hideDataCard").click(),$("#blockBackwardDeliveryMoneyType").hide(),$("#blockBackwardDeliveryMoneyInformer").hide(),$("#SenderRedeliveryPayer").removeClass("disabled"),$("#SenderRedeliveryPayer").prop("disabled",!1)),$("input.backwardDeliveryMoney").trigger("change"),!0});var y=!1;$("#formSaveOrder").ajaxForm({initFields:function(){$("#SaturdayDelivery").prop("disabled",!1),$neworder.OptionsSeat._setJSON(),$neworder.OptionsSeat._getAllInputs().prop("disabled",!0),$neworder.PartialReturn._setJSON(),$neworder.PartialReturn._getInputs().prop("disabled",!0)},beforeSubmit:function(){return"true"==$("#documentTemplateDescriptionModal #needDescription").val()?($("#documentTemplateDescriptionModal").modal(),!1):($("#documentTemplateDescriptionModal #needDescription").val(!0),$.each($noty,function(e,t){$(t.$note).hide()}),$noty=[],y||(y=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide()),void 0)},success:function(e){$(".control-group").removeClass("error");var r="";if($neworder._counterpartyOptions.Sender.LoyaltyProgram&&(r="<p>"+Yii.t("newOrder/js","Нет возможности распечатать ЕН?")+"</p><p>"+Yii.t("newOrder/js","1. Отправьте номер ЕН в смс на свой номер телефона.")+"</p><p>"+Yii.t("newOrder/js","2. Предоставьте этот номер и груз оператору при отправке.")+"</p><p>"+Yii.t("newOrder/js","3. Мы распечатаем ЕН и отправим Ваш груз.")+"</p>"),null!=e&&void 0!=e.success&&e.success===!0){if("InternetDocument"==e.data[0].TypeDocument){var a="";e.warnings.length&&(a+="<ul>",$.each(e.warnings,function(e,t){a+="<li>"+Yii.t("newOrder/js",t)+" </li>"}),a+="</ul>"),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Номер документа:")+" <b>"+e.data[0].IntDocNumber+"</b> "+Yii.t("newOrder/js","Стоимость доставки:")+" <b>"+e.data[0].CostOnSite+" грн.</b> "+Yii.t("newOrder/js","Ожидаемая дата доставки:")+" <b>"+e.data[0].EstimatedDeliveryDate+"</b><br> "+(void 0!=e.data[0].acceptTimeDelivery&&void 0!=e.data[0].acceptDateTimeDelivery?Yii.t("newOrder/js","Для доставки відправлення <b>"+e.data[0].EstimatedDeliveryDate+"</b> необхідно передати вантаж в Нову Пошту до <b>"+e.data[0].acceptTimeDelivery+"</b>, або викликати кур’єра до ")+" <b>"+e.data[0].acceptDateTimeDelivery+"</b>. ":"")+(void 0!=e.data[0].TimeIntervalStart?Yii.t("newOrder/js","с")+" <b>"+e.data[0].TimeIntervalStart+"</b> "+Yii.t("newOrder/js","по")+" <b>"+e.data[0].TimeIntervalEnd+"</b>":"")+"</p><p>"+Yii.t("newOrder/js","Вы можете создать еще один документ, перейти к списку документов либо перейти к сохраненному документу.")+"</p>"+r+a).end().modal();var o=$("#cloneDocumentLink");o.attr("href",Yii.app.createUrl("newOrder/index",{Ref:e.data[0].Ref,clone:"true"}));var n=$("#createdDocumentLink");n.attr("href",Yii.app.createUrl("newOrder/index",{Ref:e.data[0].Ref})),$paycard.newOrderCallback(e.data[0].IntDocNumber),$(".printButtonsGroup").find("a").each(function(){$(this).attr("href",Yii.app.createUrl("orders/"+$(this).data("url"),{"orders[]":e.data[0].Ref,type:$(this).data("type")}))}),$("#paymentButtonsGroup").find("a").each(function(){$(this).attr("data-ref",e.data[0].Ref)}),("EWTransporter"==$("#redeliveryTypes").val()||"EWTransporter"==$("#redeliveryTypesMore").val())&&alert(Yii.t("newOrder/js","Вам нужно распечатать 5 экземпляров ТТН")),t.on("click","#sendSMS",function(){$.ajax({type:"POST",cache:!1,url:"/orders/sendSmsForLoyaltyProgram",data:{documentRef:e.data[0].Ref},success:function(e){1==e?noty(Yii.t("orders/js","You sent SMS on your phone number"),3e3,"success","center"):noty(Yii.t("orders/js","Exceeded the limit of sent SMS"),3e3,"warning","center")}})})}else if("TemplateDocument"==e.data[0].TypeDocument){$("#documentTemplateCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Вы можете создать еще один документ, перейти к списку черновиков либо перейти к сохраненному черновику.")+"</p>"+r).end().modal();var o=$("#cloneDocumentTemplateLink");o.attr("href",Yii.app.createUrl("newOrder/index",{Ref:e.data[0].Ref,clone:"true",template:"true"}));var n=$("#createdDocumentTemplateLink");n.attr("href",Yii.app.createUrl("newOrder/index",{Ref:e.data[0].Ref,template:"true"}))}window.IsLoyalty===!0?ga("send","event","loyalty","createEN"):ga("send","event","corporate","createEN")}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("newOrder/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){y=!1,$neworder.OptionsSeat._getAllInputs().prop("disabled",!1),$neworder.PartialReturn._getInputs().prop("disabled",!1),$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),y=!1}}),$neworder.InternationalSender.init(),$neworder.OptionsSeat.init(t),$neworder.CargoTypes.init(),$neworder.VolumeWeight.init(),$neworder.VolumeGeneral.init(),$neworder.Weight.init(),$neworder.SeatsAmount.init(),$neworder.Description.init(),$neworder.DeliveryByHand.init(),$neworder.Redelivery.init(),$neworder.paymentTTN.init(t),$neworder.activeLegendFoldedUnfolded(),$neworder.AfterpaymentOnGoodsCost.init(),$neworder.Width.init(),$neworder.Length.init(),$neworder.Height.init(),$neworder.postomat.init(),$neworder.PartialReturn.init(t),$neworder.Redbox.init(t),$neworder.OnlineCredit.init(t),$("#btnTemplateDescription").click(function(){var e=$("#documentTemplateDescriptionModal #TemplateDescription").val();$('#formSaveOrder input[name="DescriptionTemplate"]').val(e),$("#documentTemplateDescriptionModal #needDescription").val(!1),$("#documentTemplateDescriptionModal").modal("hide"),$("#submitNewTemplateButton").click()}),$("#btnCancelTemplateDescription").click(function(){$("#documentTemplateDescriptionModal").modal("hide"),$("#documentTemplateDescriptionModal #TemplateDescription").val("")}),$("#submitNewOrderButton").click(function(){$("#documentTemplateDescriptionModal #needDescription").val(!1)}),$renderedCities=$("#cities_ul").children().clone(),$("#cities_ul_counterparty").append($renderedCities),window.IsLoyalty&&$(".cellRedBox").show()},InternationalSender:{init:function(){var e=$("input#InternationalSender");return e.length?(""!=e.val()&&$neworder.InternationalSender.toggleRequiredFileds(!0),e.change(function(){var e=""!=$(this).val();$neworder.InternationalSender.toggleRequiredFileds(e)}),void 0):!1},toggleRequiredFileds:function(e){$("#blockInternationalSender label").each(function(){"InternationalEmail"!=$(this).attr("for")&&(e?$('<span class="important-field">*</span>').appendTo($(this)):$(this).find("span").remove())})}},checkSundayDelivery:function(){var e=$("#SenderCityRef").val(),t=$("#SenderAddressRef").val(),r=$("#RecipientCityRef").val(),a=$("#DateTime").val(),o=$("#SenderIsWarehouse").val(),n=$("#RecipientIsWarehouse").val(),i=$("#Weight").val(),s=$("#VolumeWeight").val();$(".sundayDeliveryText").hide();var d={senderCityRef:e,recipientCityRef:r,senderIsWarehouse:o,recipientIsWarehouse:n,dateTime:a,senderAddress:t,documentWeight:i,volumeWeight:s};$.ajax({url:"/newOrder/CheckSundayDelivery",data:d,success:function(e){if(1==e.PossibleSundayDelivery?$(".sundayDeliveryText").show():$(".sundayDeliveryText").hide(),1==e.SundayDelivery){$("#dateTo").datetimepicker("setDaysOfWeekDisabled",[]),""!=e.maxDate&&$("#dateTo").datetimepicker("setEndDate",e.maxDate);var t=$("#PreferredDeliveryDate"),r=t.val(),a=document.getElementById("PreferredDeliveryDate").getAttribute("value");""!=a&&""==r&&(t.attr("value",a),t.val(a)),$("#dateTo").datetimepicker("update")}else void 0!=$neworder._recipientCityDelivery&&($neworder._recipientCityDelivery.delivery7=0,$neworder.setDeliveryDisabledDays($neworder._recipientCityDelivery))},error:function(){void 0!=$neworder._recipientCityDelivery&&($neworder._recipientCityDelivery.delivery7=0,$neworder.setDeliveryDisabledDays($neworder._recipientCityDelivery)),$(".sundayDeliveryText").hide()}})},activeLegendFoldedUnfolded:function(){$LegendFoldedUnfolded=$("legend.folded, legend.unfolded"),$LegendFoldedUnfolded.unbind("click"),$LegendFoldedUnfolded.click(function(){var e=$(this),t=$("#"+e.data("children")),r=!0;"blockAdditionalServices"===e.data("children")&&(r=$neworder.getAllowedAdditionalServices(!0)),r&&t.slideToggle("fast",function(){e.toggleClass("folded unfolded")})})},getAllowedAdditionalServices:function(e){if(!appParameters.allowedServiceConstructor)return!0;var t=$("#SenderCounterpartyRef").val(),r=$("#SenderCityRef").val(),a=$("#SenderAddressRef").val(),o=$("#RecipientCounterpartyRef").val(),n=$("#RecipientCityRef").val(),i=$("#RecipientAddressRef").val(),s=$("#PaymentMethod").val(),d=$("#PayerType").val(),l=$("#cargoTypes").val(),c=$("#seatsAmount").val(),p=$("#Weight").val(),u=$("#VolumeWeight").val(),y=$("#VolumeGeneral").val(),v=this.getServiceType(),m=$("#DateTime").val();if("Documents"==l&&(p=$("#WeightDocuments").val(),u=.1),""==t||""==r||""==a||""==o||""==n||""==i||""==s||""==d||""==l||""==c||""==v)return e&&noty(Yii.t("newOrder/js","Не все параметры заполнены.")),!1;var h={Sender:t,CitySender:r,SenderAddress:a,Recipient:o,CityRecipient:n,RecipientAddress:i,PaymentMethod:s,PayerType:d,CargoType:l,SeatsAmount:c,Weight:p,VolumeGeneral:y,ServiceType:v,FactualWeight:p,VolumetricWeight:u,DocumentWeight:p,DateTime:m},f={modelName:"Counterparty",calledMethod:"getClientServices",methodProperties:h},w={DeliveryByHand:"cellDeliveryByHand",MarketPlaceSecurePayment:"cellMarketPlaceSecurePayment",SaturdayDelivery:"cellSaturdayDelivery",SameDayDelivery:"cellSameDayDelivery",LiftingOnFloor:"cellNumberOfFloorsLifting",LiftingOnFloorWithElevator:"cellElevator",DescentFromFloorWithElevator:"cellElevator",DescentFromFloor:"cellNumberOfFloorsDescent",ExpressPallet:"cellExpressPallet",AfterpaymentOnGoodsCost:"cellAfterpaymentOnGoodsCost",Forwarding:"cellForwardingCount",FillingWarranty:"cellFillingWarranty",ForwardingCount:"cellForwardingCount"};for(var g in w)w.hasOwnProperty(g)&&$("."+w[g]).hide();return $.ajax({data:JSON.stringify(f),beforeSend:function(){},success:function(e){if(null!=e&&void 0!=e.success&&e.success===!0)for(var t in e.data[0].AvailableServices)e.data[0].AvailableServices.hasOwnProperty(t)&&void 0!=w[t]&&($("#"+w[t].substr(4)).removeClass("disabled").prop("readonly",!1).removeAttr("tabindex").removeAttr("disabled"),$("."+w[t]).show());else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$noty.push(noty(Yii.t("newOrder/js",t),3e3,"warning"))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},error:function(){noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))}}),!0},CargoTypes:{_$CargoTypes:$("#cargoTypes"),_changes:{},init:function(){$neworder.CargoTypes._$CargoTypes.change(function(){$neworder.CargoTypes.changes()})},setChange:function(e,t){$neworder.CargoTypes._changes[e]=t},unsetChange:function(e){delete $neworder.CargoTypes._changes[e]},changes:function(){for(var e in $neworder.CargoTypes._changes)$neworder.CargoTypes._changes[e]()}},Cost:{_$Cost:$("#cost")},CargoReturnValidateFields:{_$CargoReturnValidateFields:$("#RecipientIsWarehouse")},Description:{_$Description:$("#Description"),init:function(){var e="";e=$neworder.CargoTypes._$CargoTypes.val(),$neworder.CargoTypes._$CargoTypes.change(function(){var t=$(this).val();"Pallet"==e&&$neworder.Description._$Description.val(""),"TiresWheels"==t?$neworder.Description._$Description.addClass("disabled").prop("readonly",!0).attr("tabindex","-1").val(Yii.t("newOrder/js","Шини та диски")):"Documents"==t?$neworder.Description._$Description.prop("readonly",!1).removeAttr("tabindex").val(Yii.t("newOrder/js","Документы")):"Pallet"==t?$neworder.Description._$Description.val(Yii.t("newOrder/js","Палети")):$neworder.Description._$Description.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),e=t})}},Width:{$value:$("#Width"),$block:$(".cellWidth"),init:function(){$neworder.CargoTypes._$CargoTypes.change(function(){$neworder.postomat.isPostomat&&$neworder.postomat.isPostomat&&("Cargo"==$(this).val()||"Parcel"==$(this).val())?($neworder.Width.$block.show(),$neworder.Width.$value.attr("name","OptionsSeat[0][volumetricWidth]")):($neworder.postomat.isPostomat===!1||$neworder.postomat.isPostomat&&"Cargo"!=$(this).val()&&"Parcel"!=$(this).val())&&($neworder.Width.$block.hide(),$neworder.Width.$value.val("").removeAttr("name"))})}},Length:{$value:$("#Length"),$block:$(".cellLength"),init:function(){$neworder.CargoTypes._$CargoTypes.change(function(){$neworder.postomat.isPostomat&&$neworder.postomat.isPostomat&&("Cargo"==$(this).val()||"Parcel"==$(this).val())?($neworder.Length.$block.show(),$neworder.Length.$value.attr("name","OptionsSeat[0][volumetricLength]")):($neworder.postomat.isPostomat===!1||$neworder.postomat.isPostomat&&"Cargo"!=$(this).val()&&"Parcel"!=$(this).val())&&($neworder.Length.$block.hide(),$neworder.Length.$value.val("").removeAttr("name"))})}},Height:{$value:$("#Height"),$block:$(".cellHeight"),init:function(){$neworder.CargoTypes._$CargoTypes.change(function(){$neworder.postomat.isPostomat&&$neworder.postomat.isPostomat&&("Cargo"==$(this).val()||"Parcel"==$(this).val())?($neworder.Height.$block.show(),$neworder.Height.$value.attr("name","OptionsSeat[0][volumetricHeight]")):($neworder.postomat.isPostomat===!1||$neworder.postomat.isPostomat&&"Cargo"!=$(this).val()&&"Parcel"!=$(this).val())&&($neworder.Height.$block.hide(),$neworder.Height.$value.val("").removeAttr("name"))})}},MoneyTransfer:{$setMoneyTransferAddressButton:$("#SetMoneyTransferAddress"),$modal:$("#selectWarehousModal"),init:function(){this.$setMoneyTransferAddressButton.click(function(){return"disabled"==$(this).attr("disabled")?!1:($neworder.MoneyTransfer.editMoneyTransferButton(),void 0)
})},editMoneyTransferButton:function(){var e=$("#SenderCityRef").val(),t=$("#SenderAddressRef").val();$warehouses.clear_lists(t,e)},showMoneyTransfer:function(){$neworder.MoneyTransfer.editMoneyTransferButton()},hideMoneyTransfer:function(){$("#MoneyTransfer").hide().find("input").prop("disabled",!0)}},DeliveryByHand:{_$DeliveryByHand:$("#DeliveryByHand"),$recipientDescription:$("#RecipientContactText"),$modal:$("#recipientNameModal"),$createRecipientButton:$("#createRecipient"),$recipientSaveButton:$("#DeliveryByHandRecipientSaveButton"),$recipientsContainer:$("#recipient-list"),_recipientsList:[],init:function(){this.$recipientsContainer.find("input").each(function(){$neworder.DeliveryByHand._recipientsList.push($(this).val())}),this._$DeliveryByHand.on("click",function(){$neworder.DeliveryByHand.showRecipients("checked"==$(this).attr("checked"))}),this.showRecipients("checked"==$neworder.DeliveryByHand._$DeliveryByHand.attr("checked")),this.$recipientsContainer.find(".editRecipient").click(function(){$neworder.DeliveryByHand.editRecipientButton($(this).parent().data("id"))}),this.$recipientsContainer.find(".removeRecipient").on("click",function(){return $neworder.DeliveryByHand.removeRecipientButton($(this).parent().data("id")),!1}),this.$recipientSaveButton.click(function(){$neworder.DeliveryByHand.saveRecipientButton()}),this.$createRecipientButton.click(function(){return"disabled"==$(this).attr("disabled")?!1:($neworder.DeliveryByHand.editRecipientButton($(this).data("id")),void 0)}),this.$modal.find("input").on("keyup",function(){var e=$neworder.DeliveryByHand.validateRecipient($neworder.DeliveryByHand.$modal);$neworder.DeliveryByHand.$recipientSaveButton.prop("disabled",!e)}),$neworder.DeliveryByHand.toggleCreateRecipientButton()},display:function(){"true"==$("#RecipientIsWarehouse").val()?($("#DeliveryByHand").prop("checked",!1).addClass("disabled").prop("readonly",!0).attr("tabindex","-1"),$neworder.DeliveryByHand.showRecipients(!1)):void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.ShowDeliveryByHand?$("#DeliveryByHand").removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex").val("1"):$("#DeliveryByHand").prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1")},setFirstRecipient:function(e){$neworder.DeliveryByHand.editRecipient(e,0)},showRecipients:function(e){e?$("#deliveryByHandRecipientsBlock").show().find("input").prop("disabled",!1):$("#deliveryByHandRecipientsBlock").hide().find("input").prop("disabled",!0)},editRecipientButton:function(e){var t=$neworder.DeliveryByHand.$modal;t.attr("data-id",e);var r=["","",""];0==e?r=$neworder.DeliveryByHand.$recipientDescription.text().split(" "):void 0!=$neworder.DeliveryByHand._recipientsList[e]&&(r=$neworder.DeliveryByHand._recipientsList[e].split(" "));var a=t.find("#contactLastName");a.val(r[0]);var o=t.find("#contactFirstName");o.val(r[1]);var n=t.find("#contactMiddleName");n.val(r[2]),$neworder.DeliveryByHand.validateRecipient(t)?$neworder.DeliveryByHand.$recipientSaveButton.prop("disabled",!1):$neworder.DeliveryByHand.$recipientSaveButton.prop("disabled",!0)},removeRecipientButton:function(e){$neworder.DeliveryByHand._recipientsList[e]=void 0,$neworder.DeliveryByHand.$recipientsContainer.find(".recipientNameInputBlock[data-id="+e+"]").remove(),$neworder.DeliveryByHand.toggleCreateRecipientButton()},saveRecipientButton:function(){var e=$neworder.DeliveryByHand.$modal,t=[e.find("#contactLastName").val(),e.find("#contactFirstName").val(),e.find("#contactMiddleName").val()];return $neworder.DeliveryByHand.validateRecipient(e)?($neworder.DeliveryByHand.editRecipient(t.join(" "),e.attr("data-id")),e.modal("hide"),void 0):!1},validateRecipient:function(e){var t=[e.find("#contactLastName").val(),e.find("#contactFirstName").val(),e.find("#contactMiddleName").val()];if(3!=t.length)return!1;for(var r=0;r<t.length;r++)if(0==t[r].length)return!1;return!0},createRecipient:function(){var e=$neworder.DeliveryByHand._recipientsList.length;$neworder.DeliveryByHand.createRecipientBlock(e),$neworder.DeliveryByHand.toggleCreateRecipientButton()},toggleCreateRecipientButton:function(){$neworder.DeliveryByHand.$recipientsContainer.find(".recipientNameInputBlock").length>=appParameters.deliveryByHandRecipientsLimit?$neworder.DeliveryByHand.$createRecipientButton.attr("disabled",!0).addClass("disabled"):$neworder.DeliveryByHand.$createRecipientButton.attr("disabled",!1).removeClass("disabled")},editRecipient:function(e,t){void 0==$neworder.DeliveryByHand._recipientsList[t]&&$neworder.DeliveryByHand.createRecipient(e,t),$neworder.DeliveryByHand._recipientsList[t]=e,$neworder.DeliveryByHand.$recipientsContainer.find('input[name="DeliveryByHandRecipients['+t+']"]').val(e)},createRecipientBlock:function(e){var t=$neworder.DeliveryByHand.$recipientsContainer.find(".recipientNameInputBlock:first").clone(!0);t.attr("data-id",e);var r=t.find('input[name^="DeliveryByHandRecipients"]');r.attr("name","DeliveryByHandRecipients["+e+"]").val(),t.find(".removeRecipient").removeClass("disabled"),t.appendTo($neworder.DeliveryByHand.$recipientsContainer);var a=$neworder.DeliveryByHand.$createRecipientButton.data("id")+1;$neworder.DeliveryByHand.$createRecipientButton.data("id",a)},needToShowDeliveryByHand:function(){return void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.DeliveryByHand&&"true"!=$("#RecipientIsWarehouse").val()&&$neworder.DeliveryByHand.$recipientDescription.text().length>0?($("#DeliveryByHand").removeClass("disabled").prop("disabled",!1),$neworder.DeliveryByHand.showRecipients("checked"==$neworder.DeliveryByHand._$DeliveryByHand.attr("checked")),!0):($neworder.DeliveryByHand.showRecipients(!1),!1)},hideDeliveryByHand:function(){$(".cellDeliveryByHand").hide(),$("#DeliveryByHand").addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1")},showDeliveryByHand:function(){$(".cellDeliveryByHand").show(),$("#DeliveryByHand").removeClass("disabled").prop("readonly",!1).removeAttr("tabindex").val("1")}},AfterpaymentOnGoodsCost:{_$AfterpaymentOnGoodsCost:$("#AfterpaymentOnGoodsCost"),_$blockAfterpaymentOnGoodsCost:$("tr.cellAfterpaymentOnGoodsCost"),_scenario:{},init:function(){var e=$neworder.AfterpaymentOnGoodsCost;""!=e._$AfterpaymentOnGoodsCost.val()&&0!=e._$AfterpaymentOnGoodsCost.val()&&(e._scenario.isValue=!0,e.showHide())},isOption:function(){var e=$neworder.AfterpaymentOnGoodsCost;e._scenario.option=!0,e.showHide()},isCrimeaArea:function(){var e=$neworder.AfterpaymentOnGoodsCost;e._scenario.crimeaArea=!0,e.showHide()},isPostomat:function(){var e=$neworder.AfterpaymentOnGoodsCost;e._scenario.postomat=!0,e.showHide(),$("#SaturdayDelivery").prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1"),$("#FillingWarranty").prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1"),$("#SameDayDelivery").prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1"),$neworder.DeliveryByHand.hideDeliveryByHand()},hasPaymentAccess:function(){var e=$neworder.AfterpaymentOnGoodsCost;e._scenario.paymentAccess=!0,e.showHide()},noPaymentAccess:function(){var e=$neworder.AfterpaymentOnGoodsCost;delete e._scenario.paymentAccess,e.showHide()},notOption:function(){var e=$neworder.AfterpaymentOnGoodsCost;delete e._scenario.option,e.showHide()},notCrimeaArea:function(){var e=$neworder.AfterpaymentOnGoodsCost;delete e._scenario.crimeaArea,e.showHide()},notPostomat:function(){var e=$neworder.AfterpaymentOnGoodsCost;delete e._scenario.postomat,delete e._scenario.isValue,e.showHide(),"false"==$("#"+$neworder._processedCounterpartyType+"IsWarehouse").val()&&$neworder._recipientCityDelivery.branch&&$("#SaturdayDelivery").removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex").val("1"),$("#FillingWarranty").removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex").val("1")},showHide:function(){var e=$neworder.AfterpaymentOnGoodsCost;return""!=e._$AfterpaymentOnGoodsCost.val()?(e._$blockAfterpaymentOnGoodsCost.show(),void 0):(e._scenario.option?(e._$blockAfterpaymentOnGoodsCost.show(),e._scenario.postomat&&!e._scenario.paymentAccess&&(e._$AfterpaymentOnGoodsCost.val(""),e._$blockAfterpaymentOnGoodsCost.hide())):(e._$AfterpaymentOnGoodsCost.val(""),e._$blockAfterpaymentOnGoodsCost.hide()),e._scenario.postomat||e._scenario.isValue||e._scenario.option&&!e._scenario.crimeaArea?e._$AfterpaymentOnGoodsCost.prop("disabled",!1):e._$AfterpaymentOnGoodsCost.val("").prop("disabled",!0),void 0)}},Redelivery:{$redeliverySelect:$("#redeliveryTypes, #redeliveryTypesMore"),$financialInstitution:$("#financialInstitution"),init:function(){var e=$neworder.Redelivery;$neworder.checkRedeliveryPayerType(),"Documents"==$("#redeliveryTypes").val()&&void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.BackwardDeliverySubtypesDocuments?e.validRedeliveryDocumentTypes("documentsTable"):"Documents"==$("#redeliveryTypesMore").val()&&void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.BackwardDeliverySubtypesDocuments&&e.validRedeliveryDocumentTypes("documentsMoreTable"),$("#documentsTable input, #documentsMoreTable input").change(function(){e.validRedeliveryDocumentTypes($(this).closest(".table").attr("id"))}),e.$redeliverySelect.on("change",function(){e.checkRedeliveryTypes()})},checkRedeliveryTypes:function(){"CreditDocuments"==$("#redeliveryTypes").val()||"CreditDocuments"==$("#redeliveryTypesMore").val()?$("#redeliveryOnlineCredit").prop("disabled",!1).show():$("#redeliveryOnlineCredit").prop("disabled",!0).hide()},getFinancialInstitution:function(e){var t={Counterparty:e},r={modelName:"Common",calledMethod:"getBankList",methodProperties:t};$.ajax({data:JSON.stringify(r),beforeSend:function(){},success:function(e){if($neworder.Redelivery.$financialInstitution.val(""),$neworder.Redelivery.$financialInstitution.data("selectBox-selectBoxIt").remove(),null!=e&&void 0!=e.success&&e.success===!0){$neworder.Redelivery.$financialInstitution.data("selectBox-selectBoxIt").add({value:"",text:Yii.t("newOrder/js","Выберите финансовое учреждение")});for(var t=0;t<e.data.length;t++)$neworder.Redelivery.$financialInstitution.data("selectBox-selectBoxIt").add({value:e.data[t].Ref,text:e.data[t].Alias})}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}):noty(Yii.t("newOrder/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){}})},checkRestriction:function(){void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.BackwardDeliverySubtypesDocuments?($neworder.Redelivery.validRedeliveryDocumentTypes("documentsTable"),"Documents"==$("#redeliveryTypes").val()&&$("#documentsTable").slideDown("fast"),"Documents"==$("#redeliveryTypesMore").val()&&$("#documentsMoreTable").slideDown("fast")):($("#documentsTable").hide(),$("#documentsMoreTable").hide(),$("#documentsTable input, #documentsMoreTable input").prop("checked",!1).prop("disabled",!1))},validRedeliveryDocumentTypes:function(e){{var t=$("#"+e),r=$("#other"+e.replace("documents",""));t.find(".WaybillStateNumber1WithoutStamp"),t.find(".WaybillStateNumber1WithStamp"),t.find(".WaybillNewPostWithStamp"),t.find(".WaybillNewPostWithoutStamp"),t.find(".CostWaybillWithStamp"),t.find(".CostWaybillWithoutStamp")}t.find("input:checkbox:checked").length>0?r.find(":input").val("").prop("readonly",!0):r.find(":input").val("").prop("readonly",!1)}},SeatsAmount:{_active:!0,_$SeatsAmount:$("#seatsAmount"),init:function(){var e=navigator.userAgent;($.browser.msie||e.indexOf("Trident/7.0")+1)&&$("#seatsAmount").click(function(){$(this).blur(function(){$neworder.SeatsAmount._$SeatsAmount.trigger("change")})}),$neworder.SeatsAmount._$SeatsAmount.change(function(){var e=$neworder.CargoTypes._$CargoTypes.val(),t=$neworder.OptionsSeat._$selectOptionsSeat.attr("data-optionsSeat");if("Cargo"!=e&&"Pallet"!=e&&"Parcel"!=e||"true"!=t||void 0!=predefinedValues.MetroWeightPalleteEachSeats||($neworder.OptionsSeat._clearVolumetric(),$neworder.SeatsAmount._$SeatsAmount.val(),$neworder.CargoTypes._$CargoTypes.val(e).trigger("change"),$neworder.SeatsAmount._$SeatsAmount.val(value)),void 0!=predefinedValues.MetroVolumetricWeightEachSeats&&"Cargo"==$neworder.CargoTypes._$CargoTypes.val()&&$neworder.Weight._$Weight.val(predefinedValues.MetroVolumetricWeightEachSeats*$neworder.SeatsAmount._$SeatsAmount.val()),void 0!=predefinedValues.MetroWeightPalleteEachSeats&&"Pallet"==$neworder.CargoTypes._$CargoTypes.val()){var r=predefinedValues.MetroWeightPalleteEachSeats;if($neworder.Weight._$Weight.val(r*$neworder.SeatsAmount._$SeatsAmount.val()),_placesCount=$neworder.SeatsAmount._$SeatsAmount.val(),$neworder.OptionsSeat._$volumetricWeightBlock.html(""),_placesCount>0)for(var a=0;_placesCount>a;a++){var o=$neworder.OptionsSeat._$volumetricWeightClone.clone();o.find("td:first").html(1+a),o.find(".optionsSeat_volumetricVolume").attr("name","OptionsSeat["+a+"][volumetricVolume]").val(predefinedValues.MetroVolumetricVolumePalleteEachSeats),o.find(".optionsSeat_volumetricWeight").attr("name","OptionsSeat["+a+"][volumetricWeight]").val(r),o.find(".optionsSeat_volumetricWidth").attr("name","OptionsSeat["+a+"][volumetricWidth]").val(predefinedValues.MetroVolumetricWidthPalleteEachSeats),o.find(".optionsSeat_volumetricLength").attr("name","OptionsSeat["+a+"][volumetricLength]").val(predefinedValues.MetroVolumetricLengthPalleteEachSeats),o.find(".optionsSeat_volumetricHeight").attr("name","OptionsSeat["+a+"][volumetricHeight]").val(predefinedValues.MetroVolumetricHeightPalleteEachSeats),o.find(".optionsSeat_weight").attr("name","OptionsSeat["+a+"][weight]").val(r),$neworder.OptionsSeat._$volumetricWeightBlock.append(o),$neworder.OptionsSeat._$selectOptionsSeat.attr("data-optionsSeat","true")}$neworder.OptionsSeat._$volumetricSeatsAmountCount=a}}),$neworder.CargoTypes._$CargoTypes.change(function(){$neworder.postomat.isPostomat?($neworder.SeatsAmount._$SeatsAmount.val(1),$neworder.SeatsAmount._$SeatsAmount.attr("readonly","readonly")):$neworder.postomat.isPostomat===!1&&$neworder.SeatsAmount._$SeatsAmount.removeAttr("readonly")})},setOneSeatDisable:function(){var e=function(){$neworder.SeatsAmount._$SeatsAmount.addClass("disabled").prop("readonly",!0),1!=$neworder.SeatsAmount._$SeatsAmount.val()&&$neworder.SeatsAmount._$SeatsAmount.val(1).change()};$neworder.CargoTypes.setChange("changeWeightCargoType",e),e()},unsetOneSeatDisable:function(){var e=$neworder.SeatsAmount,t=$neworder;t.CargoTypes.unsetChange("changeWeightCargoType"),e._$SeatsAmount.removeClass("disabled").prop("readonly",!1),$neworder.Weight._$Weight.attr("name","Weight")},handler:function(){var e=$neworder.SeatsAmount,t=e._$SeatsAmount,r=!0;$neworder.Redbox._$Redbox.val()&&(r=!1),r!=e._active&&(e._active=r,r?t.prop("readonly",!1).removeAttr("tabindex"):t.prop("readonly",!0).attr("tabindex","-1").val("1").trigger("change"))}},Weight:{_active:!0,_$Weight:$("#Weight"),_$WeightDocuments:$("#WeightDocuments"),_$WeightBlock:$(".cellWeight"),_blockWeightIsCargo:function(){if("Cargo"==$neworder.CargoTypes._$CargoTypes.val()||"Parcel"==$neworder.CargoTypes._$CargoTypes.val()){var e=!1;$neworder.OptionsSeat._$selectOptionsSeat.find("input.optionsSeat_weight").each(function(){return""!=$(this).val()?(e=!0,!0):void 0}),e?this._$Weight.addClass("disabled").prop("readonly",!0).attr("tabindex","-1"):this._$Weight.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex")}},init:function(){var e=$neworder.Weight;$neworder.CargoTypes._$CargoTypes.change(function(){var t=$(this).val();0==cargoTypeIsCargoOrParcel&&e._$Weight.val(""),"Pallet"==t?e._$Weight.prop("disabled",!0).prop("readonly",!0).attr("tabindex","-1"):e._$Weight.prop("disabled",!1).prop("readonly",!1).removeAttr("tabindex"),"TiresWheels"==t?e._$WeightBlock.hide():e._$WeightBlock.show(),e._$WeightDocuments.length&&(e._$Weight.closest(".input").toggleClass("hidden","Documents"==t).end().prop("disabled","Documents"==t),e._$WeightDocuments.closest(".input").toggleClass("hidden","Documents"!==t).end().prop("disabled","Documents"!==t).removeClass("selectboxit-rendering").data("selectBox-selectBoxIt").refresh())}),$neworder.Weight._$Weight.change(function(e,t){var r=$neworder.Weight._$Weight.val();r=r.replace(",","."),""!=r&&$neworder.Weight._$Weight.val(r),cargoTypeIsCargoOrParcel=$neworder.CargoTypes._$CargoTypes.val(),"Cargo"==cargoTypeIsCargoOrParcel&&($("#VolumeWeight").val()>30||$("#Weight").val()>30||$neworder.CargoTypes._$CargoTypes.val("Parcel").trigger("change",[t])),"Parcel"==cargoTypeIsCargoOrParcel&&($("#VolumeWeight").val()>30||$("#Weight").val()>30)&&$neworder.CargoTypes._$CargoTypes.val("Cargo").trigger("change",[t]),$("#SameDayDelivery").is(":checked")&&($("#VolumeWeight").val()>300||$("#Weight").val()>100?($("#SameDayDelivery").prop("checked",!1),noty(Yii.t("newOrder/js",'Послуга "Локал Експрес" вимкнена, фактична вага перебільшує 100 кг. або об\'ємна 300 кг. '))):$neworder.getTimeIntervals($("#RecipientCityRef").val(),"")),cargoTypeIsCargoOrParcel=!1,$neworder.checkSundayDelivery()}),this._blockWeightIsCargo()},handler:function(){var e=$neworder.Weight,t=e._$Weight,r=!0;$neworder.Redbox._$Redbox.val()&&(r=!1),r!=e._active&&(e._active=r,r?t.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"):t.addClass("disabled").prop("readonly",!0).attr("tabindex","-1").val(""))}},VolumeWeight:{_$VolumeWeight:$("#VolumeWeight"),_$VolumeWeightBlock:$(".cellVolumeWeight"),init:function(){$neworder.CargoTypes._$CargoTypes.change(function(){var e=$(this).val();0==cargoTypeIsCargoOrParcel&&$neworder.VolumeWeight._$VolumeWeight.val(""),"Cargo"==e||"Pallet"==e||"Parcel"==e?$neworder.VolumeWeight._$VolumeWeightBlock.show():$neworder.VolumeWeight._$VolumeWeightBlock.hide(),$neworder.postomat.isPostomat?($neworder.VolumeWeight._$VolumeWeight.val(""),$neworder.VolumeWeight._$VolumeWeight.attr("readonly","readonly")):$neworder.postomat.isPostomat===!1&&$neworder.VolumeWeight._$VolumeWeight.removeAttr("readonly")}),$neworder.VolumeGeneral._$VolumeGeneral.change(function(){var e=$(this);e.val(e.val().replace(",","."));var t=e.val();""!=t?$neworder.VolumeWeight._$VolumeWeight.val((250*t).toFixed(2)).trigger("change"):$neworder.VolumeWeight._$VolumeWeight.val(""),cargoTypeIsCargoOrParcel=$neworder.CargoTypes._$CargoTypes.val(),"Cargo"==cargoTypeIsCargoOrParcel&&($("#VolumeWeight").val()>30||$("#Weight").val()>30||$neworder.CargoTypes._$CargoTypes.val("Parcel").trigger("change")),"Parcel"==cargoTypeIsCargoOrParcel&&($("#VolumeWeight").val()>30||$("#Weight").val()>30)&&$neworder.CargoTypes._$CargoTypes.val("Cargo").trigger("change"),$("#SameDayDelivery").is(":checked")&&($("#VolumeWeight").val()>300||$("#Weight").val()>100?($("#SameDayDelivery").prop("checked",!1),noty(Yii.t("newOrder/js",'Послуга "Локал Експрес" вимкнена, фактична вага перебільшує 100 кг. або об\'ємна 300 кг. '))):$neworder.getTimeIntervals($("#RecipientCityRef").val(),"")),cargoTypeIsCargoOrParcel=!1,$neworder.checkSundayDelivery()})}},VolumeGeneral:{_active:!0,_$VolumeGeneral:$("#VolumeGeneral"),_$VolumeGeneralBlock:$(".cellVolumeGeneral"),_blockVolumeGeneralIsCargo:function(){if("Cargo"==$neworder.CargoTypes._$CargoTypes.val()||"CargoType"==$neworder.CargoTypes._$CargoTypes.val()||"Parcel"==$neworder.CargoTypes._$CargoTypes.val()){var e=!1;$neworder.OptionsSeat._$selectOptionsSeat.find("input.optionsSeat_volumetricVolume").each(function(){return""!=$(this).val()?(e=!0,!0):void 0}),e?this._$VolumeGeneral.prop("readonly",!0).attr("tabindex","-1"):this._$VolumeGeneral.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex")}},init:function(){$neworder.CargoTypes._$CargoTypes.change(function(){var e=$(this).val();0==cargoTypeIsCargoOrParcel&&$neworder.VolumeGeneral._$VolumeGeneral.val(""),"Cargo"==e||"Pallet"==e||"Parcel"==e?($neworder.VolumeGeneral._$VolumeGeneralBlock.show(),"Pallet"==e?$neworder.VolumeGeneral._$VolumeGeneral.prop("readonly",!0).attr("tabindex","-1"):$neworder.VolumeGeneral._$VolumeGeneral.prop("readonly",!1).removeAttr("tabindex")):$neworder.VolumeGeneral._$VolumeGeneralBlock.hide()}),this._blockVolumeGeneralIsCargo(),$neworder.CargoTypes._$CargoTypes.change(function(){$neworder.postomat.isPostomat?($neworder.VolumeGeneral._$VolumeGeneral.val(""),$neworder.VolumeGeneral._$VolumeGeneral.attr("readonly","readonly")):$neworder.postomat.isPostomat===!1&&$neworder.VolumeGeneral._$VolumeGeneral.removeAttr("readonly")})},handler:function(){var e=$neworder.VolumeGeneral,t=e._$VolumeGeneral,r=!0;$neworder.Redbox._$Redbox.val()&&(r=!1),r!=e._active&&(e._active=r,r?t.removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"):t.addClass("disabled").prop("readonly",!0).attr("tabindex","-1").val(""))}},OptionsSeat:{_$volumetricWeightBlock:null,_$selectOptionsSeat:$("#selectOptionsSeatModal"),_$cargoSpecOptionSeat:$("#cargoSpecTable"),_$buttonBlockVolumetric:$("#buttonBlockVolumetric"),_$volumetricWeightClone:null,_$volumetricSeatsAmountCount:0,_cellSeatCount:0,_$inputs:null,_$jsonInput:$("#OptionsSeat"),_maxRows:100,_parametersSaveChangeCargoType:{cargoType:""},_clearVolumetric:function(){this._$volumetricWeightBlock.html(""),this._$selectOptionsSeat.attr("data-optionsSeat","false"),$neworder.OptionsSeat._$jsonInput.val("")},_generateVolumetricBlock:function(e){$neworder.OptionsSeat;this._$volumetricWeightBlock.html("");var t=0;if(e>0)for(;e>t;t++)this._generateVolumetric(t);$neworder.OptionsSeat._$volumetricSeatsAmountCount=t},_generateVolumetric:function(e){var t=$neworder.OptionsSeat._$volumetricWeightClone.clone();t.find("td:first").html(1+e),t.find(".optionsSeat_volumetricVolume").attr("name","OptionsSeat["+e+"][volumetricVolume]"),t.find(".optionsSeat_volumetricWeight").attr("name","OptionsSeat["+e+"][volumetricWeight]"),t.find(".optionsSeat_volumetricWidth").attr("name","OptionsSeat["+e+"][volumetricWidth]"),t.find(".optionsSeat_volumetricLength").attr("name","OptionsSeat["+e+"][volumetricLength]"),t.find(".optionsSeat_volumetricHeight").attr("name","OptionsSeat["+e+"][volumetricHeight]"),t.find(".optionsSeat_weight").attr("name","OptionsSeat["+e+"][weight]"),"undefined"!=typeof appParameters.isAvailableDetailOptionsSeat&&appParameters.isAvailableDetailOptionsSeat&&(t.find(".optionsSeat_cost").attr("name","OptionsSeat["+e+"][cost]").mask("0999999C09"),"Pallet"==$neworder.CargoTypes._$CargoTypes.val()?t.find(".optionsSeat_description").attr("name","OptionsSeat["+e+"][description]").val("Палети"):t.find(".optionsSeat_description").attr("name","OptionsSeat["+e+"][description]")),this._$volumetricWeightBlock.append(t)},_addVolumetric:function(){$neworder.OptionsSeat;if(!$(".addVolumetric").length){var e=$neworder.OptionsSeat._$volumetricWeightClone.clone();e.find("td:first").html('<i class="icon-plus"></i>'),e.find("input").removeAttr("name"),e.addClass("addVolumetric"),this._$volumetricWeightBlock.append(e),$(".addVolumetric :input").bind("keydown change",function(){$neworder.OptionsSeat._$volumetricSeatsAmountCount=$neworder.OptionsSeat._$volumetricSeatsAmountCount+1;var e=$neworder.OptionsSeat._$volumetricSeatsAmountCount;e-=1;var t=$(".addVolumetric");t.find("td:first").html($neworder.OptionsSeat._$volumetricSeatsAmountCount),t.find(".optionsSeat_volumetricVolume").attr({name:"OptionsSeat["+e+"][volumetricVolume]"}),t.find(".optionsSeat_volumetricWeight").attr("name","OptionsSeat["+e+"][volumetricWeight]"),t.find(".optionsSeat_volumetricWidth").attr("name","OptionsSeat["+e+"][volumetricWidth]"),t.find(".optionsSeat_volumetricLength").attr("name","OptionsSeat["+e+"][volumetricLength]"),t.find(".optionsSeat_volumetricHeight").attr("name","OptionsSeat["+e+"][volumetricHeight]"),t.find(".optionsSeat_weight").attr("name","OptionsSeat["+e+"][weight]"),"undefined"!=typeof appParameters.isAvailableDetailOptionsSeat&&appParameters.isAvailableDetailOptionsSeat&&(t.find(".optionsSeat_cost").attr("name","OptionsSeat["+e+"][cost]"),"Pallet"==$neworder.CargoTypes._$CargoTypes.val()?t.find(".optionsSeat_description").attr("name","OptionsSeat["+e+"][description]").val("Палети"):t.find(".optionsSeat_description").attr("name","OptionsSeat["+e+"][description]")),t.find("input").unbind("keydown change"),t.removeClass("addVolumetric"),$neworder.OptionsSeat._addVolumetric()}),$("input.mask-double_4_2").mask("0999C09"),$("input.mask-double_4_3").mask("0999C099"),$("input.mask-integer_4").mask("0999"),$("input.mask-double_7_2").mask("0999999C09"),$("input.mask-char").mask("E");var t=function(e){$(e).val()<.1&&""!=$(e).val()&&$(e).val("")};$(".optionsSeat_volumetricWidth").mask("0999").bind("blur",function(){t($(this))}),$(".optionsSeat_volumetricLength").mask("0999").bind("blur",function(){t($(this))}),$(".optionsSeat_volumetricHeight").mask("0999").bind("blur",function(){t($(this))}),$(".optionsSeat_volumetricVolume").bind("blur",function(){$(this).val()<4e-4&&""!=$(this).val()&&$(this).val(4e-4)}),$(".optionsSeat_weight").mask("0999C09").bind("blur",function(){if($(this).val()<.1&&""!=$(this).val()&&$(this).val(.1),""==$(this).val()){var e=$(this).parents("tr").find(".optionsSeat_volumetricVolume");""!=e.val()&&e.trigger("change")}})}},_changeCargoTypeToCargo:function(){var e=$("#messageOptionsSeatButton");e.trigger("click");var t=[];$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"]').each(function(e){t[$(this).attr("name")]=$(this).val(),t[e]=$(this).val()}),this._parametersSaveChangeCargoType.cargoType=$neworder.CargoTypes._$CargoTypes.val(),$neworder.CargoTypes._$CargoTypes.val("Cargo").trigger("change"),$neworder.OptionsSeat._generateVolumetricBlock(t.length/$neworder.OptionsSeat._cellSeatCount),$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"]').each(function(e){t[$(this).attr("name")]=$(this).val(),$(this).val(t[e])}),$neworder.OptionsSeat._$selectOptionsSeat.find(".optionsSeat_weight").trigger("change"),$neworder.OptionsSeat._addVolumetric()},_getInputs:function(e){var t=$neworder.OptionsSeat;if(e||null==$neworder.OptionsSeat._$inputs){var r=$neworder.postomat.hasMultipleOptionsSeat?t._$selectOptionsSeat:t._$cargoSpecOptionSeat;t._$inputs=r.find('input[name^="OptionsSeat"]')}return t._$inputs},_getAllInputs:function(){return $('[name^="OptionsSeat["]')},_setJSON:function(){var e=[];$neworder.OptionsSeat._getInputs(!0).each(function(){var t=/^(OptionsSeat\[)(\d+)(]\[)(\w+)(])$/.exec($(this).attr("name")),r=t[2],a=t[4];void 0==e[r]&&(e[r]={}),e[r][a]=$(this).val()}),$neworder.OptionsSeat._$jsonInput.val(JSON.stringify(e))},init:function(){this._$volumetricWeightClone=this._$selectOptionsSeat.find("tbody tr:first").clone();var e=null,t=[],r="",a="",o="",n=!1;this._$volumetricWeightBlock=$neworder.OptionsSeat._$selectOptionsSeat.find("tbody"),$neworder.OptionsSeat._$selectOptionsSeat.find("tbody tr:first").remove(),this._cellSeatCount=$neworder.OptionsSeat._$volumetricWeightClone.find("input").length,$("#buttonOptionsSeat").click(function(){$neworder.OptionsSeat;return $neworder.OptionsSeat._$selectOptionsSeat.modal({show:!1,keyboard:!1}),e=$neworder.SeatsAmount._$SeatsAmount.val(),r=$neworder.Weight._$Weight.val(),a=$neworder.VolumeGeneral._$VolumeGeneral.val(),o=$neworder.CargoTypes._$CargoTypes.val(),$neworder.OptionsSeat._$volumetricSeatsAmountCount=parseInt($neworder.SeatsAmount._$SeatsAmount.val()),"true"==$neworder.OptionsSeat._$selectOptionsSeat.attr("data-optionsSeat")?$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"]').each(function(e){t[$(this).attr("name")]=$(this).val(),t[e]=$(this).val()}):$neworder.OptionsSeat._generateVolumetricBlock($neworder.OptionsSeat._$volumetricSeatsAmountCount),$neworder.OptionsSeat._addVolumetric(),$neworder.OptionsSeat._$selectOptionsSeat.modal("show"),$("input.mask-double_4_4").mask("0999C0999"),!1}),$("#selectVolumetricWeight").click(function(){if($neworder.OptionsSeat._$volumetricSeatsAmountCount>0){$neworder.OptionsSeat._$selectOptionsSeat.attr("data-optionsSeat","true"),n=!0;var e=0,t=0,r=0;if($neworder.OptionsSeat._$selectOptionsSeat.find("input.optionsSeat_volumetricWeight").each(function(){var e=$(this).val();""!=e&&(t=parseFloat(e)+t)}),$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"].optionsSeat_weight').each(function(){r+=1;var t=$(this).val();""!=t&&(e=parseFloat(t)+e)}),"undefined"!=typeof appParameters.isAvailableDetailOptionsSeat&&appParameters.isAvailableDetailOptionsSeat){var a=0,o=new Array;$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"].optionsSeat_cost').each(function(){var e=$(this).val();""!=e&&(a=parseFloat(e)+a)}),$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"].optionsSeat_description').each(function(){var e=$(this).val();""!=e&&$.inArray(e,o)<0&&o.push(e)}),o=o.join(),o.length>=60&&(o=o.substring(0,60)),$neworder.Description._$Description.val(o),a>0&&$neworder.Cost._$Cost.val(a)}0>=e&&(e=Number($neworder.Weight._$Weight.val()),e=isNaN(e)?0:e),.1>e&&(e=.1),$neworder.Weight._$Weight.val(e.toFixed(2)).trigger("change",["fromPopup"]);var i=(t/250).toFixed(4)<4e-4?4e-4:(t/250).toFixed(4);$neworder.VolumeGeneral._$VolumeGeneral.val(i).trigger("change"),$neworder.SeatsAmount._$SeatsAmount.val(r)}$neworder.Weight._blockWeightIsCargo(),$neworder.VolumeGeneral._blockVolumeGeneralIsCargo()}),$(".cancelVolumetricWeightBlock").on("click",function(){$neworder.OptionsSeat._generateVolumetricBlock(t.length/$neworder.OptionsSeat._cellSeatCount),$neworder.OptionsSeat._$selectOptionsSeat.find('input[name^="OptionsSeat"]').each(function(e){t[$(this).attr("name")]=$(this).val(),$(this).val(t[e])}),o!=$neworder.CargoTypes._$CargoTypes.val()&&$neworder.CargoTypes._$CargoTypes.val(o).trigger("change"),$neworder.SeatsAmount._$SeatsAmount.val(e),$neworder.Weight._$Weight.val(r).trigger("change"),$neworder.VolumeGeneral._$VolumeGeneral.val(a).trigger("change"),$neworder.Weight._blockWeightIsCargo(),$neworder.VolumeGeneral._blockVolumeGeneralIsCargo(),n=!1}),$neworder.OptionsSeat._$selectOptionsSeat.on("click",".removeVolumetric",function(){$(this).parent().parent().parent().parent().detach(),$neworder.OptionsSeat._$volumetricSeatsAmountCount=$neworder.OptionsSeat._$volumetricSeatsAmountCount-1,$neworder.OptionsSeat._$selectOptionsSeat.find('tbody tr[class!="addVolumetric"]').each(function(e){$(this).find("td:first").html(1+e),$(this).find(".optionsSeat_volumetricVolume").attr("name","OptionsSeat["+e+"][volumetricVolume]"),$(this).find(".optionsSeat_volumetricWeight").attr("name","OptionsSeat["+e+"][volumetricWeight]"),$(this).find(".optionsSeat_volumetricWidth").attr("name","OptionsSeat["+e+"][volumetricWidth]"),$(this).find(".optionsSeat_volumetricLength").attr("name","OptionsSeat["+e+"][volumetricLength]"),$(this).find(".optionsSeat_volumetricHeight").attr("name","OptionsSeat["+e+"][volumetricHeight]"),$(this).find(".optionsSeat_weight").attr("name","OptionsSeat["+e+"][weight]"),"undefined"!=typeof appParameters.isAvailableDetailOptionsSeat&&appParameters.isAvailableDetailOptionsSeat&&($(this).find(".optionsSeat_cost").attr("name","OptionsSeat["+e+"][cost]"),$(this).find(".optionsSeat_description").attr("name","OptionsSeat["+e+"][description]"))}),$neworder.OptionsSeat._addVolumetric()}),$neworder.OptionsSeat._$selectOptionsSeat.on("click",".clearVolumetric",function(){$(this).parent().parent().parent().parent().find("input").val("")}),$neworder.OptionsSeat._$selectOptionsSeat.on("click",".cloneVolumetric",function(){var e=$(this).parent().parent().parent().parent(),t=e.find(".optionsSeat_volumetricVolume").val(),r=e.find(".optionsSeat_volumetricWeight").val(),a=e.find(".optionsSeat_volumetricWidth").val(),o=e.find(".optionsSeat_volumetricLength").val(),n=e.find(".optionsSeat_volumetricHeight").val(),i=e.find(".optionsSeat_weight").val();
if("undefined"!=typeof appParameters.isAvailableDetailOptionsSeat&&appParameters.isAvailableDetailOptionsSeat)var s=e.find(".optionsSeat_cost").val(),d=e.find(".optionsSeat_description").val();$neworder.OptionsSeat._$selectOptionsSeat.find('tbody tr[class!="addVolumetric"]').each(function(){$(this).find(".optionsSeat_volumetricVolume").val(t),$(this).find(".optionsSeat_volumetricWeight").val(r),$(this).find(".optionsSeat_volumetricWidth").val(a),$(this).find(".optionsSeat_volumetricLength").val(o),$(this).find(".optionsSeat_volumetricHeight").val(n),$(this).find(".optionsSeat_weight").val(i),"undefined"!=typeof appParameters.isAvailableDetailOptionsSeat&&appParameters.isAvailableDetailOptionsSeat&&($(this).find(".optionsSeat_cost").val(s),$(this).find(".optionsSeat_description").val(d))})}),$neworder.OptionsSeat._$selectOptionsSeat.on("change","input",function(){$(this).val($(this).val().replace(",","."))}),$neworder.OptionsSeat._$selectOptionsSeat.on("change",".optionsSeat_volumetricWidth, .optionsSeat_volumetricLength, .optionsSeat_volumetricHeight, .optionsSeat_weight",function(){var e=$(this).parent().parent().parent().parent(),t=e.find(".optionsSeat_volumetricWidth").val(),r=e.find(".optionsSeat_volumetricLength").val(),a=e.find(".optionsSeat_volumetricHeight").val(),o=e.find(".optionsSeat_weight").val();if(t>0&&r>0&&a>0){var n=t*r*a/4e3,i=(n/250).toFixed(4)<4e-4?4e-4:(n/250).toFixed(4);if(e.find(".optionsSeat_volumetricVolume").val(i),"Pallet"==$neworder.CargoTypes._$CargoTypes.val()&&o>0){var s=t*r/1e4;s>predefinedValues.PredefinedVolumetricAreaPalletMax/1e4||a>Number(predefinedValues.PredefinedVolumetricWidthHeightPalletMax)||o>Number(predefinedValues.PredefinedVolumetricWeightPalletMaxWeigh)?$neworder.OptionsSeat._changeCargoTypeToCargo():.49>=s?500>=o?n=204:750>=o?n=612:1100>=o&&(n=816):.99>=s?500>=o?n=408:750>=o?n=612:1100>=o&&(n=816):1.49>=s?500>=o?n=612:750>=o?n=612:1100>=o&&(n=816):2>=s&&(500>=o?n=816:750>=o?n=816:1100>=o&&(n=816))}else("Cargo"==$neworder.CargoTypes._$CargoTypes.val()||"Parcel"==$neworder.CargoTypes._$CargoTypes.val())&&(n=.1>n?.1:n);e.find(".optionsSeat_volumetricWeight").val(n.toFixed(2))}else e.find(".optionsSeat_volumetricWeight").val("")}),$neworder.OptionsSeat._$selectOptionsSeat.on("change",".optionsSeat_volumetricVolume",function(){{var e=$(this).parent().parent().parent().parent();e.find(".optionsSeat_volumetricWidth").val(""),e.find(".optionsSeat_volumetricLength").val(""),e.find(".optionsSeat_volumetricHeight").val("")}e.find(".optionsSeat_volumetricWeight").val((250*$(this).val()).toFixed(2))}),$neworder.CargoTypes._$CargoTypes.change(function(e,t){var r=$(this).val();"undefined"!=typeof t&&"fromPopup"!=t&&$neworder.OptionsSeat._clearVolumetric(),"Cargo"==r||"Pallet"==r||"Parcel"==r?($neworder.OptionsSeat.showOptionsSeatButton(),"Pallet"==r?($neworder.OptionsSeat._$volumetricWeightClone.find(".optionsSeat_volumetricVolume").prop("readonly",!0).attr("tabindex","-1"),$neworder.OptionsSeat._$volumetricWeightClone.find(".selectOptionsSeatOr").hide()):($neworder.OptionsSeat._$volumetricWeightClone.find(".optionsSeat_volumetricVolume").prop("readonly",!1).removeAttr("tabindex"),$neworder.OptionsSeat._$volumetricWeightClone.find(".selectOptionsSeatOr").show())):$neworder.OptionsSeat.hideOptionsSeatButton()})},setMaxRows:function(e){$neworder.OptionsSeat._defaultMaxRows=$neworder.OptionsSeat._maxRows,$neworder.OptionsSeat._maxRows=e},setDefaultMaxRows:function(){$neworder.OptionsSeat._maxRows=100},getLength:function(){return $(".blockOptionsSeatList tbody tr:not(.addVolumetric)").length},showOptionsSeatButton:function(){$neworder.OptionsSeat._$buttonBlockVolumetric.show(),$neworder.postomat.isPostomat&&$neworder.OptionsSeat._$buttonBlockVolumetric.hide()},hideOptionsSeatButton:function(){$neworder.OptionsSeat._$buttonBlockVolumetric.hide()}},paymentTTN:{pageForPay:$config_$neworder.pageForPay,init:function(e){e.on("click",".paymentOneNowTtn",function(){var e=$neworder.paymentTTN.documentCheck($(this)),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"setPaymentDocuments",methodProperties:t},a=function(e){1==e.response.success&&(window.location.href=$neworder.paymentTTN.pageForPay)},o={funk:a,data:{}};$neworder.paymentTTN.ajaxSend(r,o)}),e.on("click",".paymentOneAddTtn",function(){var e=$neworder.paymentTTN.documentCheck($(this)),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"setPaymentDocuments",methodProperties:t},a=function(e){1==e.response.success&&noty(Yii.t("orders/js","Документ добавлен к оплате Online"),3e3,"success")},o={funk:a,data:{}};$neworder.paymentTTN.ajaxSend(r,o)})},documentCheck:function(e){var t=[];return t[0]=e.attr("data-ref"),t},sandbox:function(e){e.funk&&e.funk(e.data)},ajaxSend:function(e,t){$.ajax({data:JSON.stringify(e),success:function(e){e.success===!0||(e.success===!1?noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже.")):noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))),t.data.response=e,$neworder.paymentTTN.sandbox(t)},error:function(){noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))}})}},checkRedeliveryPayerType:function(){var e=$("#SenderRedeliveryPayer"),t=$("#RecipientRedeliveryPayer");"Trays"==$neworder._redeliveryTypes||"Trays"==$neworder._redeliveryTypesMore||"EWTransporter"==$neworder._redeliveryTypes||"EWTransporter"==$neworder._redeliveryTypesMore||"CreditDocuments"==$neworder._redeliveryTypes||"CreditDocuments"==$neworder._redeliveryTypesMore?(e.trigger("click"),t.addClass("disabled"),t.prop("disabled","disabled"),this.recipientRedeliveryPayerSelect="disabled"):("disabled"==this.recipientRedeliveryPayerSelect&&(this.recipientRedeliveryPayerSelect="",t.removeClass("disabled"),t.prop("disabled",!1)),"Money"==$neworder._redeliveryTypes&&("Warehouse"!=$neworder.getRecipientType()?$("#buttonsBackwardDeliveryMoneyType button:nth-child(2)").attr("disabled",!0):$("#buttonsBackwardDeliveryMoneyType button:nth-child(2)").attr("disabled",!1))),"Money"==$neworder._redeliveryTypes||"ThirdPerson"!=$("#PayerType").val()?$("#ThirdPersonRedeliveryPayer").attr("disabled",!0):$("#ThirdPersonRedeliveryPayer").attr("disabled",!1),$neworder.DeliveryByHand.needToShowDeliveryByHand()?$neworder.DeliveryByHand.showDeliveryByHand():$neworder.DeliveryByHand.hideDeliveryByHand()},senderSelectButton:function(){if("Sender"!=$neworder._processedCounterpartyType){$neworder._processedCounterpartyType="Sender",$counterparties.counterpartyProperty="Sender",$neworder._processSelectCounterpartyText=Yii.t("newOrder/js","Нажмите для изменения ОТПРАВИТЕЛЯ");var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),a=$("#SenderContactRef").val();$configBox.appParameters._WarehouseFor="Sender",$counterparties.clear_lists(t,r,a,e)}},recipientSelectButton:function(){if("Recipient"!=$neworder._processedCounterpartyType){$neworder._processedCounterpartyType="Recipient",$counterparties.counterpartyProperty="Recipient",$neworder._processSelectCounterpartyText=Yii.t("newOrder/js","Нажмите для изменения ПОЛУЧАТЕЛЯ");var e=$("#RecipientCityText").text(),t=$("#RecipientCounterpartyRef").val(),r=$("#RecipientAddressRef").val(),a=$("#RecipientContactRef").val();$configBox.appParameters._WarehouseFor="Recipient",$counterparties.clear_lists(t,r,a,e)}},thirdPersonSelectButton:function(){if("ThirdPerson"!=$neworder._processedCounterpartyType){$("#filter_journal_cities_counterparty").fastLiveFilter("#cities_ul_counterparty"),$neworder._processedCounterpartyType="ThirdPerson",$counterpartiesOnly.counterpartyProperty="ThirdPerson",$neworder._processSelectCounterpartyText=Yii.t("newOrder/js","Нажмите для изменения ТРЕТЬЕГО ЛИЦА");var e=$("#ThirdPersonCityText").text(),t=$("#ThirdPersonCounterpartyRef").val();$counterpartiesOnly.clear_lists(e,t)}},fillSelectedCounterparty:function(){if($counterparties.check_fields_filled()){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),r=$counterparties.get_filled_element("address_ul"),a=$counterparties.get_filled_element("contacts_ul"),o=$("#"+$neworder._processedCounterpartyType+"CityRef").val(),n=$("#"+$neworder._processedCounterpartyType+"CounterpartyRef").val();$("#"+$neworder._processedCounterpartyType+"InfoTable").removeClass("hidden"),$("#"+$neworder._processedCounterpartyType+"CityText").html($("#cities_ul").find("li.active").text().trim()),$("#"+$neworder._processedCounterpartyType+"CityRef").val(e.ref).trigger("change"),$("#"+$neworder._processedCounterpartyType+"AreaRef").val(e.area),$("#"+$neworder._processedCounterpartyType+"ConglomeratesRef").val('["'+e.conglomerates.join('","')+'"]'),$("#"+$neworder._processedCounterpartyType+"CounterpartyText").html(t.description),$("#"+$neworder._processedCounterpartyType+"CounterpartyRef").val(t.ref),$("#"+$neworder._processedCounterpartyType+"AddressText").html(r.description),$("#"+$neworder._processedCounterpartyType+"AddressRef").val(r.ref),$("#"+$neworder._processedCounterpartyType+"ContactText").html(a.description),$("#"+$neworder._processedCounterpartyType+"ContactRef").val(a.ref),$("#"+$neworder._processedCounterpartyType+"PhoneText").html(a.phone),$("#"+$neworder._processedCounterpartyType+"Phone").val(a.phone),$("#"+$neworder._processedCounterpartyType+"EDRPOU").val(t.edrpou),$("#"+$neworder._processedCounterpartyType+"OwnershipForm").val(t.ownershipform),$("#"+$neworder._processedCounterpartyType+"CounterpartyType").val(t.counterpartytype),$neworder._recipientIsLatin=/[a-z]/i.test(t.description+a.description);var i=$("#"+$neworder._processedCounterpartyType+"IsWarehouse");if(i.val(r.warehouse).trigger("change"),$("#"+$neworder._processedCounterpartyType+"SelectButton").text($neworder._processSelectCounterpartyText),$("#"+$neworder._processedCounterpartyType+"RedeliveryPayer").html(("Recipient"==$neworder._processedCounterpartyType?Yii.t("newOrder/js","Получатель"):Yii.t("newOrder/js","Отправитель"))+": "+$("#cities_ul").find("li.active").text().trim()+",</br>"+t.description),$("#"+$neworder._processedCounterpartyType+"Payer").html(("Recipient"==$neworder._processedCounterpartyType?Yii.t("newOrder/js","Получатель"):Yii.t("newOrder/js","Отправитель"))+": "+$("#cities_ul").find("li.active").text().trim()+", </br>"+t.description),"Recipient"==$neworder._processedCounterpartyType){var s=$("#cities_ul").find("li.active"),d=s.data("delivery");if(null!=d){var l=s.data("branch"),c={delivery1:d[0],delivery2:d[1],delivery3:d[2],delivery4:d[3],delivery5:d[4],delivery6:d[5],delivery7:d[6],branch:l};$neworder.dateDelivery(c),$neworder._recipientCityDelivery=c}if("true"==i.val()?$("#NumberOfFloorsLifting").val("").addClass("disabled").prop("readonly",!0).attr("tabindex","-1"):$("#NumberOfFloorsLifting").removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),"true"!=i.val()&&$neworder._recipientCityDelivery.branch?$("#SaturdayDelivery").removeClass("disabled").prop("disabled",!1).removeAttr("tabindex"):$("#SaturdayDelivery").prop("checked",!1).addClass("disabled").prop("disabled",!0).attr("tabindex","-1"),$neworder.AfterpaymentOnGoodsCost.showHide(),$neworder._recipientIsLatin){var p=$("#redeliveryTypes > option[value='Money']").index();$("#redeliveryTypes").data("selectBox-selectBoxIt").disableOption(p),p=$("#redeliveryTypesMore > option[value='Money']").index(),$("#redeliveryTypesMore").data("selectBox-selectBoxIt").disableOption(p),$("#SenderPayer").click()}else{var p=$("#redeliveryTypes > option[value='Money']").index();$("#redeliveryTypes").data("selectBox-selectBoxIt").enableOption(p),p=$("#redeliveryTypesMore > option[value='Money']").index(),$("#redeliveryTypesMore").data("selectBox-selectBoxIt").enableOption(p),$("#RecipientPayer").removeClass("disabled").prop("disabled",!1)}$neworder._lookingForCargotypes=1,$("#redeliveryTypes").trigger("change"),$("#redeliveryTypesMore").trigger("change"),$neworder._lookingForCargotypes=0,$neworder.postomat.isSomePostomat(r.typeofwarehouse)?($neworder.postomat.selectWarehouse(),$neworder.postomat.hasMultipleOptionsSeat=!1):($neworder.postomat.unSelectWarehouse(),$neworder.postomat.hasMultipleOptionsSeat=!0),$neworder.DeliveryByHand.setFirstRecipient(a.description),$neworder.OnlineCredit.handler()}if($neworder.DeliveryByHand.needToShowDeliveryByHand(),"Recipient"==$neworder._processedCounterpartyType&&$neworder.getTimeIntervals(e.ref,o),"Sender"==$neworder._processedCounterpartyType){var d=$("#cities_ul").find("li.active").data("delivery");if(null!=d){var c={delivery1:d[0],delivery2:d[1],delivery3:d[2],delivery4:d[3],delivery5:d[4],delivery6:d[5],delivery7:d[6]};$neworder.dateDelivery(c)}"true"==i.val()?($(".cellNumberOfFloorsDescent").hide(),$("#NumberOfFloorsDescent").addClass("disabled").prop("readonly",!0).attr("tabindex","-1").val("")):($("#NumberOfFloorsDescent").removeClass("disabled").prop("readonly",!1).removeAttr("tabindex"),void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.DescentFromFloor?($(".cellNumberOfFloorsDescent").show(),$("#NumberOfFloorsDescent").removeClass("disabled").prop("readonly",!1).removeAttr("tabindex")):($(".cellNumberOfFloorsDescent").hide(),$("#NumberOfFloorsDescent").val("").addClass("disabled").prop("readonly",!0).attr("tabindex","-1"))),void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.CustomerReturn?$(".cellTermExtension").show():$(".cellTermExtension").hide()}$neworder.getCounterpartyOptions(t.ref,n),$neworder.getAllowedAdditionalServices(),$neworder.checkCounterpartyEDRPOU(),$("#selectCounterpartyModal").modal("hide"),1==$("#address_ul .browser_element_main.active").data("customaddress")?($("#NewAddressString").val(1),$("#RecipientAddressNameString").val($("#address_ul .browser_element_main.active").data("descriptionshort")),$("input[name=RecipientAddress]").val(""),$("#RecipientCityNameString").val($("#RecipientCityText").text()),$("#RecipientHouseString").val($("#address_ul .browser_element_main.active").data("buildingname")),$("#RecipientFlatString").val($("#address_ul .browser_element_main.active").data("flatname")),$("#RecipientNameString").val($("#contactFioString").val())):$("#NewAddressString").val(0)}},dateDelivery:function(e){$neworder.setDeliveryDisabledDays(e),$neworder.dateFromAndTo.setRecipientCity(e),$neworder.checkSundayDelivery();var t=$("#PreferredDeliveryDate");if(""!=t.val()){var r=t.val().split("."),a=new Date(r[2],r[1]-1,r[0]-1).getDay()+1;"0"==e["delivery"+a]&&t.val(""),$neworder.getTimeIntervals(e,"")}$("#SaturdayDelivery").prop("disabled",1!=e.delivery6),0==$("#SaturdayDelivery:disabled").length&&"true"==$("#RecipientIsWarehouse").val()&&$("#SaturdayDelivery").prop("disabled","disabled")},setDeliveryDisabledDays:function(e){$("#dateTo").datetimepicker("setDaysOfWeekDisabled",[1==e.delivery7?null:0,1==e.delivery1?null:1,1==e.delivery2?null:2,1==e.delivery3?null:3,1==e.delivery4?null:4,1==e.delivery5?null:5,1==e.delivery6&&e.branch?null:6])},fillSelectedThirdPerson:function(){if($counterpartiesOnly.check_fields_filled()){var e=$counterparties.get_filled_element("cities_ul_counterparty"),t=$counterparties.get_filled_element("counterparties_ul_counterparty"),r=($("#"+$neworder._processedCounterpartyType+"CityRef").val(),$("#"+$neworder._processedCounterpartyType+"CounterpartyRef").val());$("#"+$neworder._processedCounterpartyType+"InfoTable").removeClass("hidden"),$("#"+$neworder._processedCounterpartyType+"CityText").html($("#cities_ul_counterparty").find("li.active").text().trim()),$("#"+$neworder._processedCounterpartyType+"CityRef").val(e.ref),$("#"+$neworder._processedCounterpartyType+"AreaRef").val(e.area),$("#"+$neworder._processedCounterpartyType+"CounterpartyText").html(t.ownershipformdescription+" "+t.description),$("#"+$neworder._processedCounterpartyType+"CounterpartyRef").val(t.ref),$("#"+$neworder._processedCounterpartyType+"SelectButton").text($neworder._processSelectCounterpartyText),$("#"+$neworder._processedCounterpartyType+"Payer").html(Yii.t("newOrder/js","Третье лицо")+": "+$("#cities_ul_counterparty").find("li.active").text().trim()+", </br>"+t.ownershipformdescription+" "+t.description),$neworder.getCounterpartyOptions(t.ref,r,"ThirdPerson"),$neworder.getAllowedAdditionalServices(),$("#selectThirdPersonModal").modal("hide")}},getCounterpartyOptions:function(e,t,r){var a=$neworder;if(e!=t){if(void 0==r&&(r=$neworder._processedCounterpartyType),""==e||void 0==e||"00000000-0000-0000-0000-000000000000"==e)return!1;var o=r,n={Ref:e,Date:$("#DateTime").val(),typeCounterparty:r},i={modelName:"Counterparty",calledMethod:"getCounterpartyOptions",methodProperties:n};$.ajax({data:JSON.stringify(i),beforeSend:function(){$("#progressLoading"+o).show(),$("#"+o+"SelectButton").hide()},success:function(t){if(null!=t&&void 0!=t.success&&t.success===!0){var r=t.data[0];if($neworder._counterpartyOptions[o]=r,"Sender"==o){if($("#RecipientAreaRef").val()==crimeaArea?a.AfterpaymentOnGoodsCost.isCrimeaArea():a.AfterpaymentOnGoodsCost.notCrimeaArea(),r.CanAfterpaymentOnGoodsCost?a.AfterpaymentOnGoodsCost.isOption():a.AfterpaymentOnGoodsCost.notOption(),r.BlockInternationalSenderLKK?$("#wrapBlockInternationalSenderWrapper").show():$("#wrapBlockInternationalSenderWrapper").hide(),r.FillingWarranty?$("tr.cellFillingWarranty").show():$("tr.cellFillingWarranty").hide(),r.CanSameDayDelivery)if($("tr.cellSameDayDelivery").show(),$("#SenderIsWarehouse").val()&&$("#RecipientAddressRef").val()==$("#SenderAddressRef").val()&&"Recipient"==$neworder._processedCounterpartyType)$("#SameDayDelivery").prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1");else{var n=new Date;if(n.getHours()<sameDayDeliveryMaxHour){var i=$("#dateTo");i.datetimepicker("setStartDate",n)}}else $("tr.cellSameDayDelivery").hide(),$("#SameDayDelivery").prop("checked",!1);r.CanForwardingService?$("tr.cellForwardingCount").show():($("tr.cellForwardingCount").hide(),$("#ForwardingCount").val("")),$neworder.DeliveryByHand.needToShowDeliveryByHand(),r.DescentFromFloor&&"true"!=$("#SenderIsWarehouse").val()?($(".cellNumberOfFloorsDescent").show(),$("#NumberOfFloorsDescent").removeClass("disabled").prop("readonly",!1).removeAttr("tabindex")):($(".cellNumberOfFloorsDescent").hide(),$("#NumberOfFloorsDescent").val("").addClass("disabled").prop("readonly",!0).attr("tabindex","-1")),$neworder.PartialReturn.showOptions(),r.PickupService?($(".pickupService").show(),$("#pickupService").removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex"),$("#PickupService").prop("checked",!0).click(),appParameters.hasOwnProperty("predefinedValues")&&0!=appParameters.pickUpServiceBrand.length&&(predefinedValues=appParameters.pickUpServiceBrand,$("#PickupService").prop("checked",!1).click(),$("#PickUpServiceBrand").val(predefinedValues),appParameters.pickUpServiceBrand="")):$("#PickupService").is(":checked")?($(".pickupService").hide(),$("#pickupService").addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1"),$("#PickupService").prop("checked",!0).click()):$(".pickupService").hide(),$neworder.getCustomBackwardDeliveryAddresses(e,"Redelivery","#CustomBackwardDeliveryAddressRef, #AdditionalCustomBackwardDeliveryAddressRef",$("#redeliveryTypes").val()),$neworder.getCustomBackwardDeliveryAddresses(e,"CargoReturn","#CustomReturnAddressRef"),r.CustomerReturn?($(".cellTermExtension").show(),$("#TermExtension").prop("disabled",!1)):($(".cellTermExtension").hide(),$("#TermExtension").prop("disabled",!0)),$neworder.OnlineCredit.handler(),$neworder.Redelivery.checkRestriction(),$neworder._lookingForCargotypes=1,$("#redeliveryTypes").trigger("change"),$neworder.OnlineCredit._lastCounterparty=e,$neworder._lookingForCargotypes=0}$neworder.checkCounterpartyEDRPOU(),"Sender"==$("#PayerType").val()&&"undefined"!=typeof predefinedValues&&predefinedValues.CheckPaymentForDebtor&&$neworder.checkPaymentTypeForSender()}else null!=t&&void 0!=t.success&&t.success===!1?$.each(t.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}):$noty.push(noty(Yii.t("newOrder/js","Ошибка при получении свойств контрагента")))},complete:function(){$("#progressLoading"+o).hide(),$("#"+o+"SelectButton").show(),r&&($neworder.processedCounterpartyType="")}})}},getCustomBackwardDeliveryAddresses:function(e,t,r,a){var o={Ref:e,DocumentType:t,CargoType:a},n={modelName:"Counterparty",calledMethod:"getCustomBackwardDeliveryAddresses",methodProperties:o};$.ajax({data:JSON.stringify(n),beforeSend:function(){},success:function(e){if(null!=e&&void 0!=e.success&&e.success===!0){for(var t=[],a=0;a<e.data.length;a++)t.push({value:e.data[a].Ref,text:e.data[a].Address,"data-city":e.data[a].City,"data-address":e.data[a].Address,"data-counterparty":e.data[a].Counterparty,"data-contactPerson":e.data[a].ContactPerson,"data-phone":e.data[a].Phone,"data-content":"<strong>"+Yii.t("newOrder/index","Адрес")+"</strong>: "+e.data[a].Address+"<br/><strong>"+Yii.t("newOrder/index","Контрагент получатель")+"</strong>: "+e.data[a].Counterparty+"<br/><strong>"+Yii.t("newOrder/index","Контактное лицо")+"</strong>: "+e.data[a].ContactPerson+"<br/><strong>"+Yii.t("newOrder/index","Телефон")+"</strong>: "+e.data[a].Phone,"data-html":"true",rel:"popover"});$(r).each(function(){var e=$(this),r=$("#"+$(this).attr("id")+"Selected");e.data("selectBox-selectBoxIt").remove();var a=Yii.t("newOrder/js","Нет нестандартного возврата");if("CustomBackwardDeliveryAddressRef"==$(this).attr("id")?a=Yii.t("newOrder/js","Нет нестандартной обратной доставки"):"AdditionalCustomBackwardDeliveryAddressRef"==$(this).attr("id")&&(a=Yii.t("newOrder/js","Нет доп. нестандартной обратной доставки")),e.data("selectBox-selectBoxIt").add({value:"",text:a}),0==t.length)e.closest("fieldset").hide();else{for(var o=0;o<t.length;o++)e.data("selectBox-selectBoxIt").add(t[o]);""!=r.val()&&e.data("selectBox-selectBoxIt").selectOption(r.val()),e.data("selectBox-selectBoxIt").refresh(),("CustomBackwardDeliveryAddressRef"==$(this).attr("id")&&""!=$("#redeliveryTypes").val()||"AdditionalCustomBackwardDeliveryAddressRef"==$(this).attr("id")&&""!=$("#redeliveryTypesMore").val()||"CustomReturnAddressRef"==$(this).attr("id"))&&e.closest("fieldset").show()}$(".selectboxit-container").trigger("load")})}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}):$noty.push(noty(Yii.t("newOrder/js","Ошибка при получении нестандарных адрессов обратной доставки")))},complete:function(){}})},getSenderType:function(){var e=$("#SenderIsWarehouse").val(),t="false"==e?"Doors":"true"==e?"Warehouse":"";return t},getRecipientType:function(){var e=$("#RecipientIsWarehouse").val(),t="false"==e?"Doors":"true"==e?"Warehouse":"";return t},getServiceType:function(){return this.getSenderType()+this.getRecipientType()},getTimeIntervals:function(e,t){if(e!=t){var r=$("#PreferredDeliveryDate"),a=$("#TimeInterval"),o=$("#TimeIntervalSelectBoxItContainer"),n=$("#progressLoadingTimeInterval");if(a.addClass("hidden"),o.addClass("hidden"),$("#RecipientCityRef").val()==e&&"true"==$("#RecipientIsWarehouse").val())return;if(""!=r.val()){a.data("selectBox-selectBoxIt").remove();var i={RecipientCityRef:$("#RecipientCityRef").val(),DateTime:$("#PreferredDeliveryDate").val()};$("#SameDayDelivery").is(":checked")&&(new Date).toLocaleString().substring(0,9)==$("#dateFrom").datetimepicker("getDate").toLocaleString().substring(0,9)&&(($("#VolumeWeight").val()>300||$("#Weight").val()>100)&&($("#SameDayDelivery").prop("checked",!1),noty(Yii.t("newOrder/js",'Послуга "Локал Експрес" вимкнена, фактична вага перебільшує 100 кг. або об\'ємна 300 кг. '))),i.SameDayDelivery={Weight:$("#Weight").val(),VolumeWeight:$("#VolumeWeight").val()});var s={modelName:"Common",calledMethod:"getTimeIntervals",methodProperties:i};$.ajax({data:JSON.stringify(s),beforeSend:function(){""!=r.val()&&n.show()},success:function(e){if(null!=e&&void 0!=e.success&&e.success===!0){var t=(e.data,0),n=$("#TimeIntervalSelected");""!=r.val()&&(a.removeClass("hidden"),o.removeClass("hidden")),a.unbind("change"),a.data("selectBox-selectBoxIt").remove(),a.data("selectBox-selectBoxIt").add({hidden:"",disabled:"","class":"hidden",value:"NULL",text:Yii.t("newOrder/js","")}),a.data("selectBox-selectBoxIt").selectOption("NULL"),a.data("selectBox-selectBoxIt").add({value:"",text:Yii.t("newOrder/js","В течении дня")});for(var i=0;i<e.data.length;i++)a.data("selectBox-selectBoxIt").add({value:e.data[i].Number,text:e.data[i].Start+" - "+e.data[i].End}),t=e.data[i].onNextDay;if($("#SameDayDelivery").is(":checked")){if(0==t){var s=$("#DateTime").val(),d=s.split("."),l=new Date(d[2],d[1]-1,d[0]);l.setDate(l.getDate());var c=$("#dateTo");c.datetimepicker("setStartDate",l),c.datetimepicker("setDate",l)}else $neworder.dateFromAndTo.changeDateTo(!0);""===appParameters.en.TimeInterval&&(a.val("").change(),appParameters.en.TimeInterval=null)}else $('#formSaveOrder input[name="DescriptionTemplate"]').val()&&a.val("").change();""!=n.val()&&a.data("selectBox-selectBoxIt").selectOption(n.val()),0==e.data.length||"true"==$("#RecipientIsWarehouse").val()?(a.prop("disabled","disabled"),a.data("selectBox-selectBoxIt").refresh()):(a.prop("disabled",!1),a.data("selectBox-selectBoxIt").refresh()),a.bind("change")}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}):$noty.push(noty(Yii.t("newOrder/js","Ошибка при получении часовых интервалов города получателя")))},complete:function(){n.hide()}})}else a.val(1).change()}},checkCounterpartyEDRPOU:function(){var e=$("#PayerType").val(),t=$("#"+e+"EDRPOU"),r=t.val(),a=$("#"+e+"CounterpartyType").val(),o=$("#PaymentMethod"),n=o.val(),i=$("#"+e+"CityRef").val(),s=$('button.paymentsForms[data-type="NonCash"]');s.prop("disabled",!1).removeClass("disabled");var d=$('button.paymentsForms[data-type="Cash"]');if(void 0!=$neworder._counterpartyOptions[e])if("ThirdPerson"!=e){var l=$counterparties.get_filled_element("address_ul");if(null!=l&&(($neworder.postomat.isPostomatInPost(l.typeofwarehouse)||$neworder.postomat.isPostomatNP(l.typeofwarehouse))&&"Recipient"==e&&($('button.paymentsForms[data-type="NonCash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$('button.paymentsForms[data-type="Cash"]').removeClass("active").prop("disabled",!0).addClass("disabled")),$neworder.postomat.isSomePostomat(l.typeofwarehouse)&&$neworder.getWarehouseParams(l.ref)),!$neworder._counterpartyOptions[e].CanNonCashPayment&&""!=r||"PrivatePerson"==a)return"Cash"!=n?(d.click().addClass("active"),o.val("Cash"),noty(Yii.t("orders/js","Недоступна безготiвкова оплата. Змiнено на готiвку."),3e3,"warning","center")):d.addClass("active"),s.removeClass("active").prop("disabled",!0).addClass("disabled"),!1;if("NonCash"==n&&""==r&&"Sender"!=e){var c=prompt("Код ЕДРПОУ контрагента-платника не введений. Введіть код ЕДРПОУ:");if(null==c||""==c)return d.click().addClass("active"),o.val("Cash"),!1;$neworder.getCounterpartyByEDRPOU(c,i,e)}}else $neworder._counterpartyOptions[e].CanPayTheThirdPerson?($neworder._canPayTheThirdPersonStatus=!0,s.removeClass("disabled").prop("disabled",!1).addClass("active"),o.val("NonCash"),d.removeClass("active").prop("disabled",!0).addClass("disabled"),$("#infoblockTypesOfPayers").text($('button.payerType[class*="active"]').text())):$neworder._canPayTheThirdPersonStatus!==!0&&(s.removeClass("active").prop("disabled",!0).addClass("disabled"),d.removeClass("active").prop("disabled",!0).addClass("disabled"),o.val(""),$("#infoblockTypesOfPayers").text(""));return!0},getCounterpartyByEDRPOU:function(e,t,r){var a=$("#"+r+"CounterpartyText"),o=a.val(),n=$("#"+r+"OwnershipForm"),i=n.val(),s=$("#"+r+"CounterpartyRef").val(),d={EDRPOU:e,CityRef:t},l={modelName:"Counterparty",calledMethod:"getCounterpartyByEDRPOU",methodProperties:d};$.ajax({data:JSON.stringify(l),beforeSend:function(){},success:function(a){if(null!=a&&void 0!=a.success&&a.success===!0){var n=a.data[0].FullName,d=a.data[0].OwnershipForm;(o!=n||i!=d)&&(confirm("Назва та форма власності будуть змінені. Підтвердити?")?$neworder.updateCounterparty(s,t,n,d,e,r):$('button.paymentsForms[data-type="Cash"]').click())}else null!=a&&void 0!=a.success&&a.success===!1?($.each(a.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}),$('button.paymentsForms[data-type="Cash"]').click()):$noty.push(noty(Yii.t("ounterparties/js","Ошибка при получении контрагента")))},complete:function(){}})},updateCounterparty:function(e,t,r,a,o,n){var i=$("#"+n+"EDRPOU"),s=$("#"+n+"CounterpartyText"),d=$("#"+n+"OwnershipForm"),l={Ref:e,CityRef:t,EDRPOU:o,CounterpartyType:"Organization",CounterpartyProperty:n,updateNonCashCounterparty:!0},c={modelName:"Counterparty",calledMethod:"update",modelProperties:l};$.ajax({data:JSON.stringify(c),beforeSend:function(){},success:function(t){if(null!=t&&void 0!=t.success&&t.success===!0){if(i.val(t.data[0].EDRPOU),d.val(t.data[0].OwnershipForm),$neworder._processedCounterpartyType="","undefined"!=typeof t.warnings.DuplicateValidate)return noty(Yii.t("newOrder/js","Контрагент із цим кодом ЕДРПОУ уже існує, виберіть його або введіть інший код ЕДРПОУ")),$neworder.getCounterpartyOptions(e,"",n),void 0;s.text(t.data[0].Description),$neworder.getCounterpartyOptions(e,"",n)}else null!=t&&void 0!=t.success&&t.success===!1?($.each(t.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}),$('button.paymentsForms[data-type="Cash"]').click()):noty(Yii.t("ounterparties/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){}})},PickUpServiceLogic:function(e){e.prop("checked")?($neworder.getPickUpServiceBrands(),$(".PickUpServiceBrand").show()):($("#PickUpServiceBrand").empty(),$("#PickUpServiceBrand").append($("<option>",{value:"",text:"Оброблення ..."})),$(".PickUpServiceBrand").hide(),$neworder.UnSetThirdPersonPayerType())},UnSetThirdPersonPayerType:function(){$("#SenderPayer").removeClass("disabled").prop("disabled",!1).click(),$("#RecipientPayer").removeClass("disabled").prop("disabled",!1),$("#ThirdPersonPayer").removeClass("disabled").prop("disabled",!1),$("#selectThirdPersonBlock").slideUp("fast"),$("#ThirdPersonSelectButton").removeClass("disabled").prop("disabled",!1)},SetThirdPersonPayerType:function(){var e=_PickUpServiceBrand[$("#PickUpServiceBrand").val()];$("#selectThirdPersonBlock").slideDown("fast"),$("#infoblockPaymentsForms").text($('button.paymentsForms[class*="active"]').text()),$("#ThirdPersonInfoTable").removeClass("hidden"),$("#ThirdPersonCityText").html($("#SenderCityText").html()),$("#ThirdPersonCounterpartyText").html(e.ThirdPersonDescription),$("#ThirdPersonCounterpartyRef").val(e.ThirdPerson),$("#ThirdPersonPayer").click(),$("#RecipientPayer").removeClass("active").prop("disabled",!0).addClass("disabled"),$("#SenderPayer").removeClass("active").prop("disabled",!0).addClass("disabled"),$("#ThirdPersonSelectButton").removeClass("active").prop("disabled",!0).addClass("disabled")},getPickUpServiceBrands:function(){var e={Sender:$("#SenderCounterpartyRef").val(),CitySender:$("#SenderCityRef").val()},t={modelName:"Counterparty",calledMethod:"getPickupBrandsList",methodProperties:e};$.ajax({data:JSON.stringify(t),beforeSend:function(){},success:function(e){null!=e&&void 0!=e.success&&e.success===!0?(_PickUpServiceBrand={},$("#PickUpServiceBrand").empty(),$.each(e.data,function(e,t){_PickUpServiceBrand[t.Ref]=t,$("#PickUpServiceBrand").append($("<option>",{value:t.Ref,text:t.Description}))}),$("#PickUpServiceBrand option").length>0?$neworder.SetThirdPersonPayerType():($("#PickupService").prop("checked",!0).click(),noty(Yii.t("Counterparties/js","Даного контрагента немає в довідниках Pickup сервісів.")))):null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))
}):noty(Yii.t("Counterparties/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){}})},getCounterpartyBackwardDeliveryCargoTypes:function(e){var t={CounterpartyRef:e,Date:$("#DateTime").val()},r={modelName:"Common",calledMethod:"getBackwardDeliveryCargoTypes",methodProperties:t};$.ajax({data:JSON.stringify(r),beforeSend:function(){$neworder._lookingForCargotypes=1},success:function(e){if(null!=e&&void 0!=e.success&&e.success===!0){var t=$("#redeliveryTypes"),r=$("#redeliveryTypesMore"),a=t.val(),o=r.val();t.data("selectBox-selectBoxIt").remove(),r.data("selectBox-selectBoxIt").remove(),t.data("selectBox-selectBoxIt").add({value:"",text:Yii.t("newOrder/js","Нет обратной доставки")}),r.data("selectBox-selectBoxIt").add({value:"",text:Yii.t("newOrder/js","Нет доп. обратной доставки")});for(var n=0;n<e.data.length;n++)t.data("selectBox-selectBoxIt").add({value:e.data[n].Ref,text:e.data[n].Description}),r.data("selectBox-selectBoxIt").add({value:e.data[n].Ref,text:e.data[n].Description});t.data("selectBox-selectBoxIt").selectOption(a),r.data("selectBox-selectBoxIt").selectOption(o)}else null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}):noty(Yii.t("ounterparties/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){$neworder._lookingForCargotypes=0}})},getPredefinedValues:function(){if(appParameters.hasOwnProperty("predefinedValues")&&0!=appParameters.predefinedValues.length)predefinedValues=appParameters.predefinedValues,$neworder.initPredefinedValues();else{var e={},t={modelName:"CommonGeneral",calledMethod:"getPredefinedValues",methodProperties:e};$.ajax({data:JSON.stringify(t),beforeSend:function(){},success:function(e){null!=e&&void 0!=e.success&&e.success===!0&&(predefinedValues=e.data[0],$neworder.initPredefinedValues())},complete:function(){}})}},initPredefinedValues:function(){void 0!=predefinedValues.MetroVolumetricOrderCost&&""==$("#cost").val()&&$("#cost").val(predefinedValues.MetroVolumetricOrderCost)},getWarehouseParams:function(e){var t={IRef:e},r={modelName:"AddressGeneral",calledMethod:"getWarehouses",methodProperties:t};$.ajax({data:JSON.stringify(r),beforeSend:function(){},success:function(e){if(null!=e&&void 0!=e.success&&e.success===!0){var t=e.data[0];$neworder.checkWarehousePaymentAccess(t)}},complete:function(){}})},checkWarehousePaymentAccess:function(e){$neworder.AfterpaymentOnGoodsCost.noPaymentAccess(),void 0!=e.PaymentAccess&&1==e.PaymentAccess&&($("#RecipientPayer").removeClass("disabled").prop("disabled",!1),$("#SenderPayer").removeClass("disabled").prop("disabled",!1),$("#ThirdPersonPayer").removeClass("disabled").prop("disabled",!1),$('button.paymentsForms[data-type="NonCash"]').removeClass("disabled").prop("disabled",!1),$('button.paymentsForms[data-type="Cash"]').removeClass("disabled").prop("disabled",!1),$neworder.AfterpaymentOnGoodsCost.hasPaymentAccess(),$("#SaturdayDelivery").removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex"))},payTSRedelivery:function(e,t,r,a){var o=e,n=/^4/;if(0==o.search(n))var i="icVisaLogo32.png";else var i="icMastercardLogo32.png";cards='<div class = "leftstr payByCard" style = "margin-right:0"><input name = "aliasVal" type = "hidden" value = "'+r+'"><input name = "retRefVal" type = "hidden" value = "'+t+'"><input name = "sidVal" type = "hidden" value = "'+a+'"><input name = "panVal" type = "hidden" value = "'+e+'"><div class = "inline" ><input id = "hideVal" type = "hidden" value = "'+r+'"><img src="/public/img/'+i+'"></div><div class = "inline" style = "padding: 0 0 9px 0;"><span style = "font-size: 12px;"> '+r+'</span></div></div><div class = "rightstr"><p class = "payByCard">'+e+'&nbsp; <input style = "font-size: 11px;" id = "hideVal" type = "hidden" value = "'+r+'"> </p>  <p id = "hideDataCard"><img src="/public/img/icDelete.png">  </p></div>',$("#taskLinkFrame").html('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><iframe id = "TSframe" src="'+tasLink+"?register="+a+'"> </iframe>'),$("#dataCardRedelivery").html(cards),$("#payCardModalRedelivery").modal("hide"),$(".showCardsRedelivery").addClass("hide")},dateFromAndTo:{cityResipient:null,init:function(){var e=new Date,t=new Date;t.setFullYear(e.getFullYear()+1);var r,a=$("#dateFrom"),o=a.datetimepicker({startDate:new Date,endDate:t,autoclose:!0,minView:2,maxView:3,todayBtn:!0,todayHighlight:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1}),n=$("#DateTime");if(""==n.val())r=new Date;else{var i=n.val().split(".");r=new Date(i[2],i[1]-1,i[0]-1)}r.setHours(r.getHours()+48);var s=new Date(r);s.setHours(r.getHours()+24*$configBox.appParameters.PreferredDeliveryDate);var d=$("#dateTo"),l=d.datetimepicker({autoclose:!0,minView:2,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1});$neworder.dateFromAndTo.changeDateTo(),o.on("changeDate",function(){$neworder.dateFromAndTo.changeDateTo(!0)}),l.on("changeDate",function(e){if(e.date){var t=e.date,r=new Date;t.getDate()==r.getDate()&&t.getMonth()==r.getMonth()&&t.getFullYear()==r.getFullYear()&&"readonly"!=$("#SameDayDelivery").prop("readonly")?$("#SameDayDelivery").prop("checked",!0):$("#SameDayDelivery").prop("checked",!1)}})},setRecipientCity:function(e){$neworder.dateFromAndTo.cityResipient=e,$neworder.dateFromAndTo.changeDateTo()},changeDateTo:function(e){var t=$("#DateTime").val().split("."),r=new Date(t[2],t[1]-1,t[0]-1),a=new Date(t[2],t[1]-1,t[0]-1);r.setHours(r.getHours()+48);var o=!1,n=!1;if($neworder.dateFromAndTo.cityResipient&&(o=!0,$.each($neworder.dateFromAndTo.cityResipient,function(e,t){0!=t&&-1!==e.indexOf("delivery")&&(n=!0)})),o&&n)for(var i=null,s=$configBox.appParameters.PreferredDeliveryDate+1;s>0;)i=a.getDay(),i+=1,1==$neworder.dateFromAndTo.cityResipient["delivery"+i]&&(s-=1),a.setHours(a.getHours()+24);else a.setHours(a.getHours()+24*($configBox.appParameters.PreferredDeliveryDate+1));var d=$("#dateTo");d.datetimepicker("setStartDate",r),d.datetimepicker("setEndDate",a),""!=$("#PreferredDeliveryDate").val()&&e&&d.datetimepicker("setDate",r),d.datetimepicker("update")}},postomat:{isPostomat:!1,loadСompensation:!1,hasMultipleOptionsSeat:!1,fulfilment:{},init:function(){$configBox.appParameters.en&&$configBox.appParameters.en.RecipientTypeOfWarehouse&&$neworder.postomat.isSomePostomat($configBox.appParameters.en.RecipientTypeOfWarehouse)?($neworder.postomat.selectWarehouse(!0),$configBox.appParameters.en.OptionsSeat&&$configBox.appParameters.en.OptionsSeat[0]&&($neworder.Width.$value.val($configBox.appParameters.en.OptionsSeat[0].volumetricWidth),$neworder.Length.$value.val($configBox.appParameters.en.OptionsSeat[0].volumetricLength),$neworder.Height.$value.val($configBox.appParameters.en.OptionsSeat[0].volumetricHeight),$neworder.Weight._$Weight.removeAttr("readonly").val($configBox.appParameters.en.Weight)),$neworder.postomat.hasMultipleOptionsSeat=!1):$neworder.postomat.hasMultipleOptionsSeat=!0},selectWarehouse:function(e){var t=$neworder.postomat,r=$neworder;t.isPostomat=!0,t.fulfilment.selectWarehouse||(t.fulfilment.selectWarehouse=!0),t.fulfilment.selectWarehouse&&t.hideCargo(e),r.AfterpaymentOnGoodsCost.isPostomat(),$neworder.CargoTypes._$CargoTypes.change(function(){"Cargo"!=$(this).val()&&"Parcel"!=$(this).val()?($neworder.Weight._$Weight.attr("name","Weight"),$neworder.VolumeWeight._$VolumeWeight.removeAttr("readonly").val("")):("Cargo"==$(this).val()||"Parcel"==$(this).val())&&$neworder.Weight._$Weight.attr("name","OptionsSeat[0][weight]")});var a=$counterparties.get_filled_element("address_ul");!e&&$neworder.postomat.isPostomatPB(a.typeofwarehouse)&&$("#messageOptionsPostomatPBButton").click(),null!=a&&($neworder.postomat.isPostomatInPost(a.typeofwarehouse)||$neworder.postomat.isPostomatNP(a.typeofwarehouse))&&$("#RecipientPayer").removeClass("active").prop("disabled",!0).addClass("disabled")},unSelectWarehouse:function(){var e=$neworder.postomat,t=$neworder;e.fulfilment.selectWarehouse&&e.showCargo(),e.isPostomat=!1,t.SeatsAmount.unsetOneSeatDisable(),t.OptionsSeat.setDefaultMaxRows(),t.AfterpaymentOnGoodsCost.notPostomat(),$neworder._recipientIsLatin||$("#RecipientPayer").prop("disabled",!1).removeClass("disabled")},hideCargo:function(e){var t=function(e){var t=$("#fieldsetBlockBackwardDelivery");t.find("select").val("").change();for(var r=$("#redeliveryTypes > option[value!='']").length,a=$("#redeliveryTypes > option[value='Money']").index(),o=$counterparties.get_filled_element("address_ul"),n=r;n>0;n--)n!=a&&$("#redeliveryTypes").data("selectBox-selectBoxIt").disableOption(n),null!=o&&($neworder.postomat.isPostomatInPost(o.typeofwarehouse)||$neworder.postomat.isPostomatNP(o.typeofwarehouse))&&$("#redeliveryTypes").data("selectBox-selectBoxIt").disableOption(n),e&&($neworder.postomat.isPostomatInPost($configBox.appParameters.en.RecipientTypeOfWarehouse)||$neworder.postomat.isPostomatNP($configBox.appParameters.en.RecipientTypeOfWarehouse))&&$("#redeliveryTypes").data("selectBox-selectBoxIt").disableOption(n);for(var n=($("#redeliveryTypesMore > option[value!='']").length,r);n>0;n--)$("#redeliveryTypesMore").data("selectBox-selectBoxIt").disableOption(n);e&&$configBox.appParameters.en.BackwardDeliveryData&&$configBox.appParameters.en.BackwardDeliveryData[0]&&$configBox.appParameters.en.BackwardDeliveryData[0].RedeliveryString&&($("#redeliveryTypes").val("Money").change(),$("#moneyTable .backwardDeliveryMoney").val($configBox.appParameters.en.BackwardDeliveryData[0].RedeliveryString))};setTimeout(function(){$neworder.postomat.fulfilment.selectWarehouse&&t(e)},3500),t();var r=$("#cargoTypes"),a=r.find("option");"Cargo"!=r.val()&&"Parcel"!=r.val()&&"Documents"!=r.val()&&r.val("Cargo").change();var o=r.data("selectBox-selectBoxIt");if(a.each(function(e){"Cargo"!=$(this).val()&&"Parcel"!=$(this).val()&&"Documents"!=$(this).val()&&o.disableOption(e)}),$neworder.postomat.isPostomat=!0,"Cargo"==r.val()||"Parcel"==r.val()){$neworder.OptionsSeat.hideOptionsSeatButton();var n=$neworder.VolumeGeneral._$VolumeGeneral.val();r.change(),$neworder.Weight._$Weight.attr("name","OptionsSeat[0][weight]"),$neworder.VolumeWeight._$VolumeWeight.attr("readonly","readonly").val(""),$neworder.VolumeGeneral._$VolumeGeneral.attr("readonly","readonly").val(n),$neworder.SeatsAmount._$SeatsAmount.attr("readonly","readonly").val(1)}},showCargo:function(){for(var e=$("#redeliveryTypes > option[value!='']").length,t=e;t>0;t--)$("#redeliveryTypes").data("selectBox-selectBoxIt").enableOption(t);for(var t=($("#redeliveryTypesMore > option[value!='']").length,e);t>0;t--)$("#redeliveryTypesMore").data("selectBox-selectBoxIt").enableOption(t);$("#AfterpaymentOnGoodsCost").removeAttr("readonly");var r=$("#cargoTypes"),a=r.find("option"),o=r.data("selectBox-selectBoxIt");a.each(function(e){o.enableOption(e)});var n=$("#blockTypeCompensationPB");n.hide(),n.find("select").val("").change(),$neworder.postomat.isPostomat=!1,$neworder.OptionsSeat.showOptionsSeatButton(),$neworder.Weight._$Weight.attr("name","Weight"),$neworder.VolumeWeight._$VolumeWeight.removeAttr("readonly").val(""),r.change()},isPostomatPB:function(e){return e==$configBox.appParameters.TypesOfWarehouses_PostomatPB?!0:!1},isPostomatInPost:function(e){return e==$configBox.appParameters.TypesOfWarehouses_PostomatInPost?!0:!1},isPostomatNP:function(e){return e==$configBox.appParameters.TypesOfWarehouses_PostomatNP?!0:!1},isSomePostomat:function(e){return $neworder.postomat.isPostomatPB(e)||$neworder.postomat.isPostomatInPost(e)||$neworder.postomat.isPostomatNP(e)?!0:!1}},checkPaymentTypeForSender:function(){void 0!=$neworder._counterpartyOptions.Sender&&$neworder._counterpartyOptions.Sender.CanNonCashPayment?($('button.paymentsForms[data-type="NonCash"]').removeClass("disabled").prop("disabled",!1).addClass("active"),$('button.paymentsForms[data-type="Cash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$("#PaymentMethod").val("NonCash")):($('button.paymentsForms[data-type="NonCash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$('button.paymentsForms[data-type="Cash"]').removeClass("disabled").prop("disabled",!1).addClass("active"),$("#PaymentMethod").val("Cash"))},PartialReturn:{_$checkbox:$("#PartialReturn"),_$block:null,_$buttonBlock:$(".cellPartialReturn"),_$button:$("#buttonPartialReturn"),_$modal:$("#selectPartialReturnModal"),_$select:$(".blockPartialReturnList"),_$modalClone:null,_$selectClone:null,_$GoodsCount:0,_$inputs:null,_$jsonInput:$("#PartialReturnGoods"),_inputPrefix:"Goods",_maxRows:10,_cellNames:{goods_name:"Name",goods_price:"Price",goods_amount:"Amount",goods_barcode:"Barcode",goods_condition:"Condition",goods_condition_value:"ConditionValue"},_clear:function(){this._$block.html(""),this._$modal.data("goods","false"),$neworder.PartialReturn._$jsonInput.val("")},_generateBlock:function(e){$neworder.PartialReturn;this._$block.html("");var t=0;if(e>0)for(;e>t;t++)this._generateInputs(t);$neworder.PartialReturn._$GoodsCount=t},_generateInputs:function(e){var t=$neworder.PartialReturn._$selectClone.clone();t.find("td:first").html(1+e),$neworder.PartialReturn._generateInputNames(t,e),this._$block.append(t)},_generateInputNames:function(e,t){$.each($neworder.PartialReturn._cellNames,function(r,a){e.find("."+r).attr("name","Goods["+t+"]["+a+"]")})},_addRow:function(){var e=($neworder.PartialReturn,$neworder.PartialReturn._$select);if(!e.find(".addRow").length){var t=$neworder.PartialReturn._$selectClone.clone();t.find("td:first").html('<i class="icon-plus"></i>'),t.find("input").removeAttr("name"),t.addClass("addRow"),this._$block.append(t),this._$block.find(".-custom-select").addClass("custom-select"),$main.activeMenu(),$("input.mask-integer").mask("99999999999999")}},_getInputs:function(e){var t=$neworder.PartialReturn;return(e||null==$neworder.PartialReturn._$inputs)&&(t._$inputs=t._$select.find(":input")),t._$inputs},_getValues:function(){var e=[];return $neworder.PartialReturn._getInputs(!0).each(function(){var t=/^Goods\[(\d+)]\[(\w+)]$/.exec($(this).attr("name"));if(t){var r=t[1],a=t[2];void 0==e[r]&&(e[r]={}),e[r][a]=$(this).val()}}),e},_setJSON:function(){var e=$neworder.PartialReturn._getValues();$neworder.PartialReturn._$jsonInput.val(JSON.stringify(e))},calculateTotal:function(){var e=0;return $neworder.PartialReturn._$GoodsCount>0&&($neworder.PartialReturn._$modal.data("goods","true"),$neworder.PartialReturn._$modal.find("input.goods_price").each(function(){var t=$(this).val(),r=$(this).closest("tr").find("input.goods_amount").val();""!=t&&""!=r&&(e+=parseInt(t)*parseInt(r))})),e},calculateAmount:function(){var e=0;return $neworder.PartialReturn._$GoodsCount>0&&$neworder.PartialReturn._$modal.find("input.goods_amount").each(function(){var t=$(this).val();""!=t&&(e+=parseInt(t))}),e},setSum:function(){var e=$neworder.PartialReturn.calculateTotal(),t=$neworder.Cost._$Cost;t.val(e).prop("readonly",!0);var r=$("#PartialReturnAfterPaymentInput").val();"AfterPayment"==r?$neworder.AfterpaymentOnGoodsCost._$AfterpaymentOnGoodsCost.val(e).prop("readonly",!0).trigger("change"):($("#redeliveryTypes").val("Money").trigger("change"),$(".backwardDeliveryMoney").eq(0).val(e).trigger("change"))},setTotal:function(){var e=$neworder.PartialReturn.calculateAmount(),t=$neworder.PartialReturn.calculateTotal();$(".js-pr-total-amount").text(e),$(".js-pr-total-sum").text(t)},init:function(e){this._$selectClone=this._$select.find("tbody tr:first").clone();var t,r=$neworder.PartialReturn._$select,a=$neworder.PartialReturn._$button,o=this._$modal.find(".select.btn"),n=this._$modal.find(".cancel.btn");this._$block=$neworder.PartialReturn._$select.find("tbody"),$neworder.PartialReturn._$select.find("tbody tr:first").remove();var i;$neworder.PartialReturn._$checkbox.change(function(){$(this).is(":checked")?$neworder.PartialReturn._$button.removeClass("disabled").data("toggle","modal"):($neworder.PartialReturn._$button.addClass("disabled").data("toggle","_modal"),$neworder.AfterpaymentOnGoodsCost._$AfterpaymentOnGoodsCost.prop("readonly",!1).trigger("change"))}),$neworder.PartialReturn.showOptions(),$neworder.PartialReturn._$checkbox.trigger("change"),r.on("keydown change",".addRow :input",function(){$neworder.PartialReturn._$GoodsCount++;var e=r.find(".addRow");e.find("td:first").html($neworder.PartialReturn._$GoodsCount),$neworder.PartialReturn._generateInputNames(e,$neworder.PartialReturn._$GoodsCount-1),e.find("input").unbind("keydown change"),e.removeClass("addRow"),$neworder.PartialReturn._$GoodsCount<$neworder.PartialReturn._maxRows&&$neworder.PartialReturn._addRow()}),a.click(function(e){if($(this).hasClass("disabled"))return e.preventDefault(),!1;$neworder.PartialReturn;return $neworder.PartialReturn._$modal.modal({show:!1,keyboard:!1}),$neworder.fillInputValues4JqueryHTML(r),t=$neworder.PartialReturn._$block.html(),$neworder.PartialReturn._addRow(),$neworder.PartialReturn._$GoodsCount=$neworder.PartialReturn._$select.find(".goods_name").length-1,$neworder.PartialReturn._$modal.modal("show"),$neworder.PartialReturn._$select.trigger("change"),!1}),$neworder.PartialReturn._$select.on("click",".removeRow",function(){$(this).closest("tr").detach(),$neworder.PartialReturn._$GoodsCount=0,$neworder.PartialReturn._$block.find('tr[class!="addRow"]').each(function(e){$(this).find("td:first").html(1+e),$neworder.PartialReturn._generateInputNames($(this),e),$neworder.PartialReturn._$GoodsCount++}),$neworder.PartialReturn._addRow(),$neworder.PartialReturn._$select.trigger("change")}),$neworder.PartialReturn._$select.on("click",".clearRow",function(){$(this).closest("tr").find("input").val(""),$neworder.PartialReturn._$select.trigger("change")}),e.on("change",".goods_condition",function(){var e=$(this).val();if(i=$(this).closest("tr").find(".goods_condition_value"),nameCurrent=$(this).closest("tr").find(".goods_name").val(),"CostFrom"==e){var t=Yii.t("newOrder/js","PARTIAL_RETURN_CONDITION_COST_NOTE",{name:nameCurrent});$("#PartialReturnConditionCost .note").text(t),$("#PartialReturnConditionCost").modal()}else if("TogetherWith"==e){var t=Yii.t("newOrder/js","PARTIAL_RETURN_CONDITION_TOGETHER_NOTE",{name:nameCurrent});$("#PartialReturnConditionTogether .note").text(t);var r="";$neworder.PartialReturn._$select.find("input.goods_name").each(function(){var e=$(this).val(),t=$(this).closest("tr").find("input.goods_barcode").val();""!=e&&""!=t&&e!=nameCurrent&&(r+='<li class="browser_element_main"><a data-name="'+e+'">'+e+"<span>"+t+"</span></a></li>")}),r&&($("#PartialReturnConditionTogether").find(".goods").html(r),$("#PartialReturnConditionTogether").modal())}else i.val("")}),$("#checkPartialReturnConditionCost").on("click",function(){var e=$("#PartialReturnConditionCostValue"),t=e.val(),r=$neworder.PartialReturn.calculateTotal(),a=i.closest("tr"),o=a.find("input.goods_price").val(),n=a.find("input.goods_amount").val();return""!=o&&""!=n&&(r-=parseInt(o)*parseInt(n)),t>r?(noty(Yii.t("newOrder/js","Частичный возврат. Указана большая сумма в условии"),3e3,"error","center"),!1):(e.val(""),i.val(t),i.addClass("mask-integer"),$("input.mask-integer").mask("99999999999999"),void 0)}),e.on("click","#PartialReturnConditionTogether .nav li",function(){$(this).hasClass("disabled")||($("#PartialReturnConditionTogether .nav li.active").removeClass("active"),$(this).addClass("active"))}),$("#checkPartialReturnConditionTogether").on("click",function(){var e=$("#PartialReturnConditionTogether .nav li.active a").data("name");i.val(e),i.removeClass("mask-integer")}),$("button.PartialReturnAfterPaymentButton").click(function(){$("#PartialReturnAfterPaymentInput").val($(this).data("type"))}),$("#checkPartialReturnAfterPayment").click(function(){$neworder.PartialReturn.setSum()}),o.click(function(){var e=$neworder.PartialReturn._getValues(),t={PartialReturnGoods:e},r={modelName:"InternetDocument",calledMethod:"PartialReturnGoodsValidate",methodProperties:t};$.ajax({data:JSON.stringify(r),beforeSend:function(){$("#progressLoadingForm").show()},success:function(e){e.errors.length?$.each(e.errors,function(t,r){"undefined"!=typeof e.info[r]?$.each(e.info[r],function(e,t){noty(Yii.t("newOrder/js",r)+" №"+(t+1),3e3,"error","center")}):noty(Yii.t("newOrder/js",r),3e3,"error","center")}):($neworder.PartialReturn._$modal.modal("hide"),$neworder._counterpartyOptions.Sender.CanAfterpaymentOnGoodsCost?$("#PartialReturnAfterPayment").modal():$neworder.PartialReturn.setSum())},complete:function(){$("#progressLoadingForm").hide()}})}),n.on("click",function(){$neworder.PartialReturn._$block.html(t),$neworder.PartialReturn._$GoodsCount=$neworder.PartialReturn._$select.find(".goods_name").length}),$neworder.PartialReturn._$select.on("change",function(){$neworder.PartialReturn.setTotal(e)});var s=[$neworder.CargoReturnValidateFields._$CargoReturnValidateFields,$neworder.CargoTypes._$CargoTypes,$neworder.Weight._$Weight,$neworder.VolumeWeight._$VolumeWeight,$neworder.SeatsAmount._$SeatsAmount];s.reduce($.merge).change(function(){$neworder.PartialReturn.showOptions()})},showOptions:function(){if($neworder._counterpartyOptions&&$neworder._counterpartyOptions.Sender){var e=$neworder.CargoTypes._$CargoTypes.val();if($neworder.postomat.isPostomat||"Cargo"!=e&&"Parcel"!=e||$neworder.VolumeWeight._$VolumeWeight.val()>5||$neworder.Weight._$Weight.val()>5||"false"==$("#RecipientIsWarehouse").val()||!$("#RecipientAddressRef").val()||$neworder.SeatsAmount._$SeatsAmount.val()>1)return $neworder.PartialReturn.hideOptions(),void 0;$neworder.PartialReturn._$buttonBlock.show(),$neworder.PartialReturn._$checkbox.removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex")}},hideOptions:function(){$neworder.PartialReturn._$buttonBlock.hide(),$neworder.PartialReturn._$checkbox.prop("checked",!1).addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1")}},Redbox:{_active:!0,_$Redbox:$("#RedBoxBarcode"),init:function(){$neworder.Redbox._$Redbox.on("change",function(){$neworder.Weight.handler(),$neworder.VolumeGeneral.handler(),$neworder.SeatsAmount.handler()}),$neworder.CargoTypes.setChange("Redbox",$neworder.Redbox.handler),$neworder.Redbox.handler()},handler:function(){var e=$neworder.Redbox,t=e._$Redbox,r=!0;"Parcel"!=$neworder.CargoTypes._$CargoTypes.val()&&(r=!1),r!=e._active&&(e._active=r,r?t.removeClass("disabled").prop("disabled",!1).prop("readonly",!1).removeAttr("tabindex"):t.addClass("disabled").prop("disabled",!0).prop("readonly",!0).attr("tabindex","-1"))}},OnlineCredit:{_$block:$(".cellOnlineCredit"),_$checkbox:$("#OnlineCredit"),_lastCounterparty:null,init:function(){$neworder.OnlineCredit._$checkbox.change(function(){$(this).is(":checked")?($("#redeliveryTypes").val("CreditDocuments").trigger("change"),$("#SenderRedeliveryPayer").trigger("click")):"CreditDocuments"==$("#redeliveryTypes").val()&&$("#redeliveryTypes").val("").trigger("change"),$neworder.Redelivery.checkRedeliveryTypes()})},show:function(){$neworder.OnlineCredit._$checkbox.removeClass("disabled").prop("readonly",!1).prop("disabled",!1).removeAttr("tabindex"),$neworder.OnlineCredit._$block.show()},hide:function(){$neworder.OnlineCredit._$checkbox.prop("checked",!1).trigger("change").addClass("disabled").prop("readonly",!0).prop("disabled",!0).attr("tabindex","-1"),$neworder.OnlineCredit._$block.hide()},handler:function(){var e=$neworder.OnlineCredit,t=!0;(void 0==$neworder._counterpartyOptions.Sender||!$neworder._counterpartyOptions.Sender.CanCreditDocuments||"false"==$("#RecipientIsWarehouse").val()||$neworder.postomat.isPostomat)&&(t=!1),t!=e._active&&(e._active=t,t?e.show():e.hide())}},proxyValidate:function(e){e.url="/newOrder/validate",$neworder.proxy(e)},proxy:function(e){if(e.cacheKey=$neworder.makeCacheKey(e),"undefined"!=typeof $neworder.proxyCache[e.cacheKey])return e.callback.success&&e.callback.success($neworder.proxyCache[e.cacheKey]),void 0;if(!$neworder.isInBuffer(e)){$neworder.insertInBuffer(e),$neworder.clearTimeout(e);var t=setTimeout(function(e){return function(){var t=$neworder.fillRequest(e),r=JSON.stringify($.map($neworder.proxyRequest[t],function(e){return{calledMethod:e.calledMethod,methodProperties:e.methodProperties}}));$.ajax({url:e.url,data:r,beforeSend:function(){},success:function(e){"object"==typeof e&&$.each(e,function(e,r){var a=$neworder.proxyRequest[t][e];$neworder.proxyCache[a.cacheKey]=r,a.callback.success&&a.callback.success(r)})},complete:function(){$neworder.proxyRequest[t]=null}})}}(jQuery.extend(!0,{},e)),1e3);$neworder.addTimeout(e,t)}},clearBuffer:function(e){$neworder.proxyBuffer[e.url]={}},insertInBuffer:function(e){"undefined"==typeof $neworder.proxyBuffer[e.url]&&($neworder.proxyBuffer[e.url]={}),$neworder.proxyBuffer[e.url][e.calledMethod]=e},isInBuffer:function(e){var t="object"==typeof $neworder.proxyBuffer[e.url]&&"object"==typeof $neworder.proxyBuffer[e.url][e.calledMethod];return t},fillRequest:function(e){return $neworder.proxyRequest.push($neworder.proxyBuffer[e.url]),$neworder.clearBuffer(e),$neworder.proxyRequest.length-1},makeCacheKey:function(e){return e.calledMethod+"-"+JSON.stringify(e.methodProperties)},clearTimeout:function(e){"undefined"!=typeof $neworder.proxyTimeOut[e.url]&&$neworder.proxyTimeOut[e.url]&&clearTimeout($neworder.proxyTimeOut[e.url])},addTimeout:function(e,t){$neworder.proxyTimeOut[e.url]=t},fillInputValues4JqueryHTML:function(e){e.find("input, select, textarea").each(function(){var e=$(this);e.is("[type='radio']")||e.is("[type='checkbox']")?e.prop("checked")?e.attr("checked","checked"):e.removeAttr("checked"):e.is("select")?e.find(":selected").attr("selected","selected"):e.attr("value",e.val())})},proxyBuffer:{},proxyRequest:[],proxyCache:{},proxyTimeOut:{}};
$orders={_processedCounterpartyType:"",_processSelectCounterpartyText:"",_counterpartyOptions:{},_filterId:"",_filterCounterpartyId:"",init:function(){var e=$("body");$orders.$choosePrintStartOld=$(".choosePrintStartOld"),$orders.$choosePrintStartNew=$(".choosePrintStartNew"),e.on("click","table.ordersList a.btn, table.ordersList input.orderCheckbox, table.templatesList a.btn, table.templatesList input.orderCheckbox",function(e){e.stopPropagation()}),e.on("click","input.orderCheckbox",function(){$orders.selectRow($(this).closest("tr.ordersList"),!0)}),e.on("click","tr.ordersList",function(){$orders.selectRow($(this))}),e.on("click","div.my_small",function(){$orders.selectRow($(this).closest("tr.ordersList"))}),e.on("click","input.orderCheckAll",function(){var e=$(this),t=e.closest("table");t.find("input.orderCheckbox:visible").prop("checked",e.prop("checked")),t.find("tr.ordersList:visible").toggleClass("active",e.prop("checked")),t.find("input.orderCheckAll").prop("checked",e.prop("checked"))}),e.on("click","a.removeTtn",function(e){var t=$(this),r=[];r.push(t.data("ref")),$orders.removeTtn(r,"InternetDocument"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.removeTtnPack",function(e){var t=$("input.orderCheckbox:checked"),r=[];$.each(t,function(e,t){r.push($(t).closest("tr").attr("id"))}),$orders.removeTtn(r,"InternetDocument"),e.preventDefault(),e.stopPropagation()}),e.on("click",".generateReportXLS",function(e){var t=$(".ordersForm"),r=t.attr("action"),o=$('input[name="DateTime"]');""!=o.val()&&null!==o.val()?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/generateReport",{type:"xls"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала выберите дату за которую формировать отчёт"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click",".generateReportCSV",function(e){var t=$(".ordersForm"),r=t.attr("action"),o=$('input[name="DateTime"]');""!=o.val()&&null!==o.val()?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/generateReport",{type:"csv"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала выберите дату за которую формировать отчёт"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click",".getCatalogWarehouses",function(e){var t=$(".ordersForm"),r=t.attr("action");$orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/getCatalogs",{type:"Warehouses"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0,e.preventDefault(),e.stopPropagation()}),e.on("click",".columnSettings",function(){$("#columnSettingsModal").modal("show")}),$("#columnViewSave").click(function(){$("#columnSettingsModal").modal("hide"),e.modalmanager("loading"),$("#columnSettingsForm").submit()}),e.on("click","a.removeTemplate",function(e){var t=$(this),r=[];r.push(t.data("ref")),$orders.removeTtn(r,"InternetDocumentTemplate"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.removeTemplatePack",function(e){var t=$("input.orderCheckbox:checked"),r=[];$.each(t,function(e,t){r.push($(t).closest("tr").attr("id"))}),$orders.removeTtn(r,"InternetDocumentTemplate"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.showRelatedDocuments",function(){var t=$(this),r={DocumentNumber:t.data("number")},o={modelName:"InternetDocument",calledMethod:"getRelatedDocuments",methodProperties:r};$.ajax({data:JSON.stringify(o),beforeSend:function(){e.modalmanager("loading")},success:function(e){if(e.success===!0){var t="",r="",o="",n="";$.each(e.data.relatedDocuments.Document,function(e,n){r=n.Date?n.Date+" ":"",o=n.Recipient?n.Recipient:"",t+="<tr><td>"+n.Number+"</td><td>"+Yii.t("orders/js",n.OwnerDocumentType)+"</td><td>"+n.StateName+"</td><td>"+r+"<br/>"+o+"</td></tr>"}),n=t?'<table class="table table-striped table-hover table-condensed"><tbody><tr><th>'+Yii.t("orders/js","№ ТТН")+"</th><th>"+Yii.t("orders/js","Тип")+"</th><th>"+Yii.t("orders/js","Статус доставки")+"</th><th>"+Yii.t("orders/js","Доставлено (дата, Ф.И.О. Получателя)")+"</th></tr>"+t+"</tbody></table>":'<p style="text-align: center;">'+Yii.t("orders/js","Нет связанных документов.")+"</p>",$("#relatedDocumentsModal").find("div.modal-body").html("<p>"+n+"</p>").end().modal()}else e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("orders/js",t)))}):noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e.modalmanager("removeLoading")},error:function(){noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))}})}),e.on("click","a.showPartialReturn",function(){var t=$(this),r={DocumentNumber:t.data("number")};$.ajax({url:"/orders/getPartialReturnGoods",data:r,dataType:"html",beforeSend:function(){e.modalmanager("loading")},success:function(e){$("#PartialReturnContainer").html(e),$("#PartialReturnContainer").find(".-custom-select").addClass("custom-select"),$main.activeMenu(),$("#selectPartialReturnModal").modal()},complete:function(){e.modalmanager("removeLoading")},error:function(){noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))}})}),e.on("click",".unDelete > a, .recoverTtn",function(e){$orders.undelete(this,{"new":$(e.target).hasClass("icon-undo"),hide:"all"!==$("#Status2").val()}),e.preventDefault()}),$("#closeblockFooterButtons").click(function(){$("input[name~='settings[orders][hideRowAdditionalButtonsFooter]']").prop("checked",!1),$("#columnViewSave").trigger("click")}),e.on("click","a.sendSmsForLoyaltyProgram",function(e){var t=$(this).closest(".ordersForm"),r=(t.attr("action"),$("input.orderCheckbox:checked"));1==r.length?($orders.documents._ajaxSubmit=!1,$.ajax({type:"POST",cache:!1,url:"sendSmsForLoyaltyProgram",data:{documentRef:r[0].value},success:function(e){1==e?noty(Yii.t("orders/js","You sent SMS on your phone number"),3e3,"success","center"):noty(Yii.t("orders/js","Exceeded the limit of sent SMS"),3e3,"warning","center")}}),$orders.documents._ajaxSubmit=!0):r.length>1?noty(Yii.t("orders/js","Необходимо отметить только один документ"),3e3,"warning","center"):noty(Yii.t("orders/js","Сначала отметьте документ"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),$orders.markInputs(this),e.on("change click",".ordersList input:text",function(){$orders.markInputs(this)}),$("#"+createdDocumentRef).click();var t=$("#additionalServiceErrorsMessage").text().trim();t.length>1&&(noty(Yii.t("orders/js",t),3e3,"error","center"),$("#additionalServiceErrorsMessage").text("")),$orders.print.init(e),$orders.paginator.init(e),$orders.documents.init(e),$orders.scanSheet.init(e),$orders.addServices.init(e),$orders.filters.init(e),$orders.paymentTTN.init(e)},markInputs:function(){$(".ordersList input:text").each(function(){""!=$(this).val()?$(this).addClass("alert"):$(this).removeClass("alert")})},documents:{_documentsLoadingInProcess:null,_ajaxSubmit:!0,init:function(e){$operationEnable=!0,e.has("table.ordersList").on("submit","form.ordersForm",function(){return 0==$operationEnable?!1:$orders.documents._ajaxSubmit?($orders.documents._documentsLoadingInProcess=$(this).ajaxSubmit({dataType:"html",beforeSubmit:function(e,t){$operationEnable=!1,t.next(".progress").show().end().find("table.ordersList").find("tbody").remove().end().find("tfoot").remove().end()},success:function(t,r,o,n){n.next(".progress").hide().end().find("table.ordersList").find("thead.header").after(t),$("body").trigger("contentLoad"),$orders.markInputs(),__documentCount=n.find("tbody").find("tr.ordersList").length,$orders.paginator.checkPagination(e),$orders.documents._documentsLoadingInProcess=null},complete:function(){$operationEnable=!0}}),!1):void 0}),$orders.documents.formSubmit()},clearIntDocNumber:function(){$(".documentNumber").val("")},formSubmit:function(e){e=e||$("form.ordersForm").has("table.ordersList"),e.submit()}},paginator:{init:function(e){$orders.paginator.checkPagination(e),e.on("click","a.paginator",function(){var t=$(this);if(t.hasClass("disabled")||null!=$orders.documents._documentsLoadingInProcess)return!1;var r,o=t.closest(".paginatorBlock"),n=parseInt(o.attr("data-current-page")),a=t.attr("data-next-page"),i=t.parents("form.ordersForm").attr("data-groupid");""==i&&(i=0),"-"==a?r=n-1:"+"==a&&(r=n+1),o.attr("data-current-page",r).find(".paginatorCurrentPageInfo").text(r);var s=Yii.app.createUrl("orders/index",{getContent:"true",getPage:"false",groupId:i,page:r,OrderField:_orderField,OrderDirection:_orderDirection});return t.closest("form").attr("action",s).submit(),history.pushState("","",Yii.app.createUrl("orders/index",{page:r})),$orders.paginator.checkPagination(e),!1})},checkPagination:function(e){var t=e.find(".paginatorBlock");if(t.length){var r=parseInt(t.attr("data-current-page"));1>=r?t.find(".paginatorPrev").addClass("disabled"):t.find(".paginatorPrev").removeClass("disabled"),__documentListDefaultLimit!=__documentCount?t.find(".paginatorNext").addClass("disabled"):t.find(".paginatorNext").removeClass("disabled")}}},filters:{init:function(e){var t=e.find("input.documentDate"),r=e.find("input.documentDateFrom"),o=t.val(),n=r.val();r.datetimepicker({autoclose:!0,language:"uk",format:"dd.mm.yyyy HH:ii",minView:0,maxView:3,pickerPosition:"bottom-left",todayBtn:!0,weekStart:1}).change(function(t){if($(this).val()!=n){var r=$(t.currentTarget).closest("form");$orders.documents.clearIntDocNumber(),$orders.filters.checkDates(e),$orders.documents.formSubmit(r),n=$(t.currentTarget).val()}}),t.datetimepicker({autoclose:!0,minView:4,maxView:2,todayBtn:!0,todayHighlight:!0,language:"uk",weekStart:1,format:"dd.mm.yyyy"}).change(function(t){if($(this).val()!=o){var r=$(t.currentTarget).closest("form");$orders.documents.clearIntDocNumber(),$orders.filters.checkDates(e),$orders.documents.formSubmit(r),o=$(t.currentTarget).val()}});var a=e.find("input.documentEstimatedDeliveryDate"),i=a.val();a.datetimepicker({autoclose:!0,minView:4,maxView:2,todayBtn:!0,todayHighlight:!1,language:"uk",weekStart:1,format:"dd.mm.yyyy"}).change(function(t){if($(this).val()!=i){var r=$(t.currentTarget).closest("form");""!=$(this).val()&&$(t.currentTarget).siblings("input.documentDate").val(""),$orders.documents.clearIntDocNumber(),$orders.filters.checkDates(e),$orders.documents.formSubmit(r),i=$(t.currentTarget).val()}});var s=e.find("input.RecipientDateTime"),c=s.val();s.datetimepicker({autoclose:!0,minView:4,maxView:2,todayBtn:!0,todayHighlight:!1,language:"uk",weekStart:1,format:"dd.mm.yyyy"}).change(function(t){if($(this).val()!=c){var r=$(t.currentTarget).closest("form");""!=$(this).val()&&$(t.currentTarget).siblings("input.RecipientDateTime").val(""),$orders.documents.clearIntDocNumber(),$orders.filters.checkDates(e),$orders.documents.formSubmit(r),c=$(t.currentTarget).val()}});var d=e.find("input.CreateTime"),l=d.val();d.datetimepicker({autoclose:!0,minView:4,maxView:2,todayBtn:!0,todayHighlight:!1,language:"uk",weekStart:1,format:"dd.mm.yyyy"}).change(function(t){if($(this).val()!=l){var r=$(t.currentTarget).closest("form");""!=$(this).val()&&$(t.currentTarget).siblings("input.CreateTime").val(""),$orders.documents.clearIntDocNumber(),$orders.filters.checkDates(e),$orders.documents.formSubmit(r),l=$(t.currentTarget).val()}}),$("#Status2").change(function(){var e=$(this).closest("form");$orders.documents.formSubmit(e)}),$orders.filters.checkDates(e),$.ajax({url:Yii.app.createUrl("counterpartiesOnly/index",{partial:"true",filterForm:"true"}),dataType:"html",success:function(e){$("#selectCounterpartyModal").find("div.modal-body").html(e),$("#filterSender, #filterRecipient").click(function(){$orders._filterCounterpartyId=$(this),$orders._filterCounterpartyId.popover("hide"),$orders.clickCounterparty()}),$("#selectCounterpartyModal div.input-append a").remove(),$("#selectCounterpartyModal div.input-append span").removeClass("two-buttons").addClass("none-buttons"),$("div.button-input.clear").click(function(){var e=$(this).siblings("input");e.val("").trigger("keydown").focus()}),$("input.mask-char_filter").mask("L")},error:function(){}}),$("#selectCounterpartyOnlyButton").click(function(){$orders.fillSelectedCounterparty()}),$("#selectCounterpartyModalClear").click(function(){$orders.clearSelectedCounterpartyFilter()}),$("input.filterWeight, input.filterCost, input.filterSeatsAmount, input.filterCostOnSite").click(function(){var e=$(".filterFromToModal");$orders._filterId=$(this),$orders._filterId.popover("hide");var t=$orders._filterId.attr("data-type"),r="",o="";switch(t){case"filterWeight":r=Yii.t("orders/js","Фильтрация веса"),o="mask-double_3_1";break;case"filterCost":r=Yii.t("orders/js","Фильтрация страховки"),o="mask-double_7_2";break;case"filterSeatsAmount":r=Yii.t("orders/js","Фильтрация мест"),o="mask-integer_3";break;case"filterCostOnSite":r=Yii.t("orders/js","Фильтрация стоимости доставки"),o="mask-double_7_2"}e.find(".filterFrom").val($("#"+$orders._filterId.attr("data-type")+"From").val()),e.find(".filterTo").val($("#"+$orders._filterId.attr("data-type")+"To").val()),e.find(".filterTitleModal").text(r),e.find(".filterModalError").removeClass("error"),e.find(".filterFrom, .filterTo").addClass(o),$("input.mask-double_3_1").mask("099C0"),$("input.mask-double_7_2").mask("0999999C09"),$("input.mask-integer_3").mask("099"),e.modal("show")}),$("#filterModalFromToSave").click(function(){var e=$(this).closest(".filterFromToModal"),t=e.find(".filterFrom").val().replace(",","."),r=e.find(".filterTo").val().replace(",","."),o=Yii.t("orders/js","от"),n=Yii.t("orders/js","до"),a=$("#"+$orders._filterId.attr("data-type")+"From"),i=$("#"+$orders._filterId.attr("data-type")+"To"),s="";if(""!=t&&""!=r){if(parseFloat(t)>parseFloat(r))return e.find(".filterModalError").addClass("error"),!1;s=o+" "+t+" "+n+" "+r,a.val(t),i.val(r)}else""!=t&&""==r?(s=o+" "+t,a.val(t),i.val("")):""==t&&""!=r?(s=n+" "+r,a.val(""),i.val(r)):""!=t&&""!=r&&(a.val(""),i.val(""));$orders._filterId.val(s),s=""!=s?": "+s:s,$orders._filterId.attr("data-original-title",$orders._filterId.attr("data-default-title")+s),e.modal("hide"),$orders.documents.clearIntDocNumber(),$(".ordersForm").submit()}),$("#filterModalFromToClear").click(function(){var e=$(this).closest(".filterFromToModal");e.find(".filterFrom").val(""),e.find(".filterTo").val(""),$("#"+$orders._filterId.attr("data-type")+"From").val(""),$("#"+$orders._filterId.attr("data-type")+"To").val(""),$orders._filterId.val(""),$orders._filterId.attr("data-original-title",$orders._filterId.attr("data-default-title")),e.modal("hide"),$(".ordersForm").submit()}),$("#filterFrom, #filterTo").bind({keypress:function(e){var t=e.keyCode?e.keyCode:e.which;13==t&&$("#filterModalFromToSave").trigger("click")},keyup:function(){$(this).trigger("keypress")}}),$(".filterStatus").click(function(){$orders._filterId=$(this),$orders._filterId.popover("hide"),$("#filterStatusModal").modal("show")}),$(".filter_journal_statuses_content").find(".element_check").change(function(e){e.stopPropagation(),$(this).prop("checked")?$(this).closest(".browser_element_main").addClass("active"):$(this).closest(".browser_element_main").removeClass("active")}),$("#filter_journal_statuses").fastLiveFilter(".filter_journal_statuses_content"),$("#filterModalStatusSave").click(function(){var e="",t="<br/>";$("#filterStatusModal").modal("hide").find("input:checked").each(function(){e+=$(this).attr("data-ref")+";",t+=$(this).attr("data-name")+"<br/>"}),$orders._filterId.val(),t=""!=t?": "+t:t,$orders._filterId.attr("data-original-title",$orders._filterId.attr("data-default-title")+t),$("#FilterStatusesTextIt").val($orders._filterId.attr("data-original-title")),$(".documentStatus").val(Yii.t("orders/js","Выбраны статусы для поиска")),$("#filterStateId").val(e),$orders.documents.clearIntDocNumber(),$(".ordersForm").submit()}),$("#filterModalStatusClear").click(function(){$("#filterStatusModal").modal("hide").find("input:checked").each(function(){$(this).removeAttr("checked"),$(this).closest(".browser_element_main").removeClass("active")}),$("#filterStateId").val(""),$(".ordersForm").submit(),$orders._filterId.attr("data-original-title","<strong>"+$orders._filterId.attr("placeholder")+"</strong>"),$(".filterStatus").val("")}),$(".filterOnlineCreditStatus").click(function(){$orders._filterId=$(this),$orders._filterId.popover("hide"),$("#filterOnlineCreditStatusModal").modal("show")}),$("#filterModalOnlineCreditStatusSave").click(function(){var e="",t="<br/>";$("#filterOnlineCreditStatusModal").modal("hide").find("input:checked").each(function(){e+=$(this).attr("data-ref")+";",t+=$(this).attr("data-name")+"<br/>"}),$orders._filterId.val(),t=""!=t?": "+t:t,$orders._filterId.attr("data-original-title",$orders._filterId.attr("data-default-title")+t),$("#filterOnlineCreditStatusText").val($orders._filterId.attr("data-original-title")),$(".documentOnlineCreditStatus").val(Yii.t("orders/js","Выбраны статусы для поиска")),$("#filterOnlineCreditStatus").val(e),$orders.documents.clearIntDocNumber(),$(".ordersForm").submit()}),$("#filterModalOnlineCreditStatusClear").click(function(){$("#filterStatusModal").modal("hide").find("input:checked").each(function(){$(this).removeAttr("checked"),$(this).closest(".browser_element_main").removeClass("active")}),$("#filterStateId").val(""),$(".ordersForm").submit(),$orders._filterId.attr("data-original-title","<strong>"+$orders._filterId.attr("placeholder")+"</strong>"),$(".filterStatus").val("")}),$("#documentNumberForEditEW").bind({keyup:function(e){var t=$(this).val().trim().length,r=$(this).val().trim()[0],o=!(11==t&&"1"==r||14==t&&("2"==r||"5"==r));$("#checkDocumentForEditEW").attr("disabled",o),o||13==e.keyCode&&$("#checkDocumentForEditEW").trigger("click")}}),$("#checkDocumentForEditEW").click(function(){var e=$("#documentNumberForEditEW").val();document.location="/additionalServices/editEW/Number/"+e}),$("#set_document_number_redirection").bind({keyup:function(e){var t=$(this).val().trim().length,r=$(this).val().trim()[0],o=!(11==t&&"1"==r||14==t&&("2"==r||"5"==r));$("#checkDocumentForRedirection").attr("disabled",o),o||($("#documentNumberForRedirection").val($(this).val()),13==e.keyCode&&$("#checkDocumentForRedirection").trigger("click"))}}),$("#checkDocumentForRedirection").click(function(){$.ajax({url:Yii.app.createUrl("additionalServices/RedirectingAjax"),data:{documentNumber:$("#documentNumberForRedirection").val()},dataType:"html",success:function(e){""==e||null==e?noty(Yii.t("orders/js","Документ не принадлежит пользователю"),3e3,"warning"):document.location="/additionalServices/redirecting/Number/"+$("#documentNumberForRedirection").val()+"/Customer/"+e},error:function(){noty(Yii.t("orders/js","Документ не принадлежит пользователю"),3e3,"warning")}})}),$("#set_document_number_return").bind({keyup:function(e){var t=$(this).val().trim().length,r=$(this).val().trim()[0],o=!(11==t&&"1"==r||14==t&&("2"==r||"5"==r));$("#checkDocumentForReturn").attr("disabled",o),o||($("#documentNumberForReturn").val($(this).val()),13==e.keyCode&&$("#checkDocumentForReturn").trigger("click"))}}),$("#checkDocumentForReturn").click(function(){$.ajax({url:Yii.app.createUrl("additionalServices/ReturnAjax"),data:{documentNumber:$("#documentNumberForReturn").val()},dataType:"html",success:function(e){""==e||null==e?noty(Yii.t("orders/js","Документ не принадлежит пользователю"),3e3,"warning"):document.location="/additionalServices/return/Number/"+$("#documentNumberForReturn").val()},error:function(){noty(Yii.t("orders/js","Документ не принадлежит пользователю"),3e3,"warning")}})}),$("#documentNumberForTermExtension").bind({keyup:function(e){var t=$(this).val().trim().length,r=$(this).val().trim()[0],o=!(11==t&&"1"==r||14==t&&("2"==r||"5"==r));$("#checkDocumentForTermExtension").attr("disabled",o),o||13==e.keyCode&&$("#checkDocumentForTermExtension").trigger("click")}}),$("#checkDocumentForTermExtension").click(function(){var e=$("#documentNumberForTermExtension").val();document.location="/additionalServices/termExtension/Number/"+e})},checkDates:function(e){for(var t=["input.documentDate","input.documentEstimatedDeliveryDate","input.RecipientDateTime","input.CreateTime"],r=0,o=0;o<t.length;o++)""!=e.find(t[o]).val()&&void 0!=e.find(t[o]).val()&&r++;if(r>1)for(var o=0;o<t.length;o++)e.find(t[o]).datetimepicker("showClearBtn");else for(var o=0;o<t.length;o++)e.find(t[o]).datetimepicker("hideClearBtn")}},scanSheet:{_DocumentRefs:[],_ScanSheetRef:[],_Date:[],$_currentForm:{},init:function(e){e.on("click","a.removeFromScansheet",function(e){var t=$(this);$orders.scanSheet.$_currentForm=t.closest("form"),$orders.scanSheet._DocumentRefs=[],$orders.scanSheet._DocumentRefs.push(t.data("ref")),$(".removeFromScanSheetModal").modal("show"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.removeFromScansheetPack",function(e){var t=$(this),r=$("input.orderCheckbox:checked");$orders.scanSheet.$_currentForm=t.closest("form"),$orders.scanSheet._DocumentRefs=[],$.each(r,function(e,t){$orders.scanSheet._DocumentRefs.push($(t).closest("tr").attr("id"))}),$orders.scanSheet._DocumentRefs.length>0?$(".removeFromScanSheetModal").modal("show"):noty(Yii.t("orders/js","Сначала отметьте документы для удаления из ведомости"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click",".removeFromScanSheetButton",function(e){var t=$(this);$orders.scanSheet._ScanSheetRef=t.closest(".modal").find("li.active").data("ref"),$orders.scanSheet.removeFromScanSheet("ScanSheet"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.addToScansheet",function(e){var t=$(this);$orders.scanSheet.$_currentForm=t.closest("form"),$orders.scanSheet._DocumentRefs=[],$orders.scanSheet._DocumentRefs.push(t.data("ref")),$("#selectScanSheetModal").modal("show"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.addToScansheetPack",function(e){var t=$(this),r=$("input.orderCheckbox:checked");$orders.scanSheet.$_currentForm=t.closest("form"),$orders.scanSheet._DocumentRefs=[],$.each(r,function(e,t){$orders.scanSheet._DocumentRefs.push($(t).closest("tr").attr("id"))}),$orders.scanSheet._DocumentRefs.length>0?$("#selectScanSheetModal").modal("show"):noty(Yii.t("orders/js","Сначала отметьте документы для добавления в ведомость"),3e3,"warning"),e.preventDefault(),e.stopPropagation()}),e.on("click","#selectScanSheetButton",function(){var e=$(this);$orders.scanSheet._ScanSheetRef=e.closest(".modal").find("li.active").data("ref"),$orders.scanSheet._Date=e.closest(".modal").find("input.ScanSheetDateInput").val(),$orders.scanSheet.addToScanSheet("ScanSheet")}),$orders.scanSheet.updateScanSheetList()},updateScanSheetList:function(){$.ajax({url:Yii.app.createUrl("scanSheet/getScanSheetsList",{partial:"true"}),dataType:"html",success:function(e){$("#selectScanSheetModal").find("div.modal-body").html("").html(e)},error:function(){},complete:function(){$scansheet_only.init()}})},addToScanSheet:function(e){var t=$("body"),r={};void 0==$orders.scanSheet._ScanSheetRef?(r.DocumentRefs=$orders.scanSheet._DocumentRefs,r.Date=$orders.scanSheet._Date):(r.Ref=$orders.scanSheet._ScanSheetRef,r.DocumentRefs=$orders.scanSheet._DocumentRefs);var o={modelName:e,calledMethod:"insertDocuments",methodProperties:r};$.ajax({data:JSON.stringify(o),beforeSend:function(){t.modalmanager("loading"),$.each($orders.scanSheet._DocumentRefs,function(e,t){var r=$("#"+t),o=$orders.showProgressRow(t);r.hide().after(o)})},success:function(e){void 0!=e.data&&$orders.scanSheet.processAddToScanSheetResponse(e),$orders.scanSheet.updateScanSheetList(),$orders.scanSheet.$_currentForm.submit(),$("#selectScanSheetModal").modal("hide")},complete:function(){$.each($orders.scanSheet._DocumentRefs,function(e,t){var r=$("#"+t);$orders.hideProgressRow(t),r.show()}),t.modalmanager("removeLoading")}})},processAddToScanSheetResponse:function(e){$.each(e.data,function(e,t){$.each(t.Errors,function(e,t){noty(Yii.t("orders/js","Документы не добавлены в ведомость из-за ошибки: ")+Yii.t("orders/js",t.Error),8e3,"error")}),$.each(t.Data.Errors,function(e,t){noty(Yii.t("orders/js","Документ ")+t.Number+Yii.t("orders/js"," не добавлен в ведомость из-за ошибки: ")+Yii.t("orders/js",t.Error),8e3,"error")}),$.each(t.Data.Success,function(e,r){noty(Yii.t("orders/js","Документ ")+r.Number+Yii.t("orders/js"," успешно добавлен в ведомость ")+t.Number,3e3,"success")})})},removeFromScanSheet:function(e){var t={DocumentRefs:$orders.scanSheet._DocumentRefs},r={modelName:e,calledMethod:"removeDocuments",methodProperties:t};$.ajax({data:JSON.stringify(r),beforeSend:function(){$.each($orders.scanSheet._DocumentRefs,function(e,t){var r=$("#"+t),o=$orders.showProgressRow(t);r.hide().after(o)}),$(".removeFromScanSheetModal").modal("hide")},success:function(e){void 0!=e.data&&$orders.scanSheet.processRemoveFromScanSheetResponse(e),$orders.scanSheet.$_currentForm.submit()},complete:function(){$.each($orders.scanSheet._DocumentRefs,function(e,t){var r=$("#"+t);$orders.hideProgressRow(t),r.show()})}})},processRemoveFromScanSheetResponse:function(e){$.each(e.data.DocumentRefs.Errors,function(e,t){console.log(t.Error),noty(Yii.t("orders/js","Документ ")+t.Number+Yii.t("orders/js"," не удален из ведомости из-за ошибки: ")+Yii.t("orders/js",t.Error),3e3,"error")}),$.each(e.data.DocumentRefs.Success,function(e,t){noty(Yii.t("orders/js","Документ ")+t.Number+Yii.t("orders/js"," успешно удален из ведомости"),3e3,"success")})}},addServices:{init:function(e){e.on("click","a.additional-editing",function(e){e.preventDefault(),e.stopPropagation();var t=$("input.orderCheckbox:checked");if(t.length>1)return noty(Yii.t("orders/js","Одновременно можно оформить изменение только для одного отправления")),void 0;var r=t.closest("tr").find(".number").text().trim();r?document.location="/additionalServices/editEW/Number/"+r:$("#setDocumentNumberEditEWModal").modal("show")}),e.on("click","a.additional-forwarding",function(e){e.preventDefault(),e.stopPropagation();var t=$("input.orderCheckbox:checked");if(t.length>1)return noty(Yii.t("orders/js","Одновременно можно оформить переадресацию только для одного отправления")),void 0;var r=t.closest("tr").attr("id");r?document.location="/additionalServices/redirecting/Ref/"+r:$("#setDocumentNumberRedirectionModal").modal("show")}),e.on("click","a.additional-returning",function(t){t.preventDefault(),t.stopPropagation();var r=$("input.orderCheckbox:checked");if(r.length>1){var o='<form id="massiveReturn" method="post" action="/additionalServices/massiveReturn">';return r.closest("tr").find(".number").each(function(){o+='<input name="Documents[]" value="'+$(this).text().trim()+'">'}),o+="</form>",e.append(o),$("#massiveReturn").submit(),void 0}var n=r.closest("tr").attr("id");n?document.location="/additionalServices/return/Ref/"+n:$("#setDocumentNumberForReturnModal").modal("show")}),e.on("click","a.additional-term-extension",function(e){e.preventDefault(),e.stopPropagation();var t=$("input.orderCheckbox:checked");if(t.length>1)return noty(Yii.t("orders/js","Одновременно можно оформить продление срока хранения только для одного отправления")),void 0;var r=t.closest("tr").find(".number").text().trim();r?document.location="/additionalServices/termExtension/Number/"+r:$("#setDocumentNumberTermExtensionModal").modal("show")})}},paymentTTN:{pageForPay:$configBox.linkPage.pageForPay,init:function(e){e.on("click","#paymentNowTtn",function(){var e=$orders.paymentTTN.documentsCheck(),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"setPaymentDocuments",methodProperties:t},o=function(e){if($orders.paymentTTN.resultAddPaymentTtn(e.response),e.response.data.PaymentRefs.Success){var t=function(){window.location.href=$orders.paymentTTN.pageForPay};setTimeout(t,3e3)}},n={funk:o,data:{}};$orders.paymentTTN.ajaxSend(r,n)}),e.on("click","#paymentAddTtn",function(){var e=$orders.paymentTTN.documentsCheck(),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"setPaymentDocuments",methodProperties:t},o=function(e){$orders.paymentTTN.resultAddPaymentTtn(e.response)},n={funk:o,data:{}};$orders.paymentTTN.ajaxSend(r,n)}),e.on("click","#paymentDeleteTtn",function(){var e=$orders.paymentTTN.documentsCheck(),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"unsetPaymentDocuments",methodProperties:t},o=function(e){$orders.paymentTTN.resultCancelPaymentTtn(e.response)},n={funk:o,data:{}};$orders.paymentTTN.ajaxSend(r,n)}),e.on("click",".paymentOneNowTtn",function(){var e=$orders.paymentTTN.documentCheck($(this)),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"setPaymentDocuments",methodProperties:t},o=function(e){if($orders.paymentTTN.resultAddPaymentTtn(e.response),e.response.data.PaymentRefs.Success){var t=function(){window.location.href=$orders.paymentTTN.pageForPay};setTimeout(t,3e3)}},n={funk:o,data:{}};$orders.paymentTTN.ajaxSend(r,n)}),e.on("click",".paymentOneAddTtn",function(){var e=$orders.paymentTTN.documentCheck($(this)),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"setPaymentDocuments",methodProperties:t},o=function(e){$orders.paymentTTN.resultAddPaymentTtn(e.response)},n={funk:o,data:{}};$orders.paymentTTN.ajaxSend(r,n)}),e.on("click",".paymentOneDeleteTtn",function(){var e=$orders.paymentTTN.documentCheck($(this)),t={Documents:e},r={modelName:"InternetDocument",calledMethod:"unsetPaymentDocuments",methodProperties:t},o=function(e){$orders.paymentTTN.resultCancelPaymentTtn(e.response)},n={funk:o,data:{}};$orders.paymentTTN.ajaxSend(r,n)})},resultAddPaymentTtn:function(e){var t='<span class="label label-info payable">'+Yii.t("orders/js","К оплате online")+"</span>";e.data.PaymentRefs.Success.forEach(function(e){var r=$("#"+e.Ref);r.find(".stateName").find(".payable").remove(),r.find(".stateName").html(r.find(".stateName").html()+t),r.find(".paymentOneNowTtnBlock").addClass("hide"),r.find(".paymentOneDeleteTtnBlock").removeClass("hide"),noty(Yii.t("orders/js","Документ ")+r.find(".number").text()+" "+Yii.t("orders/js","добавлен к оплате Online"),3e3,"success")}),e.data.PaymentRefs.Errors.forEach(function(e){var t=$("#"+e.Ref);noty(Yii.t("orders/js","Документ ")+t.find(".number").text()+" "+Yii.t("orders/js","не добавлен к оплате из-за ошибки: ")+Yii.t("orders/js",e.Error),3e3,"error")})},resultCancelPaymentTtn:function(e){e.data.PaymentRefs.Success.forEach(function(e){var t=$("#"+e.Ref);t.find(".payable").remove(),t.find(".paymentOneNowTtnBlock").removeClass("hide"),t.find(".paymentOneDeleteTtnBlock").addClass("hide"),noty(Yii.t("orders/js","Документ ")+t.find(".number").text()+" "+Yii.t("orders/js","удален для оплате Online"),3e3,"success")}),e.data.PaymentRefs.Errors.forEach(function(e){var t=$("#"+e.Ref);noty(Yii.t("orders/js","Документ ")+t.find(".number").text()+" "+Yii.t("orders/js","не был удален для оплате Online из-за ошибки: ")+Yii.t("orders/js",e.Error),3e3,"error")})},documentsCheck:function(){var e=$("input.orderCheckbox:checked"),t=[];return $.each(e,function(e,r){t.push($(r).closest("tr").attr("id"))}),t},documentCheck:function(e){var t=[];return t[0]=e.attr("data-ref"),t},sandbox:function(e){e.funk&&e.funk(e.data)},ajaxSend:function(e,t){$.ajax({data:JSON.stringify(e),success:function(e){e.success===!0?(t.data.response=e,$orders.paymentTTN.sandbox(t)):e.success===!1?$.each(e.errors,function(e,t){$noty.push(noty(Yii.t("newOrder/js",t)))}):noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},error:function(){noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))}})}},print:{init:function(e){function t(){var e=$(".printMarkingsChangeOptionsBlock");e.off("click"),$orders.$choosePrintStart.off("click"),e.on("click","a",function(){var e=$(this).closest(".ordersForm"),t=e.attr("action"),r=$("input.orderCheckbox:checked"),n=$orders.$choosePrintStart,a=0;n.show(),n.on("click","input",function(){var e=$orders.$choosePrintStart.find("input:checked").val();
"horPrint"==e&&($(".horPrint").show(),$(".verPrint").hide()),"verPrint"==e&&($(".verPrint").show(),$(".horPrint").hide())}),n.on("click","div",function(){var n=$orders.$choosePrintStart.find("input:checked").val();a=$(this).children("."+n).text(),$orders.$choosePrintStart.hide(),r.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()});var i=o.find("#copies").val();if(r.length>0){$orders.documents._ajaxSubmit=!1;var s=$orders.$choosePrintStart.hasClass("choosePrintStartNew")?"orders/printMarking100x130":"orders/printMarkings";e.attr("target","_blank").attr("action",Yii.app.createUrl(s,{type:$("#doc_type").val(),position:a,printDirection:n,copies:i})).submit().attr("target","").attr("action",t),$orders.documents._ajaxSubmit=!0}else noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center")})})}function r(){var e=$("#sheet_format").val(),r=$("#doc_type").val();$orders.$choosePrintStartOld=$(".choosePrintStartOld"),$orders.$choosePrintStartNew=$(".choosePrintStartNew");var o=$(".printMarkingsChangeOptionsBlock");"marking"!=e||"html"!==r&&"pdf8"!==r?"marking100x130"!=e||"html"!==r&&"pdf8"!==r?(o.off(),o.hide()):($("#doc_type option[value=pdf8]").show(),o.show(),$orders.$choosePrintStart=$orders.$choosePrintStartNew,t()):($("#doc_type option[value=pdf8]").show(),o.show(),$orders.$choosePrintStart=$orders.$choosePrintStartOld,t())}e.on("click","a.printTtnPackPdf",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printDocument",{type:"pdf"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printTtnPackHtml",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printDocument",{type:"html"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printEnPackPdf",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printDocument",{type:"pdf_new"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printEnPackHtml",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printDocument",{type:"html_new"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printMarkPackPdf",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"pdf"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printMarkPackHtml",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"html"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printNewMarkPackHtml",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"html"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click",function(e){"printDirection"===e.target.name||$(e.target).hasClass("inpDirection")||($orders.$choosePrintStartOld.hide(),$orders.$choosePrintStartNew.hide())}),e.on("click","a.printNewMarkPackZebra",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"html",zebra:"zebra"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printNewMarkPackZebraPdf",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"pdf",zebra:"zebra"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printMarking100x130Html",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarking100x130",{type:"html"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printMarking100x130Pdf",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarking100x130",{type:"pdf"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printMarking100x100Html",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarking100x100",{type:"html"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()}),e.on("click","a.printMarking100x100Pdf",function(e){var t=$(this).closest(".ordersForm"),r=t.attr("action"),o=$("input.orderCheckbox:checked");o.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),o.length>0?($orders.documents._ajaxSubmit=!1,t.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarking100x100",{type:"pdf"})).submit().attr("target","").attr("action",r),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),e.preventDefault(),e.stopPropagation()});var o=$(".printOptionsBlock");e.on("click","a.printOptionsShow",function(){o.show(),r();var t=function(r){"printOptionsBlock"!=r.target.id&&($("#printOptionsBlock").hide(),e.off("click",t))};e.on("click",t)}),o.on("click","#doPrint",function(){o.hide();var e="Document",t="A4",r=o.find("#copies").val();switch(docType=o.find("#doc_type").val(),o.find("#sheet_format").val()){case"ew A4":e="Document",t="A4";break;case"ew A5":e="Document",t="A5";break;case"ew_new A5":e="Document",t="A5",docType="html"==docType?"html_new":"pdf_new";break;case"marking":e="Markings",t="A4";break;case"marking100x130":e="Marking100x130",t="A4";break;default:e="Document",t="A4"}var n=$(this).closest(".ordersForm"),a=n.attr("action"),i=$("input.orderCheckbox:checked");if(i.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),i.length>0){$orders.documents._ajaxSubmit=!1;var s="print"+e;n.attr("target","_blank").attr("action",Yii.app.createUrl("orders/"+s,{type:docType,pageFormat:t,copies:r})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0}else noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center")}),o.on("click",function(e){e.preventDefault(),e.stopPropagation()}),o.on("change","#sheet_format, #doc_type",function(){r()})}},clickCounterparty:function(){$("#selectCounterpartyModal").modal("show"),$counterpartiesOnly.initFilter(),"filterSender"==$orders._filterCounterpartyId.attr("id")?$orders.senderSelectFilter():"filterRecipient"==$orders._filterCounterpartyId.attr("id")&&$orders.recipientSelectFilter()},senderSelectFilter:function(){"Sender"!=$orders._processedCounterpartyType&&($orders._processedCounterpartyType="Sender",$counterpartiesOnly.counterpartyProperty="Sender",$counterpartiesOnly.clear_lists($("#filterSenderItText").val(),$("#filterSenderIt").val()))},recipientSelectFilter:function(){"Recipient"!=$orders._processedCounterpartyType&&($orders._processedCounterpartyType="Recipient",$counterpartiesOnly.counterpartyProperty="Recipient",$counterpartiesOnly.clear_lists($("#filterRecipientItText").val(),$("#filterRecipientIt").val()))},clearSelectedCounterpartyFilter:function(){var e=$("#filter"+$orders._processedCounterpartyType),t=$("#filter"+$orders._processedCounterpartyType+"It"),r=$("#filter"+$orders._processedCounterpartyType+"ItText"),o=$("#filter"+$orders._processedCounterpartyType+"CityIt");e.val(""),t.val(""),r.val(""),o.val(""),$(".document"+$orders._processedCounterpartyType).val(""),$counterpartiesOnly.clear_lists(r.val(),t.val()),$("#selectCounterpartyModal").modal("hide"),$(".ordersForm").submit()},fillSelectedCounterparty:function(){if($counterpartiesOnly.check_fields_filled()){var e=$("#counterparties_ul_counterparty").find("li.active"),t=$("#cities_block_counterparty").find("li.active"),r=$("#filter"+$orders._processedCounterpartyType+"It"),o=$("#filter"+$orders._processedCounterpartyType+"CityIt"),n=$("#filter"+$orders._processedCounterpartyType+"ItText");$(r).val(e.attr("id")),$(o).val(t.attr("data-ref"));var a=$("#cities_block_counterparty").find("li.active").text().trim();$(n).val(a),""!=$orders._filterCounterpartyId&&void 0!=$orders._filterCounterpartyId.data("type")&&"redirecting"==$orders._filterCounterpartyId.data("type")?(this.getBasicCounterpartyOptions(e.attr("id")),$("#filter"+$orders._processedCounterpartyType).val(e.attr("data-description"))):$("#filter"+$orders._processedCounterpartyType).val(a+" - "+e.attr("data-description")),$(".document"+$orders._processedCounterpartyType).val(a+" - "+e.attr("data-description")),$("#selectCounterpartyModal").modal("hide"),$orders.documents.clearIntDocNumber(),$(".ordersForm").submit()}},getBasicCounterpartyOptions:function(e){if(""==e||void 0==e||"00000000-0000-0000-0000-000000000000"==e)return!1;var t=$orders._processedCounterpartyType,r={Ref:e,Date:$("#DateTime").val(),typeCounterparty:t},o={modelName:"Counterparty",calledMethod:"getCounterpartyOptions",methodProperties:r};$.ajax({data:JSON.stringify(o),beforeSend:function(){$("#progressLoading"+t).show(),$("#"+t+"SelectButton").hide()},success:function(e){null!=e&&void 0!=e.success&&e.success===!0?($orders._counterpartyOptions[t]=e.data[0],void 0!=$orders._counterpartyOptions&&$orders._counterpartyOptions[t].CanNonCashPayment&&$("#Recipient").hasClass("active")?$('[data-type="NonCash"]').prop("disabled",!1).removeClass("disabled"):($('[data-type="NonCash"]').removeClass("active").prop("disabled",!0).addClass("disabled"),$('[data-type="Cash"]').addClass("active").prop("disabled",!1))):null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),$noty.push(noty(Yii.t("newOrder/js",t)))}):$noty.push(noty(Yii.t("newOrder/js","Ошибка при получении свойств контрагента")))},complete:function(){$("#progressLoading"+t).hide(),$("#"+t+"SelectButton").show(),t&&($orders.processedCounterpartyType="")}})},selectRow:function(e,t){var r=e.find("input.orderCheckbox"),o=t?!r.prop("checked"):r.prop("checked");e.toggleClass("active",!o),r.prop("checked",!o);var n=e.closest("table"),a=n.find("input.orderCheckbox:checked"),i=n.find("input.orderCheckbox");a.length==i.length?n.find("input.orderCheckAll").prop("checked",!0):n.find("input.orderCheckAll").prop("checked",!1)},removeTtn:function(e,t){if(e.length>0){var r={DocumentRefs:e},o={modelName:t,calledMethod:"delete",modelProperties:r};$.ajax({data:JSON.stringify(o),beforeSend:function(){$.each(e,function(e,t){var r=$("#"+t),o=$orders.showProgressRow(t);r.hide().after(o),r.find("input:checkbox").attr("checked",!1)})},success:function(e){return null!=e.data&&$.each(e.data,function(e,t){var r=$("#"+t.Ref);$orders.hideProgressRow(t.Ref),$button=r.find(".removeTtn"),$button.removeClass("removeTtn").addClass("recoverTtn").attr("data-original-title",Yii.t("orders/js","Восстановление ТТН")),r.find(".icon-trash").removeClass("icon-trash").addClass("icon-undo"),r.find(".text-deleted").length?r.find(".text-deleted").show():r.find(".stateName").append('<span class="text-error text-deleted">'+Yii.t("orders/js","Удалено")+"</span>"),r.show(),r.find("input:checkbox").attr("checked",!0),r.find(".MarketPlaceSecurePayment").length&&r.find(".recoverTtn").remove()}),null!=e.warnings&&$.each(e.warnings,function(e,t){noty(Yii.t("orders/js",t),3e3,"error","center");var r=$("#"+e);r.find("input:checkbox").attr("checked",!0)}),null!=e.errors&&$.each(e.errors,function(e,t){noty(Yii.t("orders/js",t),3e3,"error","center"),$orders.hideProgressRow(e);var r=$("#"+e);r.show(),r.find("input:checkbox").attr("checked",!0)}),!0}})}else noty(Yii.t("orders/js","Сначала отметьте документы для удаления"),3e3,"warning","center")},showUndeleteButton:function(e,t,r){if($orders.hideProgressRow(t),"InternetDocumentTemplate"==r)var o=$("table.templatesList").find("tr:first > th").length;else var o=$("table.ordersList").find("tr:first > th").length;e.after($("<tr>").append($("<td>").hide().attr("colspan",o).append($("<a>").text(Yii.t("orders/js","Отменить удаление")).attr("href","#").attr("data-ref",t).attr("data-type",r)).addClass("unDelete").slideDown().css("display","")))},showProgressRow:function(e,t){if(void 0!=t)var r=$(t).find("#"+e+" td").length;else var r=$("#"+e+" td").length;return $("<tr>").attr("id",e+"_progress").append($("<td>").attr("colspan",r).append($("<div>").addClass("progress").addClass("progress-striped").addClass("active").css("margin","5px 0").append($("<div>").addClass("bar").addClass("bar-danger").css("width","100%"))))},hideProgressRow:function(e){$("#"+e+"_progress").remove()},undelete:function(e,t){var r=$(e),o=r.data("ref"),n=r.data("type"),a=[];a.push(o);var i={DocumentRefs:a},s={modelName:n,calledMethod:"cancelDeletion",modelProperties:i};$.ajax({data:JSON.stringify(s),beforeSend:function(){r.closest("tr").hide().after($orders.showProgressRow(o))},success:function(e){e.success===!0?t.new?t.hide||($tr=r.closest("tr"),$button=$tr.find(".recoverTtn"),$button.removeClass("recoverTtn").addClass("removeTtn").attr("data-original-title",Yii.t("orders/js","Удаление ТТН")),$tr.find(".icon-undo").removeClass("icon-undo").addClass("icon-trash"),$tr.find(".text-deleted").hide(),$tr.show()):$("#"+o).slideDown("fast"):(r.closest("tr").show(),$.each(e.errors,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")}),$.each(e.warnings,function(e,t){noty(Yii.t("counterparties/js",t),3e3,"error","center")})),$orders.hideProgressRow(o)}})}};
var $paycard={init:function(){function a(a,e){"Unsuccess"==a?($("#textForLinkCard").html(e.responseDesc),$("#useCard").css("display","none")):($("#sendLookUpCode").css("display","block"),$("#useCard").css("display","none"))}function e(a,e){"Unsuccess"==a?($("#textForLinkCard").html(e.responseDesc),$("#useCard").css("display","none")):($("#accessPayCardModal").modal("hide"),oneClick.checkEnroll(sidNew,"ukr",self.tryToGetCards))}self=this,tasLink="https://np.taslink.com.ua",$("#payCardDocumentLink").click(function(a){a.preventDefault(),$link=$(this),$link.attr("disabled","disabled");var e=[];e.push(parseInt($(this).data("number"))),self.payCard(e,function(){$link.attr("disabled",!1)})}),$(".payCardList").click(function(){var a=$("input.orderCheckbox:checked");if(a.length>0){var e=[];$.each(a,function(a,n){e.push(parseInt($(n).closest("tr").find(".number").text()))}),self.payCard(e)}else noty(Yii.t("payCard/js","ERROR_NOT_SELECTED"),3e3,"error","center")}),$("body").on("click",".payCardOne",function(){var a=[];a.push(parseInt($(this).closest("tr").find(".number").text())),self.payCard(a)}),$("body").on("click",".payCardCancel",function(){arTtn=[],arTtn.push(parseInt($(this).closest("tr").find(".number").text())),self.payCardCancel(arTtn)}),$("#getCards").click(function(){oneClick.init(self.getSid())}),$("#getUaPayCards").ready(function(){$("#getCards").trigger("click")}),$("#payCardModal").on("click","#backToCards",function(){$(".num").removeClass("activePay"),$(".num").css("display","block")}),$("#addPaymentTasCard").click(function(){$("#taskLinkFrame").modal("show")}),$("#accessPayCardModal").on("click","#useCard",function(){$.ajax({url:"/PayCard/getCardData",dataType:"html",success:function(e){phone=e,oneClick.linkMPWallet(sidNew,{msisdn:phone},"ukr",a)}})}),$("#accessPayCardModal").on("keyup","#lookup_code",function(){6==$(this).val().length&&($("#send_lookup_code").css("background","#F35F57"),$("#accessPayCardModal").on("click","#lookup_send",function(){var a=$("#lookup_code").val();oneClick.checkLookUp(sidNew,{code:a,type:"link"},"ukr",e)}))}),$("#choosePayCardModal").on("click",".payByDefaultCard",function(){$(this).addClass("activePay"),self.payByCurrentCard()}),$("#payCardModal").on("click",".payByCard",function(){$(this).addClass("activePay"),self.payByCurrentCard()}),$("#choosePayCardModal").on("click","#linkToCard",function(){self.addFramePay()}),$("#accessPayCardModal").on("click","#linkToCard",function(){self.addFramePay()})},tryToGetCards:function(a,e){if(null!=e.accountStatus.match(/^[0-9]{4}1\d*/))$("#noAddCard").modal("show"),$("#payCardModal").modal("hide");else if(null==e.accountStatus.match(/^011100\d*/))null!=e.accountStatus.match(/^011000\d*/)?($("#accessPayCardModal").modal("show"),$("#payCardModal").modal("hide")):($("#taskLinkFrame").modal("show"),$("#taskLinkFrame").html('<iframe id = "TSframe" src="'+tasLink+"?register="+sidNew+'"> </iframe>'),$("#payCardModal").modal("hide"));else{var n=e.accountStatus,s=(n.substring(0,1),n.substring(1,2)),r=n.substring(2,3),t=(n.substring(3,4),n.substring(4,5));1==s&&0==t&&1==r&&("string"==typeof cost?($("body").modalmanager("removeLoading"),$("#filterTitleModal .redFont").html(cost+" грн."),$("#choosePayCardModal").modal("show"),oneClick.getCards(sidNew,self.showCards)):oneClick.getCards(sidNew,self.showCardsCash2Card))}},getSid:function(){$(".box_pay .progress").show();var a=$main.showProgressRow("","#paymentCardsData");$("#tableCrdsBody").html(a),$.ajax({url:"/PayCard/GetSid",dataType:"html",success:function(a){sidNew=a,$("#taskLinkFrame").html('<iframe id = "TSframe" src="'+tasLink+"?register="+sidNew+'"> </iframe>'),oneClick.checkEnroll(sidNew,"ukr",self.tryToGetCards)}})},showCards:function(a,e){retRefVal=e.retRefVal,alias=e.cards[0].alias;for(var n="",s=0;s<e.cards.length;s++){var r=e.cards[s].pan,t=/^4/;if(0==r.search(t))var d="icVisaLogo32.png";else var d="icMastercardLogo32.png";n+='<div class = "num" id = "card'+s+'"><div class = "leftstr payByCard"><table><tr><td style = "width: 60px;"><input id = "hideVal" type = "hidden" value = "'+e.cards[s].alias+'"><img src="/public/img/'+d+'"></td><td style = "padding: 0 0 9px 0;"><span>'+e.cards[s].alias+'</span></td></tr></table></div><div class = "rightstr"><p class = "payByCard">'+e.cards[s].pan+'&nbsp;&nbsp; <input id = "hideVal" type = "hidden" value = "'+e.cards[s].alias+"\"> </p> <p onclick = \"\" ><img src=\"/public/img/icDelete.png\" onclick = \" $('#deleteCardModal').modal('show'); $('#cardAlias').val('"+e.cards[s].alias+"'); $('#cardPan').val('"+e.cards[s].pan+"'); $('#cardId').val('"+s+'\'); " id = "delete">  </p></div> </div>'}$(".box_pay .progress").hide(),$("#num").html(n),$("#butPay").html(" <button onclick = 'payTS(\""+cost+'", "'+DraftRef+'", "'+sidNew+'", "'+alias+'", "'+retRefVal+"\", 1, 1);' id = 'buttonPay' class=\"btns btna btn payCardList\">Сплатити картою</button>"),$("#taskLinkFrame").html('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><iframe id = "TSframe" src="'+tasLink+"?register="+sidNew+'"> </iframe>');var i=document.getElementById("TSframe");i&&window.addEventListener("message",self.receiveMessage,!1)},showCardsCash2Card:function(a,e){retRefVal=e.retRefVal;for(var n="",s=0;s<e.cards.length;s++){var r=e.cards[s].pan,t=/^4/;if(0==r.search(t))var d="icVisaLogo32.png";else var d="icMastercardLogo32.png";n+="<div onclick = '$neworder.payTSRedelivery(\""+e.cards[s].pan+'", "'+retRefVal+'", "'+e.cards[s].alias+'", "'+sidNew+'");\' class = "num" id = "card'+s+'"><div class = "leftstr payByCard"><table><tr><td style = "width: 60px;"><input id = "hideVal" type = "hidden" value = "'+e.cards[s].alias+'"><img src="/public/img/'+d+'"></td><td style = "padding: 0 0 9px 0;"><span>'+e.cards[s].alias+'</span></td></tr></table></div><div class = "rightstr"><p class = "payByCard">'+e.cards[s].pan+'&nbsp;&nbsp; <input id = "hideVal" type = "hidden" value = "'+e.cards[s].alias+'"> </p> </div> </div>'}$(".box_pay .progress").hide(),$("#numRedelivery").html(n),$("#taskLinkFrame").html('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><iframe id = "TSframe" src="'+tasLink+"?register="+sidNew+'"> </iframe>');var i=document.getElementById("TSframe");i&&window.addEventListener("message",self.receiveMessage,!1)},receiveMessage:function(){setTimeout(self.func,3e3)},func:function(){$("#payTaskLinkFrame").modal("hide"),$("#num").html(""),"string"==typeof cost?(oneClick.getCards(sidNew,self.showCards),$("#payCardModal").modal("show")):(oneClick.getCards(sidNew,self.showCardsCash2Card),$("#payCardModalRedelivery").modal("show"))},addFramePay:function(){var a={PreauthorizationAmount:cost,TransactionId:DraftRef,MasterPassSessionId:"",CardAlias:"",LoyaltyCardRef:""};$.ajax({url:"/payCard/getSessionSid",data:a,type:"POST",dataType:"html",success:function(a){if(null!=a){$("#choosePayCardModal").modal("hide"),$("#accessPayCardModal").modal("hide"),$("#payCardModal").modal("hide");var e=tasLink+"/?pay="+a;window.location.replace(e)}}})},payByCurrentCard:function(){var a={PreauthorizationAmount:cost,TransactionId:DraftRef,MasterPassSessionId:sidNew,CardAlias:$(".activePay #hideVal").val(),LoyaltyCardRef:retRefVal};$.ajax({url:"/payCard/getSessionSid",data:a,type:"POST",dataType:"json",success:function(a){if(null!=a){$("#choosePayCardModal").modal("hide"),$("#accessPayCardModal").modal("hide"),$("#payCardModal").modal("hide");var e=tasLink+"/?pay="+a;window.location.replace(e)}},error:function(a){$("#choosePayCardModal").modal("hide"),$("#accessPayCardModal").modal("hide"),$("#payCardModal").modal("hide");var e=a.responseText,n=tasLink+"/?pay="+e;window.location.replace(n)}})},payCard:function(a,e,n){var s=[];if($.each(a,function(a,e){var n=self.getTtnRow(e);n.find(".label-info-payed").length&&s.push(e)}),s.length)return noty(Yii.t("payCard/js","CardPay payed")+s.join(", "),1e4,"error","center"),void 0;var r={Documents:a,Language:"uk"};n&&$.extend(r,n),$.ajax({url:"/payCard/getSenderPaymentInfo",data:r}).success(function(a){a.success?"98d779a7-bc88-4352-9093-c61137aa8b90"==a.data[0].Parameters.PaymentSystem?(cost=a.data[0].Parameters.bill_amount,DraftRef=a.data[0].Parameters.DraftRef,$("#accessPayCardModal #linkToCard").show(),oneClick.init(self.getSid())):($("body").append(self.makeServiceForm(a.data[0])),$("#payment-form").submit()):($.each(a.errors,function(e,n){var s=Yii.t("payCard/js",n);"undefined"!=typeof a.info[n]&&(s+=" "+a.info[n]),noty(s,1e4,"error","center")}),$("body").modalmanager("removeLoading"))}).error(function(){$("body").modalmanager("removeLoading"),noty(Yii.t("payCard/js","ERROR_OCCURRED"),3e3,"error","center")}).complete(function(){e&&e()}),$("#payCardModal").on("click","#backToCards",function(){$(".num").removeClass("activePay"),$(".num").css("display","block")}),$("#choosePayCardModal").on("click","#backToCards",function(){$(".num").removeClass("activePay"),$(".num").css("display","block"),$(".payByDefaultCard").removeClass("activePay")}),$("body").modalmanager("loading")},makeServiceForm:function(a){var e="";return e+='<form action="'+a.ServiceAction+'" method="'+a.ServiceMethod+'" id="payment-form">',e+='<input type="hidden" name="payee_id" value="'+a.Parameters.payee_id+'" />',e+='<input type="hidden" name="bill_amount" value="'+a.Parameters.bill_amount+'"/>',e+='<input type="hidden" name="description" value="'+a.Parameters.description+'"/>',e+='<input type="hidden" name="success_url" value="'+a.Parameters.success_url+'" />',e+='<input type="hidden" name="failure_url" value="'+a.Parameters.failure_url+'" />',e+='<input type="hidden" name="lang" value="'+a.Parameters.lang+'" />',e+='<input type="hidden" name="preauth_flag" value="'+a.Parameters.preauth_flag+'" />',e+='<input type="hidden" name="encoding" value="'+a.Parameters.encoding+'" />',e+='<input type="hidden" name="shop_order_number" value="'+a.Parameters.DraftRef+'" />',e+='<input type="submit" value="Оплатить" />',e+="</form>"},payCardCancel:function(a,e){$.ajax({url:"/payCard/cancelPayment",data:{Documents:a,Force:e}}).success(function(a){a.success?(noty(Yii.t("payCard/js","CARDPAY_CANCELLED"),1e4,"info","center"),$.each(a.info.arDocumentsCancelled,function(a,e){self.setCancelled(e)})):$.each(a.errors,function(e,n){if("CardPay document in order"==n){var s=Yii.t("payCard/js",n,{NUMBER:a.info.arDocuments.join(", "),OTHER_NUMBERS:a.info.arOtherDocuments.join(", ")});return confirm(s)&&self.payCardCancel(a.info.arDocuments,1),void 0}"CardPay document already cancelled"==n&&self.setCancelled(a.info.arDocuments[0]);var r="undefined"!=typeof a.info.arDocuments?a.info.arDocuments.join(", "):"",s=Yii.t("payCard/js",n,{NUMBER:r});noty(s,1e4,"error","center")})}).error(function(){noty(Yii.t("payCard/js","ERROR_OCCURRED"),3e3,"error","center")}).complete(function(){})},getTtnRow:function(a){var e=$("tr td .number:contains("+a+")").closest("tr");return e},setCancelled:function(a){var e=self.getTtnRow(a);e.find(".payCardCancel").closest(".js-btn").hide(),e.find(".payCardOne").closest(".js-btn").show(),e.find(".label-info-payed").removeClass("label-info-payed").text(Yii.t("payCard/js","Оплата отменена"))},newOrderCallback:function(a){$("#payCardDocumentLink").length&&"Sender"==$("#PayerType").val()&&"Cash"==$("#PaymentMethod").val()&&"Warehouse"==$neworder.getSenderType()&&$("#payCardDocumentLink").data("number",a).css({display:"inline-block"})}};
var $payment={init:function(){var t=$("body"),e=$("#PaymentMethod"),n=$("#PaymentSystem"),c=$("#MethodPayment");$(".methodPay").click(function(){e.val($(this).attr("data-paymentMethod")),n.val($(this).attr("data-paymentSystem"))}),$("#blockButtonFormLoad").hide(),$("#blockButtonForm").removeClass("hidden"),$("#blockPayment").find(".methodPay").on("click",function(){c.removeAttr("disabled")}),$configBox._pages.payDocumentMethod&&""!=e.val()&&""!=n.val()&&c.removeAttr("disabled"),$("#blockPayment > button:first").click(),$configBox._pages.choisMethodPay&&$("#confirmPaymentLoyaltyCart").on("click",t,function(){state=$(this).prop("checked"),state?$(".nextStep").removeAttr("disabled"):$(".nextStep").attr("disabled","disabled")}),$configBox._pages.confirmTtn&&this.initConfirmTtn(t),$configBox._pages.paymentDocuments&&this.initPaymentDocuments(t)},initConfirmTtn:function(t){t.on("click","tr.ordersList",function(){$payment.selectRow($(this).closest("tr.ordersList"))}),t.on("click","input",function(){$(this).prop("checked",!$(this).prop("checked"))}),t.on("click","#ordersOne",function(){var t=$(this).find("input.orderCheckAll");t.prop("checked",!t.prop("checked")),$payment.orderCheckAll(t,!0)}),t.on("click","#cancelPayTtn",function(){$payment.cancelPayTtn($(this))}),this.sumToPay($("input.orderCheckbox")),this.selectTable($("input.orderCheckbox"))},initPaymentDocuments:function(t){t.on("click","#showTTNPayment",function(){$("#viewTTNPayment").toggleClass("hide")}),t.on("click","#backPayMethod",function(){$("#hideButtonBack").click()})},selectRow:function(t){if(1!=this.payOneTTN){var e=t.find("input.orderCheckbox"),n=e.prop("checked");t.toggleClass("active",!n),e.prop("checked",!n),this.selectTable(t),this.sumToPay(t)}},orderCheckAll:function(t,e){if(1!=this.payOneTTN){var n=t.closest("table");if(e){var c=n.find("input.orderCheckAll").prop("checked");n.find("tr.ordersList").toggleClass("active",c),n.find("input.orderCheckbox").prop("checked",c)}this.selectTable(t)}},selectTable:function(t){var e=t.closest("table"),n=$("#cancelPayTtn"),c=$("#ConfirmTtn"),o=e.find("input.orderCheckbox:checked"),a=e.find("input.orderCheckbox"),i=o.length,r=a.length;i==r?e.find("input.orderCheckAll").prop("checked",!0):e.find("input.orderCheckAll").prop("checked",!1),0==r?$("#backPayMethod").click():1==r&&(e.find("input").hide(),a.prop("checked",!0),$(".ordersList").addClass("active"),i=1,this.payOneTTN=!0),0==i?(n.attr("disabled","disabled"),c.attr("disabled","disabled")):(1==i?(n.val(n.attr("data-cancelPayTtn_1")),c.val(c.attr("data-confirmTtn_1"))):i==r?(n.val(n.attr("data-cancelPayTtn_all")),c.val(c.attr("data-confirmTtn_all"))):(n.val(n.attr("data-cancelPayTtn_check")),c.val(c.attr("data-confirmTtn_check"))),n.removeAttr("disabled"),c.removeAttr("disabled")),this.sumToPay(t)},sumToPay:function(t){{var e=t.closest("table"),n=0;e.find("input.orderCheckbox:checked").each(function(){var t=$(this).closest("tr.ordersList").find(".sum").html().match(/(\d*\.\d{0,2})/);n+=parseFloat(t[1])})}$("#amountSum").html(n.toFixed(2))},documentsCheck:function(){var t=$("input.orderCheckbox:checked"),e=[];return $.each(t,function(){e.push($(this).val())}),e},cancelPayTtn:function(){var t=this.documentsCheck(),e={Documents:t},n={modelName:"InternetDocument",calledMethod:"unsetPaymentDocuments",methodProperties:e},c=function(e){1==e.response.success&&t.forEach(function(t){$("#"+t).remove()}),$payment.selectTable($("input.orderCheckbox")),$payment.sumToPay($("input.orderCheckbox"))},o={funk:c,data:{}};this.ajaxSend(n,o)},sandbox:function(t){t.funk&&t.funk(t.data)},ajaxSend:function(t,e){$.ajax({data:JSON.stringify(t),success:function(t){t.success===!0||(t.success===!1?noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже.")):noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))),e.data.response=t,$payment.sandbox(e)},error:function(){noty(Yii.t("orders/js","Произошла неизвестная ошибка. Попробуйте снова позже."))}})}};
function receiveMessage(a){"OK"==a.data.status?noty("Картка "+a.data.panMasked.substr(0,4)+" **** **** "+a.data.panMasked.substr(7,4)+" додана",5e3,"success","center"):noty("Картка не додана, спробуйте пізніше.",5e3,"error","center"),$("#UAPAYframe")[0].src="",$("#UAPAYframe").hide(),$("#addPaymentCard").show(),setTimeout(function(){$paymentCards.loadPaymentCardsContent()},5e3)}var $paymentCards={_loadCash2CardContentInProcess:!1,_cardRefToRemove:"",_cardRefToBlock:"",_cardRefToActive:"",_cardRefToEdit:"",init:function(){var a=$("body");a.on("click",".columnSettings",function(){$("#columnSettingsModal").modal("show")}),a.on("click","#columnViewSave",function(){$("#columnSettingsModal").modal("hide"),$("html").modalmanager("loading"),$("#columnSettingsForm").submit()}),$(".filter_journal_statuses_content").find(".element_check").change(function(a){a.stopPropagation(),$(this).prop("checked")?$(this).closest(".browser_element_main").addClass("active"):$(this).closest(".browser_element_main").removeClass("active")}),a.on("click",".paymentCardEdit",function(){$paymentCards._cardRefToEdit=$(this).attr("data_ref"),$("#CardPaymentDescription").val($(this).attr("data_desc")),$("#editPaymentCardModal").modal("show")}),a.on("click","#editPaymentCardSave",function(){var a={};return a.Ref=$paymentCards._cardRefToEdit,a.Description=$("#CardPaymentDescription").val(),a.Description?($paymentCards.editCard(a),void 0):(noty("Заполнены не все поля!"),void 0)}),a.on("click",".paymentCardUnBlock",function(){$paymentCards._cardRefToActive=$(this).attr("data_ref"),$("#confirmActivePaymentCardModalContent").html($(this).attr("data_desc")),$("#confirmActivePaymentCardModal").modal("show")}),a.on("click","#paymentCardActive",function(){$paymentCards.setCardStatus($paymentCards._cardRefToActive,"active")}),a.on("click",".paymentCardBlock",function(){$paymentCards._cardRefToBlock=$(this).attr("data_ref"),$(".confirmBlockPaymentCardModalContent").html($(this).attr("data_desc")),$("#confirmBlockPaymentCardModal").modal("show")}),a.on("click","#paymentCardBlock",function(){$paymentCards.setCardStatus($paymentCards._cardRefToBlock,"blocked")}),a.on("click",".paymentCardRemove",function(){$paymentCards._cardRefToRemove=$(this).attr("data_ref"),$(".confirmRemovePaymentCardModalContent").html($(this).attr("data_desc")),$("#confirmRemovePaymentCardModal").modal("show")}),a.on("click","#paymentCardRemove",function(){$paymentCards.removeCard($paymentCards._cardRefToRemove)}),a.on("click","#addPaymentCard",function(){$paymentCards.generateCardsAddUrl()}),$paymentCards.loadPaymentCardsContent()},editCard:function(a){$.ajax({url:Yii.app.createUrl("site/editCard"),type:"post",data:a,success:function(a){a.success?($("#editPaymentCardModal").modal("hide"),$paymentCards.loadPaymentCardsContent()):noty(a.errors[0],5e3,"error")},error:function(){noty(Yii.t("orders/js","Something going wrong, try later."),5e3,"error")}})},removeCard:function(a){var e={};e.Ref=a,$.ajax({url:Yii.app.createUrl("site/removeCard"),data:e,success:function(a){a.success?$paymentCards.loadPaymentCardsContent():noty(Yii.t("orders/js",a.errors[0]),5e3,"error")},error:function(){noty(Yii.t("orders/js","Something going wrong, try later."),5e3,"error")}}),$("#confirmRemovePaymentCardModal").modal("hide"),$(".confirmRemovePaymentCardModalContent").val("")},generateCardsAddUrl:function(){$.ajax({url:Yii.app.createUrl("site/generateCardAddUrl"),success:function(a){a.success?($("#UAPAYframe")[0].src=a.data[0].url,$("#UAPAYframe").show(),$("#addPaymentCard").hide()):noty(Yii.t("orders/js",a.errors[0]),5e3,"error")},error:function(){noty(Yii.t("orders/js","Something going wrong, try later."),5e3,"error")}})},setCardStatus:function(a,e){var t={};t.Ref=a,t.Status=e,$.ajax({url:Yii.app.createUrl("site/SetCardStatus"),type:"post",data:t,success:function(a){a.success?$paymentCards.loadPaymentCardsContent():noty(Yii.t("orders/js",a.errors[0]),5e3,"error")},error:function(){noty(Yii.t("orders/js","Something going wrong, try later."),5e3,"error")}}),$("#confirmBlockPaymentCardModal").modal("hide"),$(".confirmBlockPaymentCardModalContent").val(""),$("#confirmActivePaymentCardModal").modal("hide"),$("#confirmActiveaymentCardModalContent").val("")},loadPaymentCardsContent:function(){var a="";0==$paymentCards._loadCash2CardContentInProcess&&$.ajax({url:Yii.app.createUrl("site/PaymentCards"),type:"post",data:a,dataType:"html",beforeSend:function(){$("#paymentCardsData").find("tbody").html(""),$.each($noty,function(a,e){$(e.$note).hide()}),$noty=[];var a=$main.showProgressRow("","#paymentCardsData");$("#paymentCardsData").find("tbody").html(a)},success:function(a){$("#paymentCardsData").find("tbody").html(a)},complete:function(){$paymentCards._loadCash2CardContentInProcess=!1}})}};window.onload=function(){$("#getUaPayCards").click(function(){var a=document.getElementById("UAPAYframe");a&&window.addEventListener("message",receiveMessage,!1)})};
$redBoxes={recipientDataFilled:!1,init:function(){$handlers.handleSelectCounterpartyButton(),$handlers.handleRecipientSelectButton(),$handlers.handleSelectPaymentForm(),$handlers.handleSubmitForm(),$handlers.handlePaymentButton(),$handlers.handleServiceTypeChange(),$helpers.applyFieldMasks(),$("#SenderIsWarehouse").trigger("change")}},$redBoxes_index={init:function(){$handlers.handleOpenCreateRedBoxModal(),$handlers.handleCloseCreateRedBoxModal(),$handlers.handlePaymentOnListButton()}};var $handlers={handleOpenCreateRedBoxModal:function(){$helpers.scope.on("click",".createRedBox",function(){$("#orderRedBoxModal").modal("show")})},handleCloseCreateRedBoxModal:function(){$helpers.scope.on("click",".reset",function(){$.each($('#formSaveOrderChooseBoxes input[type="text"]'),function(e,t){$(t).val("")}),$("#orderRedBoxModal").modal("hide")})},handleChangeRedBoxQuantity:function(){$helpers.scope.on("keyup",'#formSaveOrderChooseBoxes input[type="text"]',function(){var e=0,t=0;$.each($('#formSaveOrderChooseBoxes input[type="text"]'),function(n,o){""!==$(o).val()&&(e+=parseInt($(o).val()),t+=parseInt($(o).val())*parseInt($(o).data("price")))}),$(".redBoxTotalUnits").text(e),$(".redBoxTotalPrice").text(t),0===e?$('#formSaveOrderChooseBoxes button[type="submit"]').attr("disabled","disabled"):$('#formSaveOrderChooseBoxes button[type="submit"]').removeAttr("disabled")})},handleRecipientSelectButton:function(){$counterparties.counterpartyProperty="Sender",$("#SenderSelectButton").text(Yii.t("newOrder/js","Натисніть для зміни ОДЕРЖУВАЧА")),$helpers.scope.on("click","#SenderSelectButton",function(){$functions.recipientSelectButton()})},handleSelectCounterpartyButton:function(){$helpers.scope.on("click","#selectCounterpartyButton",function(){$functions.fillSelectedCounterparty()})},handleSelectPaymentForm:function(){$helpers.scope.on("click","#blockPaymentsForms button",function(){$("#PaymentMethod").val($(this).data("type"))})},handleSubmitForm:function(){var e=!1;$("#formSaveRedBox").ajaxForm({beforeSubmit:function(){e||(e=!0,$("#progressLoadingForm").show(),$("#blockFooterButtons").hide())},success:function(e){if($(".control-group").removeClass("error"),null!=e&&void 0!=e.success){if(e.success===!1)return $.each(e.errors,function(e,t){$(".cell"+e).addClass("error"),""!=t&&$noty.push(noty(Yii.t("newOrder/js",t)))}),void 0}else if(null!=e){var t=[];$.each(e,function(e,n){t+=n.IntDocNumber+" "}),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Створені документи:")+" <b>"+t+"</b></p>").end().modal(),"NonCash"===$("#PaymentMethod").val()&&($.each(e,function(e,t){$("#documentCreatedModal").find("div.modal-body").append('<span class="DocumentToPay" data-number="'+t.IntDocNumber+'" style="display: none"></span>')}),$("#payCardDocumentRedBoxLink").trigger("click"))}else noty(Yii.t("redbox/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1,$("#progressLoadingForm").hide(),$("#blockFooterButtons").show()},error:function(){$("#progressLoadingForm").hide(),$("#submitNewOrderButton").show(),e=!1}})},handlePaymentButton:function(){$helpers.scope.on("click","#payCardDocumentRedBoxLink",function(){var e=$(".DocumentToPay"),t=[];$.each(e,function(e,n){t.push(parseInt($(n).data("number")))}),$paycard.payCard(t,null,{IsRedbox:1})})},handlePaymentOnListButton:function(){$helpers.scope.on("click",".DocumentToPay",function(){var e=[];e.push(parseInt($(this).data("number"))),$paycard.payCard(e)})},handleServiceTypeChange:function(){$helpers.scope.on("change","#SenderIsWarehouse",function(){"false"==$(this).val()?($("#blockPaymentsForms [data-type=NonCash]").addClass("disabled").attr("disabled","disabled"),$("#blockPaymentsForms [data-type=Cash]").trigger("click")):$("#blockPaymentsForms [data-type=NonCash]").removeClass("disabled").attr("disabled",!1)})}},$functions={recipientSelectButton:function(){var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),n=$("#SenderAddressRef").val(),o=$("#SenderContactRef").val();$counterparties.clear_lists(t,n,o,e)},fillSelectedCounterparty:function(){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),n=$counterparties.get_filled_element("address_ul"),o=$counterparties.get_filled_element("contacts_ul");$("#SenderCityText").html($("#cities_ul").find("li.active").text().trim()),$("#SenderCityRef").val(e.ref).trigger("change"),$("#SenderAreaRef").val(e.area),$("#SenderConglomeratesRef").val('["'+e.conglomerates.join('","')+'"]'),$("#SenderCounterpartyText").html(t.description),$("#SenderCounterpartyRef").val(t.ref),$("#SenderAddressText").html(n.description),$("#SenderAddressRef").val(n.ref),$("#SenderContactText").html(o.description),$("#SenderContactRef").val(o.ref),$("#SenderPhoneText").html(o.phone),$("#SenderPhone").val(o.phone),$("#SenderEDRPOU").val(t.edrpou),$("#SenderOwnershipForm").val(t.ownershipform),$("#SenderCounterpartyType").val(t.counterpartytype),$("#SenderIsWarehouse").val(n.warehouse).trigger("change"),$("#selectCounterpartyModal").modal("hide")}},$helpers={scope:$("body"),applyFieldMasks:function(){$("input.mask-integer").mask("#"),$("input.mask-char_filter").mask("L")}};
$redBoxesMobile={init:function(){$scope=$("body"),$handlersMobile.handleRedBoxChange($scope),$handlersMobile.handleLastNameSearch($scope),$handlersMobile.handleCityLiveSearch($scope),$handlersMobile.handleWarehouseLiveSearch($scope),$handlersMobile.handleServiceTypeChange($scope),$handlersMobile.handleStreetLiveSearch($scope),$handlersMobile.handlePrivateHouse($scope),$handlersMobile.handleSubmitForm($scope),$handlersMobile.handlePaymentButton($scope),$handlersMobile.handleKeyboardSpace($scope),$("select[name=RedBox]").trigger("change")}};var $handlersMobile={handleServiceTypeChange:function(e){e.on("change","input[name=ServiceType]",function(){"Warehouse"==$(this).val()?($(".js-address-warehouse").show(),$(".js-address-doors").hide(),$(".js-address-warehouse input").prop("disabled",!1),$(".js-address-doors input").prop("disabled","disabled"),$("[name=PaymentMethod][value=NonCash]").prop("disabled",!1)):($(".js-address-doors").show(),$(".js-address-warehouse").hide(),$(".js-address-doors input").prop("disabled",!1),$(".js-address-warehouse input").prop("disabled","disabled"),$("[name=PaymentMethod][value=NonCash]").prop("disabled","disabled"),$("[name=PaymentMethod][value=Cash]").prop("checked","checked")),$(".js-cities").html("")})},handleRedBoxChange:function(e){e.on("change","select[name=RedBox]",function(){var e=$(this).find("option:selected");$("input[name=Cost]").val(e.data("cost")+" грн")})},handleLastNameSearch:function(e){var a,t=1e3,n=$(".js-contacts"),i=$("#progressSearchLastName");e.on("keyup","input[name=LastName]",function(){clearTimeout(a),n.html("");var e=$(this).val();if(!(e.length<3)){var o=$("input[name=RecipientsPhone]").val(),s={LastName:e,Phone:o},r={apiKey:window.apiKey,modelName:"Counterparty",calledMethod:"getCatalogCounterparty",methodProperties:s};a=setTimeout(function(){$.ajax({dataType:"json",type:"POST",data:JSON.stringify(r),beforeSend:function(){i.show()},success:function(e){if(e.data.length){var a='<ul class="nav nav-list bs-docs-sidenav journal_block" id="contacts_ul">';$.each(e.data,function(e,t){a+='<li class="browser_element_main"  data-lastname="'+t.LastName+'" data-firstname="'+t.FirstName+'" data-middlename="'+t.MiddleName+'"><a>'+t.Description+"("+t.LastName+" "+t.FirstName+" "+t.MiddleName+")</a></li>"}),a+="</ul>"}else var a=Yii.t("redBoxMobile/js","Counterparty not found",null,window.language);n.html(a)},complete:function(){i.hide()},error:function(){i.hide()}})},t)}}),e.on("click","#contacts_ul li.browser_element_main",function(){$("input[name=LastName]").val($(this).data("lastname")),$("input[name=FirstName]").val($(this).data("firstname")),$("input[name=MiddleName]").val($(this).data("middlename")),n.html("")})},handleCityLiveSearch:function(e){var a,t=1e3,n=$(".js-cities"),i=$("#progressSearchSettlement");e.on("keyup","input[name=City]",function(){clearTimeout(a),n.html("");var e={FindByString:$(this).val(),CityFisrt:1,Limit:5};"Warehouse"==$("input[name=ServiceType]:checked").val()&&(e.Warehouse=!0);var o={apiKey:window.apiKey,modelName:"Address",calledMethod:"getSettlements",methodProperties:e};a=setTimeout(function(){$.ajax({dataType:"json",type:"POST",data:JSON.stringify(o),beforeSend:function(){i.show()},success:function(e){if(e.data.length){var a='<ul class="nav nav-list bs-docs-sidenav journal_block" id="cities_ul">';$.each(e.data,function(e,t){if("ua"==window.language){var n=t.SettlementTypeDescription+" "+t.Description;t.RegionsDescription&&(n+=", "+t.RegionsDescription),t.AreaDescription&&(n+=", "+t.AreaDescription)}else{var n=t.SettlementTypeDescriptionRu+" "+t.DescriptionRu;t.RegionsDescriptionRu&&(n+=", "+t.RegionsDescriptionRu),t.AreaDescriptionRu&&(n+=", "+t.AreaDescriptionRu)}a+='<li class="browser_element_main" data-settlement="'+t.Ref+'" data-description="'+t.Description+'" data-area="'+t.AreaDescription+'" data-region="'+t.RegionsDescription+'" ><a>'+n+"</a></li>"}),a+="</ul>"}else var a=Yii.t("redBoxMobile/js","City not found",null,window.language);n.html(a)},complete:function(){i.hide()},error:function(){i.hide()}})},t)}),e.on("click","#cities_ul li.browser_element_main",function(){$("input[name=SettlementRef]").val($(this).data("settlement")),$("input[name=City]").val($(this).text()),$("input[name=RecipientCityName]").val($(this).data("description")),$("input[name=RecipientArea]").val($(this).data("area")),$("input[name=RecipientAreaRegions]").val($(this).data("region")),n.html("")})},handleWarehouseLiveSearch:function(e){var a,t=1e3,n=$(".js-warehouses"),i=$("#progressSearchWarehouse");e.on("keyup","input[name=Warehouse]",function(){clearTimeout(a),n.html("");var e={apiKey:window.apiKey,modelName:"Address",calledMethod:"getWarehouses",methodProperties:{SettlementRef:$("input[name=SettlementRef]").val(),FindByString:$(this).val(),Limit:5}};a=setTimeout(function(){$.ajax({dataType:"json",type:"POST",data:JSON.stringify(e),beforeSend:function(){i.show()},success:function(e){if(e.data.length){var a='<ul class="nav nav-list bs-docs-sidenav journal_block" id="warehouses_ul">';$.each(e.data,function(e,t){if("ua"==window.language)var n=t.Description;else var n=t.DescriptionRu;a+='<li class="browser_element_main" data-ref="'+t.Ref+'" data-description="'+t.Description+'"><a>'+n+"</a></li>"}),a+="</ul>"}else var a=Yii.t("redBoxMobile/js","Warehouse not found",null,window.language);n.html(a)},complete:function(){i.hide()},error:function(){i.hide()}})},t)}),e.on("click","#warehouses_ul li.browser_element_main",function(){$("input[name=Warehouse]").val($(this).data("description")),$("input[name=WarehouseRef]").val($(this).data("ref")),n.html("")})},handleStreetLiveSearch:function(e){var a,t=1e3,n=$(".js-streets"),i=$("#progressSearchStreet");e.on("keyup","input[name=RecipientAddressName]",function(){n.html("");var e=$(this).val();if(!(e.length<4)){clearTimeout(a);var o={apiKey:window.apiKey,modelName:"Address",calledMethod:"getSettlementStreets",methodProperties:{SettlementRef:$("input[name=SettlementRef]").val(),FindByString:e,Limit:10}};a=setTimeout(function(){$.ajax({dataType:"json",type:"POST",data:JSON.stringify(o),beforeSend:function(){i.show()},success:function(e){if(e.data.length){var a='<ul class="nav nav-list bs-docs-sidenav journal_block" id="streets_ul">';$.each(e.data,function(e,t){if("ua"==window.language)var n=t.StreetsType+" "+t.Description;else var n=t.StreetsType+" "+t.DescriptionRu;a+='<li class="browser_element_main" data-ref="'+t.Ref+'" data-description="'+n+'"><a>'+n+"</a></li>"}),a+="</ul>"}else var a=Yii.t("redBoxMobile/js","Street not found",null,window.language);n.html(a)},complete:function(){i.hide()},error:function(){i.hide()}})},t)}}),e.on("click","#streets_ul li.browser_element_main",function(){$("input[name=RecipientAddressName]").val($(this).data("description")),n.html("")})},handlePrivateHouse:function(e){e.on("change","input[name=PrivateHouse]",function(){$(this).is(":checked")?($(".js-flat").hide(),$(".js-flat input").prop("disabled","disabled")):($(".js-flat").show(),$(".js-flat input").prop("disabled",!1)),$(".js-cities").html("")})},handleSubmitForm:function(){var e=!1,a=$("#progressSubmit"),t=$("#SubmitButton");$("#formSaveRedBoxMobile").ajaxForm({beforeSubmit:function(){e||(e=!0,a.show(),t.hide())},success:function(e){if($(".control-group").removeClass("error"),null!=e&&void 0!=e.success){if(e.success===!1)return $.each(e.errors,function(e,a){$(".cell"+e).addClass("error"),""!=a&&$noty.push(noty(Yii.t("newOrder/js",a)))}),void 0}else if(null!=e)if("NonCash"==$("[name=PaymentMethod]:checked").val())$modal=$("#documentCreatedModal").find("div.modal-body"),$modal.find(".DocumentToPay").remove(),$.each(e,function(e,a){$modal.append('<span class="DocumentToPay" data-number="'+a.IntDocNumber+'" style="display: none"></span>')}),$("#payCardDocumentRedBoxLink").trigger("click");else{var a=[];$.each(e,function(e,t){a+=t.IntDocNumber+" "}),$("#documentCreatedModal").find("div.modal-body").html("<p>"+Yii.t("newOrder/js","Створені документи:")+" <b>"+a+"</b></p>").end().modal()}else noty(Yii.t("redbox/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1,a.hide(),t.show()},error:function(){e=!1,a.hide(),t.show()}})},handlePaymentButton:function(e){e.on("click","#payCardDocumentRedBoxLink",function(){var e=$(".DocumentToPay"),a=[];$.each(e,function(e,t){a.push(parseInt($(t).data("number")))}),$paycard.payCard(a,null,{IsRedbox:1})})},handleKeyboardSpace:function(e){e.on("focus","input[type=text]",function(){$(".mp-keyboard-space").css({height:"150px"});var e=$(document).scrollTop()+150;$(document).scrollTop(e)}),e.on("blur","input[type=text]",function(){$(".mp-keyboard-space").css({height:"0px"})})}};
var $registration={init:function(){$(".tabs-registration .button-tab").click(function(){if(!$(this).hasClass("selected")){var t="business"==$(this).data("type")?1:0;$("#NovaposhtaRegistrationRequestForm_IsLegal").val(t),$("#legalData").toggleClass("hide"),$(".button-tab.selected").removeClass("selected"),$(this).addClass("selected")}}),$("#NovaposhtaRegistrationRequestForm_IsLegal").val()&&$('.tabs-registration .button-tab[data-type="business"]').trigger("click"),$("input.mask-cardnumber").keyup(function(){$(this).mask("#")}),$("input.mask-passportnumber").keyup(function(){$(this).mask("099999")}),$("input.mask-passportseries").keyup(function(){$(this).mask("YYY")}),$("input.mask-edrpou").keyup(function(){$(this).mask("0999999999")}),$("input.mask-name").keyup(function(){$(this).mask("Y",{translation:{Y:{pattern:/[\u0430-\u044F\u0410-\u042F\u0451\u0401\u0457\u0407\u0454\u0404\u0456\u0406\s\-]/,recursive:!0}}})}),$("input.mask-phone").keyup(function(){$(this).mask("0999999999",{translation:{0:{pattern:/[0]/},9:{pattern:/[\d]/}}})});var t=$("#BirthDate"),e=new Date,a=e.getFullYear()-100,s=e.getFullYear()-16,i=e.getMonth()+1,o=e.getDate();t.datetimepicker({autoclose:!0,startDate:"01.01."+a,endDate:o+"."+i+"."+s,startView:"decade",minView:2,maxView:4,todayBtn:!1,todayHighlight:!1,language:"uk",weekStart:1,showHour:!1,showMinute:!1,format:"dd.mm.yyyy",clearBtn:!0});var n=$.parseJSON($("#RegistrationRequestForm_Position").attr("data-source"));$("#RegistrationRequestForm_Position").on("blur",function(){$.inArray($(this).val(),n)<0&&$(this).val("")});var r=$("#RegistrationRequestForm_OwnerShipForm"),u=$("#RegistrationRequestForm_EDRPOU");r.change(function(){"7f0f351e-2519-11df-be9a-000c291af1b3"==r.val()?u.val("").attr("maxlength","10"):u.val("").attr("maxlength","8")}),$("#RegistrationRequestForm_Phone, #ActivateRegistrationRequestForm_Phone, #NovaposhtaRegistrationRequestForm_Phone").intlTelInput({onlyCountries:["ua"]}).change(),$("#NovaposhtaRegistrationRequestForm_LastName, #NovaposhtaRegistrationRequestForm_FirstName, #NovaposhtaRegistrationRequestForm_MiddleName").google_virtual_keyboard()}};
function dump(e){var t="";if(e&&"object"==typeof e)for(var r in e)t+=r+": "+e[r]+"\n";else t=e;alert(t)}var $reports={_processedCounterpartyType:"",_processSelectCounterpartyText:"",_counterpartyOptions:{},_selectedCounterpartiesCount:0,_formSubmitInProgress:!1,init:function(){$("#selectCounterpartyButton").on("click",function(){$reports.fillSelectedCounterparty()}),$(".addSenderCounterparty").on("click",function(){$reports.senderSelectButton()}),$(".addRecipientCounterparty").on("click",function(){$reports.recipientSelectButton()}),$(".counterpartyDataContainer .counterpartyDelete").live("click",function(e){$(e.target).closest(".counterpartyNode").remove()}),$("input.mask-integer_12").mask("099999999999"),$("input.mask-integer_4").mask("0999"),$("input.mask-float_7_2").mask("0999999C09"),$reports.initAjaxForm(),$reports.initTimePickers(),$reports.initDeleteButtons()},initTimePickers:function(){$(".initDT").datetimepicker({autoclose:!0,minView:3,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1,format:"dd.mm.yyyy"});var e=["dateCreated","dateSended","dateDelivered","dateReceipt"];$.each(e,function(e,t){$("#"+t+"From").datetimepicker().on("changeDate",function(){var e=$("#"+t+"From"),r=e.val().split(/\./),n=new Date(r[2],r[1]-1,r[0]),o=$("#"+t+"To");if(n instanceof Date&&!isNaN(n.getTime())){if(""!=o.val()){var a=o.val().split(/\./),i=new Date(a[2],a[1]-1,a[0]);parseInt(i.getTime())-parseInt(n.getTime())<0&&o.datetimepicker("setDate",n)}o.datetimepicker("setStartDate",n),o.datetimepicker("update")}})});var e=["Weight","Cost","SeatsAmount","CostOnSite"];$.each(e,function(e,t){$("#"+t+"From").on("blur",function(){var e=$("#"+t+"From"),r=$("#"+t+"To");""==r.val()||isNaN(r.val())||parseInt(r.val())-parseInt(e.val())<0&&r.val(e.val())})})},initDeleteButtons:function(){$(".removeReport").on("click",function(){if(confirm(Yii.t("reports","Вы подтверждаете удаление?"))){var e=$(this).data("ref");return window.location.pathname=Yii.app.createUrl("reports/removeReport",{Ref:e}),!0}return!1})},senderSelectButton:function(){if("Sender"!=$reports._processedCounterpartyType){$reports._processedCounterpartyType="Sender",$counterparties.counterpartyProperty="Sender";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),n=$("#SenderContactRef").val();$counterparties.clear_lists(t,r,n,e)}},recipientSelectButton:function(){if("Recipient"!=$reports._processedCounterpartyType){$reports._processedCounterpartyType="Recipient",$counterparties.counterpartyProperty="Recipient";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),r=$("#SenderAddressRef").val(),n=$("#SenderContactRef").val();$counterparties.clear_lists(t,r,n,e)}},addCounterparty:function(e,t,r,n){var o="",a=document.createElement("div");if(void 0!==e){var i=document.createElement("input");i.type="hidden",i.name=""+$reports._processedCounterpartyType+"Counterparties["+$reports._selectedCounterpartiesCount+"][CityRef]",i.value=e.ref,a.appendChild(i),o+=e.description}if(void 0!==t){var i=document.createElement("input");i.type="hidden",i.name=""+$reports._processedCounterpartyType+"Counterparties["+$reports._selectedCounterpartiesCount+"][CounterpartyRef]",i.value=t.ref,a.appendChild(i),o+=", "+t.description}if(void 0!==r){var i=document.createElement("input");i.type="hidden",i.name=""+$reports._processedCounterpartyType+"Counterparties["+$reports._selectedCounterpartiesCount+"][AddressRef]",i.value=r.ref,a.appendChild(i);var i=document.createElement("input");i.type="hidden",i.name=""+$reports._processedCounterpartyType+"Counterparties["+$reports._selectedCounterpartiesCount+"][IsWarehouse]",i.value="true"==r.warehouse?1:0,a.appendChild(i),o+=", "+r.description}if(void 0!==n){var i=document.createElement("input");i.type="hidden",i.name=""+$reports._processedCounterpartyType+"Counterparties["+$reports._selectedCounterpartiesCount+"][ContactRef]",i.value=n.ref,a.appendChild(i),o+=", "+n.description}if(""!==o){var s=document.createElement("div");s.className="counterpartyTitle",s.innerHTML=o,a.appendChild(s)}if(""!==o){var s=document.createElement("div");s.className="counterpartyDelete",s.innerHTML='<a class="btn btns btn-small" ><i class="icon-trash"></i></a>',a.className="counterpartyNode",a.appendChild(s),document.getElementById($reports._processedCounterpartyType+"CounterpartiesData").appendChild(a),$reports._selectedCounterpartiesCount++}},fillSelectedCounterparty:function(){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),r=$counterparties.get_filled_element("address_ul"),n=$counterparties.get_filled_element("contacts_ul");$reports.addCounterparty(e,t,r,n),$("#selectCounterpartyModal").modal("hide")},initAjaxForm:function(){$reports.formSubmitInProgress||$("#CreateNewReport").ajaxForm({beforeSubmit:function(){$reports.formSubmitInProgress||$reports.beginAjax()},success:function(e){$reports.afterAjax(),$(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0?$("#documentCreatedReport").modal().show():null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){""!=t&&noty(Yii.t("reports/js",t))}):noty(Yii.t("reports/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){$reports.afterAjax()},error:function(){$reports.afterAjax()}})},beginAjax:function(){$reports.formSubmitInProgress=!0,$("#progressLoadingForm").show(),$("#formSubmitButton").attr("disabled",!0)},afterAjax:function(){$reports.formSubmitInProgress=!1,$("#progressLoadingForm").hide(),$("#formSubmitButton").attr("disabled",!1)}};
$scanSheets={_ScanSheetRefs:[],init:function(){{var t=$("body");$(".scanSheetContent")}t.on("click","input.scanSheetCheckAll",function(){var t=$(this),e=t.closest("table");e.find("input.scanSheetCheckbox:visible").prop("checked",t.prop("checked")),e.find("tr.scanSheetList:visible").toggleClass("active",t.prop("checked")),e.find("input.scanSheetCheckAll").prop("checked",t.prop("checked"))}),$(".openScanSheet").click(function(t){var e=$(this),a=e.closest("tr").next("tr").find(".scanSheet"),r=e.closest("tr").next("tr").find(".scanSheetContent"),n=e.closest("tr").attr("data-groupId");e.find("i").toggleClass("icon-folder-close-alt").toggleClass("icon-folder-open-alt").end().closest("tr").next("tr").toggle().end(),a.hasClass("loaded")||$.ajax({url:Yii.app.createUrl("scanSheet/getScanSheet",{scanSheet:n}),dataType:"html",success:function(t){a.addClass("loaded"),a.find(".progress").remove(),a.html(t)}}),r.hasClass("loaded")||$.ajax({url:Yii.app.createUrl("orders/index",{getTable:"true",getPage:"false",groupId:n,OrderField:"IntDocNumber"}),dataType:"html",success:function(t){r.addClass("loaded"),r.find(".progress").remove(),r.html(t),$orders.filters.init(r.find(".ordersForm")),r.find(".ordersForm").submit(),$orders.print.init(r.find(".ordersForm"))}}),t.preventDefault(),t.stopPropagation()}),t.on("click","a.removeScanSheet",function(t){var e=$(this);$scanSheets._ScanSheetRefs=[],$scanSheets._ScanSheetRefs.push(e.data("ref")),$("#removeScanSheetModal").modal("show"),t.preventDefault(),t.stopPropagation()}),$("body").on("click","#removeScanSheetButton",function(){var t=$(this);$scanSheets._ScanSheetRef=t.closest(".modal").find("li.active").data("ref"),$scanSheets.removeScanSheet("ScanSheet")}),t.on("click","a.printScanSheetPackPdf",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("scanSheet/printScanSheet",{type:"pdf"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetPackPdfPortrait",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("scanSheet/printScanSheet",{type:"pdf",orientation:"portrait"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetPackHtml",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("scanSheet/printScanSheet",{type:"html"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetPackHtmlPortrait",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("scanSheet/printScanSheet",{type:"html",orientation:"portrait"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetMarkPackPdf",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"pdf"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetMarkPackHtml",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"html"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetNewMarkPackHtml",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"html"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetNewMarkPackZebra",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"html",zebra:"zebra"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),t.on("click","a.printScanSheetNewMarkPackZebraPdf",function(t){var e=$(this).closest(".scanSheetForm"),a=e.attr("action"),r=$("input.scanSheetCheckbox:checked");r.each(function(){$(this).closest("tr").find(".buttonEditDocument").hide()}),r.length>0?($orders.documents._ajaxSubmit=!1,e.attr("target","_blank").attr("action",Yii.app.createUrl("orders/printMarkings",{type:"pdf",zebra:"zebra"})).submit().attr("target","").attr("action",a),$orders.documents._ajaxSubmit=!0):noty(Yii.t("orders/js","Сначала отметьте документы для печати"),3e3,"warning","center"),t.preventDefault(),t.stopPropagation()}),$scanSheets.paginator.init(t)},paginator:{init:function(t){$scanSheets.paginator.checkPagination(t),t.on("click","a.paginatorScanSheet",function(){var e=$(this);if(e.hasClass("disabled"))return!1;var a,r=e.closest(".paginatorBlockScanSheet"),n=parseInt(r.attr("data-current-page")),s=e.attr("data-next-page");"-"==s?a=n-1:"+"==s&&(a=n+1),r.attr("data-current-page",a).find(".paginatorCurrentPageInfoScanSheet").text(a);var i=Yii.app.createUrl("scanSheet/index",{page:a});return e.closest("form").attr("action",i).submit(),history.pushState("","",Yii.app.createUrl("scanSheet/index",{page:a})),$scanSheets.paginator.checkPagination(t),!1})},checkPagination:function(t){var e=t.find(".paginatorBlockScanSheet");if(e.length){var a=parseInt(e.attr("data-current-page"));1>=a?e.find(".paginatorPrevScanSheet").addClass("disabled"):e.find(".paginatorPrevScanSheet").removeClass("disabled"),__scanSheetListDefaultLimit!=$(".scanSheetForm table.ordersList tbody tr.scanSheetList").length?e.find(".paginatorNextScanSheet").addClass("disabled"):e.find(".paginatorNextScanSheet").removeClass("disabled")}}},removeScanSheet:function(t){var e={ScanSheetRefs:$scanSheets._ScanSheetRefs},a={modelName:t,calledMethod:"deleteScanSheet",methodProperties:e};$.ajax({data:JSON.stringify(a),beforeSend:function(){$.each($scanSheets._ScanSheetRefs,function(t,e){var a=$("#"+e),r=$scanSheets.showProgressRow(e);a.hide().next("tr").hide().end().after(r)})},success:function(t){$.each(t.data.ScanSheetRefs,function(t,e){$.each(e,function(e,a){switch(t){case"Errors":noty(Yii.t("scanSheet/js","Ведомость")+" "+a.Number+" "+Yii.t("scanSheet/js","не удалена из-за ошибки:")+" "+Yii.t("scanSheet/js",a.Error),3e3,"error"),$("#"+a.Ref).show();break;case"Success":noty(Yii.t("scanSheet/js","Ведомость")+" "+a.Number+" "+Yii.t("scanSheet/js","успешно удалена"),3e3,"success")}$scanSheets.hideProgressRow(a.Ref)})}),$("#removeScanSheetModal").modal("hide")},complete:function(){$.each($orders.scanSheet._DocumentRefs,function(t,e){var a=$("#"+e);$orders.hideProgressRow(e),a.show()}),0==$(".ordersList tr[data-groupId]:visible").length?$("#emptyRow").show():$("#emptyRow").hide()}})},showProgressRow:function(t){var e=$("tr:first > th").length;return $("<tr>").attr("id",t+"_progress").append($("<td>").attr("colspan",e).append($("<div>").addClass("progress").addClass("progress-striped").addClass("active").css("margin","5px 0").append($("<div>").addClass("bar").addClass("bar-danger").css("width","100%"))))},hideProgressRow:function(t){$("#"+t+"_progress").hide()},showUndeleteButton:function(t,e,a){$orders.hideProgressRow(e);var r=$("table.ordersList").find("tr:first > th").length;t.after($("<tr>").append($("<td>").hide().attr("colspan",r).append($("<a>").text(Yii.t("orders/js","Отменить удаление")).attr("href","#").attr("data-ref",e).attr("data-type",a)).addClass("unDelete").slideDown().css("display","")))},undelete:function(t){var e=$(t),a=e.data("ref"),r=e.data("type"),n=[];n.push(a);var s={DocumentRefs:n},i={modelName:r,calledMethod:"cancelDeletion",modelProperties:s};$.ajax({data:JSON.stringify(i),beforeSend:function(){e.closest("tr").hide().after($orders.showProgressRow(a))},success:function(t){t.success===!0?$("#"+a).slideDown("fast"):(e.closest("tr").show(),$.each(t.errors,function(t,e){noty(Yii.t("counterparties/js",e),3e3,"error","center")})),$orders.hideProgressRow(a)}})}};
var $scansheet_only={init:function(){var e=$(".scanSheetsList");e.find(".filter_journal_cities_counterparty").fastLiveFilter(".scanSheetsList .cities_ul_counterparty"),e.on("click",".cities_ul_counterparty > li.browser_element_main",function(){var e=$(this);if(!e.hasClass("active")){{e.attr("data-ref")}e.parent().find("li").removeClass("active"),e.addClass("active"),$scansheet_only.check_fields_filled()}});var t=e.find(".ScanSheetDate"),a=t.val(),i=new Date;i.setHours(i.getHours()),t.datetimepicker({startDate:i,autoclose:!0,minView:4,maxView:2,todayBtn:!0,todayHighlight:!0,language:"uk",weekStart:1,format:"dd.mm.yyyy"}).change(function(e){$(this).val()!=a&&(a=$(e.currentTarget).val())});var n=e.find(".block_date");$(".none_date").on("click",function(){n.slideUp()}),$(".add_date").on("click",function(){n.slideDown()})},check_fields_filled:function(){var e=$(".scanSheetsList").find(".cities_ul_counterparty").find("li.active");return e.length>0?($("#selectScanSheetButton").removeClass("disabled"),!0):($("#selectScanSheetButton").addClass("disabled"),!1)}};
var $settings={init:function(){var a=$("#tabs");a.bind("show",function(a){var t=$(this),i=/#.+/gi,e=a.target.toString().match(i)[0];if(window.location.hash=e.replace("#",""),!$(a.target).hasClass("static")){var n=$(e);n.hasClass("loaded")||$.ajax({url:Yii.app.createUrl("settings/"+e.replace("#","")),method:"GET",dataType:"html",ifModified:!0,beforeSend:function(){n.html('<div class="progress progress-striped active"><div class="bar bar-danger" style="width: 100%;"></div></div>')},success:function(a){n.addClass("loaded").html(a),$main.activeMenu(),$main.activeHover(),"#payment"==e?$paymentCards.loadPaymentCardsContent():"#additionalServices"==e&&$settingsAdditionalServices.onload()},error:function(){n.html("<h1>Error 404</h1>")},complete:function(){t.tab()}})}});var t;t=window.location.hash?a.find('a[href^="'+window.location.hash+'"]'):a.find("a:first"),t.click()}};
var $settingsAdditionalServices={modal:null,init:function(){$(document).on("hover",".popovr_modal",function(){var t=!1;$(".popover ").each(function(e,i){"block"==i.style.display&&(t=!0,i.style.display="none")}),0==t&&$(this).popover("show")}),$(document).on("show.bs.modal",".settingsAdditionalServices.modal",function(){$settingsAdditionalServices.modal=$(this).find(".modal-body").html()}),$(document).on("hide.bs.modal",".settingsAdditionalServices.modal",function(){$(this).find(".modal-body").html($settingsAdditionalServices.modal)}),$(document).on("click","#counterparties_ul_add li.browser_element_main, #counterparties_ul_edit li.browser_element_main",function(t){if(isLabel=$(t.target).hasClass("element_label"),!isLabel){isCheckbox=$(t.target).hasClass("element_check");var e=$(this),i=$(this).find(".element_check");e.hasClass("active")?(isCheckbox||i.attr("checked",!1),e.removeClass("active")):(isCheckbox||i.attr("checked","checked"),e.addClass("active"))}}),$(document).on("keypress, keyup","[name=days]",function(){$(this).removeClass("error"),$(this).val()>10&&$(this).val(10)}),$(document).on("click","#submitAutoReturn",function(){0==$(".settingsAdditionalServicesOneCounterparty").length&&0==$("#counterparties_ul").find("li input[type=checkbox]:checked(:not)").length?noty(Yii.t("settings/additionalServices","Выберите контрагента"),3e3,"warning","center"):$("#formAutoReturn").submit()}),$(document).on("click","#submitAutoReturnEdit",function(){$("#formAutoReturnEdit").submit()}),$(document).on("click","#submitAutoReturnEditDisable",function(){$("#counterparties_ul_edit input[type=checkbox]:checked").each(function(){$(this).attr("checked",!1)}),$("#formAutoReturnEdit").submit()}),$(document).on("click","#submitTermExtension",function(){"checked"==$("input[name='orderRecipient']").attr("checked")&&""==$("#days").val()?noty(Yii.t("settings/additionalServices","Укажите количество дней"),3e3,"warning","center"):$("#formTermExtension").submit()}),$(document).on("click","#submitTermExtensionDisable",function(){$("input[name=orderRecipient]").val(0),$("input[name=days]").val(0),$("#formTermExtension").submit()}),$(document).on("click","#autoReturnShowCounterparties",function(){$("#couterpartiesBlock").show()}),$(document).on("click","#formAutoReturn #selectAllCounterparties, #formAutoReturnEdit #selectAllCounterparties",function(){0!=$(this).closest(".modal").find(".nav input[type=checkbox]:not(:checked)").length?($(this).closest(".modal").find(".nav input[type=checkbox]:not(:checked)").each(function(){$(this).trigger("click")}),$(this)[0].checked=!0):($(this).closest(".modal").find(".nav input[type=checkbox]:checked(:not)").each(function(){$(this).trigger("click")}),$(this)[0].checked=!1)}),$(document).on("submit","#formAutoReturn, #formAutoReturnEdit",function(t){$days=$(this).find("[name=days]");var e=$days.val().trim();e||(t.preventDefault(),$days.addClass("error"),console.log($days.siblings()),$days.siblings().filter(".error-container").text(Yii.t("settings/js","заполните поле")).show())})},onload:function(){}};
var $settings_counterparties={init:function(){function r(r){var r=r||"Sender";if("ThirdPerson"==r)var t=Yii.app.createUrl("counterpartiesOnly/index",{partial:"true",filterForm:"true"});else var t=Yii.app.createUrl("counterparties/index",{partial:"true"});$.ajax({url:t,dataType:"html",beforeSend:function(){$("#counterpartiesData").html('<div class="progress progress-striped active"><div class="bar bar-danger" style="width: 100%;"></div></div>')},success:function(t){$("#counterpartiesData").html(t),"ThirdPerson"==r?($counterpartiesOnly.counterpartyProperty=r,$counterpartiesOnly.init()):($counterparties.counterpartyProperty=r,$counterparties.init())},error:function(){console.log("error loading counterparties")}})}r(),$("button.payerType").click(function(){var t=$(this);r(t.data("type")),$counterparties.counterpartyProperty=t.data("type"),$("#cities_ul").find("li").removeClass("active"),$("#filter_journal_cities").val("").trigger("keydown")})}};
var $universalMassiveUpload_index={_processedCounterpartyType:"",_processSelectCounterpartyText:"",_counterpartyOptions:{},_selectedCounterpartiesCount:0,init:function(){$("#selectCounterpartyButton").on("click",function(){$universalMassiveUpload_index.fillSelectedCounterparty()}),$(".addSenderCounterparty").on("click",function(){$universalMassiveUpload_index.senderSelectButton()}),$(".addRecipientCounterparty").on("click",function(){$universalMassiveUpload_index.recipientSelectButton()}),$(".counterpartyDataContainer .counterpartyDelete").live("click",function(e){$(e.target).closest(".counterpartyNode").remove()}),$("input.mask-integer_12").mask("099999999999"),$("input.mask-integer_4").mask("0999"),$("input.mask-float_7_2").mask("0999999C09"),$universalMassiveUpload_index.initAjaxForm(),$universalMassiveUpload_index.initTimePickers(),$universalMassiveUpload_index.initDeleteButtons(),$universalMassiveUpload_index.initFormSubmitButton()},initTimePickers:function(){$(".initDT").datetimepicker({autoclose:!0,minView:3,maxView:3,clearBtn:!0,language:"uk",pickerPosition:"bottom-left",weekStart:1,format:"dd.mm.yyyy"});var e=["dateCreated","dateSended","dateDelivered","dateReceipt"];$.each(e,function(e,t){$("#"+t+"From").datetimepicker().on("changeDate",function(){var e=$("#"+t+"From"),n=e.val().split(/\./),r=new Date(n[2],n[1]-1,n[0]),i=$("#"+t+"To");if(r instanceof Date&&!isNaN(r.getTime())){if(""!=i.val()){var a=i.val().split(/\./),o=new Date(a[2],a[1]-1,a[0]);parseInt(o.getTime())-parseInt(r.getTime())<0&&i.datetimepicker("setDate",r)}i.datetimepicker("setStartDate",r),i.datetimepicker("update")}})});var e=["Weight","Cost","SeatsAmount","CostOnSite"];$.each(e,function(e,t){$("#"+t+"From").on("blur",function(){var e=$("#"+t+"From"),n=$("#"+t+"To");""==n.val()||isNaN(n.val())||parseInt(n.val())-parseInt(e.val())<0&&n.val(e.val())})})},initFormSubmitButton:function(){var e=!1,t=!1;$("#formSubmit").on("click",function(n){console.log("formSubmit clicked"),console.log(e),console.log(t),console.log($universalMassiveUpload_index._selectedCounterpartiesCount),n.preventDefault(),e===!0&&$universalMassiveUpload_index._selectedCounterpartiesCount>0?$("#UniversalForm").submit():noty("Некоторые поля остались не заполненными. Должен быть указан файл и выбран контрагент-отправитель.")}),$("#file1").on("change",function(){e=!0}),$("#file2").on("change",function(){t=!0})},initDeleteButtons:function(){$(".removeReport").on("click",function(){if(confirm(Yii.t("reports","Вы подтверждаете удаление?"))){var e=$(this).data("ref");return window.location.pathname=Yii.app.createUrl("reports/removeReport",{Ref:e}),!0}return!1})},senderSelectButton:function(){if("Sender"!=$universalMassiveUpload_index._processedCounterpartyType){$universalMassiveUpload_index._processedCounterpartyType="Sender",$counterparties.counterpartyProperty="Sender";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),n=$("#SenderAddressRef").val(),r=$("#SenderContactRef").val();$counterparties.clear_lists(t,n,r,e)}},recipientSelectButton:function(){if("Recipient"!=$universalMassiveUpload_index._processedCounterpartyType){$universalMassiveUpload_index._processedCounterpartyType="Recipient",$counterparties.counterpartyProperty="Recipient";var e=$("#SenderCityText").text(),t=$("#SenderCounterpartyRef").val(),n=$("#SenderAddressRef").val(),r=$("#SenderContactRef").val();$counterparties.clear_lists(t,n,r,e)}},addCounterparty:function(e,t,n,r){var i="",a=document.createElement("div");if(void 0!==e){var o=document.createElement("input");o.type="hidden",o.name=""+$universalMassiveUpload_index._processedCounterpartyType+"Counterparties[CityRef]",o.value=e.ref,a.appendChild(o),i+=e.description}if(void 0!==t){var o=document.createElement("input");o.type="hidden",o.name=""+$universalMassiveUpload_index._processedCounterpartyType+"Counterparties[CounterpartyRef]",o.value=t.ref,a.appendChild(o),i+=", "+t.description}if(void 0!==n){var o=document.createElement("input");o.type="hidden",o.name=""+$universalMassiveUpload_index._processedCounterpartyType+"Counterparties[AddressRef]",o.value=n.ref,a.appendChild(o);var o=document.createElement("input");o.type="hidden",o.name=""+$universalMassiveUpload_index._processedCounterpartyType+"Counterparties[IsWarehouse]",o.value="true"==n.warehouse?1:0,a.appendChild(o),i+=", "+n.description}if(void 0!==r){var o=document.createElement("input");o.type="hidden",o.name=""+$universalMassiveUpload_index._processedCounterpartyType+"Counterparties[ContactRef]",o.value=r.ref,a.appendChild(o),i+=", "+r.description}if(""!==i){var s=document.createElement("div");s.className="counterpartyTitle",s.innerHTML=i,a.appendChild(s)}""!==i&&(document.getElementById($universalMassiveUpload_index._processedCounterpartyType+"CounterpartiesData").appendChild(a),$universalMassiveUpload_index._selectedCounterpartiesCount++),$(".addSenderCounterparty").hide()},fillSelectedCounterparty:function(){var e=$counterparties.get_filled_element("cities_ul"),t=$counterparties.get_filled_element("counterparties_ul"),n=$counterparties.get_filled_element("address_ul"),r=$counterparties.get_filled_element("contacts_ul");$universalMassiveUpload_index.addCounterparty(e,t,n,r),$("#selectCounterpartyModal").modal("hide")},initAjaxForm:function(){var e=!1;$("#CreateNewReport").ajaxForm({beforeSubmit:function(){e||(e=!0)},success:function(e){$(".control-group").removeClass("error"),null!=e&&void 0!=e.success&&e.success===!0?$("#documentCreatedReport").modal().show():null!=e&&void 0!=e.success&&e.success===!1?$.each(e.errors,function(e,t){""!=t&&noty(Yii.t("reports/js",t))}):noty(Yii.t("reports/js","Произошла неизвестная ошибка. Попробуйте снова позже."))},complete:function(){e=!1},error:function(){e=!1}})}};
var $warehouses={cityRef:"",addressRefToSelect:"",init:function(){var e,t;clearTimeout(e);var a=($("#warehous_ul").find("li.active").attr("data-ref"),$warehouses.cityRef);e=setTimeout(function(){var e={CityRef:a};$warehouses.load_list_rendered("GetWarehouse",e,"warehous_ul","filter_journal_warehous",t,$warehouses.addressRefToSelect)},1e3),$("#filter_journal_warehous").bind({keyup:function(){$(this).trigger("keypress"),clearTimeout(e);var a=$(this).val(),s=$warehouses.cityRef;e=setTimeout(function(){var e={CityRef:s,FindByString:a};$counterparties.load_list_rendered("GetWarehouse",e,"warehous_ul","filter_journal_warehous",t,$warehouses.addressRefToSelect)},1e3),$warehouses.addressRefToSelect=""}}),$("#warehous_ul").on("click","li.browser_element_main",function(){var e=$(this);if(!e.hasClass("active")){{e.attr("data-ref")}e.parent().find("li.active").removeClass("active"),e.addClass("active")}$warehouses.check_address_filled()}),$warehouses.addressRefToSelect=""},load_list_rendered:function(e,t,a,s,r,i){i=i||0;var l=$("#"+a);return null!=r&&r.abort(),r=$.ajax({url:Yii.app.createUrl("counterparties/"+e,t),type:"get",dataType:"html",ifModified:!0,beforeSend:function(){l.html("").css("opacity",0),$("#"+a).parent().addClass("loading"),$warehouses.check_fields_filled()},success:function(e){l.html(e),$warehouses.select_element(a,i),$warehouses.check_fields_filled()},error:function(e){"abort"!=e.statusText&&noty(Yii.t("counterparties/js","Возникла ошибка"))},complete:function(){$("#"+a).parent().removeClass("loading"),l.css("opacity",1)}})},check_address_filled:function(){var e=$("#warehous_ul").find("li.active");return e.length>0&&e.data("warehouse")?($("#selectWarehousModalButton").removeClass("disabled"),!0):($("#selectWarehousModalButton").addClass("disabled"),!1)},check_fields_filled:function(){var e=$("#warehous_ul").find("li.active");return $warehouses.check_address_filled(),e.length>0?($("#selectCounterpartyButton").removeClass("disabled"),!0):($("#selectCounterpartyButton").addClass("disabled"),!1)},select_element:function(e,t){t=t||0;var a,s=$("#"+e);""==t||0==t?a=s.find("li.browser_element_main").first():(liSelectElement='li.browser_element_main[data-ref="'+t+'"]',a=s.find(liSelectElement)),a.trigger("click")},get_filled_element:function(e,t){if(t)var a=$("#"+e+"> li").filter('[data-ref="'+t+'"]');else var a=$("#"+e).find("li.active");return a.data()},clear_lists:function(e,t){$warehouses.addressRefToSelect=e,$warehouses.cityRef=t,$warehouses.check_fields_filled()}};